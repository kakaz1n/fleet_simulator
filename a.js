/*! jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license */
!function (e, t) { "use strict"; "object" == typeof module && "object" == typeof module.exports ? module.exports = e.document ? t(e, !0) : function (e) { if (!e.document) throw new Error("jQuery requires a window with a document"); return t(e) } : t(e) }("undefined" != typeof window ? window : this, (function (e, t) { "use strict"; var n = [], r = e.document, i = Object.getPrototypeOf, o = n.slice, a = n.concat, s = n.push, u = n.indexOf, l = {}, c = l.toString, f = l.hasOwnProperty, p = f.toString, d = p.call(Object), h = {}; function g(e, t) { var n = (t = t || r).createElement("script"); n.text = e, t.head.appendChild(n).parentNode.removeChild(n) } var v = "3.1.1", m = function (e, t) { return new m.fn.init(e, t) }, y = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, x = /^-ms-/, b = /-([a-z])/g, w = function (e, t) { return t.toUpperCase() }; function T(e) { var t = !!e && "length" in e && e.length, n = m.type(e); return "function" !== n && !m.isWindow(e) && ("array" === n || 0 === t || "number" == typeof t && t > 0 && t - 1 in e) } m.fn = m.prototype = { jquery: v, constructor: m, length: 0, toArray: function () { return o.call(this) }, get: function (e) { return null == e ? o.call(this) : e < 0 ? this[e + this.length] : this[e] }, pushStack: function (e) { var t = m.merge(this.constructor(), e); return t.prevObject = this, t }, each: function (e) { return m.each(this, e) }, map: function (e) { return this.pushStack(m.map(this, (function (t, n) { return e.call(t, n, t) }))) }, slice: function () { return this.pushStack(o.apply(this, arguments)) }, first: function () { return this.eq(0) }, last: function () { return this.eq(-1) }, eq: function (e) { var t = this.length, n = +e + (e < 0 ? t : 0); return this.pushStack(n >= 0 && n < t ? [this[n]] : []) }, end: function () { return this.prevObject || this.constructor() }, push: s, sort: n.sort, splice: n.splice }, m.extend = m.fn.extend = function () { var e, t, n, r, i, o, a = arguments[0] || {}, s = 1, u = arguments.length, l = !1; for ("boolean" == typeof a && (l = a, a = arguments[s] || {}, s++), "object" == typeof a || m.isFunction(a) || (a = {}), s === u && (a = this, s--); s < u; s++)if (null != (e = arguments[s])) for (t in e) n = a[t], a !== (r = e[t]) && (l && r && (m.isPlainObject(r) || (i = m.isArray(r))) ? (i ? (i = !1, o = n && m.isArray(n) ? n : []) : o = n && m.isPlainObject(n) ? n : {}, a[t] = m.extend(l, o, r)) : void 0 !== r && (a[t] = r)); return a }, m.extend({ expando: "jQuery" + (v + Math.random()).replace(/\D/g, ""), isReady: !0, error: function (e) { throw new Error(e) }, noop: function () { }, isFunction: function (e) { return "function" === m.type(e) }, isArray: Array.isArray, isWindow: function (e) { return null != e && e === e.window }, isNumeric: function (e) { var t = m.type(e); return ("number" === t || "string" === t) && !isNaN(e - parseFloat(e)) }, isPlainObject: function (e) { var t, n; return !(!e || "[object Object]" !== c.call(e) || (t = i(e)) && (n = f.call(t, "constructor") && t.constructor, "function" != typeof n || p.call(n) !== d)) }, isEmptyObject: function (e) { var t; for (t in e) return !1; return !0 }, type: function (e) { return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? l[c.call(e)] || "object" : typeof e }, globalEval: function (e) { g(e) }, camelCase: function (e) { return e.replace(x, "ms-").replace(b, w) }, nodeName: function (e, t) { return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase() }, each: function (e, t) { var n, r = 0; if (T(e)) for (n = e.length; r < n && !1 !== t.call(e[r], r, e[r]); r++); else for (r in e) if (!1 === t.call(e[r], r, e[r])) break; return e }, trim: function (e) { return null == e ? "" : (e + "").replace(y, "") }, makeArray: function (e, t) { var n = t || []; return null != e && (T(Object(e)) ? m.merge(n, "string" == typeof e ? [e] : e) : s.call(n, e)), n }, inArray: function (e, t, n) { return null == t ? -1 : u.call(t, e, n) }, merge: function (e, t) { for (var n = +t.length, r = 0, i = e.length; r < n; r++)e[i++] = t[r]; return e.length = i, e }, grep: function (e, t, n) { for (var r = [], i = 0, o = e.length, a = !n; i < o; i++)!t(e[i], i) !== a && r.push(e[i]); return r }, map: function (e, t, n) { var r, i, o = 0, s = []; if (T(e)) for (r = e.length; o < r; o++)null != (i = t(e[o], o, n)) && s.push(i); else for (o in e) null != (i = t(e[o], o, n)) && s.push(i); return a.apply([], s) }, guid: 1, proxy: function (e, t) { var n, r, i; if ("string" == typeof t && (n = e[t], t = e, e = n), m.isFunction(e)) return r = o.call(arguments, 2), (i = function () { return e.apply(t || this, r.concat(o.call(arguments))) }).guid = e.guid = e.guid || m.guid++, i }, now: Date.now, support: h }), "function" == typeof Symbol && (m.fn[Symbol.iterator] = n[Symbol.iterator]), m.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), (function (e, t) { l["[object " + t + "]"] = t.toLowerCase() })); var C = function (e) { var t, n, r, i, o, a, s, u, l, c, f, p, d, h, g, v, m, y, x, b = "sizzle" + 1 * new Date, w = e.document, T = 0, C = 0, E = ae(), k = ae(), N = ae(), S = function (e, t) { return e === t && (f = !0), 0 }, D = {}.hasOwnProperty, j = [], A = j.pop, q = j.push, L = j.push, H = j.slice, F = function (e, t) { for (var n = 0, r = e.length; n < r; n++)if (e[n] === t) return n; return -1 }, O = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", P = "[\\x20\\t\\r\\n\\f]", R = "(?:\\\\.|[\\w-]|[^\0-\\xa0])+", M = "\\[" + P + "*(" + R + ")(?:" + P + "*([*^$|!~]?=)" + P + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + R + "))|)" + P + "*\\]", I = ":(" + R + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + M + ")*)|.*)\\)|)", W = new RegExp(P + "+", "g"), $ = new RegExp("^" + P + "+|((?:^|[^\\\\])(?:\\\\.)*)" + P + "+$", "g"), B = new RegExp("^" + P + "*," + P + "*"), _ = new RegExp("^" + P + "*([>+~]|" + P + ")" + P + "*"), z = new RegExp("=" + P + "*([^\\]'\"]*?)" + P + "*\\]", "g"), X = new RegExp(I), U = new RegExp("^" + R + "$"), V = { ID: new RegExp("^#(" + R + ")"), CLASS: new RegExp("^\\.(" + R + ")"), TAG: new RegExp("^(" + R + "|[*])"), ATTR: new RegExp("^" + M), PSEUDO: new RegExp("^" + I), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + P + "*(even|odd|(([+-]|)(\\d*)n|)" + P + "*(?:([+-]|)" + P + "*(\\d+)|))" + P + "*\\)|)", "i"), bool: new RegExp("^(?:" + O + ")$", "i"), needsContext: new RegExp("^" + P + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + P + "*((?:-\\d)?\\d*)" + P + "*\\)|)(?=[^-]|$)", "i") }, G = /^(?:input|select|textarea|button)$/i, Y = /^h\d$/i, Q = /^[^{]+\{\s*\[native \w/, J = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, K = /[+~]/, Z = new RegExp("\\\\([\\da-f]{1,6}" + P + "?|(" + P + ")|.)", "ig"), ee = function (e, t, n) { var r = "0x" + t - 65536; return r != r || n ? t : r < 0 ? String.fromCharCode(r + 65536) : String.fromCharCode(r >> 10 | 55296, 1023 & r | 56320) }, te = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g, ne = function (e, t) { return t ? "\0" === e ? "ï¿½" : e.slice(0, -1) + "\\" + e.charCodeAt(e.length - 1).toString(16) + " " : "\\" + e }, re = function () { p() }, ie = ye((function (e) { return !0 === e.disabled && ("form" in e || "label" in e) }), { dir: "parentNode", next: "legend" }); try { L.apply(j = H.call(w.childNodes), w.childNodes), j[w.childNodes.length].nodeType } catch (e) { L = { apply: j.length ? function (e, t) { q.apply(e, H.call(t)) } : function (e, t) { for (var n = e.length, r = 0; e[n++] = t[r++];); e.length = n - 1 } } } function oe(e, t, r, i) { var o, s, l, c, f, h, m, y = t && t.ownerDocument, T = t ? t.nodeType : 9; if (r = r || [], "string" != typeof e || !e || 1 !== T && 9 !== T && 11 !== T) return r; if (!i && ((t ? t.ownerDocument || t : w) !== d && p(t), t = t || d, g)) { if (11 !== T && (f = J.exec(e))) if (o = f[1]) { if (9 === T) { if (!(l = t.getElementById(o))) return r; if (l.id === o) return r.push(l), r } else if (y && (l = y.getElementById(o)) && x(t, l) && l.id === o) return r.push(l), r } else { if (f[2]) return L.apply(r, t.getElementsByTagName(e)), r; if ((o = f[3]) && n.getElementsByClassName && t.getElementsByClassName) return L.apply(r, t.getElementsByClassName(o)), r } if (n.qsa && !N[e + " "] && (!v || !v.test(e))) { if (1 !== T) y = t, m = e; else if ("object" !== t.nodeName.toLowerCase()) { for ((c = t.getAttribute("id")) ? c = c.replace(te, ne) : t.setAttribute("id", c = b), s = (h = a(e)).length; s--;)h[s] = "#" + c + " " + me(h[s]); m = h.join(","), y = K.test(e) && ge(t.parentNode) || t } if (m) try { return L.apply(r, y.querySelectorAll(m)), r } catch (e) { } finally { c === b && t.removeAttribute("id") } } } return u(e.replace($, "$1"), t, r, i) } function ae() { var e = []; return function t(n, i) { return e.push(n + " ") > r.cacheLength && delete t[e.shift()], t[n + " "] = i } } function se(e) { return e[b] = !0, e } function ue(e) { var t = d.createElement("fieldset"); try { return !!e(t) } catch (e) { return !1 } finally { t.parentNode && t.parentNode.removeChild(t), t = null } } function le(e, t) { for (var n = e.split("|"), i = n.length; i--;)r.attrHandle[n[i]] = t } function ce(e, t) { var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && e.sourceIndex - t.sourceIndex; if (r) return r; if (n) for (; n = n.nextSibling;)if (n === t) return -1; return e ? 1 : -1 } function fe(e) { return function (t) { return "input" === t.nodeName.toLowerCase() && t.type === e } } function pe(e) { return function (t) { var n = t.nodeName.toLowerCase(); return ("input" === n || "button" === n) && t.type === e } } function de(e) { return function (t) { return "form" in t ? t.parentNode && !1 === t.disabled ? "label" in t ? "label" in t.parentNode ? t.parentNode.disabled === e : t.disabled === e : t.isDisabled === e || t.isDisabled !== !e && ie(t) === e : t.disabled === e : "label" in t && t.disabled === e } } function he(e) { return se((function (t) { return t = +t, se((function (n, r) { for (var i, o = e([], n.length, t), a = o.length; a--;)n[i = o[a]] && (n[i] = !(r[i] = n[i])) })) })) } function ge(e) { return e && void 0 !== e.getElementsByTagName && e } for (t in n = oe.support = {}, o = oe.isXML = function (e) { var t = e && (e.ownerDocument || e).documentElement; return !!t && "HTML" !== t.nodeName }, p = oe.setDocument = function (e) { var t, i, a = e ? e.ownerDocument || e : w; return a !== d && 9 === a.nodeType && a.documentElement ? (h = (d = a).documentElement, g = !o(d), w !== d && (i = d.defaultView) && i.top !== i && (i.addEventListener ? i.addEventListener("unload", re, !1) : i.attachEvent && i.attachEvent("onunload", re)), n.attributes = ue((function (e) { return e.className = "i", !e.getAttribute("className") })), n.getElementsByTagName = ue((function (e) { return e.appendChild(d.createComment("")), !e.getElementsByTagName("*").length })), n.getElementsByClassName = Q.test(d.getElementsByClassName), n.getById = ue((function (e) { return h.appendChild(e).id = b, !d.getElementsByName || !d.getElementsByName(b).length })), n.getById ? (r.filter.ID = function (e) { var t = e.replace(Z, ee); return function (e) { return e.getAttribute("id") === t } }, r.find.ID = function (e, t) { if (void 0 !== t.getElementById && g) { var n = t.getElementById(e); return n ? [n] : [] } }) : (r.filter.ID = function (e) { var t = e.replace(Z, ee); return function (e) { var n = void 0 !== e.getAttributeNode && e.getAttributeNode("id"); return n && n.value === t } }, r.find.ID = function (e, t) { if (void 0 !== t.getElementById && g) { var n, r, i, o = t.getElementById(e); if (o) { if ((n = o.getAttributeNode("id")) && n.value === e) return [o]; for (i = t.getElementsByName(e), r = 0; o = i[r++];)if ((n = o.getAttributeNode("id")) && n.value === e) return [o] } return [] } }), r.find.TAG = n.getElementsByTagName ? function (e, t) { return void 0 !== t.getElementsByTagName ? t.getElementsByTagName(e) : n.qsa ? t.querySelectorAll(e) : void 0 } : function (e, t) { var n, r = [], i = 0, o = t.getElementsByTagName(e); if ("*" === e) { for (; n = o[i++];)1 === n.nodeType && r.push(n); return r } return o }, r.find.CLASS = n.getElementsByClassName && function (e, t) { if (void 0 !== t.getElementsByClassName && g) return t.getElementsByClassName(e) }, m = [], v = [], (n.qsa = Q.test(d.querySelectorAll)) && (ue((function (e) { h.appendChild(e).innerHTML = "<a id='" + b + "'></a><select id='" + b + "-\r\\' msallowcapture=''><option selected=''></option></select>", e.querySelectorAll("[msallowcapture^='']").length && v.push("[*^$]=" + P + "*(?:''|\"\")"), e.querySelectorAll("[selected]").length || v.push("\\[" + P + "*(?:value|" + O + ")"), e.querySelectorAll("[id~=" + b + "-]").length || v.push("~="), e.querySelectorAll(":checked").length || v.push(":checked"), e.querySelectorAll("a#" + b + "+*").length || v.push(".#.+[+~]") })), ue((function (e) { e.innerHTML = "<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>"; var t = d.createElement("input"); t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("name", "D"), e.querySelectorAll("[name=d]").length && v.push("name" + P + "*[*^$|!~]?="), 2 !== e.querySelectorAll(":enabled").length && v.push(":enabled", ":disabled"), h.appendChild(e).disabled = !0, 2 !== e.querySelectorAll(":disabled").length && v.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), v.push(",.*:") }))), (n.matchesSelector = Q.test(y = h.matches || h.webkitMatchesSelector || h.mozMatchesSelector || h.oMatchesSelector || h.msMatchesSelector)) && ue((function (e) { n.disconnectedMatch = y.call(e, "*"), y.call(e, "[s!='']:x"), m.push("!=", I) })), v = v.length && new RegExp(v.join("|")), m = m.length && new RegExp(m.join("|")), t = Q.test(h.compareDocumentPosition), x = t || Q.test(h.contains) ? function (e, t) { var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode; return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r))) } : function (e, t) { if (t) for (; t = t.parentNode;)if (t === e) return !0; return !1 }, S = t ? function (e, t) { if (e === t) return f = !0, 0; var r = !e.compareDocumentPosition - !t.compareDocumentPosition; return r || (1 & (r = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1) || !n.sortDetached && t.compareDocumentPosition(e) === r ? e === d || e.ownerDocument === w && x(w, e) ? -1 : t === d || t.ownerDocument === w && x(w, t) ? 1 : c ? F(c, e) - F(c, t) : 0 : 4 & r ? -1 : 1) } : function (e, t) { if (e === t) return f = !0, 0; var n, r = 0, i = e.parentNode, o = t.parentNode, a = [e], s = [t]; if (!i || !o) return e === d ? -1 : t === d ? 1 : i ? -1 : o ? 1 : c ? F(c, e) - F(c, t) : 0; if (i === o) return ce(e, t); for (n = e; n = n.parentNode;)a.unshift(n); for (n = t; n = n.parentNode;)s.unshift(n); for (; a[r] === s[r];)r++; return r ? ce(a[r], s[r]) : a[r] === w ? -1 : s[r] === w ? 1 : 0 }, d) : d }, oe.matches = function (e, t) { return oe(e, null, null, t) }, oe.matchesSelector = function (e, t) { if ((e.ownerDocument || e) !== d && p(e), t = t.replace(z, "='$1']"), n.matchesSelector && g && !N[t + " "] && (!m || !m.test(t)) && (!v || !v.test(t))) try { var r = y.call(e, t); if (r || n.disconnectedMatch || e.document && 11 !== e.document.nodeType) return r } catch (e) { } return oe(t, d, null, [e]).length > 0 }, oe.contains = function (e, t) { return (e.ownerDocument || e) !== d && p(e), x(e, t) }, oe.attr = function (e, t) { (e.ownerDocument || e) !== d && p(e); var i = r.attrHandle[t.toLowerCase()], o = i && D.call(r.attrHandle, t.toLowerCase()) ? i(e, t, !g) : void 0; return void 0 !== o ? o : n.attributes || !g ? e.getAttribute(t) : (o = e.getAttributeNode(t)) && o.specified ? o.value : null }, oe.escape = function (e) { return (e + "").replace(te, ne) }, oe.error = function (e) { throw new Error("Syntax error, unrecognized expression: " + e) }, oe.uniqueSort = function (e) { var t, r = [], i = 0, o = 0; if (f = !n.detectDuplicates, c = !n.sortStable && e.slice(0), e.sort(S), f) { for (; t = e[o++];)t === e[o] && (i = r.push(o)); for (; i--;)e.splice(r[i], 1) } return c = null, e }, i = oe.getText = function (e) { var t, n = "", r = 0, o = e.nodeType; if (o) { if (1 === o || 9 === o || 11 === o) { if ("string" == typeof e.textContent) return e.textContent; for (e = e.firstChild; e; e = e.nextSibling)n += i(e) } else if (3 === o || 4 === o) return e.nodeValue } else for (; t = e[r++];)n += i(t); return n }, (r = oe.selectors = { cacheLength: 50, createPseudo: se, match: V, attrHandle: {}, find: {}, relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling" } }, preFilter: { ATTR: function (e) { return e[1] = e[1].replace(Z, ee), e[3] = (e[3] || e[4] || e[5] || "").replace(Z, ee), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4) }, CHILD: function (e) { return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || oe.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && oe.error(e[0]), e }, PSEUDO: function (e) { var t, n = !e[6] && e[2]; return V.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && X.test(n) && (t = a(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3)) } }, filter: { TAG: function (e) { var t = e.replace(Z, ee).toLowerCase(); return "*" === e ? function () { return !0 } : function (e) { return e.nodeName && e.nodeName.toLowerCase() === t } }, CLASS: function (e) { var t = E[e + " "]; return t || (t = new RegExp("(^|" + P + ")" + e + "(" + P + "|$)")) && E(e, (function (e) { return t.test("string" == typeof e.className && e.className || void 0 !== e.getAttribute && e.getAttribute("class") || "") })) }, ATTR: function (e, t, n) { return function (r) { var i = oe.attr(r, e); return null == i ? "!=" === t : !t || (i += "", "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && i.indexOf(n) > -1 : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? (" " + i.replace(W, " ") + " ").indexOf(n) > -1 : "|=" === t && (i === n || i.slice(0, n.length + 1) === n + "-")) } }, CHILD: function (e, t, n, r, i) { var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t; return 1 === r && 0 === i ? function (e) { return !!e.parentNode } : function (t, n, u) { var l, c, f, p, d, h, g = o !== a ? "nextSibling" : "previousSibling", v = t.parentNode, m = s && t.nodeName.toLowerCase(), y = !u && !s, x = !1; if (v) { if (o) { for (; g;) { for (p = t; p = p[g];)if (s ? p.nodeName.toLowerCase() === m : 1 === p.nodeType) return !1; h = g = "only" === e && !h && "nextSibling" } return !0 } if (h = [a ? v.firstChild : v.lastChild], a && y) { for (x = (d = (l = (c = (f = (p = v)[b] || (p[b] = {}))[p.uniqueID] || (f[p.uniqueID] = {}))[e] || [])[0] === T && l[1]) && l[2], p = d && v.childNodes[d]; p = ++d && p && p[g] || (x = d = 0) || h.pop();)if (1 === p.nodeType && ++x && p === t) { c[e] = [T, d, x]; break } } else if (y && (x = d = (l = (c = (f = (p = t)[b] || (p[b] = {}))[p.uniqueID] || (f[p.uniqueID] = {}))[e] || [])[0] === T && l[1]), !1 === x) for (; (p = ++d && p && p[g] || (x = d = 0) || h.pop()) && ((s ? p.nodeName.toLowerCase() !== m : 1 !== p.nodeType) || !++x || (y && ((c = (f = p[b] || (p[b] = {}))[p.uniqueID] || (f[p.uniqueID] = {}))[e] = [T, x]), p !== t));); return (x -= i) === r || x % r == 0 && x / r >= 0 } } }, PSEUDO: function (e, t) { var n, i = r.pseudos[e] || r.setFilters[e.toLowerCase()] || oe.error("unsupported pseudo: " + e); return i[b] ? i(t) : i.length > 1 ? (n = [e, e, "", t], r.setFilters.hasOwnProperty(e.toLowerCase()) ? se((function (e, n) { for (var r, o = i(e, t), a = o.length; a--;)e[r = F(e, o[a])] = !(n[r] = o[a]) })) : function (e) { return i(e, 0, n) }) : i } }, pseudos: { not: se((function (e) { var t = [], n = [], r = s(e.replace($, "$1")); return r[b] ? se((function (e, t, n, i) { for (var o, a = r(e, null, i, []), s = e.length; s--;)(o = a[s]) && (e[s] = !(t[s] = o)) })) : function (e, i, o) { return t[0] = e, r(t, null, o, n), t[0] = null, !n.pop() } })), has: se((function (e) { return function (t) { return oe(e, t).length > 0 } })), contains: se((function (e) { return e = e.replace(Z, ee), function (t) { return (t.textContent || t.innerText || i(t)).indexOf(e) > -1 } })), lang: se((function (e) { return U.test(e || "") || oe.error("unsupported lang: " + e), e = e.replace(Z, ee).toLowerCase(), function (t) { var n; do { if (n = g ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang")) return (n = n.toLowerCase()) === e || 0 === n.indexOf(e + "-") } while ((t = t.parentNode) && 1 === t.nodeType); return !1 } })), target: function (t) { var n = e.location && e.location.hash; return n && n.slice(1) === t.id }, root: function (e) { return e === h }, focus: function (e) { return e === d.activeElement && (!d.hasFocus || d.hasFocus()) && !!(e.type || e.href || ~e.tabIndex) }, enabled: de(!1), disabled: de(!0), checked: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && !!e.checked || "option" === t && !!e.selected }, selected: function (e) { return e.parentNode && e.parentNode.selectedIndex, !0 === e.selected }, empty: function (e) { for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeType < 6) return !1; return !0 }, parent: function (e) { return !r.pseudos.empty(e) }, header: function (e) { return Y.test(e.nodeName) }, input: function (e) { return G.test(e.nodeName) }, button: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && "button" === e.type || "button" === t }, text: function (e) { var t; return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase()) }, first: he((function () { return [0] })), last: he((function (e, t) { return [t - 1] })), eq: he((function (e, t, n) { return [n < 0 ? n + t : n] })), even: he((function (e, t) { for (var n = 0; n < t; n += 2)e.push(n); return e })), odd: he((function (e, t) { for (var n = 1; n < t; n += 2)e.push(n); return e })), lt: he((function (e, t, n) { for (var r = n < 0 ? n + t : n; --r >= 0;)e.push(r); return e })), gt: he((function (e, t, n) { for (var r = n < 0 ? n + t : n; ++r < t;)e.push(r); return e })) } }).pseudos.nth = r.pseudos.eq, { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) r.pseudos[t] = fe(t); for (t in { submit: !0, reset: !0 }) r.pseudos[t] = pe(t); function ve() { } function me(e) { for (var t = 0, n = e.length, r = ""; t < n; t++)r += e[t].value; return r } function ye(e, t, n) { var r = t.dir, i = t.next, o = i || r, a = n && "parentNode" === o, s = C++; return t.first ? function (t, n, i) { for (; t = t[r];)if (1 === t.nodeType || a) return e(t, n, i); return !1 } : function (t, n, u) { var l, c, f, p = [T, s]; if (u) { for (; t = t[r];)if ((1 === t.nodeType || a) && e(t, n, u)) return !0 } else for (; t = t[r];)if (1 === t.nodeType || a) if (c = (f = t[b] || (t[b] = {}))[t.uniqueID] || (f[t.uniqueID] = {}), i && i === t.nodeName.toLowerCase()) t = t[r] || t; else { if ((l = c[o]) && l[0] === T && l[1] === s) return p[2] = l[2]; if (c[o] = p, p[2] = e(t, n, u)) return !0 } return !1 } } function xe(e) { return e.length > 1 ? function (t, n, r) { for (var i = e.length; i--;)if (!e[i](t, n, r)) return !1; return !0 } : e[0] } function be(e, t, n, r, i) { for (var o, a = [], s = 0, u = e.length, l = null != t; s < u; s++)(o = e[s]) && (n && !n(o, r, i) || (a.push(o), l && t.push(s))); return a } function we(e, t, n, r, i, o) { return r && !r[b] && (r = we(r)), i && !i[b] && (i = we(i, o)), se((function (o, a, s, u) { var l, c, f, p = [], d = [], h = a.length, g = o || function (e, t, n) { for (var r = 0, i = t.length; r < i; r++)oe(e, t[r], n); return n }(t || "*", s.nodeType ? [s] : s, []), v = !e || !o && t ? g : be(g, p, e, s, u), m = n ? i || (o ? e : h || r) ? [] : a : v; if (n && n(v, m, s, u), r) for (l = be(m, d), r(l, [], s, u), c = l.length; c--;)(f = l[c]) && (m[d[c]] = !(v[d[c]] = f)); if (o) { if (i || e) { if (i) { for (l = [], c = m.length; c--;)(f = m[c]) && l.push(v[c] = f); i(null, m = [], l, u) } for (c = m.length; c--;)(f = m[c]) && (l = i ? F(o, f) : p[c]) > -1 && (o[l] = !(a[l] = f)) } } else m = be(m === a ? m.splice(h, m.length) : m), i ? i(null, a, m, u) : L.apply(a, m) })) } function Te(e) { for (var t, n, i, o = e.length, a = r.relative[e[0].type], s = a || r.relative[" "], u = a ? 1 : 0, c = ye((function (e) { return e === t }), s, !0), f = ye((function (e) { return F(t, e) > -1 }), s, !0), p = [function (e, n, r) { var i = !a && (r || n !== l) || ((t = n).nodeType ? c(e, n, r) : f(e, n, r)); return t = null, i }]; u < o; u++)if (n = r.relative[e[u].type]) p = [ye(xe(p), n)]; else { if ((n = r.filter[e[u].type].apply(null, e[u].matches))[b]) { for (i = ++u; i < o && !r.relative[e[i].type]; i++); return we(u > 1 && xe(p), u > 1 && me(e.slice(0, u - 1).concat({ value: " " === e[u - 2].type ? "*" : "" })).replace($, "$1"), n, u < i && Te(e.slice(u, i)), i < o && Te(e = e.slice(i)), i < o && me(e)) } p.push(n) } return xe(p) } function Ce(e, t) { var n = t.length > 0, i = e.length > 0, o = function (o, a, s, u, c) { var f, h, v, m = 0, y = "0", x = o && [], b = [], w = l, C = o || i && r.find.TAG("*", c), E = T += null == w ? 1 : Math.random() || .1, k = C.length; for (c && (l = a === d || a || c); y !== k && null != (f = C[y]); y++) { if (i && f) { for (h = 0, a || f.ownerDocument === d || (p(f), s = !g); v = e[h++];)if (v(f, a || d, s)) { u.push(f); break } c && (T = E) } n && ((f = !v && f) && m--, o && x.push(f)) } if (m += y, n && y !== m) { for (h = 0; v = t[h++];)v(x, b, a, s); if (o) { if (m > 0) for (; y--;)x[y] || b[y] || (b[y] = A.call(u)); b = be(b) } L.apply(u, b), c && !o && b.length > 0 && m + t.length > 1 && oe.uniqueSort(u) } return c && (T = E, l = w), x }; return n ? se(o) : o } return ve.prototype = r.filters = r.pseudos, r.setFilters = new ve, a = oe.tokenize = function (e, t) { var n, i, o, a, s, u, l, c = k[e + " "]; if (c) return t ? 0 : c.slice(0); for (s = e, u = [], l = r.preFilter; s;) { for (a in n && !(i = B.exec(s)) || (i && (s = s.slice(i[0].length) || s), u.push(o = [])), n = !1, (i = _.exec(s)) && (n = i.shift(), o.push({ value: n, type: i[0].replace($, " ") }), s = s.slice(n.length)), r.filter) !(i = V[a].exec(s)) || l[a] && !(i = l[a](i)) || (n = i.shift(), o.push({ value: n, type: a, matches: i }), s = s.slice(n.length)); if (!n) break } return t ? s.length : s ? oe.error(e) : k(e, u).slice(0) }, s = oe.compile = function (e, t) { var n, r = [], i = [], o = N[e + " "]; if (!o) { for (t || (t = a(e)), n = t.length; n--;)(o = Te(t[n]))[b] ? r.push(o) : i.push(o); (o = N(e, Ce(i, r))).selector = e } return o }, u = oe.select = function (e, t, n, i) { var o, u, l, c, f, p = "function" == typeof e && e, d = !i && a(e = p.selector || e); if (n = n || [], 1 === d.length) { if ((u = d[0] = d[0].slice(0)).length > 2 && "ID" === (l = u[0]).type && 9 === t.nodeType && g && r.relative[u[1].type]) { if (!(t = (r.find.ID(l.matches[0].replace(Z, ee), t) || [])[0])) return n; p && (t = t.parentNode), e = e.slice(u.shift().value.length) } for (o = V.needsContext.test(e) ? 0 : u.length; o-- && (l = u[o], !r.relative[c = l.type]);)if ((f = r.find[c]) && (i = f(l.matches[0].replace(Z, ee), K.test(u[0].type) && ge(t.parentNode) || t))) { if (u.splice(o, 1), !(e = i.length && me(u))) return L.apply(n, i), n; break } } return (p || s(e, d))(i, t, !g, n, !t || K.test(e) && ge(t.parentNode) || t), n }, n.sortStable = b.split("").sort(S).join("") === b, n.detectDuplicates = !!f, p(), n.sortDetached = ue((function (e) { return 1 & e.compareDocumentPosition(d.createElement("fieldset")) })), ue((function (e) { return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href") })) || le("type|href|height|width", (function (e, t, n) { if (!n) return e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2) })), n.attributes && ue((function (e) { return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value") })) || le("value", (function (e, t, n) { if (!n && "input" === e.nodeName.toLowerCase()) return e.defaultValue })), ue((function (e) { return null == e.getAttribute("disabled") })) || le(O, (function (e, t, n) { var r; if (!n) return !0 === e[t] ? t.toLowerCase() : (r = e.getAttributeNode(t)) && r.specified ? r.value : null })), oe }(e); m.find = C, m.expr = C.selectors, m.expr[":"] = m.expr.pseudos, m.uniqueSort = m.unique = C.uniqueSort, m.text = C.getText, m.isXMLDoc = C.isXML, m.contains = C.contains, m.escapeSelector = C.escape; var E = function (e, t, n) { for (var r = [], i = void 0 !== n; (e = e[t]) && 9 !== e.nodeType;)if (1 === e.nodeType) { if (i && m(e).is(n)) break; r.push(e) } return r }, k = function (e, t) { for (var n = []; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e); return n }, N = m.expr.match.needsContext, S = /^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i, D = /^.[^:#\[\.,]*$/; function j(e, t, n) { return m.isFunction(t) ? m.grep(e, (function (e, r) { return !!t.call(e, r, e) !== n })) : t.nodeType ? m.grep(e, (function (e) { return e === t !== n })) : "string" != typeof t ? m.grep(e, (function (e) { return u.call(t, e) > -1 !== n })) : D.test(t) ? m.filter(t, e, n) : (t = m.filter(t, e), m.grep(e, (function (e) { return u.call(t, e) > -1 !== n && 1 === e.nodeType }))) } m.filter = function (e, t, n) { var r = t[0]; return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === r.nodeType ? m.find.matchesSelector(r, e) ? [r] : [] : m.find.matches(e, m.grep(t, (function (e) { return 1 === e.nodeType }))) }, m.fn.extend({ find: function (e) { var t, n, r = this.length, i = this; if ("string" != typeof e) return this.pushStack(m(e).filter((function () { for (t = 0; t < r; t++)if (m.contains(i[t], this)) return !0 }))); for (n = this.pushStack([]), t = 0; t < r; t++)m.find(e, i[t], n); return r > 1 ? m.uniqueSort(n) : n }, filter: function (e) { return this.pushStack(j(this, e || [], !1)) }, not: function (e) { return this.pushStack(j(this, e || [], !0)) }, is: function (e) { return !!j(this, "string" == typeof e && N.test(e) ? m(e) : e || [], !1).length } }); var A, q = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/; (m.fn.init = function (e, t, n) { var i, o; if (!e) return this; if (n = n || A, "string" == typeof e) { if (!(i = "<" === e[0] && ">" === e[e.length - 1] && e.length >= 3 ? [null, e, null] : q.exec(e)) || !i[1] && t) return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e); if (i[1]) { if (t = t instanceof m ? t[0] : t, m.merge(this, m.parseHTML(i[1], t && t.nodeType ? t.ownerDocument || t : r, !0)), S.test(i[1]) && m.isPlainObject(t)) for (i in t) m.isFunction(this[i]) ? this[i](t[i]) : this.attr(i, t[i]); return this } return (o = r.getElementById(i[2])) && (this[0] = o, this.length = 1), this } return e.nodeType ? (this[0] = e, this.length = 1, this) : m.isFunction(e) ? void 0 !== n.ready ? n.ready(e) : e(m) : m.makeArray(e, this) }).prototype = m.fn, A = m(r); var L = /^(?:parents|prev(?:Until|All))/, H = { children: !0, contents: !0, next: !0, prev: !0 }; function F(e, t) { for (; (e = e[t]) && 1 !== e.nodeType;); return e } m.fn.extend({ has: function (e) { var t = m(e, this), n = t.length; return this.filter((function () { for (var e = 0; e < n; e++)if (m.contains(this, t[e])) return !0 })) }, closest: function (e, t) { var n, r = 0, i = this.length, o = [], a = "string" != typeof e && m(e); if (!N.test(e)) for (; r < i; r++)for (n = this[r]; n && n !== t; n = n.parentNode)if (n.nodeType < 11 && (a ? a.index(n) > -1 : 1 === n.nodeType && m.find.matchesSelector(n, e))) { o.push(n); break } return this.pushStack(o.length > 1 ? m.uniqueSort(o) : o) }, index: function (e) { return e ? "string" == typeof e ? u.call(m(e), this[0]) : u.call(this, e.jquery ? e[0] : e) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1 }, add: function (e, t) { return this.pushStack(m.uniqueSort(m.merge(this.get(), m(e, t)))) }, addBack: function (e) { return this.add(null == e ? this.prevObject : this.prevObject.filter(e)) } }), m.each({ parent: function (e) { var t = e.parentNode; return t && 11 !== t.nodeType ? t : null }, parents: function (e) { return E(e, "parentNode") }, parentsUntil: function (e, t, n) { return E(e, "parentNode", n) }, next: function (e) { return F(e, "nextSibling") }, prev: function (e) { return F(e, "previousSibling") }, nextAll: function (e) { return E(e, "nextSibling") }, prevAll: function (e) { return E(e, "previousSibling") }, nextUntil: function (e, t, n) { return E(e, "nextSibling", n) }, prevUntil: function (e, t, n) { return E(e, "previousSibling", n) }, siblings: function (e) { return k((e.parentNode || {}).firstChild, e) }, children: function (e) { return k(e.firstChild) }, contents: function (e) { return e.contentDocument || m.merge([], e.childNodes) } }, (function (e, t) { m.fn[e] = function (n, r) { var i = m.map(this, t, n); return "Until" !== e.slice(-5) && (r = n), r && "string" == typeof r && (i = m.filter(r, i)), this.length > 1 && (H[e] || m.uniqueSort(i), L.test(e) && i.reverse()), this.pushStack(i) } })); var O = /[^\x20\t\r\n\f]+/g; function P(e) { return e } function R(e) { throw e } function M(e, t, n) { var r; try { e && m.isFunction(r = e.promise) ? r.call(e).done(t).fail(n) : e && m.isFunction(r = e.then) ? r.call(e, t, n) : t.call(void 0, e) } catch (e) { n.call(void 0, e) } } m.Callbacks = function (e) { e = "string" == typeof e ? function (e) { var t = {}; return m.each(e.match(O) || [], (function (e, n) { t[n] = !0 })), t }(e) : m.extend({}, e); var t, n, r, i, o = [], a = [], s = -1, u = function () { for (i = e.once, r = t = !0; a.length; s = -1)for (n = a.shift(); ++s < o.length;)!1 === o[s].apply(n[0], n[1]) && e.stopOnFalse && (s = o.length, n = !1); e.memory || (n = !1), t = !1, i && (o = n ? [] : "") }, l = { add: function () { return o && (n && !t && (s = o.length - 1, a.push(n)), function t(n) { m.each(n, (function (n, r) { m.isFunction(r) ? e.unique && l.has(r) || o.push(r) : r && r.length && "string" !== m.type(r) && t(r) })) }(arguments), n && !t && u()), this }, remove: function () { return m.each(arguments, (function (e, t) { for (var n; (n = m.inArray(t, o, n)) > -1;)o.splice(n, 1), n <= s && s-- })), this }, has: function (e) { return e ? m.inArray(e, o) > -1 : o.length > 0 }, empty: function () { return o && (o = []), this }, disable: function () { return i = a = [], o = n = "", this }, disabled: function () { return !o }, lock: function () { return i = a = [], n || t || (o = n = ""), this }, locked: function () { return !!i }, fireWith: function (e, n) { return i || (n = [e, (n = n || []).slice ? n.slice() : n], a.push(n), t || u()), this }, fire: function () { return l.fireWith(this, arguments), this }, fired: function () { return !!r } }; return l }, m.extend({ Deferred: function (t) { var n = [["notify", "progress", m.Callbacks("memory"), m.Callbacks("memory"), 2], ["resolve", "done", m.Callbacks("once memory"), m.Callbacks("once memory"), 0, "resolved"], ["reject", "fail", m.Callbacks("once memory"), m.Callbacks("once memory"), 1, "rejected"]], r = "pending", i = { state: function () { return r }, always: function () { return o.done(arguments).fail(arguments), this }, catch: function (e) { return i.then(null, e) }, pipe: function () { var e = arguments; return m.Deferred((function (t) { m.each(n, (function (n, r) { var i = m.isFunction(e[r[4]]) && e[r[4]]; o[r[1]]((function () { var e = i && i.apply(this, arguments); e && m.isFunction(e.promise) ? e.promise().progress(t.notify).done(t.resolve).fail(t.reject) : t[r[0] + "With"](this, i ? [e] : arguments) })) })), e = null })).promise() }, then: function (t, r, i) { var o = 0; function a(t, n, r, i) { return function () { var s = this, u = arguments, l = function () { var e, l; if (!(t < o)) { if ((e = r.apply(s, u)) === n.promise()) throw new TypeError("Thenable self-resolution"); l = e && ("object" == typeof e || "function" == typeof e) && e.then, m.isFunction(l) ? i ? l.call(e, a(o, n, P, i), a(o, n, R, i)) : (o++, l.call(e, a(o, n, P, i), a(o, n, R, i), a(o, n, P, n.notifyWith))) : (r !== P && (s = void 0, u = [e]), (i || n.resolveWith)(s, u)) } }, c = i ? l : function () { try { l() } catch (e) { m.Deferred.exceptionHook && m.Deferred.exceptionHook(e, c.stackTrace), t + 1 >= o && (r !== R && (s = void 0, u = [e]), n.rejectWith(s, u)) } }; t ? c() : (m.Deferred.getStackHook && (c.stackTrace = m.Deferred.getStackHook()), e.setTimeout(c)) } } return m.Deferred((function (e) { n[0][3].add(a(0, e, m.isFunction(i) ? i : P, e.notifyWith)), n[1][3].add(a(0, e, m.isFunction(t) ? t : P)), n[2][3].add(a(0, e, m.isFunction(r) ? r : R)) })).promise() }, promise: function (e) { return null != e ? m.extend(e, i) : i } }, o = {}; return m.each(n, (function (e, t) { var a = t[2], s = t[5]; i[t[1]] = a.add, s && a.add((function () { r = s }), n[3 - e][2].disable, n[0][2].lock), a.add(t[3].fire), o[t[0]] = function () { return o[t[0] + "With"](this === o ? void 0 : this, arguments), this }, o[t[0] + "With"] = a.fireWith })), i.promise(o), t && t.call(o, o), o }, when: function (e) { var t = arguments.length, n = t, r = Array(n), i = o.call(arguments), a = m.Deferred(), s = function (e) { return function (n) { r[e] = this, i[e] = arguments.length > 1 ? o.call(arguments) : n, --t || a.resolveWith(r, i) } }; if (t <= 1 && (M(e, a.done(s(n)).resolve, a.reject), "pending" === a.state() || m.isFunction(i[n] && i[n].then))) return a.then(); for (; n--;)M(i[n], s(n), a.reject); return a.promise() } }); var I = /^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/; m.Deferred.exceptionHook = function (t, n) { e.console && e.console.warn && t && I.test(t.name) && e.console.warn("jQuery.Deferred exception: " + t.message, t.stack, n) }, m.readyException = function (t) { e.setTimeout((function () { throw t })) }; var W = m.Deferred(); function $() { r.removeEventListener("DOMContentLoaded", $), e.removeEventListener("load", $), m.ready() } m.fn.ready = function (e) { return W.then(e).catch((function (e) { m.readyException(e) })), this }, m.extend({ isReady: !1, readyWait: 1, holdReady: function (e) { e ? m.readyWait++ : m.ready(!0) }, ready: function (e) { (!0 === e ? --m.readyWait : m.isReady) || (m.isReady = !0, !0 !== e && --m.readyWait > 0 || W.resolveWith(r, [m])) } }), m.ready.then = W.then, "complete" === r.readyState || "loading" !== r.readyState && !r.documentElement.doScroll ? e.setTimeout(m.ready) : (r.addEventListener("DOMContentLoaded", $), e.addEventListener("load", $)); var B = function (e, t, n, r, i, o, a) { var s = 0, u = e.length, l = null == n; if ("object" === m.type(n)) for (s in i = !0, n) B(e, t, s, n[s], !0, o, a); else if (void 0 !== r && (i = !0, m.isFunction(r) || (a = !0), l && (a ? (t.call(e, r), t = null) : (l = t, t = function (e, t, n) { return l.call(m(e), n) })), t)) for (; s < u; s++)t(e[s], n, a ? r : r.call(e[s], s, t(e[s], n))); return i ? e : l ? t.call(e) : u ? t(e[0], n) : o }, _ = function (e) { return 1 === e.nodeType || 9 === e.nodeType || !+e.nodeType }; function z() { this.expando = m.expando + z.uid++ } z.uid = 1, z.prototype = { cache: function (e) { var t = e[this.expando]; return t || (t = {}, _(e) && (e.nodeType ? e[this.expando] = t : Object.defineProperty(e, this.expando, { value: t, configurable: !0 }))), t }, set: function (e, t, n) { var r, i = this.cache(e); if ("string" == typeof t) i[m.camelCase(t)] = n; else for (r in t) i[m.camelCase(r)] = t[r]; return i }, get: function (e, t) { return void 0 === t ? this.cache(e) : e[this.expando] && e[this.expando][m.camelCase(t)] }, access: function (e, t, n) { return void 0 === t || t && "string" == typeof t && void 0 === n ? this.get(e, t) : (this.set(e, t, n), void 0 !== n ? n : t) }, remove: function (e, t) { var n, r = e[this.expando]; if (void 0 !== r) { if (void 0 !== t) { m.isArray(t) ? t = t.map(m.camelCase) : t = (t = m.camelCase(t)) in r ? [t] : t.match(O) || [], n = t.length; for (; n--;)delete r[t[n]] } (void 0 === t || m.isEmptyObject(r)) && (e.nodeType ? e[this.expando] = void 0 : delete e[this.expando]) } }, hasData: function (e) { var t = e[this.expando]; return void 0 !== t && !m.isEmptyObject(t) } }; var X = new z, U = new z, V = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, G = /[A-Z]/g; function Y(e, t, n) { var r; if (void 0 === n && 1 === e.nodeType) if (r = "data-" + t.replace(G, "-$&").toLowerCase(), "string" == typeof (n = e.getAttribute(r))) { try { n = function (e) { return "true" === e || "false" !== e && ("null" === e ? null : e === +e + "" ? +e : V.test(e) ? JSON.parse(e) : e) }(n) } catch (e) { } U.set(e, t, n) } else n = void 0; return n } m.extend({ hasData: function (e) { return U.hasData(e) || X.hasData(e) }, data: function (e, t, n) { return U.access(e, t, n) }, removeData: function (e, t) { U.remove(e, t) }, _data: function (e, t, n) { return X.access(e, t, n) }, _removeData: function (e, t) { X.remove(e, t) } }), m.fn.extend({ data: function (e, t) { var n, r, i, o = this[0], a = o && o.attributes; if (void 0 === e) { if (this.length && (i = U.get(o), 1 === o.nodeType && !X.get(o, "hasDataAttrs"))) { for (n = a.length; n--;)a[n] && (0 === (r = a[n].name).indexOf("data-") && (r = m.camelCase(r.slice(5)), Y(o, r, i[r]))); X.set(o, "hasDataAttrs", !0) } return i } return "object" == typeof e ? this.each((function () { U.set(this, e) })) : B(this, (function (t) { var n; if (o && void 0 === t) { if (void 0 !== (n = U.get(o, e))) return n; if (void 0 !== (n = Y(o, e))) return n } else this.each((function () { U.set(this, e, t) })) }), null, t, arguments.length > 1, null, !0) }, removeData: function (e) { return this.each((function () { U.remove(this, e) })) } }), m.extend({ queue: function (e, t, n) { var r; if (e) return t = (t || "fx") + "queue", r = X.get(e, t), n && (!r || m.isArray(n) ? r = X.access(e, t, m.makeArray(n)) : r.push(n)), r || [] }, dequeue: function (e, t) { t = t || "fx"; var n = m.queue(e, t), r = n.length, i = n.shift(), o = m._queueHooks(e, t); "inprogress" === i && (i = n.shift(), r--), i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, (function () { m.dequeue(e, t) }), o)), !r && o && o.empty.fire() }, _queueHooks: function (e, t) { var n = t + "queueHooks"; return X.get(e, n) || X.access(e, n, { empty: m.Callbacks("once memory").add((function () { X.remove(e, [t + "queue", n]) })) }) } }), m.fn.extend({ queue: function (e, t) { var n = 2; return "string" != typeof e && (t = e, e = "fx", n--), arguments.length < n ? m.queue(this[0], e) : void 0 === t ? this : this.each((function () { var n = m.queue(this, e, t); m._queueHooks(this, e), "fx" === e && "inprogress" !== n[0] && m.dequeue(this, e) })) }, dequeue: function (e) { return this.each((function () { m.dequeue(this, e) })) }, clearQueue: function (e) { return this.queue(e || "fx", []) }, promise: function (e, t) { var n, r = 1, i = m.Deferred(), o = this, a = this.length, s = function () { --r || i.resolveWith(o, [o]) }; for ("string" != typeof e && (t = e, e = void 0), e = e || "fx"; a--;)(n = X.get(o[a], e + "queueHooks")) && n.empty && (r++, n.empty.add(s)); return s(), i.promise(t) } }); var Q = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, J = new RegExp("^(?:([+-])=|)(" + Q + ")([a-z%]*)$", "i"), K = ["Top", "Right", "Bottom", "Left"], Z = function (e, t) { return "none" === (e = t || e).style.display || "" === e.style.display && m.contains(e.ownerDocument, e) && "none" === m.css(e, "display") }, ee = function (e, t, n, r) { var i, o, a = {}; for (o in t) a[o] = e.style[o], e.style[o] = t[o]; for (o in i = n.apply(e, r || []), t) e.style[o] = a[o]; return i }; function te(e, t, n, r) { var i, o = 1, a = 20, s = r ? function () { return r.cur() } : function () { return m.css(e, t, "") }, u = s(), l = n && n[3] || (m.cssNumber[t] ? "" : "px"), c = (m.cssNumber[t] || "px" !== l && +u) && J.exec(m.css(e, t)); if (c && c[3] !== l) { l = l || c[3], n = n || [], c = +u || 1; do { c /= o = o || ".5", m.style(e, t, c + l) } while (o !== (o = s() / u) && 1 !== o && --a) } return n && (c = +c || +u || 0, i = n[1] ? c + (n[1] + 1) * n[2] : +n[2], r && (r.unit = l, r.start = c, r.end = i)), i } var ne = {}; function re(e) { var t, n = e.ownerDocument, r = e.nodeName, i = ne[r]; return i || (t = n.body.appendChild(n.createElement(r)), i = m.css(t, "display"), t.parentNode.removeChild(t), "none" === i && (i = "block"), ne[r] = i, i) } function ie(e, t) { for (var n, r, i = [], o = 0, a = e.length; o < a; o++)(r = e[o]).style && (n = r.style.display, t ? ("none" === n && (i[o] = X.get(r, "display") || null, i[o] || (r.style.display = "")), "" === r.style.display && Z(r) && (i[o] = re(r))) : "none" !== n && (i[o] = "none", X.set(r, "display", n))); for (o = 0; o < a; o++)null != i[o] && (e[o].style.display = i[o]); return e } m.fn.extend({ show: function () { return ie(this, !0) }, hide: function () { return ie(this) }, toggle: function (e) { return "boolean" == typeof e ? e ? this.show() : this.hide() : this.each((function () { Z(this) ? m(this).show() : m(this).hide() })) } }); var oe = /^(?:checkbox|radio)$/i, ae = /<([a-z][^\/\0>\x20\t\r\n\f]+)/i, se = /^$|\/(?:java|ecma)script/i, ue = { option: [1, "<select multiple='multiple'>", "</select>"], thead: [1, "<table>", "</table>"], col: [2, "<table><colgroup>", "</colgroup></table>"], tr: [2, "<table><tbody>", "</tbody></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: [0, "", ""] }; function le(e, t) { var n; return n = void 0 !== e.getElementsByTagName ? e.getElementsByTagName(t || "*") : void 0 !== e.querySelectorAll ? e.querySelectorAll(t || "*") : [], void 0 === t || t && m.nodeName(e, t) ? m.merge([e], n) : n } function ce(e, t) { for (var n = 0, r = e.length; n < r; n++)X.set(e[n], "globalEval", !t || X.get(t[n], "globalEval")) } ue.optgroup = ue.option, ue.tbody = ue.tfoot = ue.colgroup = ue.caption = ue.thead, ue.th = ue.td; var fe = /<|&#?\w+;/; function pe(e, t, n, r, i) { for (var o, a, s, u, l, c, f = t.createDocumentFragment(), p = [], d = 0, h = e.length; d < h; d++)if ((o = e[d]) || 0 === o) if ("object" === m.type(o)) m.merge(p, o.nodeType ? [o] : o); else if (fe.test(o)) { for (a = a || f.appendChild(t.createElement("div")), s = (ae.exec(o) || ["", ""])[1].toLowerCase(), u = ue[s] || ue._default, a.innerHTML = u[1] + m.htmlPrefilter(o) + u[2], c = u[0]; c--;)a = a.lastChild; m.merge(p, a.childNodes), (a = f.firstChild).textContent = "" } else p.push(t.createTextNode(o)); for (f.textContent = "", d = 0; o = p[d++];)if (r && m.inArray(o, r) > -1) i && i.push(o); else if (l = m.contains(o.ownerDocument, o), a = le(f.appendChild(o), "script"), l && ce(a), n) for (c = 0; o = a[c++];)se.test(o.type || "") && n.push(o); return f } !function () { var e = r.createDocumentFragment().appendChild(r.createElement("div")), t = r.createElement("input"); t.setAttribute("type", "radio"), t.setAttribute("checked", "checked"), t.setAttribute("name", "t"), e.appendChild(t), h.checkClone = e.cloneNode(!0).cloneNode(!0).lastChild.checked, e.innerHTML = "<textarea>x</textarea>", h.noCloneChecked = !!e.cloneNode(!0).lastChild.defaultValue }(); var de = r.documentElement, he = /^key/, ge = /^(?:mouse|pointer|contextmenu|drag|drop)|click/, ve = /^([^.]*)(?:\.(.+)|)/; function me() { return !0 } function ye() { return !1 } function xe() { try { return r.activeElement } catch (e) { } } function be(e, t, n, r, i, o) { var a, s; if ("object" == typeof t) { for (s in "string" != typeof n && (r = r || n, n = void 0), t) be(e, s, n, r, t[s], o); return e } if (null == r && null == i ? (i = n, r = n = void 0) : null == i && ("string" == typeof n ? (i = r, r = void 0) : (i = r, r = n, n = void 0)), !1 === i) i = ye; else if (!i) return e; return 1 === o && (a = i, (i = function (e) { return m().off(e), a.apply(this, arguments) }).guid = a.guid || (a.guid = m.guid++)), e.each((function () { m.event.add(this, t, i, r, n) })) } m.event = { global: {}, add: function (e, t, n, r, i) { var o, a, s, u, l, c, f, p, d, h, g, v = X.get(e); if (v) for (n.handler && (n = (o = n).handler, i = o.selector), i && m.find.matchesSelector(de, i), n.guid || (n.guid = m.guid++), (u = v.events) || (u = v.events = {}), (a = v.handle) || (a = v.handle = function (t) { return void 0 !== m && m.event.triggered !== t.type ? m.event.dispatch.apply(e, arguments) : void 0 }), l = (t = (t || "").match(O) || [""]).length; l--;)d = g = (s = ve.exec(t[l]) || [])[1], h = (s[2] || "").split(".").sort(), d && (f = m.event.special[d] || {}, d = (i ? f.delegateType : f.bindType) || d, f = m.event.special[d] || {}, c = m.extend({ type: d, origType: g, data: r, handler: n, guid: n.guid, selector: i, needsContext: i && m.expr.match.needsContext.test(i), namespace: h.join(".") }, o), (p = u[d]) || ((p = u[d] = []).delegateCount = 0, f.setup && !1 !== f.setup.call(e, r, h, a) || e.addEventListener && e.addEventListener(d, a)), f.add && (f.add.call(e, c), c.handler.guid || (c.handler.guid = n.guid)), i ? p.splice(p.delegateCount++, 0, c) : p.push(c), m.event.global[d] = !0) }, remove: function (e, t, n, r, i) { var o, a, s, u, l, c, f, p, d, h, g, v = X.hasData(e) && X.get(e); if (v && (u = v.events)) { for (l = (t = (t || "").match(O) || [""]).length; l--;)if (d = g = (s = ve.exec(t[l]) || [])[1], h = (s[2] || "").split(".").sort(), d) { for (f = m.event.special[d] || {}, p = u[d = (r ? f.delegateType : f.bindType) || d] || [], s = s[2] && new RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"), a = o = p.length; o--;)c = p[o], !i && g !== c.origType || n && n.guid !== c.guid || s && !s.test(c.namespace) || r && r !== c.selector && ("**" !== r || !c.selector) || (p.splice(o, 1), c.selector && p.delegateCount--, f.remove && f.remove.call(e, c)); a && !p.length && (f.teardown && !1 !== f.teardown.call(e, h, v.handle) || m.removeEvent(e, d, v.handle), delete u[d]) } else for (d in u) m.event.remove(e, d + t[l], n, r, !0); m.isEmptyObject(u) && X.remove(e, "handle events") } }, dispatch: function (e) { var t, n, r, i, o, a, s = m.event.fix(e), u = new Array(arguments.length), l = (X.get(this, "events") || {})[s.type] || [], c = m.event.special[s.type] || {}; for (u[0] = s, t = 1; t < arguments.length; t++)u[t] = arguments[t]; if (s.delegateTarget = this, !c.preDispatch || !1 !== c.preDispatch.call(this, s)) { for (a = m.event.handlers.call(this, s, l), t = 0; (i = a[t++]) && !s.isPropagationStopped();)for (s.currentTarget = i.elem, n = 0; (o = i.handlers[n++]) && !s.isImmediatePropagationStopped();)s.rnamespace && !s.rnamespace.test(o.namespace) || (s.handleObj = o, s.data = o.data, void 0 !== (r = ((m.event.special[o.origType] || {}).handle || o.handler).apply(i.elem, u)) && !1 === (s.result = r) && (s.preventDefault(), s.stopPropagation())); return c.postDispatch && c.postDispatch.call(this, s), s.result } }, handlers: function (e, t) { var n, r, i, o, a, s = [], u = t.delegateCount, l = e.target; if (u && l.nodeType && !("click" === e.type && e.button >= 1)) for (; l !== this; l = l.parentNode || this)if (1 === l.nodeType && ("click" !== e.type || !0 !== l.disabled)) { for (o = [], a = {}, n = 0; n < u; n++)void 0 === a[i = (r = t[n]).selector + " "] && (a[i] = r.needsContext ? m(i, this).index(l) > -1 : m.find(i, this, null, [l]).length), a[i] && o.push(r); o.length && s.push({ elem: l, handlers: o }) } return l = this, u < t.length && s.push({ elem: l, handlers: t.slice(u) }), s }, addProp: function (e, t) { Object.defineProperty(m.Event.prototype, e, { enumerable: !0, configurable: !0, get: m.isFunction(t) ? function () { if (this.originalEvent) return t(this.originalEvent) } : function () { if (this.originalEvent) return this.originalEvent[e] }, set: function (t) { Object.defineProperty(this, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) } }) }, fix: function (e) { return e[m.expando] ? e : new m.Event(e) }, special: { load: { noBubble: !0 }, focus: { trigger: function () { if (this !== xe() && this.focus) return this.focus(), !1 }, delegateType: "focusin" }, blur: { trigger: function () { if (this === xe() && this.blur) return this.blur(), !1 }, delegateType: "focusout" }, click: { trigger: function () { if ("checkbox" === this.type && this.click && m.nodeName(this, "input")) return this.click(), !1 }, _default: function (e) { return m.nodeName(e.target, "a") } }, beforeunload: { postDispatch: function (e) { void 0 !== e.result && e.originalEvent && (e.originalEvent.returnValue = e.result) } } } }, m.removeEvent = function (e, t, n) { e.removeEventListener && e.removeEventListener(t, n) }, m.Event = function (e, t) { return this instanceof m.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || void 0 === e.defaultPrevented && !1 === e.returnValue ? me : ye, this.target = e.target && 3 === e.target.nodeType ? e.target.parentNode : e.target, this.currentTarget = e.currentTarget, this.relatedTarget = e.relatedTarget) : this.type = e, t && m.extend(this, t), this.timeStamp = e && e.timeStamp || m.now(), void (this[m.expando] = !0)) : new m.Event(e, t) }, m.Event.prototype = { constructor: m.Event, isDefaultPrevented: ye, isPropagationStopped: ye, isImmediatePropagationStopped: ye, isSimulated: !1, preventDefault: function () { var e = this.originalEvent; this.isDefaultPrevented = me, e && !this.isSimulated && e.preventDefault() }, stopPropagation: function () { var e = this.originalEvent; this.isPropagationStopped = me, e && !this.isSimulated && e.stopPropagation() }, stopImmediatePropagation: function () { var e = this.originalEvent; this.isImmediatePropagationStopped = me, e && !this.isSimulated && e.stopImmediatePropagation(), this.stopPropagation() } }, m.each({ altKey: !0, bubbles: !0, cancelable: !0, changedTouches: !0, ctrlKey: !0, detail: !0, eventPhase: !0, metaKey: !0, pageX: !0, pageY: !0, shiftKey: !0, view: !0, char: !0, charCode: !0, key: !0, keyCode: !0, button: !0, buttons: !0, clientX: !0, clientY: !0, offsetX: !0, offsetY: !0, pointerId: !0, pointerType: !0, screenX: !0, screenY: !0, targetTouches: !0, toElement: !0, touches: !0, which: function (e) { var t = e.button; return null == e.which && he.test(e.type) ? null != e.charCode ? e.charCode : e.keyCode : !e.which && void 0 !== t && ge.test(e.type) ? 1 & t ? 1 : 2 & t ? 3 : 4 & t ? 2 : 0 : e.which } }, m.event.addProp), m.each({ mouseenter: "mouseover", mouseleave: "mouseout", pointerenter: "pointerover", pointerleave: "pointerout" }, (function (e, t) { m.event.special[e] = { delegateType: t, bindType: t, handle: function (e) { var n, r = this, i = e.relatedTarget, o = e.handleObj; return i && (i === r || m.contains(r, i)) || (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n } } })), m.fn.extend({ on: function (e, t, n, r) { return be(this, e, t, n, r) }, one: function (e, t, n, r) { return be(this, e, t, n, r, 1) }, off: function (e, t, n) { var r, i; if (e && e.preventDefault && e.handleObj) return r = e.handleObj, m(e.delegateTarget).off(r.namespace ? r.origType + "." + r.namespace : r.origType, r.selector, r.handler), this; if ("object" == typeof e) { for (i in e) this.off(i, t, e[i]); return this } return !1 !== t && "function" != typeof t || (n = t, t = void 0), !1 === n && (n = ye), this.each((function () { m.event.remove(this, e, n, t) })) } }); var we = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi, Te = /<script|<style|<link/i, Ce = /checked\s*(?:[^=]|=\s*.checked.)/i, Ee = /^true\/(.*)/, ke = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g; function Ne(e, t) { return m.nodeName(e, "table") && m.nodeName(11 !== t.nodeType ? t : t.firstChild, "tr") && e.getElementsByTagName("tbody")[0] || e } function Se(e) { return e.type = (null !== e.getAttribute("type")) + "/" + e.type, e } function De(e) { var t = Ee.exec(e.type); return t ? e.type = t[1] : e.removeAttribute("type"), e } function je(e, t) { var n, r, i, o, a, s, u, l; if (1 === t.nodeType) { if (X.hasData(e) && (o = X.access(e), a = X.set(t, o), l = o.events)) for (i in delete a.handle, a.events = {}, l) for (n = 0, r = l[i].length; n < r; n++)m.event.add(t, i, l[i][n]); U.hasData(e) && (s = U.access(e), u = m.extend({}, s), U.set(t, u)) } } function Ae(e, t) { var n = t.nodeName.toLowerCase(); "input" === n && oe.test(e.type) ? t.checked = e.checked : "input" !== n && "textarea" !== n || (t.defaultValue = e.defaultValue) } function qe(e, t, n, r) { t = a.apply([], t); var i, o, s, u, l, c, f = 0, p = e.length, d = p - 1, v = t[0], y = m.isFunction(v); if (y || p > 1 && "string" == typeof v && !h.checkClone && Ce.test(v)) return e.each((function (i) { var o = e.eq(i); y && (t[0] = v.call(this, i, o.html())), qe(o, t, n, r) })); if (p && (o = (i = pe(t, e[0].ownerDocument, !1, e, r)).firstChild, 1 === i.childNodes.length && (i = o), o || r)) { for (u = (s = m.map(le(i, "script"), Se)).length; f < p; f++)l = i, f !== d && (l = m.clone(l, !0, !0), u && m.merge(s, le(l, "script"))), n.call(e[f], l, f); if (u) for (c = s[s.length - 1].ownerDocument, m.map(s, De), f = 0; f < u; f++)l = s[f], se.test(l.type || "") && !X.access(l, "globalEval") && m.contains(c, l) && (l.src ? m._evalUrl && m._evalUrl(l.src) : g(l.textContent.replace(ke, ""), c)) } return e } function Le(e, t, n) { for (var r, i = t ? m.filter(t, e) : e, o = 0; null != (r = i[o]); o++)n || 1 !== r.nodeType || m.cleanData(le(r)), r.parentNode && (n && m.contains(r.ownerDocument, r) && ce(le(r, "script")), r.parentNode.removeChild(r)); return e } m.extend({ htmlPrefilter: function (e) { return e.replace(we, "<$1></$2>") }, clone: function (e, t, n) { var r, i, o, a, s = e.cloneNode(!0), u = m.contains(e.ownerDocument, e); if (!(h.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || m.isXMLDoc(e))) for (a = le(s), r = 0, i = (o = le(e)).length; r < i; r++)Ae(o[r], a[r]); if (t) if (n) for (o = o || le(e), a = a || le(s), r = 0, i = o.length; r < i; r++)je(o[r], a[r]); else je(e, s); return (a = le(s, "script")).length > 0 && ce(a, !u && le(e, "script")), s }, cleanData: function (e) { for (var t, n, r, i = m.event.special, o = 0; void 0 !== (n = e[o]); o++)if (_(n)) { if (t = n[X.expando]) { if (t.events) for (r in t.events) i[r] ? m.event.remove(n, r) : m.removeEvent(n, r, t.handle); n[X.expando] = void 0 } n[U.expando] && (n[U.expando] = void 0) } } }), m.fn.extend({ detach: function (e) { return Le(this, e, !0) }, remove: function (e) { return Le(this, e) }, text: function (e) { return B(this, (function (e) { return void 0 === e ? m.text(this) : this.empty().each((function () { 1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || (this.textContent = e) })) }), null, e, arguments.length) }, append: function () { return qe(this, arguments, (function (e) { 1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || Ne(this, e).appendChild(e) })) }, prepend: function () { return qe(this, arguments, (function (e) { if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) { var t = Ne(this, e); t.insertBefore(e, t.firstChild) } })) }, before: function () { return qe(this, arguments, (function (e) { this.parentNode && this.parentNode.insertBefore(e, this) })) }, after: function () { return qe(this, arguments, (function (e) { this.parentNode && this.parentNode.insertBefore(e, this.nextSibling) })) }, empty: function () { for (var e, t = 0; null != (e = this[t]); t++)1 === e.nodeType && (m.cleanData(le(e, !1)), e.textContent = ""); return this }, clone: function (e, t) { return e = null != e && e, t = null == t ? e : t, this.map((function () { return m.clone(this, e, t) })) }, html: function (e) { return B(this, (function (e) { var t = this[0] || {}, n = 0, r = this.length; if (void 0 === e && 1 === t.nodeType) return t.innerHTML; if ("string" == typeof e && !Te.test(e) && !ue[(ae.exec(e) || ["", ""])[1].toLowerCase()]) { e = m.htmlPrefilter(e); try { for (; n < r; n++)1 === (t = this[n] || {}).nodeType && (m.cleanData(le(t, !1)), t.innerHTML = e); t = 0 } catch (e) { } } t && this.empty().append(e) }), null, e, arguments.length) }, replaceWith: function () { var e = []; return qe(this, arguments, (function (t) { var n = this.parentNode; m.inArray(this, e) < 0 && (m.cleanData(le(this)), n && n.replaceChild(t, this)) }), e) } }), m.each({ appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith" }, (function (e, t) { m.fn[e] = function (e) { for (var n, r = [], i = m(e), o = i.length - 1, a = 0; a <= o; a++)n = a === o ? this : this.clone(!0), m(i[a])[t](n), s.apply(r, n.get()); return this.pushStack(r) } })); var He = /^margin/, Fe = new RegExp("^(" + Q + ")(?!px)[a-z%]+$", "i"), Oe = function (t) { var n = t.ownerDocument.defaultView; return n && n.opener || (n = e), n.getComputedStyle(t) }; function Pe(e, t, n) { var r, i, o, a, s = e.style; return (n = n || Oe(e)) && ("" !== (a = n.getPropertyValue(t) || n[t]) || m.contains(e.ownerDocument, e) || (a = m.style(e, t)), !h.pixelMarginRight() && Fe.test(a) && He.test(t) && (r = s.width, i = s.minWidth, o = s.maxWidth, s.minWidth = s.maxWidth = s.width = a, a = n.width, s.width = r, s.minWidth = i, s.maxWidth = o)), void 0 !== a ? a + "" : a } function Re(e, t) { return { get: function () { return e() ? void delete this.get : (this.get = t).apply(this, arguments) } } } !function () { function t() { if (u) { u.style.cssText = "box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%", u.innerHTML = "", de.appendChild(s); var t = e.getComputedStyle(u); n = "1%" !== t.top, a = "2px" === t.marginLeft, i = "4px" === t.width, u.style.marginRight = "50%", o = "4px" === t.marginRight, de.removeChild(s), u = null } } var n, i, o, a, s = r.createElement("div"), u = r.createElement("div"); u.style && (u.style.backgroundClip = "content-box", u.cloneNode(!0).style.backgroundClip = "", h.clearCloneStyle = "content-box" === u.style.backgroundClip, s.style.cssText = "border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute", s.appendChild(u), m.extend(h, { pixelPosition: function () { return t(), n }, boxSizingReliable: function () { return t(), i }, pixelMarginRight: function () { return t(), o }, reliableMarginLeft: function () { return t(), a } })) }(); var Me = /^(none|table(?!-c[ea]).+)/, Ie = { position: "absolute", visibility: "hidden", display: "block" }, We = { letterSpacing: "0", fontWeight: "400" }, $e = ["Webkit", "Moz", "ms"], Be = r.createElement("div").style; function _e(e) { if (e in Be) return e; for (var t = e[0].toUpperCase() + e.slice(1), n = $e.length; n--;)if ((e = $e[n] + t) in Be) return e } function ze(e, t, n) { var r = J.exec(t); return r ? Math.max(0, r[2] - (n || 0)) + (r[3] || "px") : t } function Xe(e, t, n, r, i) { var o, a = 0; for (o = n === (r ? "border" : "content") ? 4 : "width" === t ? 1 : 0; o < 4; o += 2)"margin" === n && (a += m.css(e, n + K[o], !0, i)), r ? ("content" === n && (a -= m.css(e, "padding" + K[o], !0, i)), "margin" !== n && (a -= m.css(e, "border" + K[o] + "Width", !0, i))) : (a += m.css(e, "padding" + K[o], !0, i), "padding" !== n && (a += m.css(e, "border" + K[o] + "Width", !0, i))); return a } function Ue(e, t, n) { var r, i = !0, o = Oe(e), a = "border-box" === m.css(e, "boxSizing", !1, o); if (e.getClientRects().length && (r = e.getBoundingClientRect()[t]), r <= 0 || null == r) { if (((r = Pe(e, t, o)) < 0 || null == r) && (r = e.style[t]), Fe.test(r)) return r; i = a && (h.boxSizingReliable() || r === e.style[t]), r = parseFloat(r) || 0 } return r + Xe(e, t, n || (a ? "border" : "content"), i, o) + "px" } function Ve(e, t, n, r, i) { return new Ve.prototype.init(e, t, n, r, i) } m.extend({ cssHooks: { opacity: { get: function (e, t) { if (t) { var n = Pe(e, "opacity"); return "" === n ? "1" : n } } } }, cssNumber: { animationIterationCount: !0, columnCount: !0, fillOpacity: !0, flexGrow: !0, flexShrink: !0, fontWeight: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0 }, cssProps: { float: "cssFloat" }, style: function (e, t, n, r) { if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) { var i, o, a, s = m.camelCase(t), u = e.style; return t = m.cssProps[s] || (m.cssProps[s] = _e(s) || s), a = m.cssHooks[t] || m.cssHooks[s], void 0 === n ? a && "get" in a && void 0 !== (i = a.get(e, !1, r)) ? i : u[t] : ("string" === (o = typeof n) && (i = J.exec(n)) && i[1] && (n = te(e, t, i), o = "number"), void (null != n && n == n && ("number" === o && (n += i && i[3] || (m.cssNumber[s] ? "" : "px")), h.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (u[t] = "inherit"), a && "set" in a && void 0 === (n = a.set(e, n, r)) || (u[t] = n)))) } }, css: function (e, t, n, r) { var i, o, a, s = m.camelCase(t); return t = m.cssProps[s] || (m.cssProps[s] = _e(s) || s), (a = m.cssHooks[t] || m.cssHooks[s]) && "get" in a && (i = a.get(e, !0, n)), void 0 === i && (i = Pe(e, t, r)), "normal" === i && t in We && (i = We[t]), "" === n || n ? (o = parseFloat(i), !0 === n || isFinite(o) ? o || 0 : i) : i } }), m.each(["height", "width"], (function (e, t) { m.cssHooks[t] = { get: function (e, n, r) { if (n) return !Me.test(m.css(e, "display")) || e.getClientRects().length && e.getBoundingClientRect().width ? Ue(e, t, r) : ee(e, Ie, (function () { return Ue(e, t, r) })) }, set: function (e, n, r) { var i, o = r && Oe(e), a = r && Xe(e, t, r, "border-box" === m.css(e, "boxSizing", !1, o), o); return a && (i = J.exec(n)) && "px" !== (i[3] || "px") && (e.style[t] = n, n = m.css(e, t)), ze(0, n, a) } } })), m.cssHooks.marginLeft = Re(h.reliableMarginLeft, (function (e, t) { if (t) return (parseFloat(Pe(e, "marginLeft")) || e.getBoundingClientRect().left - ee(e, { marginLeft: 0 }, (function () { return e.getBoundingClientRect().left }))) + "px" })), m.each({ margin: "", padding: "", border: "Width" }, (function (e, t) { m.cssHooks[e + t] = { expand: function (n) { for (var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n]; r < 4; r++)i[e + K[r] + t] = o[r] || o[r - 2] || o[0]; return i } }, He.test(e) || (m.cssHooks[e + t].set = ze) })), m.fn.extend({ css: function (e, t) { return B(this, (function (e, t, n) { var r, i, o = {}, a = 0; if (m.isArray(t)) { for (r = Oe(e), i = t.length; a < i; a++)o[t[a]] = m.css(e, t[a], !1, r); return o } return void 0 !== n ? m.style(e, t, n) : m.css(e, t) }), e, t, arguments.length > 1) } }), m.Tween = Ve, Ve.prototype = { constructor: Ve, init: function (e, t, n, r, i, o) { this.elem = e, this.prop = n, this.easing = i || m.easing._default, this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (m.cssNumber[n] ? "" : "px") }, cur: function () { var e = Ve.propHooks[this.prop]; return e && e.get ? e.get(this) : Ve.propHooks._default.get(this) }, run: function (e) { var t, n = Ve.propHooks[this.prop]; return this.options.duration ? this.pos = t = m.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : this.pos = t = e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : Ve.propHooks._default.set(this), this } }, Ve.prototype.init.prototype = Ve.prototype, Ve.propHooks = { _default: { get: function (e) { var t; return 1 !== e.elem.nodeType || null != e.elem[e.prop] && null == e.elem.style[e.prop] ? e.elem[e.prop] : (t = m.css(e.elem, e.prop, "")) && "auto" !== t ? t : 0 }, set: function (e) { m.fx.step[e.prop] ? m.fx.step[e.prop](e) : 1 !== e.elem.nodeType || null == e.elem.style[m.cssProps[e.prop]] && !m.cssHooks[e.prop] ? e.elem[e.prop] = e.now : m.style(e.elem, e.prop, e.now + e.unit) } } }, Ve.propHooks.scrollTop = Ve.propHooks.scrollLeft = { set: function (e) { e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now) } }, m.easing = { linear: function (e) { return e }, swing: function (e) { return .5 - Math.cos(e * Math.PI) / 2 }, _default: "swing" }, m.fx = Ve.prototype.init, m.fx.step = {}; var Ge, Ye, Qe = /^(?:toggle|show|hide)$/, Je = /queueHooks$/; function Ke() { Ye && (e.requestAnimationFrame(Ke), m.fx.tick()) } function Ze() { return e.setTimeout((function () { Ge = void 0 })), Ge = m.now() } function et(e, t) { var n, r = 0, i = { height: e }; for (t = t ? 1 : 0; r < 4; r += 2 - t)i["margin" + (n = K[r])] = i["padding" + n] = e; return t && (i.opacity = i.width = e), i } function tt(e, t, n) { for (var r, i = (nt.tweeners[t] || []).concat(nt.tweeners["*"]), o = 0, a = i.length; o < a; o++)if (r = i[o].call(n, t, e)) return r } function nt(e, t, n) { var r, i, o = 0, a = nt.prefilters.length, s = m.Deferred().always((function () { delete u.elem })), u = function () { if (i) return !1; for (var t = Ge || Ze(), n = Math.max(0, l.startTime + l.duration - t), r = 1 - (n / l.duration || 0), o = 0, a = l.tweens.length; o < a; o++)l.tweens[o].run(r); return s.notifyWith(e, [l, r, n]), r < 1 && a ? n : (s.resolveWith(e, [l]), !1) }, l = s.promise({ elem: e, props: m.extend({}, t), opts: m.extend(!0, { specialEasing: {}, easing: m.easing._default }, n), originalProperties: t, originalOptions: n, startTime: Ge || Ze(), duration: n.duration, tweens: [], createTween: function (t, n) { var r = m.Tween(e, l.opts, t, n, l.opts.specialEasing[t] || l.opts.easing); return l.tweens.push(r), r }, stop: function (t) { var n = 0, r = t ? l.tweens.length : 0; if (i) return this; for (i = !0; n < r; n++)l.tweens[n].run(1); return t ? (s.notifyWith(e, [l, 1, 0]), s.resolveWith(e, [l, t])) : s.rejectWith(e, [l, t]), this } }), c = l.props; for (function (e, t) { var n, r, i, o, a; for (n in e) if (i = t[r = m.camelCase(n)], o = e[n], m.isArray(o) && (i = o[1], o = e[n] = o[0]), n !== r && (e[r] = o, delete e[n]), (a = m.cssHooks[r]) && "expand" in a) for (n in o = a.expand(o), delete e[r], o) n in e || (e[n] = o[n], t[n] = i); else t[r] = i }(c, l.opts.specialEasing); o < a; o++)if (r = nt.prefilters[o].call(l, e, c, l.opts)) return m.isFunction(r.stop) && (m._queueHooks(l.elem, l.opts.queue).stop = m.proxy(r.stop, r)), r; return m.map(c, tt, l), m.isFunction(l.opts.start) && l.opts.start.call(e, l), m.fx.timer(m.extend(u, { elem: e, anim: l, queue: l.opts.queue })), l.progress(l.opts.progress).done(l.opts.done, l.opts.complete).fail(l.opts.fail).always(l.opts.always) } m.Animation = m.extend(nt, { tweeners: { "*": [function (e, t) { var n = this.createTween(e, t); return te(n.elem, e, J.exec(t), n), n }] }, tweener: function (e, t) { m.isFunction(e) ? (t = e, e = ["*"]) : e = e.match(O); for (var n, r = 0, i = e.length; r < i; r++)n = e[r], nt.tweeners[n] = nt.tweeners[n] || [], nt.tweeners[n].unshift(t) }, prefilters: [function (e, t, n) { var r, i, o, a, s, u, l, c, f = "width" in t || "height" in t, p = this, d = {}, h = e.style, g = e.nodeType && Z(e), v = X.get(e, "fxshow"); for (r in n.queue || (null == (a = m._queueHooks(e, "fx")).unqueued && (a.unqueued = 0, s = a.empty.fire, a.empty.fire = function () { a.unqueued || s() }), a.unqueued++, p.always((function () { p.always((function () { a.unqueued--, m.queue(e, "fx").length || a.empty.fire() })) }))), t) if (i = t[r], Qe.test(i)) { if (delete t[r], o = o || "toggle" === i, i === (g ? "hide" : "show")) { if ("show" !== i || !v || void 0 === v[r]) continue; g = !0 } d[r] = v && v[r] || m.style(e, r) } if ((u = !m.isEmptyObject(t)) || !m.isEmptyObject(d)) for (r in f && 1 === e.nodeType && (n.overflow = [h.overflow, h.overflowX, h.overflowY], null == (l = v && v.display) && (l = X.get(e, "display")), "none" === (c = m.css(e, "display")) && (l ? c = l : (ie([e], !0), l = e.style.display || l, c = m.css(e, "display"), ie([e]))), ("inline" === c || "inline-block" === c && null != l) && "none" === m.css(e, "float") && (u || (p.done((function () { h.display = l })), null == l && (c = h.display, l = "none" === c ? "" : c)), h.display = "inline-block")), n.overflow && (h.overflow = "hidden", p.always((function () { h.overflow = n.overflow[0], h.overflowX = n.overflow[1], h.overflowY = n.overflow[2] }))), u = !1, d) u || (v ? "hidden" in v && (g = v.hidden) : v = X.access(e, "fxshow", { display: l }), o && (v.hidden = !g), g && ie([e], !0), p.done((function () { for (r in g || ie([e]), X.remove(e, "fxshow"), d) m.style(e, r, d[r]) }))), u = tt(g ? v[r] : 0, r, p), r in v || (v[r] = u.start, g && (u.end = u.start, u.start = 0)) }], prefilter: function (e, t) { t ? nt.prefilters.unshift(e) : nt.prefilters.push(e) } }), m.speed = function (e, t, n) { var i = e && "object" == typeof e ? m.extend({}, e) : { complete: n || !n && t || m.isFunction(e) && e, duration: e, easing: n && t || t && !m.isFunction(t) && t }; return m.fx.off || r.hidden ? i.duration = 0 : "number" != typeof i.duration && (i.duration in m.fx.speeds ? i.duration = m.fx.speeds[i.duration] : i.duration = m.fx.speeds._default), null != i.queue && !0 !== i.queue || (i.queue = "fx"), i.old = i.complete, i.complete = function () { m.isFunction(i.old) && i.old.call(this), i.queue && m.dequeue(this, i.queue) }, i }, m.fn.extend({ fadeTo: function (e, t, n, r) { return this.filter(Z).css("opacity", 0).show().end().animate({ opacity: t }, e, n, r) }, animate: function (e, t, n, r) { var i = m.isEmptyObject(e), o = m.speed(t, n, r), a = function () { var t = nt(this, m.extend({}, e), o); (i || X.get(this, "finish")) && t.stop(!0) }; return a.finish = a, i || !1 === o.queue ? this.each(a) : this.queue(o.queue, a) }, stop: function (e, t, n) { var r = function (e) { var t = e.stop; delete e.stop, t(n) }; return "string" != typeof e && (n = t, t = e, e = void 0), t && !1 !== e && this.queue(e || "fx", []), this.each((function () { var t = !0, i = null != e && e + "queueHooks", o = m.timers, a = X.get(this); if (i) a[i] && a[i].stop && r(a[i]); else for (i in a) a[i] && a[i].stop && Je.test(i) && r(a[i]); for (i = o.length; i--;)o[i].elem !== this || null != e && o[i].queue !== e || (o[i].anim.stop(n), t = !1, o.splice(i, 1)); !t && n || m.dequeue(this, e) })) }, finish: function (e) { return !1 !== e && (e = e || "fx"), this.each((function () { var t, n = X.get(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = m.timers, a = r ? r.length : 0; for (n.finish = !0, m.queue(this, e, []), i && i.stop && i.stop.call(this, !0), t = o.length; t--;)o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1)); for (t = 0; t < a; t++)r[t] && r[t].finish && r[t].finish.call(this); delete n.finish })) } }), m.each(["toggle", "show", "hide"], (function (e, t) { var n = m.fn[t]; m.fn[t] = function (e, r, i) { return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(et(t, !0), e, r, i) } })), m.each({ slideDown: et("show"), slideUp: et("hide"), slideToggle: et("toggle"), fadeIn: { opacity: "show" }, fadeOut: { opacity: "hide" }, fadeToggle: { opacity: "toggle" } }, (function (e, t) { m.fn[e] = function (e, n, r) { return this.animate(t, e, n, r) } })), m.timers = [], m.fx.tick = function () { var e, t = 0, n = m.timers; for (Ge = m.now(); t < n.length; t++)(e = n[t])() || n[t] !== e || n.splice(t--, 1); n.length || m.fx.stop(), Ge = void 0 }, m.fx.timer = function (e) { m.timers.push(e), e() ? m.fx.start() : m.timers.pop() }, m.fx.interval = 13, m.fx.start = function () { Ye || (Ye = e.requestAnimationFrame ? e.requestAnimationFrame(Ke) : e.setInterval(m.fx.tick, m.fx.interval)) }, m.fx.stop = function () { e.cancelAnimationFrame ? e.cancelAnimationFrame(Ye) : e.clearInterval(Ye), Ye = null }, m.fx.speeds = { slow: 600, fast: 200, _default: 400 }, m.fn.delay = function (t, n) { return t = m.fx && m.fx.speeds[t] || t, n = n || "fx", this.queue(n, (function (n, r) { var i = e.setTimeout(n, t); r.stop = function () { e.clearTimeout(i) } })) }, function () { var e = r.createElement("input"), t = r.createElement("select").appendChild(r.createElement("option")); e.type = "checkbox", h.checkOn = "" !== e.value, h.optSelected = t.selected, (e = r.createElement("input")).value = "t", e.type = "radio", h.radioValue = "t" === e.value }(); var rt, it = m.expr.attrHandle; m.fn.extend({ attr: function (e, t) { return B(this, m.attr, e, t, arguments.length > 1) }, removeAttr: function (e) { return this.each((function () { m.removeAttr(this, e) })) } }), m.extend({ attr: function (e, t, n) { var r, i, o = e.nodeType; if (3 !== o && 8 !== o && 2 !== o) return void 0 === e.getAttribute ? m.prop(e, t, n) : (1 === o && m.isXMLDoc(e) || (i = m.attrHooks[t.toLowerCase()] || (m.expr.match.bool.test(t) ? rt : void 0)), void 0 !== n ? null === n ? void m.removeAttr(e, t) : i && "set" in i && void 0 !== (r = i.set(e, n, t)) ? r : (e.setAttribute(t, n + ""), n) : i && "get" in i && null !== (r = i.get(e, t)) ? r : null == (r = m.find.attr(e, t)) ? void 0 : r) }, attrHooks: { type: { set: function (e, t) { if (!h.radioValue && "radio" === t && m.nodeName(e, "input")) { var n = e.value; return e.setAttribute("type", t), n && (e.value = n), t } } } }, removeAttr: function (e, t) { var n, r = 0, i = t && t.match(O); if (i && 1 === e.nodeType) for (; n = i[r++];)e.removeAttribute(n) } }), rt = { set: function (e, t, n) { return !1 === t ? m.removeAttr(e, n) : e.setAttribute(n, n), n } }, m.each(m.expr.match.bool.source.match(/\w+/g), (function (e, t) { var n = it[t] || m.find.attr; it[t] = function (e, t, r) { var i, o, a = t.toLowerCase(); return r || (o = it[a], it[a] = i, i = null != n(e, t, r) ? a : null, it[a] = o), i } })); var ot = /^(?:input|select|textarea|button)$/i, at = /^(?:a|area)$/i; function st(e) { return (e.match(O) || []).join(" ") } function ut(e) { return e.getAttribute && e.getAttribute("class") || "" } m.fn.extend({ prop: function (e, t) { return B(this, m.prop, e, t, arguments.length > 1) }, removeProp: function (e) { return this.each((function () { delete this[m.propFix[e] || e] })) } }), m.extend({ prop: function (e, t, n) { var r, i, o = e.nodeType; if (3 !== o && 8 !== o && 2 !== o) return 1 === o && m.isXMLDoc(e) || (t = m.propFix[t] || t, i = m.propHooks[t]), void 0 !== n ? i && "set" in i && void 0 !== (r = i.set(e, n, t)) ? r : e[t] = n : i && "get" in i && null !== (r = i.get(e, t)) ? r : e[t] }, propHooks: { tabIndex: { get: function (e) { var t = m.find.attr(e, "tabindex"); return t ? parseInt(t, 10) : ot.test(e.nodeName) || at.test(e.nodeName) && e.href ? 0 : -1 } } }, propFix: { for: "htmlFor", class: "className" } }), h.optSelected || (m.propHooks.selected = { get: function (e) { var t = e.parentNode; return t && t.parentNode && t.parentNode.selectedIndex, null }, set: function (e) { var t = e.parentNode; t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex) } }), m.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], (function () { m.propFix[this.toLowerCase()] = this })), m.fn.extend({ addClass: function (e) { var t, n, r, i, o, a, s, u = 0; if (m.isFunction(e)) return this.each((function (t) { m(this).addClass(e.call(this, t, ut(this))) })); if ("string" == typeof e && e) for (t = e.match(O) || []; n = this[u++];)if (i = ut(n), r = 1 === n.nodeType && " " + st(i) + " ") { for (a = 0; o = t[a++];)r.indexOf(" " + o + " ") < 0 && (r += o + " "); i !== (s = st(r)) && n.setAttribute("class", s) } return this }, removeClass: function (e) { var t, n, r, i, o, a, s, u = 0; if (m.isFunction(e)) return this.each((function (t) { m(this).removeClass(e.call(this, t, ut(this))) })); if (!arguments.length) return this.attr("class", ""); if ("string" == typeof e && e) for (t = e.match(O) || []; n = this[u++];)if (i = ut(n), r = 1 === n.nodeType && " " + st(i) + " ") { for (a = 0; o = t[a++];)for (; r.indexOf(" " + o + " ") > -1;)r = r.replace(" " + o + " ", " "); i !== (s = st(r)) && n.setAttribute("class", s) } return this }, toggleClass: function (e, t) { var n = typeof e; return "boolean" == typeof t && "string" === n ? t ? this.addClass(e) : this.removeClass(e) : m.isFunction(e) ? this.each((function (n) { m(this).toggleClass(e.call(this, n, ut(this), t), t) })) : this.each((function () { var t, r, i, o; if ("string" === n) for (r = 0, i = m(this), o = e.match(O) || []; t = o[r++];)i.hasClass(t) ? i.removeClass(t) : i.addClass(t); else void 0 !== e && "boolean" !== n || ((t = ut(this)) && X.set(this, "__className__", t), this.setAttribute && this.setAttribute("class", t || !1 === e ? "" : X.get(this, "__className__") || "")) })) }, hasClass: function (e) { var t, n, r = 0; for (t = " " + e + " "; n = this[r++];)if (1 === n.nodeType && (" " + st(ut(n)) + " ").indexOf(t) > -1) return !0; return !1 } }); var lt = /\r/g; m.fn.extend({ val: function (e) { var t, n, r, i = this[0]; return arguments.length ? (r = m.isFunction(e), this.each((function (n) { var i; 1 === this.nodeType && (null == (i = r ? e.call(this, n, m(this).val()) : e) ? i = "" : "number" == typeof i ? i += "" : m.isArray(i) && (i = m.map(i, (function (e) { return null == e ? "" : e + "" }))), (t = m.valHooks[this.type] || m.valHooks[this.nodeName.toLowerCase()]) && "set" in t && void 0 !== t.set(this, i, "value") || (this.value = i)) }))) : i ? (t = m.valHooks[i.type] || m.valHooks[i.nodeName.toLowerCase()]) && "get" in t && void 0 !== (n = t.get(i, "value")) ? n : "string" == typeof (n = i.value) ? n.replace(lt, "") : null == n ? "" : n : void 0 } }), m.extend({ valHooks: { option: { get: function (e) { var t = m.find.attr(e, "value"); return null != t ? t : st(m.text(e)) } }, select: { get: function (e) { var t, n, r, i = e.options, o = e.selectedIndex, a = "select-one" === e.type, s = a ? null : [], u = a ? o + 1 : i.length; for (r = o < 0 ? u : a ? o : 0; r < u; r++)if (((n = i[r]).selected || r === o) && !n.disabled && (!n.parentNode.disabled || !m.nodeName(n.parentNode, "optgroup"))) { if (t = m(n).val(), a) return t; s.push(t) } return s }, set: function (e, t) { for (var n, r, i = e.options, o = m.makeArray(t), a = i.length; a--;)((r = i[a]).selected = m.inArray(m.valHooks.option.get(r), o) > -1) && (n = !0); return n || (e.selectedIndex = -1), o } } } }), m.each(["radio", "checkbox"], (function () { m.valHooks[this] = { set: function (e, t) { if (m.isArray(t)) return e.checked = m.inArray(m(e).val(), t) > -1 } }, h.checkOn || (m.valHooks[this].get = function (e) { return null === e.getAttribute("value") ? "on" : e.value }) })); var ct = /^(?:focusinfocus|focusoutblur)$/; m.extend(m.event, { trigger: function (t, n, i, o) { var a, s, u, l, c, p, d, h = [i || r], g = f.call(t, "type") ? t.type : t, v = f.call(t, "namespace") ? t.namespace.split(".") : []; if (s = u = i = i || r, 3 !== i.nodeType && 8 !== i.nodeType && !ct.test(g + m.event.triggered) && (g.indexOf(".") > -1 && (v = g.split("."), g = v.shift(), v.sort()), c = g.indexOf(":") < 0 && "on" + g, (t = t[m.expando] ? t : new m.Event(g, "object" == typeof t && t)).isTrigger = o ? 2 : 3, t.namespace = v.join("."), t.rnamespace = t.namespace ? new RegExp("(^|\\.)" + v.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, t.result = void 0, t.target || (t.target = i), n = null == n ? [t] : m.makeArray(n, [t]), d = m.event.special[g] || {}, o || !d.trigger || !1 !== d.trigger.apply(i, n))) { if (!o && !d.noBubble && !m.isWindow(i)) { for (l = d.delegateType || g, ct.test(l + g) || (s = s.parentNode); s; s = s.parentNode)h.push(s), u = s; u === (i.ownerDocument || r) && h.push(u.defaultView || u.parentWindow || e) } for (a = 0; (s = h[a++]) && !t.isPropagationStopped();)t.type = a > 1 ? l : d.bindType || g, (p = (X.get(s, "events") || {})[t.type] && X.get(s, "handle")) && p.apply(s, n), (p = c && s[c]) && p.apply && _(s) && (t.result = p.apply(s, n), !1 === t.result && t.preventDefault()); return t.type = g, o || t.isDefaultPrevented() || d._default && !1 !== d._default.apply(h.pop(), n) || !_(i) || c && m.isFunction(i[g]) && !m.isWindow(i) && ((u = i[c]) && (i[c] = null), m.event.triggered = g, i[g](), m.event.triggered = void 0, u && (i[c] = u)), t.result } }, simulate: function (e, t, n) { var r = m.extend(new m.Event, n, { type: e, isSimulated: !0 }); m.event.trigger(r, null, t) } }), m.fn.extend({ trigger: function (e, t) { return this.each((function () { m.event.trigger(e, t, this) })) }, triggerHandler: function (e, t) { var n = this[0]; if (n) return m.event.trigger(e, t, n, !0) } }), m.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "), (function (e, t) { m.fn[t] = function (e, n) { return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t) } })), m.fn.extend({ hover: function (e, t) { return this.mouseenter(e).mouseleave(t || e) } }), h.focusin = "onfocusin" in e, h.focusin || m.each({ focus: "focusin", blur: "focusout" }, (function (e, t) { var n = function (e) { m.event.simulate(t, e.target, m.event.fix(e)) }; m.event.special[t] = { setup: function () { var r = this.ownerDocument || this, i = X.access(r, t); i || r.addEventListener(e, n, !0), X.access(r, t, (i || 0) + 1) }, teardown: function () { var r = this.ownerDocument || this, i = X.access(r, t) - 1; i ? X.access(r, t, i) : (r.removeEventListener(e, n, !0), X.remove(r, t)) } } })); var ft = e.location, pt = m.now(), dt = /\?/; m.parseXML = function (t) { var n; if (!t || "string" != typeof t) return null; try { n = (new e.DOMParser).parseFromString(t, "text/xml") } catch (e) { n = void 0 } return n && !n.getElementsByTagName("parsererror").length || m.error("Invalid XML: " + t), n }; var ht = /\[\]$/, gt = /\r?\n/g, vt = /^(?:submit|button|image|reset|file)$/i, mt = /^(?:input|select|textarea|keygen)/i; function yt(e, t, n, r) { var i; if (m.isArray(t)) m.each(t, (function (t, i) { n || ht.test(e) ? r(e, i) : yt(e + "[" + ("object" == typeof i && null != i ? t : "") + "]", i, n, r) })); else if (n || "object" !== m.type(t)) r(e, t); else for (i in t) yt(e + "[" + i + "]", t[i], n, r) } m.param = function (e, t) { var n, r = [], i = function (e, t) { var n = m.isFunction(t) ? t() : t; r[r.length] = encodeURIComponent(e) + "=" + encodeURIComponent(null == n ? "" : n) }; if (m.isArray(e) || e.jquery && !m.isPlainObject(e)) m.each(e, (function () { i(this.name, this.value) })); else for (n in e) yt(n, e[n], t, i); return r.join("&") }, m.fn.extend({ serialize: function () { return m.param(this.serializeArray()) }, serializeArray: function () { return this.map((function () { var e = m.prop(this, "elements"); return e ? m.makeArray(e) : this })).filter((function () { var e = this.type; return this.name && !m(this).is(":disabled") && mt.test(this.nodeName) && !vt.test(e) && (this.checked || !oe.test(e)) })).map((function (e, t) { var n = m(this).val(); return null == n ? null : m.isArray(n) ? m.map(n, (function (e) { return { name: t.name, value: e.replace(gt, "\r\n") } })) : { name: t.name, value: n.replace(gt, "\r\n") } })).get() } }); var xt = /%20/g, bt = /#.*$/, wt = /([?&])_=[^&]*/, Tt = /^(.*?):[ \t]*([^\r\n]*)$/gm, Ct = /^(?:GET|HEAD)$/, Et = /^\/\//, kt = {}, Nt = {}, St = "*/".concat("*"), Dt = r.createElement("a"); function jt(e) { return function (t, n) { "string" != typeof t && (n = t, t = "*"); var r, i = 0, o = t.toLowerCase().match(O) || []; if (m.isFunction(n)) for (; r = o[i++];)"+" === r[0] ? (r = r.slice(1) || "*", (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n) } } function At(e, t, n, r) { var i = {}, o = e === Nt; function a(s) { var u; return i[s] = !0, m.each(e[s] || [], (function (e, s) { var l = s(t, n, r); return "string" != typeof l || o || i[l] ? o ? !(u = l) : void 0 : (t.dataTypes.unshift(l), a(l), !1) })), u } return a(t.dataTypes[0]) || !i["*"] && a("*") } function qt(e, t) { var n, r, i = m.ajaxSettings.flatOptions || {}; for (n in t) void 0 !== t[n] && ((i[n] ? e : r || (r = {}))[n] = t[n]); return r && m.extend(!0, e, r), e } Dt.href = ft.href, m.extend({ active: 0, lastModified: {}, etag: {}, ajaxSettings: { url: ft.href, type: "GET", isLocal: /^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ft.protocol), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: { "*": St, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript" }, contents: { xml: /\bxml\b/, html: /\bhtml/, json: /\bjson\b/ }, responseFields: { xml: "responseXML", text: "responseText", json: "responseJSON" }, converters: { "* text": String, "text html": !0, "text json": JSON.parse, "text xml": m.parseXML }, flatOptions: { url: !0, context: !0 } }, ajaxSetup: function (e, t) { return t ? qt(qt(e, m.ajaxSettings), t) : qt(m.ajaxSettings, e) }, ajaxPrefilter: jt(kt), ajaxTransport: jt(Nt), ajax: function (t, n) { "object" == typeof t && (n = t, t = void 0), n = n || {}; var i, o, a, s, u, l, c, f, p, d, h = m.ajaxSetup({}, n), g = h.context || h, v = h.context && (g.nodeType || g.jquery) ? m(g) : m.event, y = m.Deferred(), x = m.Callbacks("once memory"), b = h.statusCode || {}, w = {}, T = {}, C = "canceled", E = { readyState: 0, getResponseHeader: function (e) { var t; if (c) { if (!s) for (s = {}; t = Tt.exec(a);)s[t[1].toLowerCase()] = t[2]; t = s[e.toLowerCase()] } return null == t ? null : t }, getAllResponseHeaders: function () { return c ? a : null }, setRequestHeader: function (e, t) { return null == c && (e = T[e.toLowerCase()] = T[e.toLowerCase()] || e, w[e] = t), this }, overrideMimeType: function (e) { return null == c && (h.mimeType = e), this }, statusCode: function (e) { var t; if (e) if (c) E.always(e[E.status]); else for (t in e) b[t] = [b[t], e[t]]; return this }, abort: function (e) { var t = e || C; return i && i.abort(t), k(0, t), this } }; if (y.promise(E), h.url = ((t || h.url || ft.href) + "").replace(Et, ft.protocol + "//"), h.type = n.method || n.type || h.method || h.type, h.dataTypes = (h.dataType || "*").toLowerCase().match(O) || [""], null == h.crossDomain) { l = r.createElement("a"); try { l.href = h.url, l.href = l.href, h.crossDomain = Dt.protocol + "//" + Dt.host != l.protocol + "//" + l.host } catch (e) { h.crossDomain = !0 } } if (h.data && h.processData && "string" != typeof h.data && (h.data = m.param(h.data, h.traditional)), At(kt, h, n, E), c) return E; for (p in (f = m.event && h.global) && 0 == m.active++ && m.event.trigger("ajaxStart"), h.type = h.type.toUpperCase(), h.hasContent = !Ct.test(h.type), o = h.url.replace(bt, ""), h.hasContent ? h.data && h.processData && 0 === (h.contentType || "").indexOf("application/x-www-form-urlencoded") && (h.data = h.data.replace(xt, "+")) : (d = h.url.slice(o.length), h.data && (o += (dt.test(o) ? "&" : "?") + h.data, delete h.data), !1 === h.cache && (o = o.replace(wt, "$1"), d = (dt.test(o) ? "&" : "?") + "_=" + pt++ + d), h.url = o + d), h.ifModified && (m.lastModified[o] && E.setRequestHeader("If-Modified-Since", m.lastModified[o]), m.etag[o] && E.setRequestHeader("If-None-Match", m.etag[o])), (h.data && h.hasContent && !1 !== h.contentType || n.contentType) && E.setRequestHeader("Content-Type", h.contentType), E.setRequestHeader("Accept", h.dataTypes[0] && h.accepts[h.dataTypes[0]] ? h.accepts[h.dataTypes[0]] + ("*" !== h.dataTypes[0] ? ", " + St + "; q=0.01" : "") : h.accepts["*"]), h.headers) E.setRequestHeader(p, h.headers[p]); if (h.beforeSend && (!1 === h.beforeSend.call(g, E, h) || c)) return E.abort(); if (C = "abort", x.add(h.complete), E.done(h.success), E.fail(h.error), i = At(Nt, h, n, E)) { if (E.readyState = 1, f && v.trigger("ajaxSend", [E, h]), c) return E; h.async && h.timeout > 0 && (u = e.setTimeout((function () { E.abort("timeout") }), h.timeout)); try { c = !1, i.send(w, k) } catch (e) { if (c) throw e; k(-1, e) } } else k(-1, "No Transport"); function k(t, n, r, s) { var l, p, d, w, T, C = n; c || (c = !0, u && e.clearTimeout(u), i = void 0, a = s || "", E.readyState = t > 0 ? 4 : 0, l = t >= 200 && t < 300 || 304 === t, r && (w = function (e, t, n) { for (var r, i, o, a, s = e.contents, u = e.dataTypes; "*" === u[0];)u.shift(), void 0 === r && (r = e.mimeType || t.getResponseHeader("Content-Type")); if (r) for (i in s) if (s[i] && s[i].test(r)) { u.unshift(i); break } if (u[0] in n) o = u[0]; else { for (i in n) { if (!u[0] || e.converters[i + " " + u[0]]) { o = i; break } a || (a = i) } o = o || a } if (o) return o !== u[0] && u.unshift(o), n[o] }(h, E, r)), w = function (e, t, n, r) { var i, o, a, s, u, l = {}, c = e.dataTypes.slice(); if (c[1]) for (a in e.converters) l[a.toLowerCase()] = e.converters[a]; for (o = c.shift(); o;)if (e.responseFields[o] && (n[e.responseFields[o]] = t), !u && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)), u = o, o = c.shift()) if ("*" === o) o = u; else if ("*" !== u && u !== o) { if (!(a = l[u + " " + o] || l["* " + o])) for (i in l) if ((s = i.split(" "))[1] === o && (a = l[u + " " + s[0]] || l["* " + s[0]])) { !0 === a ? a = l[i] : !0 !== l[i] && (o = s[0], c.unshift(s[1])); break } if (!0 !== a) if (a && e.throws) t = a(t); else try { t = a(t) } catch (e) { return { state: "parsererror", error: a ? e : "No conversion from " + u + " to " + o } } } return { state: "success", data: t } }(h, w, E, l), l ? (h.ifModified && ((T = E.getResponseHeader("Last-Modified")) && (m.lastModified[o] = T), (T = E.getResponseHeader("etag")) && (m.etag[o] = T)), 204 === t || "HEAD" === h.type ? C = "nocontent" : 304 === t ? C = "notmodified" : (C = w.state, p = w.data, l = !(d = w.error))) : (d = C, !t && C || (C = "error", t < 0 && (t = 0))), E.status = t, E.statusText = (n || C) + "", l ? y.resolveWith(g, [p, C, E]) : y.rejectWith(g, [E, C, d]), E.statusCode(b), b = void 0, f && v.trigger(l ? "ajaxSuccess" : "ajaxError", [E, h, l ? p : d]), x.fireWith(g, [E, C]), f && (v.trigger("ajaxComplete", [E, h]), --m.active || m.event.trigger("ajaxStop"))) } return E }, getJSON: function (e, t, n) { return m.get(e, t, n, "json") }, getScript: function (e, t) { return m.get(e, void 0, t, "script") } }), m.each(["get", "post"], (function (e, t) { m[t] = function (e, n, r, i) { return m.isFunction(n) && (i = i || r, r = n, n = void 0), m.ajax(m.extend({ url: e, type: t, dataType: i, data: n, success: r }, m.isPlainObject(e) && e)) } })), m._evalUrl = function (e) { return m.ajax({ url: e, type: "GET", dataType: "script", cache: !0, async: !1, global: !1, throws: !0 }) }, m.fn.extend({ wrapAll: function (e) { var t; return this[0] && (m.isFunction(e) && (e = e.call(this[0])), t = m(e, this[0].ownerDocument).eq(0).clone(!0), this[0].parentNode && t.insertBefore(this[0]), t.map((function () { for (var e = this; e.firstElementChild;)e = e.firstElementChild; return e })).append(this)), this }, wrapInner: function (e) { return m.isFunction(e) ? this.each((function (t) { m(this).wrapInner(e.call(this, t)) })) : this.each((function () { var t = m(this), n = t.contents(); n.length ? n.wrapAll(e) : t.append(e) })) }, wrap: function (e) { var t = m.isFunction(e); return this.each((function (n) { m(this).wrapAll(t ? e.call(this, n) : e) })) }, unwrap: function (e) { return this.parent(e).not("body").each((function () { m(this).replaceWith(this.childNodes) })), this } }), m.expr.pseudos.hidden = function (e) { return !m.expr.pseudos.visible(e) }, m.expr.pseudos.visible = function (e) { return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length) }, m.ajaxSettings.xhr = function () { try { return new e.XMLHttpRequest } catch (e) { } }; var Lt = { 0: 200, 1223: 204 }, Ht = m.ajaxSettings.xhr(); h.cors = !!Ht && "withCredentials" in Ht, h.ajax = Ht = !!Ht, m.ajaxTransport((function (t) { var n, r; if (h.cors || Ht && !t.crossDomain) return { send: function (i, o) { var a, s = t.xhr(); if (s.open(t.type, t.url, t.async, t.username, t.password), t.xhrFields) for (a in t.xhrFields) s[a] = t.xhrFields[a]; for (a in t.mimeType && s.overrideMimeType && s.overrideMimeType(t.mimeType), t.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest"), i) s.setRequestHeader(a, i[a]); n = function (e) { return function () { n && (n = r = s.onload = s.onerror = s.onabort = s.onreadystatechange = null, "abort" === e ? s.abort() : "error" === e ? "number" != typeof s.status ? o(0, "error") : o(s.status, s.statusText) : o(Lt[s.status] || s.status, s.statusText, "text" !== (s.responseType || "text") || "string" != typeof s.responseText ? { binary: s.response } : { text: s.responseText }, s.getAllResponseHeaders())) } }, s.onload = n(), r = s.onerror = n("error"), void 0 !== s.onabort ? s.onabort = r : s.onreadystatechange = function () { 4 === s.readyState && e.setTimeout((function () { n && r() })) }, n = n("abort"); try { s.send(t.hasContent && t.data || null) } catch (e) { if (n) throw e } }, abort: function () { n && n() } } })), m.ajaxPrefilter((function (e) { e.crossDomain && (e.contents.script = !1) })), m.ajaxSetup({ accepts: { script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript" }, contents: { script: /\b(?:java|ecma)script\b/ }, converters: { "text script": function (e) { return m.globalEval(e), e } } }), m.ajaxPrefilter("script", (function (e) { void 0 === e.cache && (e.cache = !1), e.crossDomain && (e.type = "GET") })), m.ajaxTransport("script", (function (e) { var t, n; if (e.crossDomain) return { send: function (i, o) { t = m("<script>").prop({ charset: e.scriptCharset, src: e.url }).on("load error", n = function (e) { t.remove(), n = null, e && o("error" === e.type ? 404 : 200, e.type) }), r.head.appendChild(t[0]) }, abort: function () { n && n() } } })); var Ft = [], Ot = /(=)\?(?=&|$)|\?\?/; function Pt(e) { return m.isWindow(e) ? e : 9 === e.nodeType && e.defaultView } m.ajaxSetup({ jsonp: "callback", jsonpCallback: function () { var e = Ft.pop() || m.expando + "_" + pt++; return this[e] = !0, e } }), m.ajaxPrefilter("json jsonp", (function (t, n, r) { var i, o, a, s = !1 !== t.jsonp && (Ot.test(t.url) ? "url" : "string" == typeof t.data && 0 === (t.contentType || "").indexOf("application/x-www-form-urlencoded") && Ot.test(t.data) && "data"); if (s || "jsonp" === t.dataTypes[0]) return i = t.jsonpCallback = m.isFunction(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback, s ? t[s] = t[s].replace(Ot, "$1" + i) : !1 !== t.jsonp && (t.url += (dt.test(t.url) ? "&" : "?") + t.jsonp + "=" + i), t.converters["script json"] = function () { return a || m.error(i + " was not called"), a[0] }, t.dataTypes[0] = "json", o = e[i], e[i] = function () { a = arguments }, r.always((function () { void 0 === o ? m(e).removeProp(i) : e[i] = o, t[i] && (t.jsonpCallback = n.jsonpCallback, Ft.push(i)), a && m.isFunction(o) && o(a[0]), a = o = void 0 })), "script" })), h.createHTMLDocument = function () { var e = r.implementation.createHTMLDocument("").body; return e.innerHTML = "<form></form><form></form>", 2 === e.childNodes.length }(), m.parseHTML = function (e, t, n) { return "string" != typeof e ? [] : ("boolean" == typeof t && (n = t, t = !1), t || (h.createHTMLDocument ? ((i = (t = r.implementation.createHTMLDocument("")).createElement("base")).href = r.location.href, t.head.appendChild(i)) : t = r), a = !n && [], (o = S.exec(e)) ? [t.createElement(o[1])] : (o = pe([e], t, a), a && a.length && m(a).remove(), m.merge([], o.childNodes))); var i, o, a }, m.fn.load = function (e, t, n) { var r, i, o, a = this, s = e.indexOf(" "); return s > -1 && (r = st(e.slice(s)), e = e.slice(0, s)), m.isFunction(t) ? (n = t, t = void 0) : t && "object" == typeof t && (i = "POST"), a.length > 0 && m.ajax({ url: e, type: i || "GET", dataType: "html", data: t }).done((function (e) { o = arguments, a.html(r ? m("<div>").append(m.parseHTML(e)).find(r) : e) })).always(n && function (e, t) { a.each((function () { n.apply(this, o || [e.responseText, t, e]) })) }), this }, m.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], (function (e, t) { m.fn[t] = function (e) { return this.on(t, e) } })), m.expr.pseudos.animated = function (e) { return m.grep(m.timers, (function (t) { return e === t.elem })).length }, m.offset = { setOffset: function (e, t, n) { var r, i, o, a, s, u, l = m.css(e, "position"), c = m(e), f = {}; "static" === l && (e.style.position = "relative"), s = c.offset(), o = m.css(e, "top"), u = m.css(e, "left"), ("absolute" === l || "fixed" === l) && (o + u).indexOf("auto") > -1 ? (a = (r = c.position()).top, i = r.left) : (a = parseFloat(o) || 0, i = parseFloat(u) || 0), m.isFunction(t) && (t = t.call(e, n, m.extend({}, s))), null != t.top && (f.top = t.top - s.top + a), null != t.left && (f.left = t.left - s.left + i), "using" in t ? t.using.call(e, f) : c.css(f) } }, m.fn.extend({ offset: function (e) { if (arguments.length) return void 0 === e ? this : this.each((function (t) { m.offset.setOffset(this, e, t) })); var t, n, r, i, o = this[0]; return o ? o.getClientRects().length ? (r = o.getBoundingClientRect()).width || r.height ? (n = Pt(i = o.ownerDocument), t = i.documentElement, { top: r.top + n.pageYOffset - t.clientTop, left: r.left + n.pageXOffset - t.clientLeft }) : r : { top: 0, left: 0 } : void 0 }, position: function () { if (this[0]) { var e, t, n = this[0], r = { top: 0, left: 0 }; return "fixed" === m.css(n, "position") ? t = n.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), m.nodeName(e[0], "html") || (r = e.offset()), r = { top: r.top + m.css(e[0], "borderTopWidth", !0), left: r.left + m.css(e[0], "borderLeftWidth", !0) }), { top: t.top - r.top - m.css(n, "marginTop", !0), left: t.left - r.left - m.css(n, "marginLeft", !0) } } }, offsetParent: function () { return this.map((function () { for (var e = this.offsetParent; e && "static" === m.css(e, "position");)e = e.offsetParent; return e || de })) } }), m.each({ scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, (function (e, t) { var n = "pageYOffset" === t; m.fn[e] = function (r) { return B(this, (function (e, r, i) { var o = Pt(e); return void 0 === i ? o ? o[t] : e[r] : void (o ? o.scrollTo(n ? o.pageXOffset : i, n ? i : o.pageYOffset) : e[r] = i) }), e, r, arguments.length) } })), m.each(["top", "left"], (function (e, t) { m.cssHooks[t] = Re(h.pixelPosition, (function (e, n) { if (n) return n = Pe(e, t), Fe.test(n) ? m(e).position()[t] + "px" : n })) })), m.each({ Height: "height", Width: "width" }, (function (e, t) { m.each({ padding: "inner" + e, content: t, "": "outer" + e }, (function (n, r) { m.fn[r] = function (i, o) { var a = arguments.length && (n || "boolean" != typeof i), s = n || (!0 === i || !0 === o ? "margin" : "border"); return B(this, (function (t, n, i) { var o; return m.isWindow(t) ? 0 === r.indexOf("outer") ? t["inner" + e] : t.document.documentElement["client" + e] : 9 === t.nodeType ? (o = t.documentElement, Math.max(t.body["scroll" + e], o["scroll" + e], t.body["offset" + e], o["offset" + e], o["client" + e])) : void 0 === i ? m.css(t, n, s) : m.style(t, n, i, s) }), t, a ? i : void 0, a) } })) })), m.fn.extend({ bind: function (e, t, n) { return this.on(e, null, t, n) }, unbind: function (e, t) { return this.off(e, null, t) }, delegate: function (e, t, n, r) { return this.on(t, e, n, r) }, undelegate: function (e, t, n) { return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n) } }), m.parseJSON = JSON.parse, "function" == typeof define && define.amd && define("jquery", [], (function () { return m })); var Rt = e.jQuery, Mt = e.$; return m.noConflict = function (t) { return e.$ === m && (e.$ = Mt), t && e.jQuery === m && (e.jQuery = Rt), m }, t || (e.jQuery = e.$ = m), m }));
/*! jQuery UI - v1.12.1 - 2018-05-31
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, focusable.js, form-reset-mixin.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/draggable.js, widgets/droppable.js, widgets/resizable.js, widgets/selectable.js, widgets/sortable.js, widgets/datepicker.js, widgets/menu.js, widgets/mouse.js, widgets/selectmenu.js, effect.js, effects/effect-shake.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
!function (t) { "function" == typeof define && define.amd ? define(["jquery"], t) : t(jQuery) }((function (t) { function e() { this._curInst = null, this._keyEvent = !1, this._disabledInputs = [], this._datepickerShowing = !1, this._inDialog = !1, this._mainDivId = "ui-datepicker-div", this._inlineClass = "ui-datepicker-inline", this._appendClass = "ui-datepicker-append", this._triggerClass = "ui-datepicker-trigger", this._dialogClass = "ui-datepicker-dialog", this._disableClass = "ui-datepicker-disabled", this._unselectableClass = "ui-datepicker-unselectable", this._currentClass = "ui-datepicker-current-day", this._dayOverClass = "ui-datepicker-days-cell-over", this.regional = [], this.regional[""] = { closeText: "Done", prevText: "Prev", nextText: "Next", currentText: "Today", monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"], weekHeader: "Wk", dateFormat: "mm/dd/yy", firstDay: 0, isRTL: !1, showMonthAfterYear: !1, yearSuffix: "" }, this._defaults = { showOn: "focus", showAnim: "fadeIn", showOptions: {}, defaultDate: null, appendText: "", buttonText: "...", buttonImage: "", buttonImageOnly: !1, hideIfNoPrevNext: !1, navigationAsDateFormat: !1, gotoCurrent: !1, changeMonth: !1, changeYear: !1, yearRange: "c-10:c+10", showOtherMonths: !1, selectOtherMonths: !1, showWeek: !1, calculateWeek: this.iso8601Week, shortYearCutoff: "+10", minDate: null, maxDate: null, duration: "fast", beforeShowDay: null, beforeShow: null, onSelect: null, onChangeMonthYear: null, onClose: null, numberOfMonths: 1, showCurrentAtPos: 0, stepMonths: 1, stepBigMonths: 12, altField: "", altFormat: "", constrainInput: !0, showButtonPanel: !1, autoSize: !1, disabled: !1 }, t.extend(this._defaults, this.regional[""]), this.regional.en = t.extend(!0, {}, this.regional[""]), this.regional["en-US"] = t.extend(!0, {}, this.regional.en), this.dpDiv = i(t("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")) } function i(e) { var i = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a"; return e.on("mouseout", i, (function () { t(this).removeClass("ui-state-hover"), -1 !== this.className.indexOf("ui-datepicker-prev") && t(this).removeClass("ui-datepicker-prev-hover"), -1 !== this.className.indexOf("ui-datepicker-next") && t(this).removeClass("ui-datepicker-next-hover") })).on("mouseover", i, s) } function s() { t.datepicker._isDisabledDatepicker(h.inline ? h.dpDiv.parent()[0] : h.input[0]) || (t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"), t(this).addClass("ui-state-hover"), -1 !== this.className.indexOf("ui-datepicker-prev") && t(this).addClass("ui-datepicker-prev-hover"), -1 !== this.className.indexOf("ui-datepicker-next") && t(this).addClass("ui-datepicker-next-hover")) } function n(e, i) { for (var s in t.extend(e, i), i) null == i[s] && (e[s] = i[s]); return e } t.ui = t.ui || {}, t.ui.version = "1.12.1"; var o = 0, r = Array.prototype.slice; t.cleanData = function (e) { return function (i) { var s, n, o; for (o = 0; null != (n = i[o]); o++)try { (s = t._data(n, "events")) && s.remove && t(n).triggerHandler("remove") } catch (t) { } e(i) } }(t.cleanData), t.widget = function (e, i, s) { var n, o, r, a = {}, h = e.split(".")[0], l = h + "-" + (e = e.split(".")[1]); return s || (s = i, i = t.Widget), t.isArray(s) && (s = t.extend.apply(null, [{}].concat(s))), t.expr[":"][l.toLowerCase()] = function (e) { return !!t.data(e, l) }, t[h] = t[h] || {}, n = t[h][e], o = t[h][e] = function (t, e) { return this._createWidget ? void (arguments.length && this._createWidget(t, e)) : new o(t, e) }, t.extend(o, n, { version: s.version, _proto: t.extend({}, s), _childConstructors: [] }), (r = new i).options = t.widget.extend({}, r.options), t.each(s, (function (e, s) { return t.isFunction(s) ? void (a[e] = function () { function t() { return i.prototype[e].apply(this, arguments) } function n(t) { return i.prototype[e].apply(this, t) } return function () { var e, i = this._super, o = this._superApply; return this._super = t, this._superApply = n, e = s.apply(this, arguments), this._super = i, this._superApply = o, e } }()) : void (a[e] = s) })), o.prototype = t.widget.extend(r, { widgetEventPrefix: n && r.widgetEventPrefix || e }, a, { constructor: o, namespace: h, widgetName: e, widgetFullName: l }), n ? (t.each(n._childConstructors, (function (e, i) { var s = i.prototype; t.widget(s.namespace + "." + s.widgetName, o, i._proto) })), delete n._childConstructors) : i._childConstructors.push(o), t.widget.bridge(e, o), o }, t.widget.extend = function (e) { for (var i, s, n = r.call(arguments, 1), o = 0, a = n.length; a > o; o++)for (i in n[o]) s = n[o][i], n[o].hasOwnProperty(i) && void 0 !== s && (e[i] = t.isPlainObject(s) ? t.isPlainObject(e[i]) ? t.widget.extend({}, e[i], s) : t.widget.extend({}, s) : s); return e }, t.widget.bridge = function (e, i) { var s = i.prototype.widgetFullName || e; t.fn[e] = function (n) { var o = "string" == typeof n, a = r.call(arguments, 1), h = this; return o ? this.length || "instance" !== n ? this.each((function () { var i, o = t.data(this, s); return "instance" === n ? (h = o, !1) : o ? t.isFunction(o[n]) && "_" !== n.charAt(0) ? (i = o[n].apply(o, a)) !== o && void 0 !== i ? (h = i && i.jquery ? h.pushStack(i.get()) : i, !1) : void 0 : t.error("no such method '" + n + "' for " + e + " widget instance") : t.error("cannot call methods on " + e + " prior to initialization; attempted to call method '" + n + "'") })) : h = void 0 : (a.length && (n = t.widget.extend.apply(null, [n].concat(a))), this.each((function () { var e = t.data(this, s); e ? (e.option(n || {}), e._init && e._init()) : t.data(this, s, new i(n, this)) }))), h } }, t.Widget = function () { }, t.Widget._childConstructors = [], t.Widget.prototype = { widgetName: "widget", widgetEventPrefix: "", defaultElement: "<div>", options: { classes: {}, disabled: !1, create: null }, _createWidget: function (e, i) { i = t(i || this.defaultElement || this)[0], this.element = t(i), this.uuid = o++, this.eventNamespace = "." + this.widgetName + this.uuid, this.bindings = t(), this.hoverable = t(), this.focusable = t(), this.classesElementLookup = {}, i !== this && (t.data(i, this.widgetFullName, this), this._on(!0, this.element, { remove: function (t) { t.target === i && this.destroy() } }), this.document = t(i.style ? i.ownerDocument : i.document || i), this.window = t(this.document[0].defaultView || this.document[0].parentWindow)), this.options = t.widget.extend({}, this.options, this._getCreateOptions(), e), this._create(), this.options.disabled && this._setOptionDisabled(this.options.disabled), this._trigger("create", null, this._getCreateEventData()), this._init() }, _getCreateOptions: function () { return {} }, _getCreateEventData: t.noop, _create: t.noop, _init: t.noop, destroy: function () { var e = this; this._destroy(), t.each(this.classesElementLookup, (function (t, i) { e._removeClass(i, t) })), this.element.off(this.eventNamespace).removeData(this.widgetFullName), this.widget().off(this.eventNamespace).removeAttr("aria-disabled"), this.bindings.off(this.eventNamespace) }, _destroy: t.noop, widget: function () { return this.element }, option: function (e, i) { var s, n, o, r = e; if (0 === arguments.length) return t.widget.extend({}, this.options); if ("string" == typeof e) if (r = {}, s = e.split("."), e = s.shift(), s.length) { for (n = r[e] = t.widget.extend({}, this.options[e]), o = 0; s.length - 1 > o; o++)n[s[o]] = n[s[o]] || {}, n = n[s[o]]; if (e = s.pop(), 1 === arguments.length) return void 0 === n[e] ? null : n[e]; n[e] = i } else { if (1 === arguments.length) return void 0 === this.options[e] ? null : this.options[e]; r[e] = i } return this._setOptions(r), this }, _setOptions: function (t) { var e; for (e in t) this._setOption(e, t[e]); return this }, _setOption: function (t, e) { return "classes" === t && this._setOptionClasses(e), this.options[t] = e, "disabled" === t && this._setOptionDisabled(e), this }, _setOptionClasses: function (e) { var i, s, n; for (i in e) n = this.classesElementLookup[i], e[i] !== this.options.classes[i] && n && n.length && (s = t(n.get()), this._removeClass(n, i), s.addClass(this._classes({ element: s, keys: i, classes: e, add: !0 }))) }, _setOptionDisabled: function (t) { this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null, !!t), t && (this._removeClass(this.hoverable, null, "ui-state-hover"), this._removeClass(this.focusable, null, "ui-state-focus")) }, enable: function () { return this._setOptions({ disabled: !1 }) }, disable: function () { return this._setOptions({ disabled: !0 }) }, _classes: function (e) { function i(i, o) { var r, a; for (a = 0; i.length > a; a++)r = n.classesElementLookup[i[a]] || t(), r = e.add ? t(t.unique(r.get().concat(e.element.get()))) : t(r.not(e.element).get()), n.classesElementLookup[i[a]] = r, s.push(i[a]), o && e.classes[i[a]] && s.push(e.classes[i[a]]) } var s = [], n = this; return e = t.extend({ element: this.element, classes: this.options.classes || {} }, e), this._on(e.element, { remove: "_untrackClassesElement" }), e.keys && i(e.keys.match(/\S+/g) || [], !0), e.extra && i(e.extra.match(/\S+/g) || []), s.join(" ") }, _untrackClassesElement: function (e) { var i = this; t.each(i.classesElementLookup, (function (s, n) { -1 !== t.inArray(e.target, n) && (i.classesElementLookup[s] = t(n.not(e.target).get())) })) }, _removeClass: function (t, e, i) { return this._toggleClass(t, e, i, !1) }, _addClass: function (t, e, i) { return this._toggleClass(t, e, i, !0) }, _toggleClass: function (t, e, i, s) { s = "boolean" == typeof s ? s : i; var n = "string" == typeof t || null === t, o = { extra: n ? e : i, keys: n ? t : e, element: n ? this.element : t, add: s }; return o.element.toggleClass(this._classes(o), s), this }, _on: function (e, i, s) { var n, o = this; "boolean" != typeof e && (s = i, i = e, e = !1), s ? (i = n = t(i), this.bindings = this.bindings.add(i)) : (s = i, i = this.element, n = this.widget()), t.each(s, (function (s, r) { function a() { return e || !0 !== o.options.disabled && !t(this).hasClass("ui-state-disabled") ? ("string" == typeof r ? o[r] : r).apply(o, arguments) : void 0 } "string" != typeof r && (a.guid = r.guid = r.guid || a.guid || t.guid++); var h = s.match(/^([\w:-]*)\s*(.*)$/), l = h[1] + o.eventNamespace, c = h[2]; c ? n.on(l, c, a) : i.on(l, a) })) }, _off: function (e, i) { i = (i || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, e.off(i).off(i), this.bindings = t(this.bindings.not(e).get()), this.focusable = t(this.focusable.not(e).get()), this.hoverable = t(this.hoverable.not(e).get()) }, _delay: function (t, e) { var i = this; return setTimeout((function () { return ("string" == typeof t ? i[t] : t).apply(i, arguments) }), e || 0) }, _hoverable: function (e) { this.hoverable = this.hoverable.add(e), this._on(e, { mouseenter: function (e) { this._addClass(t(e.currentTarget), null, "ui-state-hover") }, mouseleave: function (e) { this._removeClass(t(e.currentTarget), null, "ui-state-hover") } }) }, _focusable: function (e) { this.focusable = this.focusable.add(e), this._on(e, { focusin: function (e) { this._addClass(t(e.currentTarget), null, "ui-state-focus") }, focusout: function (e) { this._removeClass(t(e.currentTarget), null, "ui-state-focus") } }) }, _trigger: function (e, i, s) { var n, o, r = this.options[e]; if (s = s || {}, (i = t.Event(i)).type = (e === this.widgetEventPrefix ? e : this.widgetEventPrefix + e).toLowerCase(), i.target = this.element[0], o = i.originalEvent) for (n in o) n in i || (i[n] = o[n]); return this.element.trigger(i, s), !(t.isFunction(r) && !1 === r.apply(this.element[0], [i].concat(s)) || i.isDefaultPrevented()) } }, t.each({ show: "fadeIn", hide: "fadeOut" }, (function (e, i) { t.Widget.prototype["_" + e] = function (s, n, o) { "string" == typeof n && (n = { effect: n }); var r, a = n ? !0 === n || "number" == typeof n ? i : n.effect || i : e; "number" == typeof (n = n || {}) && (n = { duration: n }), r = !t.isEmptyObject(n), n.complete = o, n.delay && s.delay(n.delay), r && t.effects && t.effects.effect[a] ? s[e](n) : a !== e && s[a] ? s[a](n.duration, n.easing, o) : s.queue((function (i) { t(this)[e](), o && o.call(s[0]), i() })) } })), t.widget, function () { function e(t, e, i) { return [parseFloat(t[0]) * (u.test(t[0]) ? e / 100 : 1), parseFloat(t[1]) * (u.test(t[1]) ? i / 100 : 1)] } function i(e, i) { return parseInt(t.css(e, i), 10) || 0 } function s(e) { var i = e[0]; return 9 === i.nodeType ? { width: e.width(), height: e.height(), offset: { top: 0, left: 0 } } : t.isWindow(i) ? { width: e.width(), height: e.height(), offset: { top: e.scrollTop(), left: e.scrollLeft() } } : i.preventDefault ? { width: 0, height: 0, offset: { top: i.pageY, left: i.pageX } } : { width: e.outerWidth(), height: e.outerHeight(), offset: e.offset() } } var n, o = Math.max, r = Math.abs, a = /left|center|right/, h = /top|center|bottom/, l = /[\+\-]\d+(\.[\d]+)?%?/, c = /^\w+/, u = /%$/, d = t.fn.position; t.position = { scrollbarWidth: function () { if (void 0 !== n) return n; var e, i, s = t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"), o = s.children()[0]; return t("body").append(s), e = o.offsetWidth, s.css("overflow", "scroll"), e === (i = o.offsetWidth) && (i = s[0].clientWidth), s.remove(), n = e - i }, getScrollInfo: function (e) { var i = e.isWindow || e.isDocument ? "" : e.element.css("overflow-x"), s = e.isWindow || e.isDocument ? "" : e.element.css("overflow-y"), n = "scroll" === i || "auto" === i && e.width < e.element[0].scrollWidth; return { width: "scroll" === s || "auto" === s && e.height < e.element[0].scrollHeight ? t.position.scrollbarWidth() : 0, height: n ? t.position.scrollbarWidth() : 0 } }, getWithinInfo: function (e) { var i = t(e || window), s = t.isWindow(i[0]), n = !!i[0] && 9 === i[0].nodeType; return { element: i, isWindow: s, isDocument: n, offset: !s && !n ? t(e).offset() : { left: 0, top: 0 }, scrollLeft: i.scrollLeft(), scrollTop: i.scrollTop(), width: i.outerWidth(), height: i.outerHeight() } } }, t.fn.position = function (n) { if (!n || !n.of) return d.apply(this, arguments); n = t.extend({}, n); var u, p, f, g, m, _, v = t(n.of), b = t.position.getWithinInfo(n.within), y = t.position.getScrollInfo(b), w = (n.collision || "flip").split(" "), k = {}; return _ = s(v), v[0].preventDefault && (n.at = "left top"), p = _.width, f = _.height, g = _.offset, m = t.extend({}, g), t.each(["my", "at"], (function () { var t, e, i = (n[this] || "").split(" "); 1 === i.length && (i = a.test(i[0]) ? i.concat(["center"]) : h.test(i[0]) ? ["center"].concat(i) : ["center", "center"]), i[0] = a.test(i[0]) ? i[0] : "center", i[1] = h.test(i[1]) ? i[1] : "center", t = l.exec(i[0]), e = l.exec(i[1]), k[this] = [t ? t[0] : 0, e ? e[0] : 0], n[this] = [c.exec(i[0])[0], c.exec(i[1])[0]] })), 1 === w.length && (w[1] = w[0]), "right" === n.at[0] ? m.left += p : "center" === n.at[0] && (m.left += p / 2), "bottom" === n.at[1] ? m.top += f : "center" === n.at[1] && (m.top += f / 2), u = e(k.at, p, f), m.left += u[0], m.top += u[1], this.each((function () { var s, a, h = t(this), l = h.outerWidth(), c = h.outerHeight(), d = i(this, "marginLeft"), _ = i(this, "marginTop"), D = l + d + i(this, "marginRight") + y.width, C = c + _ + i(this, "marginBottom") + y.height, x = t.extend({}, m), I = e(k.my, h.outerWidth(), h.outerHeight()); "right" === n.my[0] ? x.left -= l : "center" === n.my[0] && (x.left -= l / 2), "bottom" === n.my[1] ? x.top -= c : "center" === n.my[1] && (x.top -= c / 2), x.left += I[0], x.top += I[1], s = { marginLeft: d, marginTop: _ }, t.each(["left", "top"], (function (e, i) { t.ui.position[w[e]] && t.ui.position[w[e]][i](x, { targetWidth: p, targetHeight: f, elemWidth: l, elemHeight: c, collisionPosition: s, collisionWidth: D, collisionHeight: C, offset: [u[0] + I[0], u[1] + I[1]], my: n.my, at: n.at, within: b, elem: h }) })), n.using && (a = function (t) { var e = g.left - x.left, i = e + p - l, s = g.top - x.top, a = s + f - c, u = { target: { element: v, left: g.left, top: g.top, width: p, height: f }, element: { element: h, left: x.left, top: x.top, width: l, height: c }, horizontal: 0 > i ? "left" : e > 0 ? "right" : "center", vertical: 0 > a ? "top" : s > 0 ? "bottom" : "middle" }; l > p && p > r(e + i) && (u.horizontal = "center"), c > f && f > r(s + a) && (u.vertical = "middle"), u.important = o(r(e), r(i)) > o(r(s), r(a)) ? "horizontal" : "vertical", n.using.call(this, t, u) }), h.offset(t.extend(x, { using: a })) })) }, t.ui.position = { fit: { left: function (t, e) { var i, s = e.within, n = s.isWindow ? s.scrollLeft : s.offset.left, r = s.width, a = t.left - e.collisionPosition.marginLeft, h = n - a, l = a + e.collisionWidth - r - n; e.collisionWidth > r ? h > 0 && 0 >= l ? (i = t.left + h + e.collisionWidth - r - n, t.left += h - i) : t.left = l > 0 && 0 >= h ? n : h > l ? n + r - e.collisionWidth : n : h > 0 ? t.left += h : l > 0 ? t.left -= l : t.left = o(t.left - a, t.left) }, top: function (t, e) { var i, s = e.within, n = s.isWindow ? s.scrollTop : s.offset.top, r = e.within.height, a = t.top - e.collisionPosition.marginTop, h = n - a, l = a + e.collisionHeight - r - n; e.collisionHeight > r ? h > 0 && 0 >= l ? (i = t.top + h + e.collisionHeight - r - n, t.top += h - i) : t.top = l > 0 && 0 >= h ? n : h > l ? n + r - e.collisionHeight : n : h > 0 ? t.top += h : l > 0 ? t.top -= l : t.top = o(t.top - a, t.top) } }, flip: { left: function (t, e) { var i, s, n = e.within, o = n.offset.left + n.scrollLeft, a = n.width, h = n.isWindow ? n.scrollLeft : n.offset.left, l = t.left - e.collisionPosition.marginLeft, c = l - h, u = l + e.collisionWidth - a - h, d = "left" === e.my[0] ? -e.elemWidth : "right" === e.my[0] ? e.elemWidth : 0, p = "left" === e.at[0] ? e.targetWidth : "right" === e.at[0] ? -e.targetWidth : 0, f = -2 * e.offset[0]; 0 > c ? (0 > (i = t.left + d + p + f + e.collisionWidth - a - o) || r(c) > i) && (t.left += d + p + f) : u > 0 && (((s = t.left - e.collisionPosition.marginLeft + d + p + f - h) > 0 || u > r(s)) && (t.left += d + p + f)) }, top: function (t, e) { var i, s, n = e.within, o = n.offset.top + n.scrollTop, a = n.height, h = n.isWindow ? n.scrollTop : n.offset.top, l = t.top - e.collisionPosition.marginTop, c = l - h, u = l + e.collisionHeight - a - h, d = "top" === e.my[1] ? -e.elemHeight : "bottom" === e.my[1] ? e.elemHeight : 0, p = "top" === e.at[1] ? e.targetHeight : "bottom" === e.at[1] ? -e.targetHeight : 0, f = -2 * e.offset[1]; 0 > c ? (0 > (s = t.top + d + p + f + e.collisionHeight - a - o) || r(c) > s) && (t.top += d + p + f) : u > 0 && (((i = t.top - e.collisionPosition.marginTop + d + p + f - h) > 0 || u > r(i)) && (t.top += d + p + f)) } }, flipfit: { left: function () { t.ui.position.flip.left.apply(this, arguments), t.ui.position.fit.left.apply(this, arguments) }, top: function () { t.ui.position.flip.top.apply(this, arguments), t.ui.position.fit.top.apply(this, arguments) } } } }(), t.ui.position, t.extend(t.expr[":"], { data: t.expr.createPseudo ? t.expr.createPseudo((function (e) { return function (i) { return !!t.data(i, e) } })) : function (e, i, s) { return !!t.data(e, s[3]) } }), t.fn.extend({ disableSelection: function () { var t = "onselectstart" in document.createElement("div") ? "selectstart" : "mousedown"; return function () { return this.on(t + ".ui-disableSelection", (function (t) { t.preventDefault() })) } }(), enableSelection: function () { return this.off(".ui-disableSelection") } }), t.ui.focusable = function (e, i) { var s, n, o, r, a, h = e.nodeName.toLowerCase(); return "area" === h ? (n = (s = e.parentNode).name, !(!e.href || !n || "map" !== s.nodeName.toLowerCase()) && ((o = t("img[usemap='#" + n + "']")).length > 0 && o.is(":visible"))) : (/^(input|select|textarea|button|object)$/.test(h) ? (r = !e.disabled) && ((a = t(e).closest("fieldset")[0]) && (r = !a.disabled)) : r = "a" === h && e.href || i, r && t(e).is(":visible") && function (t) { for (var e = t.css("visibility"); "inherit" === e;)e = (t = t.parent()).css("visibility"); return "hidden" !== e }(t(e))) }, t.extend(t.expr[":"], { focusable: function (e) { return t.ui.focusable(e, null != t.attr(e, "tabindex")) } }), t.ui.focusable, t.fn.form = function () { return "string" == typeof this[0].form ? this.closest("form") : t(this[0].form) }, t.ui.formResetMixin = { _formResetHandler: function () { var e = t(this); setTimeout((function () { var i = e.data("ui-form-reset-instances"); t.each(i, (function () { this.refresh() })) })) }, _bindFormResetHandler: function () { if (this.form = this.element.form(), this.form.length) { var t = this.form.data("ui-form-reset-instances") || []; t.length || this.form.on("reset.ui-form-reset", this._formResetHandler), t.push(this), this.form.data("ui-form-reset-instances", t) } }, _unbindFormResetHandler: function () { if (this.form.length) { var e = this.form.data("ui-form-reset-instances"); e.splice(t.inArray(this, e), 1), e.length ? this.form.data("ui-form-reset-instances", e) : this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset") } } }, t.ui.keyCode = { BACKSPACE: 8, COMMA: 188, DELETE: 46, DOWN: 40, END: 35, ENTER: 13, ESCAPE: 27, HOME: 36, LEFT: 37, PAGE_DOWN: 34, PAGE_UP: 33, PERIOD: 190, RIGHT: 39, SPACE: 32, TAB: 9, UP: 38 }, t.ui.escapeSelector = function () { var t = /([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g; return function (e) { return e.replace(t, "\\$1") } }(), t.fn.labels = function () { var e, i, s, n, o; return this[0].labels && this[0].labels.length ? this.pushStack(this[0].labels) : (n = this.eq(0).parents("label"), (s = this.attr("id")) && (o = (e = this.eq(0).parents().last()).add(e.length ? e.siblings() : this.siblings()), i = "label[for='" + t.ui.escapeSelector(s) + "']", n = n.add(o.find(i).addBack(i))), this.pushStack(n)) }, t.fn.scrollParent = function (e) { var i = this.css("position"), s = "absolute" === i, n = e ? /(auto|scroll|hidden)/ : /(auto|scroll)/, o = this.parents().filter((function () { var e = t(this); return (!s || "static" !== e.css("position")) && n.test(e.css("overflow") + e.css("overflow-y") + e.css("overflow-x")) })).eq(0); return "fixed" !== i && o.length ? o : t(this[0].ownerDocument || document) }, t.extend(t.expr[":"], { tabbable: function (e) { var i = t.attr(e, "tabindex"), s = null != i; return (!s || i >= 0) && t.ui.focusable(e, s) } }), t.fn.extend({ uniqueId: function () { var t = 0; return function () { return this.each((function () { this.id || (this.id = "ui-id-" + ++t) })) } }(), removeUniqueId: function () { return this.each((function () { /^ui-id-\d+$/.test(this.id) && t(this).removeAttr("id") })) } }), t.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()); var a = !1; t(document).on("mouseup", (function () { a = !1 })), t.widget("ui.mouse", { version: "1.12.1", options: { cancel: "input, textarea, button, select, option", distance: 1, delay: 0 }, _mouseInit: function () { var e = this; this.element.on("mousedown." + this.widgetName, (function (t) { return e._mouseDown(t) })).on("click." + this.widgetName, (function (i) { return !0 === t.data(i.target, e.widgetName + ".preventClickEvent") ? (t.removeData(i.target, e.widgetName + ".preventClickEvent"), i.stopImmediatePropagation(), !1) : void 0 })), this.started = !1 }, _mouseDestroy: function () { this.element.off("." + this.widgetName), this._mouseMoveDelegate && this.document.off("mousemove." + this.widgetName, this._mouseMoveDelegate).off("mouseup." + this.widgetName, this._mouseUpDelegate) }, _mouseDown: function (e) { if (!a) { this._mouseMoved = !1, this._mouseStarted && this._mouseUp(e), this._mouseDownEvent = e; var i = this, s = 1 === e.which, n = !("string" != typeof this.options.cancel || !e.target.nodeName) && t(e.target).closest(this.options.cancel).length; return !(s && !n && this._mouseCapture(e)) || (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout((function () { i.mouseDelayMet = !0 }), this.options.delay)), this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = !1 !== this._mouseStart(e), !this._mouseStarted) ? (e.preventDefault(), !0) : (!0 === t.data(e.target, this.widgetName + ".preventClickEvent") && t.removeData(e.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function (t) { return i._mouseMove(t) }, this._mouseUpDelegate = function (t) { return i._mouseUp(t) }, this.document.on("mousemove." + this.widgetName, this._mouseMoveDelegate).on("mouseup." + this.widgetName, this._mouseUpDelegate), e.preventDefault(), a = !0, !0)) } }, _mouseMove: function (e) { if (this._mouseMoved) { if (t.ui.ie && (!document.documentMode || 9 > document.documentMode) && !e.button) return this._mouseUp(e); if (!e.which) if (e.originalEvent.altKey || e.originalEvent.ctrlKey || e.originalEvent.metaKey || e.originalEvent.shiftKey) this.ignoreMissingWhich = !0; else if (!this.ignoreMissingWhich) return this._mouseUp(e) } return (e.which || e.button) && (this._mouseMoved = !0), this._mouseStarted ? (this._mouseDrag(e), e.preventDefault()) : (this._mouseDistanceMet(e) && this._mouseDelayMet(e) && (this._mouseStarted = !1 !== this._mouseStart(this._mouseDownEvent, e), this._mouseStarted ? this._mouseDrag(e) : this._mouseUp(e)), !this._mouseStarted) }, _mouseUp: function (e) { this.document.off("mousemove." + this.widgetName, this._mouseMoveDelegate).off("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, e.target === this._mouseDownEvent.target && t.data(e.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(e)), this._mouseDelayTimer && (clearTimeout(this._mouseDelayTimer), delete this._mouseDelayTimer), this.ignoreMissingWhich = !1, a = !1, e.preventDefault() }, _mouseDistanceMet: function (t) { return Math.max(Math.abs(this._mouseDownEvent.pageX - t.pageX), Math.abs(this._mouseDownEvent.pageY - t.pageY)) >= this.options.distance }, _mouseDelayMet: function () { return this.mouseDelayMet }, _mouseStart: function () { }, _mouseDrag: function () { }, _mouseStop: function () { }, _mouseCapture: function () { return !0 } }), t.ui.plugin = { add: function (e, i, s) { var n, o = t.ui[e].prototype; for (n in s) o.plugins[n] = o.plugins[n] || [], o.plugins[n].push([i, s[n]]) }, call: function (t, e, i, s) { var n, o = t.plugins[e]; if (o && (s || t.element[0].parentNode && 11 !== t.element[0].parentNode.nodeType)) for (n = 0; o.length > n; n++)t.options[o[n][0]] && o[n][1].apply(t.element, i) } }, t.ui.safeActiveElement = function (t) { var e; try { e = t.activeElement } catch (i) { e = t.body } return e || (e = t.body), e.nodeName || (e = t.body), e }, t.ui.safeBlur = function (e) { e && "body" !== e.nodeName.toLowerCase() && t(e).trigger("blur") }, t.widget("ui.draggable", t.ui.mouse, { version: "1.12.1", widgetEventPrefix: "drag", options: { addClasses: !0, appendTo: "parent", axis: !1, connectToSortable: !1, containment: !1, cursor: "auto", cursorAt: !1, grid: !1, handle: !1, helper: "original", iframeFix: !1, opacity: !1, refreshPositions: !1, revert: !1, revertDuration: 500, scope: "default", scroll: !0, scrollSensitivity: 20, scrollSpeed: 20, snap: !1, snapMode: "both", snapTolerance: 20, stack: !1, zIndex: !1, drag: null, start: null, stop: null }, _create: function () { "original" === this.options.helper && this._setPositionRelative(), this.options.addClasses && this._addClass("ui-draggable"), this._setHandleClassName(), this._mouseInit() }, _setOption: function (t, e) { this._super(t, e), "handle" === t && (this._removeHandleClassName(), this._setHandleClassName()) }, _destroy: function () { return (this.helper || this.element).is(".ui-draggable-dragging") ? void (this.destroyOnClear = !0) : (this._removeHandleClassName(), void this._mouseDestroy()) }, _mouseCapture: function (e) { var i = this.options; return !(this.helper || i.disabled || t(e.target).closest(".ui-resizable-handle").length > 0) && (this.handle = this._getHandle(e), !!this.handle && (this._blurActiveElement(e), this._blockFrames(!0 === i.iframeFix ? "iframe" : i.iframeFix), !0)) }, _blockFrames: function (e) { this.iframeBlocks = this.document.find(e).map((function () { var e = t(this); return t("<div>").css("position", "absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0] })) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _blurActiveElement: function (e) { var i = t.ui.safeActiveElement(this.document[0]); t(e.target).closest(i).length || t.ui.safeBlur(i) }, _mouseStart: function (e) { var i = this.options; return this.helper = this._createHelper(e), this._addClass(this.helper, "ui-draggable-dragging"), this._cacheHelperProportions(), t.ui.ddmanager && (t.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(!0), this.offsetParent = this.helper.offsetParent(), this.hasFixedAncestor = this.helper.parents().filter((function () { return "fixed" === t(this).css("position") })).length > 0, this.positionAbs = this.element.offset(), this._refreshOffsets(e), this.originalPosition = this.position = this._generatePosition(e, !1), this.originalPageX = e.pageX, this.originalPageY = e.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt), this._setContainment(), !1 === this._trigger("start", e) ? (this._clear(), !1) : (this._cacheHelperProportions(), t.ui.ddmanager && !i.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e), this._mouseDrag(e, !0), t.ui.ddmanager && t.ui.ddmanager.dragStart(this, e), !0) }, _refreshOffsets: function (t) { this.offset = { top: this.positionAbs.top - this.margins.top, left: this.positionAbs.left - this.margins.left, scroll: !1, parent: this._getParentOffset(), relative: this._getRelativeOffset() }, this.offset.click = { left: t.pageX - this.offset.left, top: t.pageY - this.offset.top } }, _mouseDrag: function (e, i) { if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(e, !0), this.positionAbs = this._convertPositionTo("absolute"), !i) { var s = this._uiHash(); if (!1 === this._trigger("drag", e, s)) return this._mouseUp(new t.Event("mouseup", e)), !1; this.position = s.position } return this.helper[0].style.left = this.position.left + "px", this.helper[0].style.top = this.position.top + "px", t.ui.ddmanager && t.ui.ddmanager.drag(this, e), !1 }, _mouseStop: function (e) { var i = this, s = !1; return t.ui.ddmanager && !this.options.dropBehaviour && (s = t.ui.ddmanager.drop(this, e)), this.dropped && (s = this.dropped, this.dropped = !1), "invalid" === this.options.revert && !s || "valid" === this.options.revert && s || !0 === this.options.revert || t.isFunction(this.options.revert) && this.options.revert.call(this.element, s) ? t(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), (function () { !1 !== i._trigger("stop", e) && i._clear() })) : !1 !== this._trigger("stop", e) && this._clear(), !1 }, _mouseUp: function (e) { return this._unblockFrames(), t.ui.ddmanager && t.ui.ddmanager.dragStop(this, e), this.handleElement.is(e.target) && this.element.trigger("focus"), t.ui.mouse.prototype._mouseUp.call(this, e) }, cancel: function () { return this.helper.is(".ui-draggable-dragging") ? this._mouseUp(new t.Event("mouseup", { target: this.element[0] })) : this._clear(), this }, _getHandle: function (e) { return !this.options.handle || !!t(e.target).closest(this.element.find(this.options.handle)).length }, _setHandleClassName: function () { this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element, this._addClass(this.handleElement, "ui-draggable-handle") }, _removeHandleClassName: function () { this._removeClass(this.handleElement, "ui-draggable-handle") }, _createHelper: function (e) { var i = this.options, s = t.isFunction(i.helper), n = s ? t(i.helper.apply(this.element[0], [e])) : "clone" === i.helper ? this.element.clone().removeAttr("id") : this.element; return n.parents("body").length || n.appendTo("parent" === i.appendTo ? this.element[0].parentNode : i.appendTo), s && n[0] === this.element[0] && this._setPositionRelative(), n[0] === this.element[0] || /(fixed|absolute)/.test(n.css("position")) || n.css("position", "absolute"), n }, _setPositionRelative: function () { /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative") }, _adjustOffsetFromHelper: function (e) { "string" == typeof e && (e = e.split(" ")), t.isArray(e) && (e = { left: +e[0], top: +e[1] || 0 }), "left" in e && (this.offset.click.left = e.left + this.margins.left), "right" in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left), "top" in e && (this.offset.click.top = e.top + this.margins.top), "bottom" in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top) }, _isRootNode: function (t) { return /(html|body)/i.test(t.tagName) || t === this.document[0] }, _getParentOffset: function () { var e = this.offsetParent.offset(), i = this.document[0]; return "absolute" === this.cssPosition && this.scrollParent[0] !== i && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(), e.top += this.scrollParent.scrollTop()), this._isRootNode(this.offsetParent[0]) && (e = { top: 0, left: 0 }), { top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0) } }, _getRelativeOffset: function () { if ("relative" !== this.cssPosition) return { top: 0, left: 0 }; var t = this.element.position(), e = this._isRootNode(this.scrollParent[0]); return { top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + (e ? 0 : this.scrollParent.scrollTop()), left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + (e ? 0 : this.scrollParent.scrollLeft()) } }, _cacheMargins: function () { this.margins = { left: parseInt(this.element.css("marginLeft"), 10) || 0, top: parseInt(this.element.css("marginTop"), 10) || 0, right: parseInt(this.element.css("marginRight"), 10) || 0, bottom: parseInt(this.element.css("marginBottom"), 10) || 0 } }, _cacheHelperProportions: function () { this.helperProportions = { width: this.helper.outerWidth(), height: this.helper.outerHeight() } }, _setContainment: function () { var e, i, s, n = this.options, o = this.document[0]; return this.relativeContainer = null, n.containment ? "window" === n.containment ? void (this.containment = [t(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, t(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, t(window).scrollLeft() + t(window).width() - this.helperProportions.width - this.margins.left, t(window).scrollTop() + (t(window).height() || o.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]) : "document" === n.containment ? void (this.containment = [0, 0, t(o).width() - this.helperProportions.width - this.margins.left, (t(o).height() || o.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]) : n.containment.constructor === Array ? void (this.containment = n.containment) : ("parent" === n.containment && (n.containment = this.helper[0].parentNode), void ((s = (i = t(n.containment))[0]) && (e = /(scroll|auto)/.test(i.css("overflow")), this.containment = [(parseInt(i.css("borderLeftWidth"), 10) || 0) + (parseInt(i.css("paddingLeft"), 10) || 0), (parseInt(i.css("borderTopWidth"), 10) || 0) + (parseInt(i.css("paddingTop"), 10) || 0), (e ? Math.max(s.scrollWidth, s.offsetWidth) : s.offsetWidth) - (parseInt(i.css("borderRightWidth"), 10) || 0) - (parseInt(i.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (e ? Math.max(s.scrollHeight, s.offsetHeight) : s.offsetHeight) - (parseInt(i.css("borderBottomWidth"), 10) || 0) - (parseInt(i.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relativeContainer = i))) : void (this.containment = null) }, _convertPositionTo: function (t, e) { e || (e = this.position); var i = "absolute" === t ? 1 : -1, s = this._isRootNode(this.scrollParent[0]); return { top: e.top + this.offset.relative.top * i + this.offset.parent.top * i - ("fixed" === this.cssPosition ? -this.offset.scroll.top : s ? 0 : this.offset.scroll.top) * i, left: e.left + this.offset.relative.left * i + this.offset.parent.left * i - ("fixed" === this.cssPosition ? -this.offset.scroll.left : s ? 0 : this.offset.scroll.left) * i } }, _generatePosition: function (t, e) { var i, s, n, o, r = this.options, a = this._isRootNode(this.scrollParent[0]), h = t.pageX, l = t.pageY; return a && this.offset.scroll || (this.offset.scroll = { top: this.scrollParent.scrollTop(), left: this.scrollParent.scrollLeft() }), e && (this.containment && (this.relativeContainer ? (s = this.relativeContainer.offset(), i = [this.containment[0] + s.left, this.containment[1] + s.top, this.containment[2] + s.left, this.containment[3] + s.top]) : i = this.containment, t.pageX - this.offset.click.left < i[0] && (h = i[0] + this.offset.click.left), t.pageY - this.offset.click.top < i[1] && (l = i[1] + this.offset.click.top), t.pageX - this.offset.click.left > i[2] && (h = i[2] + this.offset.click.left), t.pageY - this.offset.click.top > i[3] && (l = i[3] + this.offset.click.top)), r.grid && (n = r.grid[1] ? this.originalPageY + Math.round((l - this.originalPageY) / r.grid[1]) * r.grid[1] : this.originalPageY, l = i ? n - this.offset.click.top >= i[1] || n - this.offset.click.top > i[3] ? n : n - this.offset.click.top >= i[1] ? n - r.grid[1] : n + r.grid[1] : n, o = r.grid[0] ? this.originalPageX + Math.round((h - this.originalPageX) / r.grid[0]) * r.grid[0] : this.originalPageX, h = i ? o - this.offset.click.left >= i[0] || o - this.offset.click.left > i[2] ? o : o - this.offset.click.left >= i[0] ? o - r.grid[0] : o + r.grid[0] : o), "y" === r.axis && (h = this.originalPageX), "x" === r.axis && (l = this.originalPageY)), { top: l - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.offset.scroll.top : a ? 0 : this.offset.scroll.top), left: h - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.offset.scroll.left : a ? 0 : this.offset.scroll.left) } }, _clear: function () { this._removeClass(this.helper, "ui-draggable-dragging"), this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(), this.helper = null, this.cancelHelperRemoval = !1, this.destroyOnClear && this.destroy() }, _trigger: function (e, i, s) { return s = s || this._uiHash(), t.ui.plugin.call(this, e, [i, s, this], !0), /^(drag|start|stop)/.test(e) && (this.positionAbs = this._convertPositionTo("absolute"), s.offset = this.positionAbs), t.Widget.prototype._trigger.call(this, e, i, s) }, plugins: {}, _uiHash: function () { return { helper: this.helper, position: this.position, originalPosition: this.originalPosition, offset: this.positionAbs } } }), t.ui.plugin.add("draggable", "connectToSortable", { start: function (e, i, s) { var n = t.extend({}, i, { item: s.element }); s.sortables = [], t(s.options.connectToSortable).each((function () { var i = t(this).sortable("instance"); i && !i.options.disabled && (s.sortables.push(i), i.refreshPositions(), i._trigger("activate", e, n)) })) }, stop: function (e, i, s) { var n = t.extend({}, i, { item: s.element }); s.cancelHelperRemoval = !1, t.each(s.sortables, (function () { var t = this; t.isOver ? (t.isOver = 0, s.cancelHelperRemoval = !0, t.cancelHelperRemoval = !1, t._storedCSS = { position: t.placeholder.css("position"), top: t.placeholder.css("top"), left: t.placeholder.css("left") }, t._mouseStop(e), t.options.helper = t.options._helper) : (t.cancelHelperRemoval = !0, t._trigger("deactivate", e, n)) })) }, drag: function (e, i, s) { t.each(s.sortables, (function () { var n = !1, o = this; o.positionAbs = s.positionAbs, o.helperProportions = s.helperProportions, o.offset.click = s.offset.click, o._intersectsWith(o.containerCache) && (n = !0, t.each(s.sortables, (function () { return this.positionAbs = s.positionAbs, this.helperProportions = s.helperProportions, this.offset.click = s.offset.click, this !== o && this._intersectsWith(this.containerCache) && t.contains(o.element[0], this.element[0]) && (n = !1), n }))), n ? (o.isOver || (o.isOver = 1, s._parent = i.helper.parent(), o.currentItem = i.helper.appendTo(o.element).data("ui-sortable-item", !0), o.options._helper = o.options.helper, o.options.helper = function () { return i.helper[0] }, e.target = o.currentItem[0], o._mouseCapture(e, !0), o._mouseStart(e, !0, !0), o.offset.click.top = s.offset.click.top, o.offset.click.left = s.offset.click.left, o.offset.parent.left -= s.offset.parent.left - o.offset.parent.left, o.offset.parent.top -= s.offset.parent.top - o.offset.parent.top, s._trigger("toSortable", e), s.dropped = o.element, t.each(s.sortables, (function () { this.refreshPositions() })), s.currentItem = s.element, o.fromOutside = s), o.currentItem && (o._mouseDrag(e), i.position = o.position)) : o.isOver && (o.isOver = 0, o.cancelHelperRemoval = !0, o.options._revert = o.options.revert, o.options.revert = !1, o._trigger("out", e, o._uiHash(o)), o._mouseStop(e, !0), o.options.revert = o.options._revert, o.options.helper = o.options._helper, o.placeholder && o.placeholder.remove(), i.helper.appendTo(s._parent), s._refreshOffsets(e), i.position = s._generatePosition(e, !0), s._trigger("fromSortable", e), s.dropped = !1, t.each(s.sortables, (function () { this.refreshPositions() }))) })) } }), t.ui.plugin.add("draggable", "cursor", { start: function (e, i, s) { var n = t("body"), o = s.options; n.css("cursor") && (o._cursor = n.css("cursor")), n.css("cursor", o.cursor) }, stop: function (e, i, s) { var n = s.options; n._cursor && t("body").css("cursor", n._cursor) } }), t.ui.plugin.add("draggable", "opacity", { start: function (e, i, s) { var n = t(i.helper), o = s.options; n.css("opacity") && (o._opacity = n.css("opacity")), n.css("opacity", o.opacity) }, stop: function (e, i, s) { var n = s.options; n._opacity && t(i.helper).css("opacity", n._opacity) } }), t.ui.plugin.add("draggable", "scroll", { start: function (t, e, i) { i.scrollParentNotHidden || (i.scrollParentNotHidden = i.helper.scrollParent(!1)), i.scrollParentNotHidden[0] !== i.document[0] && "HTML" !== i.scrollParentNotHidden[0].tagName && (i.overflowOffset = i.scrollParentNotHidden.offset()) }, drag: function (e, i, s) { var n = s.options, o = !1, r = s.scrollParentNotHidden[0], a = s.document[0]; r !== a && "HTML" !== r.tagName ? (n.axis && "x" === n.axis || (s.overflowOffset.top + r.offsetHeight - e.pageY < n.scrollSensitivity ? r.scrollTop = o = r.scrollTop + n.scrollSpeed : e.pageY - s.overflowOffset.top < n.scrollSensitivity && (r.scrollTop = o = r.scrollTop - n.scrollSpeed)), n.axis && "y" === n.axis || (s.overflowOffset.left + r.offsetWidth - e.pageX < n.scrollSensitivity ? r.scrollLeft = o = r.scrollLeft + n.scrollSpeed : e.pageX - s.overflowOffset.left < n.scrollSensitivity && (r.scrollLeft = o = r.scrollLeft - n.scrollSpeed))) : (n.axis && "x" === n.axis || (e.pageY - t(a).scrollTop() < n.scrollSensitivity ? o = t(a).scrollTop(t(a).scrollTop() - n.scrollSpeed) : t(window).height() - (e.pageY - t(a).scrollTop()) < n.scrollSensitivity && (o = t(a).scrollTop(t(a).scrollTop() + n.scrollSpeed))), n.axis && "y" === n.axis || (e.pageX - t(a).scrollLeft() < n.scrollSensitivity ? o = t(a).scrollLeft(t(a).scrollLeft() - n.scrollSpeed) : t(window).width() - (e.pageX - t(a).scrollLeft()) < n.scrollSensitivity && (o = t(a).scrollLeft(t(a).scrollLeft() + n.scrollSpeed)))), !1 !== o && t.ui.ddmanager && !n.dropBehaviour && t.ui.ddmanager.prepareOffsets(s, e) } }), t.ui.plugin.add("draggable", "snap", { start: function (e, i, s) { var n = s.options; s.snapElements = [], t(n.snap.constructor !== String ? n.snap.items || ":data(ui-draggable)" : n.snap).each((function () { var e = t(this), i = e.offset(); this !== s.element[0] && s.snapElements.push({ item: this, width: e.outerWidth(), height: e.outerHeight(), top: i.top, left: i.left }) })) }, drag: function (e, i, s) { var n, o, r, a, h, l, c, u, d, p, f = s.options, g = f.snapTolerance, m = i.offset.left, _ = m + s.helperProportions.width, v = i.offset.top, b = v + s.helperProportions.height; for (d = s.snapElements.length - 1; d >= 0; d--)l = (h = s.snapElements[d].left - s.margins.left) + s.snapElements[d].width, u = (c = s.snapElements[d].top - s.margins.top) + s.snapElements[d].height, h - g > _ || m > l + g || c - g > b || v > u + g || !t.contains(s.snapElements[d].item.ownerDocument, s.snapElements[d].item) ? (s.snapElements[d].snapping && s.options.snap.release && s.options.snap.release.call(s.element, e, t.extend(s._uiHash(), { snapItem: s.snapElements[d].item })), s.snapElements[d].snapping = !1) : ("inner" !== f.snapMode && (n = g >= Math.abs(c - b), o = g >= Math.abs(u - v), r = g >= Math.abs(h - _), a = g >= Math.abs(l - m), n && (i.position.top = s._convertPositionTo("relative", { top: c - s.helperProportions.height, left: 0 }).top), o && (i.position.top = s._convertPositionTo("relative", { top: u, left: 0 }).top), r && (i.position.left = s._convertPositionTo("relative", { top: 0, left: h - s.helperProportions.width }).left), a && (i.position.left = s._convertPositionTo("relative", { top: 0, left: l }).left)), p = n || o || r || a, "outer" !== f.snapMode && (n = g >= Math.abs(c - v), o = g >= Math.abs(u - b), r = g >= Math.abs(h - m), a = g >= Math.abs(l - _), n && (i.position.top = s._convertPositionTo("relative", { top: c, left: 0 }).top), o && (i.position.top = s._convertPositionTo("relative", { top: u - s.helperProportions.height, left: 0 }).top), r && (i.position.left = s._convertPositionTo("relative", { top: 0, left: h }).left), a && (i.position.left = s._convertPositionTo("relative", { top: 0, left: l - s.helperProportions.width }).left)), !s.snapElements[d].snapping && (n || o || r || a || p) && s.options.snap.snap && s.options.snap.snap.call(s.element, e, t.extend(s._uiHash(), { snapItem: s.snapElements[d].item })), s.snapElements[d].snapping = n || o || r || a || p) } }), t.ui.plugin.add("draggable", "stack", { start: function (e, i, s) { var n, o = s.options, r = t.makeArray(t(o.stack)).sort((function (e, i) { return (parseInt(t(e).css("zIndex"), 10) || 0) - (parseInt(t(i).css("zIndex"), 10) || 0) })); r.length && (n = parseInt(t(r[0]).css("zIndex"), 10) || 0, t(r).each((function (e) { t(this).css("zIndex", n + e) })), this.css("zIndex", n + r.length)) } }), t.ui.plugin.add("draggable", "zIndex", { start: function (e, i, s) { var n = t(i.helper), o = s.options; n.css("zIndex") && (o._zIndex = n.css("zIndex")), n.css("zIndex", o.zIndex) }, stop: function (e, i, s) { var n = s.options; n._zIndex && t(i.helper).css("zIndex", n._zIndex) } }), t.ui.draggable, t.widget("ui.droppable", { version: "1.12.1", widgetEventPrefix: "drop", options: { accept: "*", addClasses: !0, greedy: !1, scope: "default", tolerance: "intersect", activate: null, deactivate: null, drop: null, out: null, over: null }, _create: function () { var e, i = this.options, s = i.accept; this.isover = !1, this.isout = !0, this.accept = t.isFunction(s) ? s : function (t) { return t.is(s) }, this.proportions = function () { return arguments.length ? void (e = arguments[0]) : e || (e = { width: this.element[0].offsetWidth, height: this.element[0].offsetHeight }) }, this._addToManager(i.scope), i.addClasses && this._addClass("ui-droppable") }, _addToManager: function (e) { t.ui.ddmanager.droppables[e] = t.ui.ddmanager.droppables[e] || [], t.ui.ddmanager.droppables[e].push(this) }, _splice: function (t) { for (var e = 0; t.length > e; e++)t[e] === this && t.splice(e, 1) }, _destroy: function () { var e = t.ui.ddmanager.droppables[this.options.scope]; this._splice(e) }, _setOption: function (e, i) { if ("accept" === e) this.accept = t.isFunction(i) ? i : function (t) { return t.is(i) }; else if ("scope" === e) { var s = t.ui.ddmanager.droppables[this.options.scope]; this._splice(s), this._addToManager(i) } this._super(e, i) }, _activate: function (e) { var i = t.ui.ddmanager.current; this._addActiveClass(), i && this._trigger("activate", e, this.ui(i)) }, _deactivate: function (e) { var i = t.ui.ddmanager.current; this._removeActiveClass(), i && this._trigger("deactivate", e, this.ui(i)) }, _over: function (e) { var i = t.ui.ddmanager.current; i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this._addHoverClass(), this._trigger("over", e, this.ui(i))) }, _out: function (e) { var i = t.ui.ddmanager.current; i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this._removeHoverClass(), this._trigger("out", e, this.ui(i))) }, _drop: function (e, i) { var s = i || t.ui.ddmanager.current, n = !1; return !(!s || (s.currentItem || s.element)[0] === this.element[0]) && (this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each((function () { var i = t(this).droppable("instance"); return i.options.greedy && !i.options.disabled && i.options.scope === s.options.scope && i.accept.call(i.element[0], s.currentItem || s.element) && l(s, t.extend(i, { offset: i.element.offset() }), i.options.tolerance, e) ? (n = !0, !1) : void 0 })), !n && (!!this.accept.call(this.element[0], s.currentItem || s.element) && (this._removeActiveClass(), this._removeHoverClass(), this._trigger("drop", e, this.ui(s)), this.element))) }, ui: function (t) { return { draggable: t.currentItem || t.element, helper: t.helper, position: t.position, offset: t.positionAbs } }, _addHoverClass: function () { this._addClass("ui-droppable-hover") }, _removeHoverClass: function () { this._removeClass("ui-droppable-hover") }, _addActiveClass: function () { this._addClass("ui-droppable-active") }, _removeActiveClass: function () { this._removeClass("ui-droppable-active") } }); var h, l = t.ui.intersect = function () { function t(t, e, i) { return t >= e && e + i > t } return function (e, i, s, n) { if (!i.offset) return !1; var o = (e.positionAbs || e.position.absolute).left + e.margins.left, r = (e.positionAbs || e.position.absolute).top + e.margins.top, a = o + e.helperProportions.width, h = r + e.helperProportions.height, l = i.offset.left, c = i.offset.top, u = l + i.proportions().width, d = c + i.proportions().height; switch (s) { case "fit": return o >= l && u >= a && r >= c && d >= h; case "intersect": return o + e.helperProportions.width / 2 > l && u > a - e.helperProportions.width / 2 && r + e.helperProportions.height / 2 > c && d > h - e.helperProportions.height / 2; case "pointer": return t(n.pageY, c, i.proportions().height) && t(n.pageX, l, i.proportions().width); case "touch": return (r >= c && d >= r || h >= c && d >= h || c > r && h > d) && (o >= l && u >= o || a >= l && u >= a || l > o && a > u); default: return !1 } } }(); t.ui.ddmanager = { current: null, droppables: { default: [] }, prepareOffsets: function (e, i) { var s, n, o = t.ui.ddmanager.droppables[e.options.scope] || [], r = i ? i.type : null, a = (e.currentItem || e.element).find(":data(ui-droppable)").addBack(); t: for (s = 0; o.length > s; s++)if (!(o[s].options.disabled || e && !o[s].accept.call(o[s].element[0], e.currentItem || e.element))) { for (n = 0; a.length > n; n++)if (a[n] === o[s].element[0]) { o[s].proportions().height = 0; continue t } o[s].visible = "none" !== o[s].element.css("display"), o[s].visible && ("mousedown" === r && o[s]._activate.call(o[s], i), o[s].offset = o[s].element.offset(), o[s].proportions({ width: o[s].element[0].offsetWidth, height: o[s].element[0].offsetHeight })) } }, drop: function (e, i) { var s = !1; return t.each((t.ui.ddmanager.droppables[e.options.scope] || []).slice(), (function () { this.options && (!this.options.disabled && this.visible && l(e, this, this.options.tolerance, i) && (s = this._drop.call(this, i) || s), !this.options.disabled && this.visible && this.accept.call(this.element[0], e.currentItem || e.element) && (this.isout = !0, this.isover = !1, this._deactivate.call(this, i))) })), s }, dragStart: function (e, i) { e.element.parentsUntil("body").on("scroll.droppable", (function () { e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i) })) }, drag: function (e, i) { e.options.refreshPositions && t.ui.ddmanager.prepareOffsets(e, i), t.each(t.ui.ddmanager.droppables[e.options.scope] || [], (function () { if (!this.options.disabled && !this.greedyChild && this.visible) { var s, n, o, r = l(e, this, this.options.tolerance, i), a = !r && this.isover ? "isout" : r && !this.isover ? "isover" : null; a && (this.options.greedy && (n = this.options.scope, (o = this.element.parents(":data(ui-droppable)").filter((function () { return t(this).droppable("instance").options.scope === n }))).length && ((s = t(o[0]).droppable("instance")).greedyChild = "isover" === a)), s && "isover" === a && (s.isover = !1, s.isout = !0, s._out.call(s, i)), this[a] = !0, this["isout" === a ? "isover" : "isout"] = !1, this["isover" === a ? "_over" : "_out"].call(this, i), s && "isout" === a && (s.isout = !1, s.isover = !0, s._over.call(s, i))) } })) }, dragStop: function (e, i) { e.element.parentsUntil("body").off("scroll.droppable"), e.options.refreshPositions || t.ui.ddmanager.prepareOffsets(e, i) } }, !1 !== t.uiBackCompat && t.widget("ui.droppable", t.ui.droppable, { options: { hoverClass: !1, activeClass: !1 }, _addActiveClass: function () { this._super(), this.options.activeClass && this.element.addClass(this.options.activeClass) }, _removeActiveClass: function () { this._super(), this.options.activeClass && this.element.removeClass(this.options.activeClass) }, _addHoverClass: function () { this._super(), this.options.hoverClass && this.element.addClass(this.options.hoverClass) }, _removeHoverClass: function () { this._super(), this.options.hoverClass && this.element.removeClass(this.options.hoverClass) } }), t.ui.droppable, t.widget("ui.resizable", t.ui.mouse, { version: "1.12.1", widgetEventPrefix: "resize", options: { alsoResize: !1, animate: !1, animateDuration: "slow", animateEasing: "swing", aspectRatio: !1, autoHide: !1, classes: { "ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se" }, containment: !1, ghost: !1, grid: !1, handles: "e,s,se", helper: !1, maxHeight: null, maxWidth: null, minHeight: 10, minWidth: 10, zIndex: 90, resize: null, start: null, stop: null }, _num: function (t) { return parseFloat(t) || 0 }, _isNumber: function (t) { return !isNaN(parseFloat(t)) }, _hasScroll: function (e, i) { if ("hidden" === t(e).css("overflow")) return !1; var s = i && "left" === i ? "scrollLeft" : "scrollTop", n = !1; return e[s] > 0 || (e[s] = 1, n = e[s] > 0, e[s] = 0, n) }, _create: function () { var e, i = this.options, s = this; this._addClass("ui-resizable"), t.extend(this, { _aspectRatio: !!i.aspectRatio, aspectRatio: i.aspectRatio, originalElement: this.element, _proportionallyResizeElements: [], _helper: i.helper || i.ghost || i.animate ? i.helper || "ui-resizable-helper" : null }), this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i) && (this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({ position: this.element.css("position"), width: this.element.outerWidth(), height: this.element.outerHeight(), top: this.element.css("top"), left: this.element.css("left") })), this.element = this.element.parent().data("ui-resizable", this.element.resizable("instance")), this.elementIsWrapper = !0, e = { marginTop: this.originalElement.css("marginTop"), marginRight: this.originalElement.css("marginRight"), marginBottom: this.originalElement.css("marginBottom"), marginLeft: this.originalElement.css("marginLeft") }, this.element.css(e), this.originalElement.css("margin", 0), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({ position: "static", zoom: 1, display: "block" })), this.originalElement.css(e), this._proportionallyResize()), this._setupHandles(), i.autoHide && t(this.element).on("mouseenter", (function () { i.disabled || (s._removeClass("ui-resizable-autohide"), s._handles.show()) })).on("mouseleave", (function () { i.disabled || s.resizing || (s._addClass("ui-resizable-autohide"), s._handles.hide()) })), this._mouseInit() }, _destroy: function () { this._mouseDestroy(); var e, i = function (e) { t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove() }; return this.elementIsWrapper && (i(this.element), e = this.element, this.originalElement.css({ position: e.css("position"), width: e.outerWidth(), height: e.outerHeight(), top: e.css("top"), left: e.css("left") }).insertAfter(e), e.remove()), this.originalElement.css("resize", this.originalResizeStyle), i(this.originalElement), this }, _setOption: function (t, e) { switch (this._super(t, e), t) { case "handles": this._removeHandles(), this._setupHandles() } }, _setupHandles: function () { var e, i, s, n, o, r = this.options, a = this; if (this.handles = r.handles || (t(".ui-resizable-handle", this.element).length ? { n: ".ui-resizable-n", e: ".ui-resizable-e", s: ".ui-resizable-s", w: ".ui-resizable-w", se: ".ui-resizable-se", sw: ".ui-resizable-sw", ne: ".ui-resizable-ne", nw: ".ui-resizable-nw" } : "e,s,se"), this._handles = t(), this.handles.constructor === String) for ("all" === this.handles && (this.handles = "n,e,s,w,se,sw,ne,nw"), s = this.handles.split(","), this.handles = {}, i = 0; s.length > i; i++)n = "ui-resizable-" + (e = t.trim(s[i])), o = t("<div>"), this._addClass(o, "ui-resizable-handle " + n), o.css({ zIndex: r.zIndex }), this.handles[e] = ".ui-resizable-" + e, this.element.append(o); this._renderAxis = function (e) { var i, s, n, o; for (i in e = e || this.element, this.handles) this.handles[i].constructor === String ? this.handles[i] = this.element.children(this.handles[i]).first().show() : (this.handles[i].jquery || this.handles[i].nodeType) && (this.handles[i] = t(this.handles[i]), this._on(this.handles[i], { mousedown: a._mouseDown })), this.elementIsWrapper && this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i) && (s = t(this.handles[i], this.element), o = /sw|ne|nw|se|n|s/.test(i) ? s.outerHeight() : s.outerWidth(), n = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""), e.css(n, o), this._proportionallyResize()), this._handles = this._handles.add(this.handles[i]) }, this._renderAxis(this.element), this._handles = this._handles.add(this.element.find(".ui-resizable-handle")), this._handles.disableSelection(), this._handles.on("mouseover", (function () { a.resizing || (this.className && (o = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), a.axis = o && o[1] ? o[1] : "se") })), r.autoHide && (this._handles.hide(), this._addClass("ui-resizable-autohide")) }, _removeHandles: function () { this._handles.remove() }, _mouseCapture: function (e) { var i, s, n = !1; for (i in this.handles) ((s = t(this.handles[i])[0]) === e.target || t.contains(s, e.target)) && (n = !0); return !this.options.disabled && n }, _mouseStart: function (e) { var i, s, n, o = this.options, r = this.element; return this.resizing = !0, this._renderProxy(), i = this._num(this.helper.css("left")), s = this._num(this.helper.css("top")), o.containment && (i += t(o.containment).scrollLeft() || 0, s += t(o.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = { left: i, top: s }, this.size = this._helper ? { width: this.helper.width(), height: this.helper.height() } : { width: r.width(), height: r.height() }, this.originalSize = this._helper ? { width: r.outerWidth(), height: r.outerHeight() } : { width: r.width(), height: r.height() }, this.sizeDiff = { width: r.outerWidth() - r.width(), height: r.outerHeight() - r.height() }, this.originalPosition = { left: i, top: s }, this.originalMousePosition = { left: e.pageX, top: e.pageY }, this.aspectRatio = "number" == typeof o.aspectRatio ? o.aspectRatio : this.originalSize.width / this.originalSize.height || 1, n = t(".ui-resizable-" + this.axis).css("cursor"), t("body").css("cursor", "auto" === n ? this.axis + "-resize" : n), this._addClass("ui-resizable-resizing"), this._propagate("start", e), !0 }, _mouseDrag: function (e) { var i, s, n = this.originalMousePosition, o = this.axis, r = e.pageX - n.left || 0, a = e.pageY - n.top || 0, h = this._change[o]; return this._updatePrevProperties(), !!h && (i = h.apply(this, [e, r, a]), this._updateVirtualBoundaries(e.shiftKey), (this._aspectRatio || e.shiftKey) && (i = this._updateRatio(i, e)), i = this._respectSize(i, e), this._updateCache(i), this._propagate("resize", e), s = this._applyChanges(), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), t.isEmptyObject(s) || (this._updatePrevProperties(), this._trigger("resize", e, this.ui()), this._applyChanges()), !1) }, _mouseStop: function (e) { this.resizing = !1; var i, s, n, o, r, a, h, l = this.options, c = this; return this._helper && (n = (s = (i = this._proportionallyResizeElements).length && /textarea/i.test(i[0].nodeName)) && this._hasScroll(i[0], "left") ? 0 : c.sizeDiff.height, o = s ? 0 : c.sizeDiff.width, r = { width: c.helper.width() - o, height: c.helper.height() - n }, a = parseFloat(c.element.css("left")) + (c.position.left - c.originalPosition.left) || null, h = parseFloat(c.element.css("top")) + (c.position.top - c.originalPosition.top) || null, l.animate || this.element.css(t.extend(r, { top: h, left: a })), c.helper.height(c.size.height), c.helper.width(c.size.width), this._helper && !l.animate && this._proportionallyResize()), t("body").css("cursor", "auto"), this._removeClass("ui-resizable-resizing"), this._propagate("stop", e), this._helper && this.helper.remove(), !1 }, _updatePrevProperties: function () { this.prevPosition = { top: this.position.top, left: this.position.left }, this.prevSize = { width: this.size.width, height: this.size.height } }, _applyChanges: function () { var t = {}; return this.position.top !== this.prevPosition.top && (t.top = this.position.top + "px"), this.position.left !== this.prevPosition.left && (t.left = this.position.left + "px"), this.size.width !== this.prevSize.width && (t.width = this.size.width + "px"), this.size.height !== this.prevSize.height && (t.height = this.size.height + "px"), this.helper.css(t), t }, _updateVirtualBoundaries: function (t) { var e, i, s, n, o, r = this.options; o = { minWidth: this._isNumber(r.minWidth) ? r.minWidth : 0, maxWidth: this._isNumber(r.maxWidth) ? r.maxWidth : 1 / 0, minHeight: this._isNumber(r.minHeight) ? r.minHeight : 0, maxHeight: this._isNumber(r.maxHeight) ? r.maxHeight : 1 / 0 }, (this._aspectRatio || t) && (e = o.minHeight * this.aspectRatio, s = o.minWidth / this.aspectRatio, i = o.maxHeight * this.aspectRatio, n = o.maxWidth / this.aspectRatio, e > o.minWidth && (o.minWidth = e), s > o.minHeight && (o.minHeight = s), o.maxWidth > i && (o.maxWidth = i), o.maxHeight > n && (o.maxHeight = n)), this._vBoundaries = o }, _updateCache: function (t) { this.offset = this.helper.offset(), this._isNumber(t.left) && (this.position.left = t.left), this._isNumber(t.top) && (this.position.top = t.top), this._isNumber(t.height) && (this.size.height = t.height), this._isNumber(t.width) && (this.size.width = t.width) }, _updateRatio: function (t) { var e = this.position, i = this.size, s = this.axis; return this._isNumber(t.height) ? t.width = t.height * this.aspectRatio : this._isNumber(t.width) && (t.height = t.width / this.aspectRatio), "sw" === s && (t.left = e.left + (i.width - t.width), t.top = null), "nw" === s && (t.top = e.top + (i.height - t.height), t.left = e.left + (i.width - t.width)), t }, _respectSize: function (t) { var e = this._vBoundaries, i = this.axis, s = this._isNumber(t.width) && e.maxWidth && e.maxWidth < t.width, n = this._isNumber(t.height) && e.maxHeight && e.maxHeight < t.height, o = this._isNumber(t.width) && e.minWidth && e.minWidth > t.width, r = this._isNumber(t.height) && e.minHeight && e.minHeight > t.height, a = this.originalPosition.left + this.originalSize.width, h = this.originalPosition.top + this.originalSize.height, l = /sw|nw|w/.test(i), c = /nw|ne|n/.test(i); return o && (t.width = e.minWidth), r && (t.height = e.minHeight), s && (t.width = e.maxWidth), n && (t.height = e.maxHeight), o && l && (t.left = a - e.minWidth), s && l && (t.left = a - e.maxWidth), r && c && (t.top = h - e.minHeight), n && c && (t.top = h - e.maxHeight), t.width || t.height || t.left || !t.top ? t.width || t.height || t.top || !t.left || (t.left = null) : t.top = null, t }, _getPaddingPlusBorderDimensions: function (t) { for (var e = 0, i = [], s = [t.css("borderTopWidth"), t.css("borderRightWidth"), t.css("borderBottomWidth"), t.css("borderLeftWidth")], n = [t.css("paddingTop"), t.css("paddingRight"), t.css("paddingBottom"), t.css("paddingLeft")]; 4 > e; e++)i[e] = parseFloat(s[e]) || 0, i[e] += parseFloat(n[e]) || 0; return { height: i[0] + i[2], width: i[1] + i[3] } }, _proportionallyResize: function () { if (this._proportionallyResizeElements.length) for (var t, e = 0, i = this.helper || this.element; this._proportionallyResizeElements.length > e; e++)t = this._proportionallyResizeElements[e], this.outerDimensions || (this.outerDimensions = this._getPaddingPlusBorderDimensions(t)), t.css({ height: i.height() - this.outerDimensions.height || 0, width: i.width() - this.outerDimensions.width || 0 }) }, _renderProxy: function () { var e = this.element, i = this.options; this.elementOffset = e.offset(), this._helper ? (this.helper = this.helper || t("<div style='overflow:hidden;'></div>"), this._addClass(this.helper, this._helper), this.helper.css({ width: this.element.outerWidth(), height: this.element.outerHeight(), position: "absolute", left: this.elementOffset.left + "px", top: this.elementOffset.top + "px", zIndex: ++i.zIndex }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element }, _change: { e: function (t, e) { return { width: this.originalSize.width + e } }, w: function (t, e) { var i = this.originalSize; return { left: this.originalPosition.left + e, width: i.width - e } }, n: function (t, e, i) { var s = this.originalSize; return { top: this.originalPosition.top + i, height: s.height - i } }, s: function (t, e, i) { return { height: this.originalSize.height + i } }, se: function (e, i, s) { return t.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [e, i, s])) }, sw: function (e, i, s) { return t.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [e, i, s])) }, ne: function (e, i, s) { return t.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [e, i, s])) }, nw: function (e, i, s) { return t.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [e, i, s])) } }, _propagate: function (e, i) { t.ui.plugin.call(this, e, [i, this.ui()]), "resize" !== e && this._trigger(e, i, this.ui()) }, plugins: {}, ui: function () { return { originalElement: this.originalElement, element: this.element, helper: this.helper, position: this.position, size: this.size, originalSize: this.originalSize, originalPosition: this.originalPosition } } }), t.ui.plugin.add("resizable", "animate", { stop: function (e) { var i = t(this).resizable("instance"), s = i.options, n = i._proportionallyResizeElements, o = n.length && /textarea/i.test(n[0].nodeName), r = o && i._hasScroll(n[0], "left") ? 0 : i.sizeDiff.height, a = o ? 0 : i.sizeDiff.width, h = { width: i.size.width - a, height: i.size.height - r }, l = parseFloat(i.element.css("left")) + (i.position.left - i.originalPosition.left) || null, c = parseFloat(i.element.css("top")) + (i.position.top - i.originalPosition.top) || null; i.element.animate(t.extend(h, c && l ? { top: c, left: l } : {}), { duration: s.animateDuration, easing: s.animateEasing, step: function () { var s = { width: parseFloat(i.element.css("width")), height: parseFloat(i.element.css("height")), top: parseFloat(i.element.css("top")), left: parseFloat(i.element.css("left")) }; n && n.length && t(n[0]).css({ width: s.width, height: s.height }), i._updateCache(s), i._propagate("resize", e) } }) } }), t.ui.plugin.add("resizable", "containment", { start: function () { var e, i, s, n, o, r, a, h = t(this).resizable("instance"), l = h.options, c = h.element, u = l.containment, d = u instanceof t ? u.get(0) : /parent/.test(u) ? c.parent().get(0) : u; d && (h.containerElement = t(d), /document/.test(u) || u === document ? (h.containerOffset = { left: 0, top: 0 }, h.containerPosition = { left: 0, top: 0 }, h.parentData = { element: t(document), left: 0, top: 0, width: t(document).width(), height: t(document).height() || document.body.parentNode.scrollHeight }) : (e = t(d), i = [], t(["Top", "Right", "Left", "Bottom"]).each((function (t, s) { i[t] = h._num(e.css("padding" + s)) })), h.containerOffset = e.offset(), h.containerPosition = e.position(), h.containerSize = { height: e.innerHeight() - i[3], width: e.innerWidth() - i[1] }, s = h.containerOffset, n = h.containerSize.height, o = h.containerSize.width, r = h._hasScroll(d, "left") ? d.scrollWidth : o, a = h._hasScroll(d) ? d.scrollHeight : n, h.parentData = { element: d, left: s.left, top: s.top, width: r, height: a })) }, resize: function (e) { var i, s, n, o, r = t(this).resizable("instance"), a = r.options, h = r.containerOffset, l = r.position, c = r._aspectRatio || e.shiftKey, u = { top: 0, left: 0 }, d = r.containerElement, p = !0; d[0] !== document && /static/.test(d.css("position")) && (u = h), l.left < (r._helper ? h.left : 0) && (r.size.width = r.size.width + (r._helper ? r.position.left - h.left : r.position.left - u.left), c && (r.size.height = r.size.width / r.aspectRatio, p = !1), r.position.left = a.helper ? h.left : 0), l.top < (r._helper ? h.top : 0) && (r.size.height = r.size.height + (r._helper ? r.position.top - h.top : r.position.top), c && (r.size.width = r.size.height * r.aspectRatio, p = !1), r.position.top = r._helper ? h.top : 0), n = r.containerElement.get(0) === r.element.parent().get(0), o = /relative|absolute/.test(r.containerElement.css("position")), n && o ? (r.offset.left = r.parentData.left + r.position.left, r.offset.top = r.parentData.top + r.position.top) : (r.offset.left = r.element.offset().left, r.offset.top = r.element.offset().top), i = Math.abs(r.sizeDiff.width + (r._helper ? r.offset.left - u.left : r.offset.left - h.left)), s = Math.abs(r.sizeDiff.height + (r._helper ? r.offset.top - u.top : r.offset.top - h.top)), i + r.size.width >= r.parentData.width && (r.size.width = r.parentData.width - i, c && (r.size.height = r.size.width / r.aspectRatio, p = !1)), s + r.size.height >= r.parentData.height && (r.size.height = r.parentData.height - s, c && (r.size.width = r.size.height * r.aspectRatio, p = !1)), p || (r.position.left = r.prevPosition.left, r.position.top = r.prevPosition.top, r.size.width = r.prevSize.width, r.size.height = r.prevSize.height) }, stop: function () { var e = t(this).resizable("instance"), i = e.options, s = e.containerOffset, n = e.containerPosition, o = e.containerElement, r = t(e.helper), a = r.offset(), h = r.outerWidth() - e.sizeDiff.width, l = r.outerHeight() - e.sizeDiff.height; e._helper && !i.animate && /relative/.test(o.css("position")) && t(this).css({ left: a.left - n.left - s.left, width: h, height: l }), e._helper && !i.animate && /static/.test(o.css("position")) && t(this).css({ left: a.left - n.left - s.left, width: h, height: l }) } }), t.ui.plugin.add("resizable", "alsoResize", { start: function () { var e = t(this).resizable("instance").options; t(e.alsoResize).each((function () { var e = t(this); e.data("ui-resizable-alsoresize", { width: parseFloat(e.width()), height: parseFloat(e.height()), left: parseFloat(e.css("left")), top: parseFloat(e.css("top")) }) })) }, resize: function (e, i) { var s = t(this).resizable("instance"), n = s.options, o = s.originalSize, r = s.originalPosition, a = { height: s.size.height - o.height || 0, width: s.size.width - o.width || 0, top: s.position.top - r.top || 0, left: s.position.left - r.left || 0 }; t(n.alsoResize).each((function () { var e = t(this), s = t(this).data("ui-resizable-alsoresize"), n = {}, o = e.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"]; t.each(o, (function (t, e) { var i = (s[e] || 0) + (a[e] || 0); i && i >= 0 && (n[e] = i || null) })), e.css(n) })) }, stop: function () { t(this).removeData("ui-resizable-alsoresize") } }), t.ui.plugin.add("resizable", "ghost", { start: function () { var e = t(this).resizable("instance"), i = e.size; e.ghost = e.originalElement.clone(), e.ghost.css({ opacity: .25, display: "block", position: "relative", height: i.height, width: i.width, margin: 0, left: 0, top: 0 }), e._addClass(e.ghost, "ui-resizable-ghost"), !1 !== t.uiBackCompat && "string" == typeof e.options.ghost && e.ghost.addClass(this.options.ghost), e.ghost.appendTo(e.helper) }, resize: function () { var e = t(this).resizable("instance"); e.ghost && e.ghost.css({ position: "relative", height: e.size.height, width: e.size.width }) }, stop: function () { var e = t(this).resizable("instance"); e.ghost && e.helper && e.helper.get(0).removeChild(e.ghost.get(0)) } }), t.ui.plugin.add("resizable", "grid", { resize: function () { var e, i = t(this).resizable("instance"), s = i.options, n = i.size, o = i.originalSize, r = i.originalPosition, a = i.axis, h = "number" == typeof s.grid ? [s.grid, s.grid] : s.grid, l = h[0] || 1, c = h[1] || 1, u = Math.round((n.width - o.width) / l) * l, d = Math.round((n.height - o.height) / c) * c, p = o.width + u, f = o.height + d, g = s.maxWidth && p > s.maxWidth, m = s.maxHeight && f > s.maxHeight, _ = s.minWidth && s.minWidth > p, v = s.minHeight && s.minHeight > f; s.grid = h, _ && (p += l), v && (f += c), g && (p -= l), m && (f -= c), /^(se|s|e)$/.test(a) ? (i.size.width = p, i.size.height = f) : /^(ne)$/.test(a) ? (i.size.width = p, i.size.height = f, i.position.top = r.top - d) : /^(sw)$/.test(a) ? (i.size.width = p, i.size.height = f, i.position.left = r.left - u) : ((0 >= f - c || 0 >= p - l) && (e = i._getPaddingPlusBorderDimensions(this)), f - c > 0 ? (i.size.height = f, i.position.top = r.top - d) : (f = c - e.height, i.size.height = f, i.position.top = r.top + o.height - f), p - l > 0 ? (i.size.width = p, i.position.left = r.left - u) : (p = l - e.width, i.size.width = p, i.position.left = r.left + o.width - p)) } }), t.ui.resizable, t.widget("ui.selectable", t.ui.mouse, { version: "1.12.1", options: { appendTo: "body", autoRefresh: !0, distance: 0, filter: "*", tolerance: "touch", selected: null, selecting: null, start: null, stop: null, unselected: null, unselecting: null }, _create: function () { var e = this; this._addClass("ui-selectable"), this.dragged = !1, this.refresh = function () { e.elementPos = t(e.element[0]).offset(), e.selectees = t(e.options.filter, e.element[0]), e._addClass(e.selectees, "ui-selectee"), e.selectees.each((function () { var i = t(this), s = i.offset(), n = { left: s.left - e.elementPos.left, top: s.top - e.elementPos.top }; t.data(this, "selectable-item", { element: this, $element: i, left: n.left, top: n.top, right: n.left + i.outerWidth(), bottom: n.top + i.outerHeight(), startselected: !1, selected: i.hasClass("ui-selected"), selecting: i.hasClass("ui-selecting"), unselecting: i.hasClass("ui-unselecting") }) })) }, this.refresh(), this._mouseInit(), this.helper = t("<div>"), this._addClass(this.helper, "ui-selectable-helper") }, _destroy: function () { this.selectees.removeData("selectable-item"), this._mouseDestroy() }, _mouseStart: function (e) { var i = this, s = this.options; this.opos = [e.pageX, e.pageY], this.elementPos = t(this.element[0]).offset(), this.options.disabled || (this.selectees = t(s.filter, this.element[0]), this._trigger("start", e), t(s.appendTo).append(this.helper), this.helper.css({ left: e.pageX, top: e.pageY, width: 0, height: 0 }), s.autoRefresh && this.refresh(), this.selectees.filter(".ui-selected").each((function () { var s = t.data(this, "selectable-item"); s.startselected = !0, e.metaKey || e.ctrlKey || (i._removeClass(s.$element, "ui-selected"), s.selected = !1, i._addClass(s.$element, "ui-unselecting"), s.unselecting = !0, i._trigger("unselecting", e, { unselecting: s.element })) })), t(e.target).parents().addBack().each((function () { var s, n = t.data(this, "selectable-item"); return n ? (s = !e.metaKey && !e.ctrlKey || !n.$element.hasClass("ui-selected"), i._removeClass(n.$element, s ? "ui-unselecting" : "ui-selected")._addClass(n.$element, s ? "ui-selecting" : "ui-unselecting"), n.unselecting = !s, n.selecting = s, n.selected = s, s ? i._trigger("selecting", e, { selecting: n.element }) : i._trigger("unselecting", e, { unselecting: n.element }), !1) : void 0 }))) }, _mouseDrag: function (e) { if (this.dragged = !0, !this.options.disabled) { var i, s = this, n = this.options, o = this.opos[0], r = this.opos[1], a = e.pageX, h = e.pageY; return o > a && (i = a, a = o, o = i), r > h && (i = h, h = r, r = i), this.helper.css({ left: o, top: r, width: a - o, height: h - r }), this.selectees.each((function () { var i = t.data(this, "selectable-item"), l = !1, c = {}; i && i.element !== s.element[0] && (c.left = i.left + s.elementPos.left, c.right = i.right + s.elementPos.left, c.top = i.top + s.elementPos.top, c.bottom = i.bottom + s.elementPos.top, "touch" === n.tolerance ? l = !(c.left > a || o > c.right || c.top > h || r > c.bottom) : "fit" === n.tolerance && (l = c.left > o && a > c.right && c.top > r && h > c.bottom), l ? (i.selected && (s._removeClass(i.$element, "ui-selected"), i.selected = !1), i.unselecting && (s._removeClass(i.$element, "ui-unselecting"), i.unselecting = !1), i.selecting || (s._addClass(i.$element, "ui-selecting"), i.selecting = !0, s._trigger("selecting", e, { selecting: i.element }))) : (i.selecting && ((e.metaKey || e.ctrlKey) && i.startselected ? (s._removeClass(i.$element, "ui-selecting"), i.selecting = !1, s._addClass(i.$element, "ui-selected"), i.selected = !0) : (s._removeClass(i.$element, "ui-selecting"), i.selecting = !1, i.startselected && (s._addClass(i.$element, "ui-unselecting"), i.unselecting = !0), s._trigger("unselecting", e, { unselecting: i.element }))), i.selected && (e.metaKey || e.ctrlKey || i.startselected || (s._removeClass(i.$element, "ui-selected"), i.selected = !1, s._addClass(i.$element, "ui-unselecting"), i.unselecting = !0, s._trigger("unselecting", e, { unselecting: i.element }))))) })), !1 } }, _mouseStop: function (e) { var i = this; return this.dragged = !1, t(".ui-unselecting", this.element[0]).each((function () { var s = t.data(this, "selectable-item"); i._removeClass(s.$element, "ui-unselecting"), s.unselecting = !1, s.startselected = !1, i._trigger("unselected", e, { unselected: s.element }) })), t(".ui-selecting", this.element[0]).each((function () { var s = t.data(this, "selectable-item"); i._removeClass(s.$element, "ui-selecting")._addClass(s.$element, "ui-selected"), s.selecting = !1, s.selected = !0, s.startselected = !0, i._trigger("selected", e, { selected: s.element }) })), this._trigger("stop", e), this.helper.remove(), !1 } }), t.widget("ui.sortable", t.ui.mouse, { version: "1.12.1", widgetEventPrefix: "sort", ready: !1, options: { appendTo: "parent", axis: !1, connectWith: !1, containment: !1, cursor: "auto", cursorAt: !1, dropOnEmpty: !0, forcePlaceholderSize: !1, forceHelperSize: !1, grid: !1, handle: !1, helper: "original", items: "> *", opacity: !1, placeholder: !1, revert: !1, scroll: !0, scrollSensitivity: 20, scrollSpeed: 20, scope: "default", tolerance: "intersect", zIndex: 1e3, activate: null, beforeStop: null, change: null, deactivate: null, out: null, over: null, receive: null, remove: null, sort: null, start: null, stop: null, update: null }, _isOverAxis: function (t, e, i) { return t >= e && e + i > t }, _isFloating: function (t) { return /left|right/.test(t.css("float")) || /inline|table-cell/.test(t.css("display")) }, _create: function () { this.containerCache = {}, this._addClass("ui-sortable"), this.refresh(), this.offset = this.element.offset(), this._mouseInit(), this._setHandleClassName(), this.ready = !0 }, _setOption: function (t, e) { this._super(t, e), "handle" === t && this._setHandleClassName() }, _setHandleClassName: function () { var e = this; this._removeClass(this.element.find(".ui-sortable-handle"), "ui-sortable-handle"), t.each(this.items, (function () { e._addClass(this.instance.options.handle ? this.item.find(this.instance.options.handle) : this.item, "ui-sortable-handle") })) }, _destroy: function () { this._mouseDestroy(); for (var t = this.items.length - 1; t >= 0; t--)this.items[t].item.removeData(this.widgetName + "-item"); return this }, _mouseCapture: function (e, i) { var s = null, n = !1, o = this; return !this.reverting && (!this.options.disabled && "static" !== this.options.type && (this._refreshItems(e), t(e.target).parents().each((function () { return t.data(this, o.widgetName + "-item") === o ? (s = t(this), !1) : void 0 })), t.data(e.target, o.widgetName + "-item") === o && (s = t(e.target)), !!s && (!(this.options.handle && !i && (t(this.options.handle, s).find("*").addBack().each((function () { this === e.target && (n = !0) })), !n)) && (this.currentItem = s, this._removeCurrentsFromItems(), !0)))) }, _mouseStart: function (e, i, s) { var n, o, r = this.options; if (this.currentContainer = this, this.refreshPositions(), this.helper = this._createHelper(e), this._cacheHelperProportions(), this._cacheMargins(), this.scrollParent = this.helper.scrollParent(), this.offset = this.currentItem.offset(), this.offset = { top: this.offset.top - this.margins.top, left: this.offset.left - this.margins.left }, t.extend(this.offset, { click: { left: e.pageX - this.offset.left, top: e.pageY - this.offset.top }, parent: this._getParentOffset(), relative: this._getRelativeOffset() }), this.helper.css("position", "absolute"), this.cssPosition = this.helper.css("position"), this.originalPosition = this._generatePosition(e), this.originalPageX = e.pageX, this.originalPageY = e.pageY, r.cursorAt && this._adjustOffsetFromHelper(r.cursorAt), this.domPosition = { prev: this.currentItem.prev()[0], parent: this.currentItem.parent()[0] }, this.helper[0] !== this.currentItem[0] && this.currentItem.hide(), this._createPlaceholder(), r.containment && this._setContainment(), r.cursor && "auto" !== r.cursor && (o = this.document.find("body"), this.storedCursor = o.css("cursor"), o.css("cursor", r.cursor), this.storedStylesheet = t("<style>*{ cursor: " + r.cursor + " !important; }</style>").appendTo(o)), r.opacity && (this.helper.css("opacity") && (this._storedOpacity = this.helper.css("opacity")), this.helper.css("opacity", r.opacity)), r.zIndex && (this.helper.css("zIndex") && (this._storedZIndex = this.helper.css("zIndex")), this.helper.css("zIndex", r.zIndex)), this.scrollParent[0] !== this.document[0] && "HTML" !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()), this._trigger("start", e, this._uiHash()), this._preserveHelperProportions || this._cacheHelperProportions(), !s) for (n = this.containers.length - 1; n >= 0; n--)this.containers[n]._trigger("activate", e, this._uiHash(this)); return t.ui.ddmanager && (t.ui.ddmanager.current = this), t.ui.ddmanager && !r.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e), this.dragging = !0, this._addClass(this.helper, "ui-sortable-helper"), this._mouseDrag(e), !0 }, _mouseDrag: function (e) { var i, s, n, o, r = this.options, a = !1; for (this.position = this._generatePosition(e), this.positionAbs = this._convertPositionTo("absolute"), this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs), this.options.scroll && (this.scrollParent[0] !== this.document[0] && "HTML" !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < r.scrollSensitivity ? this.scrollParent[0].scrollTop = a = this.scrollParent[0].scrollTop + r.scrollSpeed : e.pageY - this.overflowOffset.top < r.scrollSensitivity && (this.scrollParent[0].scrollTop = a = this.scrollParent[0].scrollTop - r.scrollSpeed), this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < r.scrollSensitivity ? this.scrollParent[0].scrollLeft = a = this.scrollParent[0].scrollLeft + r.scrollSpeed : e.pageX - this.overflowOffset.left < r.scrollSensitivity && (this.scrollParent[0].scrollLeft = a = this.scrollParent[0].scrollLeft - r.scrollSpeed)) : (e.pageY - this.document.scrollTop() < r.scrollSensitivity ? a = this.document.scrollTop(this.document.scrollTop() - r.scrollSpeed) : this.window.height() - (e.pageY - this.document.scrollTop()) < r.scrollSensitivity && (a = this.document.scrollTop(this.document.scrollTop() + r.scrollSpeed)), e.pageX - this.document.scrollLeft() < r.scrollSensitivity ? a = this.document.scrollLeft(this.document.scrollLeft() - r.scrollSpeed) : this.window.width() - (e.pageX - this.document.scrollLeft()) < r.scrollSensitivity && (a = this.document.scrollLeft(this.document.scrollLeft() + r.scrollSpeed))), !1 !== a && t.ui.ddmanager && !r.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)), this.positionAbs = this._convertPositionTo("absolute"), this.options.axis && "y" === this.options.axis || (this.helper[0].style.left = this.position.left + "px"), this.options.axis && "x" === this.options.axis || (this.helper[0].style.top = this.position.top + "px"), i = this.items.length - 1; i >= 0; i--)if (n = (s = this.items[i]).item[0], (o = this._intersectsWithPointer(s)) && s.instance === this.currentContainer && n !== this.currentItem[0] && this.placeholder[1 === o ? "next" : "prev"]()[0] !== n && !t.contains(this.placeholder[0], n) && ("semi-dynamic" !== this.options.type || !t.contains(this.element[0], n))) { if (this.direction = 1 === o ? "down" : "up", "pointer" !== this.options.tolerance && !this._intersectsWithSides(s)) break; this._rearrange(e, s), this._trigger("change", e, this._uiHash()); break } return this._contactContainers(e), t.ui.ddmanager && t.ui.ddmanager.drag(this, e), this._trigger("sort", e, this._uiHash()), this.lastPositionAbs = this.positionAbs, !1 }, _mouseStop: function (e, i) { if (e) { if (t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e), this.options.revert) { var s = this, n = this.placeholder.offset(), o = this.options.axis, r = {}; o && "x" !== o || (r.left = n.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === this.document[0].body ? 0 : this.offsetParent[0].scrollLeft)), o && "y" !== o || (r.top = n.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === this.document[0].body ? 0 : this.offsetParent[0].scrollTop)), this.reverting = !0, t(this.helper).animate(r, parseInt(this.options.revert, 10) || 500, (function () { s._clear(e) })) } else this._clear(e, i); return !1 } }, cancel: function () { if (this.dragging) { this._mouseUp(new t.Event("mouseup", { target: null })), "original" === this.options.helper ? (this.currentItem.css(this._storedCSS), this._removeClass(this.currentItem, "ui-sortable-helper")) : this.currentItem.show(); for (var e = this.containers.length - 1; e >= 0; e--)this.containers[e]._trigger("deactivate", null, this._uiHash(this)), this.containers[e].containerCache.over && (this.containers[e]._trigger("out", null, this._uiHash(this)), this.containers[e].containerCache.over = 0) } return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]), "original" !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(), t.extend(this, { helper: null, dragging: !1, reverting: !1, _noFinalSort: null }), this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)), this }, serialize: function (e) { var i = this._getItemsAsjQuery(e && e.connected), s = []; return e = e || {}, t(i).each((function () { var i = (t(e.item || this).attr(e.attribute || "id") || "").match(e.expression || /(.+)[\-=_](.+)/); i && s.push((e.key || i[1] + "[]") + "=" + (e.key && e.expression ? i[1] : i[2])) })), !s.length && e.key && s.push(e.key + "="), s.join("&") }, toArray: function (e) { var i = this._getItemsAsjQuery(e && e.connected), s = []; return e = e || {}, i.each((function () { s.push(t(e.item || this).attr(e.attribute || "id") || "") })), s }, _intersectsWith: function (t) { var e = this.positionAbs.left, i = e + this.helperProportions.width, s = this.positionAbs.top, n = s + this.helperProportions.height, o = t.left, r = o + t.width, a = t.top, h = a + t.height, l = this.offset.click.top, c = this.offset.click.left, u = "x" === this.options.axis || s + l > a && h > s + l, d = "y" === this.options.axis || e + c > o && r > e + c, p = u && d; return "pointer" === this.options.tolerance || this.options.forcePointerForContainers || "pointer" !== this.options.tolerance && this.helperProportions[this.floating ? "width" : "height"] > t[this.floating ? "width" : "height"] ? p : e + this.helperProportions.width / 2 > o && r > i - this.helperProportions.width / 2 && s + this.helperProportions.height / 2 > a && h > n - this.helperProportions.height / 2 }, _intersectsWithPointer: function (t) { var e, i, s = "x" === this.options.axis || this._isOverAxis(this.positionAbs.top + this.offset.click.top, t.top, t.height), n = "y" === this.options.axis || this._isOverAxis(this.positionAbs.left + this.offset.click.left, t.left, t.width); return !!(s && n) && (e = this._getDragVerticalDirection(), i = this._getDragHorizontalDirection(), this.floating ? "right" === i || "down" === e ? 2 : 1 : e && ("down" === e ? 2 : 1)) }, _intersectsWithSides: function (t) { var e = this._isOverAxis(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height), i = this._isOverAxis(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width), s = this._getDragVerticalDirection(), n = this._getDragHorizontalDirection(); return this.floating && n ? "right" === n && i || "left" === n && !i : s && ("down" === s && e || "up" === s && !e) }, _getDragVerticalDirection: function () { var t = this.positionAbs.top - this.lastPositionAbs.top; return 0 !== t && (t > 0 ? "down" : "up") }, _getDragHorizontalDirection: function () { var t = this.positionAbs.left - this.lastPositionAbs.left; return 0 !== t && (t > 0 ? "right" : "left") }, refresh: function (t) { return this._refreshItems(t), this._setHandleClassName(), this.refreshPositions(), this }, _connectWith: function () { var t = this.options; return t.connectWith.constructor === String ? [t.connectWith] : t.connectWith }, _getItemsAsjQuery: function (e) { function i() { a.push(this) } var s, n, o, r, a = [], h = [], l = this._connectWith(); if (l && e) for (s = l.length - 1; s >= 0; s--)for (n = (o = t(l[s], this.document[0])).length - 1; n >= 0; n--)(r = t.data(o[n], this.widgetFullName)) && r !== this && !r.options.disabled && h.push([t.isFunction(r.options.items) ? r.options.items.call(r.element) : t(r.options.items, r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), r]); for (h.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, { options: this.options, item: this.currentItem }) : t(this.options.items, this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"), this]), s = h.length - 1; s >= 0; s--)h[s][0].each(i); return t(a) }, _removeCurrentsFromItems: function () { var e = this.currentItem.find(":data(" + this.widgetName + "-item)"); this.items = t.grep(this.items, (function (t) { for (var i = 0; e.length > i; i++)if (e[i] === t.item[0]) return !1; return !0 })) }, _refreshItems: function (e) { this.items = [], this.containers = [this]; var i, s, n, o, r, a, h, l, c = this.items, u = [[t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, { item: this.currentItem }) : t(this.options.items, this.element), this]], d = this._connectWith(); if (d && this.ready) for (i = d.length - 1; i >= 0; i--)for (s = (n = t(d[i], this.document[0])).length - 1; s >= 0; s--)(o = t.data(n[s], this.widgetFullName)) && o !== this && !o.options.disabled && (u.push([t.isFunction(o.options.items) ? o.options.items.call(o.element[0], e, { item: this.currentItem }) : t(o.options.items, o.element), o]), this.containers.push(o)); for (i = u.length - 1; i >= 0; i--)for (r = u[i][1], s = 0, l = (a = u[i][0]).length; l > s; s++)(h = t(a[s])).data(this.widgetName + "-item", r), c.push({ item: h, instance: r, width: 0, height: 0, left: 0, top: 0 }) }, refreshPositions: function (e) { var i, s, n, o; for (this.floating = !!this.items.length && ("x" === this.options.axis || this._isFloating(this.items[0].item)), this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset()), i = this.items.length - 1; i >= 0; i--)(s = this.items[i]).instance !== this.currentContainer && this.currentContainer && s.item[0] !== this.currentItem[0] || (n = this.options.toleranceElement ? t(this.options.toleranceElement, s.item) : s.item, e || (s.width = n.outerWidth(), s.height = n.outerHeight()), o = n.offset(), s.left = o.left, s.top = o.top); if (this.options.custom && this.options.custom.refreshContainers) this.options.custom.refreshContainers.call(this); else for (i = this.containers.length - 1; i >= 0; i--)o = this.containers[i].element.offset(), this.containers[i].containerCache.left = o.left, this.containers[i].containerCache.top = o.top, this.containers[i].containerCache.width = this.containers[i].element.outerWidth(), this.containers[i].containerCache.height = this.containers[i].element.outerHeight(); return this }, _createPlaceholder: function (e) { var i, s = (e = e || this).options; s.placeholder && s.placeholder.constructor !== String || (i = s.placeholder, s.placeholder = { element: function () { var s = e.currentItem[0].nodeName.toLowerCase(), n = t("<" + s + ">", e.document[0]); return e._addClass(n, "ui-sortable-placeholder", i || e.currentItem[0].className)._removeClass(n, "ui-sortable-helper"), "tbody" === s ? e._createTrPlaceholder(e.currentItem.find("tr").eq(0), t("<tr>", e.document[0]).appendTo(n)) : "tr" === s ? e._createTrPlaceholder(e.currentItem, n) : "img" === s && n.attr("src", e.currentItem.attr("src")), i || n.css("visibility", "hidden"), n }, update: function (t, n) { (!i || s.forcePlaceholderSize) && (n.height() || n.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css("paddingTop") || 0, 10) - parseInt(e.currentItem.css("paddingBottom") || 0, 10)), n.width() || n.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css("paddingLeft") || 0, 10) - parseInt(e.currentItem.css("paddingRight") || 0, 10))) } }), e.placeholder = t(s.placeholder.element.call(e.element, e.currentItem)), e.currentItem.after(e.placeholder), s.placeholder.update(e, e.placeholder) }, _createTrPlaceholder: function (e, i) { var s = this; e.children().each((function () { t("<td>&#160;</td>", s.document[0]).attr("colspan", t(this).attr("colspan") || 1).appendTo(i) })) }, _contactContainers: function (e) { var i, s, n, o, r, a, h, l, c, u, d = null, p = null; for (i = this.containers.length - 1; i >= 0; i--)if (!t.contains(this.currentItem[0], this.containers[i].element[0])) if (this._intersectsWith(this.containers[i].containerCache)) { if (d && t.contains(this.containers[i].element[0], d.element[0])) continue; d = this.containers[i], p = i } else this.containers[i].containerCache.over && (this.containers[i]._trigger("out", e, this._uiHash(this)), this.containers[i].containerCache.over = 0); if (d) if (1 === this.containers.length) this.containers[p].containerCache.over || (this.containers[p]._trigger("over", e, this._uiHash(this)), this.containers[p].containerCache.over = 1); else { for (n = 1e4, o = null, r = (c = d.floating || this._isFloating(this.currentItem)) ? "left" : "top", a = c ? "width" : "height", u = c ? "pageX" : "pageY", s = this.items.length - 1; s >= 0; s--)t.contains(this.containers[p].element[0], this.items[s].item[0]) && this.items[s].item[0] !== this.currentItem[0] && (h = this.items[s].item.offset()[r], l = !1, e[u] - h > this.items[s][a] / 2 && (l = !0), n > Math.abs(e[u] - h) && (n = Math.abs(e[u] - h), o = this.items[s], this.direction = l ? "up" : "down")); if (!o && !this.options.dropOnEmpty) return; if (this.currentContainer === this.containers[p]) return void (this.currentContainer.containerCache.over || (this.containers[p]._trigger("over", e, this._uiHash()), this.currentContainer.containerCache.over = 1)); o ? this._rearrange(e, o, null, !0) : this._rearrange(e, null, this.containers[p].element, !0), this._trigger("change", e, this._uiHash()), this.containers[p]._trigger("change", e, this._uiHash(this)), this.currentContainer = this.containers[p], this.options.placeholder.update(this.currentContainer, this.placeholder), this.containers[p]._trigger("over", e, this._uiHash(this)), this.containers[p].containerCache.over = 1 } }, _createHelper: function (e) { var i = this.options, s = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [e, this.currentItem])) : "clone" === i.helper ? this.currentItem.clone() : this.currentItem; return s.parents("body").length || t("parent" !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(s[0]), s[0] === this.currentItem[0] && (this._storedCSS = { width: this.currentItem[0].style.width, height: this.currentItem[0].style.height, position: this.currentItem.css("position"), top: this.currentItem.css("top"), left: this.currentItem.css("left") }), (!s[0].style.width || i.forceHelperSize) && s.width(this.currentItem.width()), (!s[0].style.height || i.forceHelperSize) && s.height(this.currentItem.height()), s }, _adjustOffsetFromHelper: function (e) { "string" == typeof e && (e = e.split(" ")), t.isArray(e) && (e = { left: +e[0], top: +e[1] || 0 }), "left" in e && (this.offset.click.left = e.left + this.margins.left), "right" in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left), "top" in e && (this.offset.click.top = e.top + this.margins.top), "bottom" in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top) }, _getParentOffset: function () { this.offsetParent = this.helper.offsetParent(); var e = this.offsetParent.offset(); return "absolute" === this.cssPosition && this.scrollParent[0] !== this.document[0] && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(), e.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === this.document[0].body || this.offsetParent[0].tagName && "html" === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = { top: 0, left: 0 }), { top: e.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left: e.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0) } }, _getRelativeOffset: function () { if ("relative" === this.cssPosition) { var t = this.currentItem.position(); return { top: t.top - (parseInt(this.helper.css("top"), 10) || 0) + this.scrollParent.scrollTop(), left: t.left - (parseInt(this.helper.css("left"), 10) || 0) + this.scrollParent.scrollLeft() } } return { top: 0, left: 0 } }, _cacheMargins: function () { this.margins = { left: parseInt(this.currentItem.css("marginLeft"), 10) || 0, top: parseInt(this.currentItem.css("marginTop"), 10) || 0 } }, _cacheHelperProportions: function () { this.helperProportions = { width: this.helper.outerWidth(), height: this.helper.outerHeight() } }, _setContainment: function () { var e, i, s, n = this.options; "parent" === n.containment && (n.containment = this.helper[0].parentNode), ("document" === n.containment || "window" === n.containment) && (this.containment = [0 - this.offset.relative.left - this.offset.parent.left, 0 - this.offset.relative.top - this.offset.parent.top, "document" === n.containment ? this.document.width() : this.window.width() - this.helperProportions.width - this.margins.left, ("document" === n.containment ? this.document.height() || document.body.parentNode.scrollHeight : this.window.height() || this.document[0].body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]), /^(document|window|parent)$/.test(n.containment) || (e = t(n.containment)[0], i = t(n.containment).offset(), s = "hidden" !== t(e).css("overflow"), this.containment = [i.left + (parseInt(t(e).css("borderLeftWidth"), 10) || 0) + (parseInt(t(e).css("paddingLeft"), 10) || 0) - this.margins.left, i.top + (parseInt(t(e).css("borderTopWidth"), 10) || 0) + (parseInt(t(e).css("paddingTop"), 10) || 0) - this.margins.top, i.left + (s ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css("borderLeftWidth"), 10) || 0) - (parseInt(t(e).css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left, i.top + (s ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css("borderTopWidth"), 10) || 0) - (parseInt(t(e).css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top]) }, _convertPositionTo: function (e, i) { i || (i = this.position); var s = "absolute" === e ? 1 : -1, n = "absolute" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, o = /(html|body)/i.test(n[0].tagName); return { top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : o ? 0 : n.scrollTop()) * s, left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : o ? 0 : n.scrollLeft()) * s } }, _generatePosition: function (e) { var i, s, n = this.options, o = e.pageX, r = e.pageY, a = "absolute" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent, h = /(html|body)/i.test(a[0].tagName); return "relative" !== this.cssPosition || this.scrollParent[0] !== this.document[0] && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()), this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (o = this.containment[0] + this.offset.click.left), e.pageY - this.offset.click.top < this.containment[1] && (r = this.containment[1] + this.offset.click.top), e.pageX - this.offset.click.left > this.containment[2] && (o = this.containment[2] + this.offset.click.left), e.pageY - this.offset.click.top > this.containment[3] && (r = this.containment[3] + this.offset.click.top)), n.grid && (i = this.originalPageY + Math.round((r - this.originalPageY) / n.grid[1]) * n.grid[1], r = this.containment ? i - this.offset.click.top >= this.containment[1] && i - this.offset.click.top <= this.containment[3] ? i : i - this.offset.click.top >= this.containment[1] ? i - n.grid[1] : i + n.grid[1] : i, s = this.originalPageX + Math.round((o - this.originalPageX) / n.grid[0]) * n.grid[0], o = this.containment ? s - this.offset.click.left >= this.containment[0] && s - this.offset.click.left <= this.containment[2] ? s : s - this.offset.click.left >= this.containment[0] ? s - n.grid[0] : s + n.grid[0] : s)), { top: r - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.scrollParent.scrollTop() : h ? 0 : a.scrollTop()), left: o - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.scrollParent.scrollLeft() : h ? 0 : a.scrollLeft()) } }, _rearrange: function (t, e, i, s) { i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], "down" === this.direction ? e.item[0] : e.item[0].nextSibling), this.counter = this.counter ? ++this.counter : 1; var n = this.counter; this._delay((function () { n === this.counter && this.refreshPositions(!s) })) }, _clear: function (t, e) { function i(t, e, i) { return function (s) { i._trigger(t, s, e._uiHash(e)) } } this.reverting = !1; var s, n = []; if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem), this._noFinalSort = null, this.helper[0] === this.currentItem[0]) { for (s in this._storedCSS) ("auto" === this._storedCSS[s] || "static" === this._storedCSS[s]) && (this._storedCSS[s] = ""); this.currentItem.css(this._storedCSS), this._removeClass(this.currentItem, "ui-sortable-helper") } else this.currentItem.show(); for (this.fromOutside && !e && n.push((function (t) { this._trigger("receive", t, this._uiHash(this.fromOutside)) })), !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not(".ui-sortable-helper")[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || n.push((function (t) { this._trigger("update", t, this._uiHash()) })), this !== this.currentContainer && (e || (n.push((function (t) { this._trigger("remove", t, this._uiHash()) })), n.push(function (t) { return function (e) { t._trigger("receive", e, this._uiHash(this)) } }.call(this, this.currentContainer)), n.push(function (t) { return function (e) { t._trigger("update", e, this._uiHash(this)) } }.call(this, this.currentContainer)))), s = this.containers.length - 1; s >= 0; s--)e || n.push(i("deactivate", this, this.containers[s])), this.containers[s].containerCache.over && (n.push(i("out", this, this.containers[s])), this.containers[s].containerCache.over = 0); if (this.storedCursor && (this.document.find("body").css("cursor", this.storedCursor), this.storedStylesheet.remove()), this._storedOpacity && this.helper.css("opacity", this._storedOpacity), this._storedZIndex && this.helper.css("zIndex", "auto" === this._storedZIndex ? "" : this._storedZIndex), this.dragging = !1, e || this._trigger("beforeStop", t, this._uiHash()), this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.cancelHelperRemoval || (this.helper[0] !== this.currentItem[0] && this.helper.remove(), this.helper = null), !e) { for (s = 0; n.length > s; s++)n[s].call(this, t); this._trigger("stop", t, this._uiHash()) } return this.fromOutside = !1, !this.cancelHelperRemoval }, _trigger: function () { !1 === t.Widget.prototype._trigger.apply(this, arguments) && this.cancel() }, _uiHash: function (e) { var i = e || this; return { helper: i.helper, placeholder: i.placeholder || t([]), position: i.position, originalPosition: i.originalPosition, offset: i.positionAbs, item: i.currentItem, sender: e ? e.element : null } } }), t.extend(t.ui, { datepicker: { version: "1.12.1" } }), t.extend(e.prototype, { markerClassName: "hasDatepicker", maxRows: 4, _widgetDatepicker: function () { return this.dpDiv }, setDefaults: function (t) { return n(this._defaults, t || {}), this }, _attachDatepicker: function (e, i) { var s, n, o; n = "div" === (s = e.nodeName.toLowerCase()) || "span" === s, e.id || (this.uuid += 1, e.id = "dp" + this.uuid), (o = this._newInst(t(e), n)).settings = t.extend({}, i || {}), "input" === s ? this._connectDatepicker(e, o) : n && this._inlineDatepicker(e, o) }, _newInst: function (e, s) { return { id: e[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1"), input: e, selectedDay: 0, selectedMonth: 0, selectedYear: 0, drawMonth: 0, drawYear: 0, inline: s, dpDiv: s ? i(t("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")) : this.dpDiv } }, _connectDatepicker: function (e, i) { var s = t(e); i.append = t([]), i.trigger = t([]), s.hasClass(this.markerClassName) || (this._attachments(s, i), s.addClass(this.markerClassName).on("keydown", this._doKeyDown).on("keypress", this._doKeyPress).on("keyup", this._doKeyUp), this._autoSize(i), t.data(e, "datepicker", i), i.settings.disabled && this._disableDatepicker(e)) }, _attachments: function (e, i) { var s, n, o, r = this._get(i, "appendText"), a = this._get(i, "isRTL"); i.append && i.append.remove(), r && (i.append = t("<span class='" + this._appendClass + "'>" + r + "</span>"), e[a ? "before" : "after"](i.append)), e.off("focus", this._showDatepicker), i.trigger && i.trigger.remove(), ("focus" === (s = this._get(i, "showOn")) || "both" === s) && e.on("focus", this._showDatepicker), ("button" === s || "both" === s) && (n = this._get(i, "buttonText"), o = this._get(i, "buttonImage"), i.trigger = t(this._get(i, "buttonImageOnly") ? t("<img/>").addClass(this._triggerClass).attr({ src: o, alt: n, title: n }) : t("<button type='button'></button>").addClass(this._triggerClass).html(o ? t("<img/>").attr({ src: o, alt: n, title: n }) : n)), e[a ? "before" : "after"](i.trigger), i.trigger.on("click", (function () { return t.datepicker._datepickerShowing && t.datepicker._lastInput === e[0] ? t.datepicker._hideDatepicker() : t.datepicker._datepickerShowing && t.datepicker._lastInput !== e[0] ? (t.datepicker._hideDatepicker(), t.datepicker._showDatepicker(e[0])) : t.datepicker._showDatepicker(e[0]), !1 }))) }, _autoSize: function (t) { if (this._get(t, "autoSize") && !t.inline) { var e, i, s, n, o = new Date(2009, 11, 20), r = this._get(t, "dateFormat"); r.match(/[DM]/) && (e = function (t) { for (i = 0, s = 0, n = 0; t.length > n; n++)t[n].length > i && (i = t[n].length, s = n); return s }, o.setMonth(e(this._get(t, r.match(/MM/) ? "monthNames" : "monthNamesShort"))), o.setDate(e(this._get(t, r.match(/DD/) ? "dayNames" : "dayNamesShort")) + 20 - o.getDay())), t.input.attr("size", this._formatDate(t, o).length) } }, _inlineDatepicker: function (e, i) { var s = t(e); s.hasClass(this.markerClassName) || (s.addClass(this.markerClassName).append(i.dpDiv), t.data(e, "datepicker", i), this._setDate(i, this._getDefaultDate(i), !0), this._updateDatepicker(i), this._updateAlternate(i), i.settings.disabled && this._disableDatepicker(e), i.dpDiv.css("display", "block")) }, _dialogDatepicker: function (e, i, s, o, r) { var a, h, l, c, u, d = this._dialogInst; return d || (this.uuid += 1, a = "dp" + this.uuid, this._dialogInput = t("<input type='text' id='" + a + "' style='position: absolute; top: -100px; width: 0px;'/>"), this._dialogInput.on("keydown", this._doKeyDown), t("body").append(this._dialogInput), (d = this._dialogInst = this._newInst(this._dialogInput, !1)).settings = {}, t.data(this._dialogInput[0], "datepicker", d)), n(d.settings, o || {}), i = i && i.constructor === Date ? this._formatDate(d, i) : i, this._dialogInput.val(i), this._pos = r ? r.length ? r : [r.pageX, r.pageY] : null, this._pos || (h = document.documentElement.clientWidth, l = document.documentElement.clientHeight, c = document.documentElement.scrollLeft || document.body.scrollLeft, u = document.documentElement.scrollTop || document.body.scrollTop, this._pos = [h / 2 - 100 + c, l / 2 - 150 + u]), this._dialogInput.css("left", this._pos[0] + 20 + "px").css("top", this._pos[1] + "px"), d.settings.onSelect = s, this._inDialog = !0, this.dpDiv.addClass(this._dialogClass), this._showDatepicker(this._dialogInput[0]), t.blockUI && t.blockUI(this.dpDiv), t.data(this._dialogInput[0], "datepicker", d), this }, _destroyDatepicker: function (e) { var i, s = t(e), n = t.data(e, "datepicker"); s.hasClass(this.markerClassName) && (i = e.nodeName.toLowerCase(), t.removeData(e, "datepicker"), "input" === i ? (n.append.remove(), n.trigger.remove(), s.removeClass(this.markerClassName).off("focus", this._showDatepicker).off("keydown", this._doKeyDown).off("keypress", this._doKeyPress).off("keyup", this._doKeyUp)) : ("div" === i || "span" === i) && s.removeClass(this.markerClassName).empty(), h === n && (h = null)) }, _enableDatepicker: function (e) { var i, s, n = t(e), o = t.data(e, "datepicker"); n.hasClass(this.markerClassName) && ("input" === (i = e.nodeName.toLowerCase()) ? (e.disabled = !1, o.trigger.filter("button").each((function () { this.disabled = !1 })).end().filter("img").css({ opacity: "1.0", cursor: "" })) : ("div" === i || "span" === i) && ((s = n.children("." + this._inlineClass)).children().removeClass("ui-state-disabled"), s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !1)), this._disabledInputs = t.map(this._disabledInputs, (function (t) { return t === e ? null : t }))) }, _disableDatepicker: function (e) { var i, s, n = t(e), o = t.data(e, "datepicker"); n.hasClass(this.markerClassName) && ("input" === (i = e.nodeName.toLowerCase()) ? (e.disabled = !0, o.trigger.filter("button").each((function () { this.disabled = !0 })).end().filter("img").css({ opacity: "0.5", cursor: "default" })) : ("div" === i || "span" === i) && ((s = n.children("." + this._inlineClass)).children().addClass("ui-state-disabled"), s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", !0)), this._disabledInputs = t.map(this._disabledInputs, (function (t) { return t === e ? null : t })), this._disabledInputs[this._disabledInputs.length] = e) }, _isDisabledDatepicker: function (t) { if (!t) return !1; for (var e = 0; this._disabledInputs.length > e; e++)if (this._disabledInputs[e] === t) return !0; return !1 }, _getInst: function (e) { try { return t.data(e, "datepicker") } catch (t) { throw "Missing instance data for this datepicker" } }, _optionDatepicker: function (e, i, s) { var o, r, a, h, l = this._getInst(e); return 2 === arguments.length && "string" == typeof i ? "defaults" === i ? t.extend({}, t.datepicker._defaults) : l ? "all" === i ? t.extend({}, l.settings) : this._get(l, i) : null : (o = i || {}, "string" == typeof i && ((o = {})[i] = s), void (l && (this._curInst === l && this._hideDatepicker(), r = this._getDateDatepicker(e, !0), a = this._getMinMaxDate(l, "min"), h = this._getMinMaxDate(l, "max"), n(l.settings, o), null !== a && void 0 !== o.dateFormat && void 0 === o.minDate && (l.settings.minDate = this._formatDate(l, a)), null !== h && void 0 !== o.dateFormat && void 0 === o.maxDate && (l.settings.maxDate = this._formatDate(l, h)), "disabled" in o && (o.disabled ? this._disableDatepicker(e) : this._enableDatepicker(e)), this._attachments(t(e), l), this._autoSize(l), this._setDate(l, r), this._updateAlternate(l), this._updateDatepicker(l)))) }, _changeDatepicker: function (t, e, i) { this._optionDatepicker(t, e, i) }, _refreshDatepicker: function (t) { var e = this._getInst(t); e && this._updateDatepicker(e) }, _setDateDatepicker: function (t, e) { var i = this._getInst(t); i && (this._setDate(i, e), this._updateDatepicker(i), this._updateAlternate(i)) }, _getDateDatepicker: function (t, e) { var i = this._getInst(t); return i && !i.inline && this._setDateFromField(i, e), i ? this._getDate(i) : null }, _doKeyDown: function (e) { var i, s, n, o = t.datepicker._getInst(e.target), r = !0, a = o.dpDiv.is(".ui-datepicker-rtl"); if (o._keyEvent = !0, t.datepicker._datepickerShowing) switch (e.keyCode) { case 9: t.datepicker._hideDatepicker(), r = !1; break; case 13: return (n = t("td." + t.datepicker._dayOverClass + ":not(." + t.datepicker._currentClass + ")", o.dpDiv))[0] && t.datepicker._selectDay(e.target, o.selectedMonth, o.selectedYear, n[0]), (i = t.datepicker._get(o, "onSelect")) ? (s = t.datepicker._formatDate(o), i.apply(o.input ? o.input[0] : null, [s, o])) : t.datepicker._hideDatepicker(), !1; case 27: t.datepicker._hideDatepicker(); break; case 33: t.datepicker._adjustDate(e.target, e.ctrlKey ? -t.datepicker._get(o, "stepBigMonths") : -t.datepicker._get(o, "stepMonths"), "M"); break; case 34: t.datepicker._adjustDate(e.target, e.ctrlKey ? +t.datepicker._get(o, "stepBigMonths") : +t.datepicker._get(o, "stepMonths"), "M"); break; case 35: (e.ctrlKey || e.metaKey) && t.datepicker._clearDate(e.target), r = e.ctrlKey || e.metaKey; break; case 36: (e.ctrlKey || e.metaKey) && t.datepicker._gotoToday(e.target), r = e.ctrlKey || e.metaKey; break; case 37: (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, a ? 1 : -1, "D"), r = e.ctrlKey || e.metaKey, e.originalEvent.altKey && t.datepicker._adjustDate(e.target, e.ctrlKey ? -t.datepicker._get(o, "stepBigMonths") : -t.datepicker._get(o, "stepMonths"), "M"); break; case 38: (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, -7, "D"), r = e.ctrlKey || e.metaKey; break; case 39: (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, a ? -1 : 1, "D"), r = e.ctrlKey || e.metaKey, e.originalEvent.altKey && t.datepicker._adjustDate(e.target, e.ctrlKey ? +t.datepicker._get(o, "stepBigMonths") : +t.datepicker._get(o, "stepMonths"), "M"); break; case 40: (e.ctrlKey || e.metaKey) && t.datepicker._adjustDate(e.target, 7, "D"), r = e.ctrlKey || e.metaKey; break; default: r = !1 } else 36 === e.keyCode && e.ctrlKey ? t.datepicker._showDatepicker(this) : r = !1; r && (e.preventDefault(), e.stopPropagation()) }, _doKeyPress: function (e) { var i, s, n = t.datepicker._getInst(e.target); return t.datepicker._get(n, "constrainInput") ? (i = t.datepicker._possibleChars(t.datepicker._get(n, "dateFormat")), s = String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode), e.ctrlKey || e.metaKey || " " > s || !i || i.indexOf(s) > -1) : void 0 }, _doKeyUp: function (e) { var i = t.datepicker._getInst(e.target); if (i.input.val() !== i.lastVal) try { t.datepicker.parseDate(t.datepicker._get(i, "dateFormat"), i.input ? i.input.val() : null, t.datepicker._getFormatConfig(i)) && (t.datepicker._setDateFromField(i), t.datepicker._updateAlternate(i), t.datepicker._updateDatepicker(i)) } catch (t) { } return !0 }, _showDatepicker: function (e) { var i, s, o, r, a, h, l; ("input" !== (e = e.target || e).nodeName.toLowerCase() && (e = t("input", e.parentNode)[0]), t.datepicker._isDisabledDatepicker(e) || t.datepicker._lastInput === e) || (i = t.datepicker._getInst(e), t.datepicker._curInst && t.datepicker._curInst !== i && (t.datepicker._curInst.dpDiv.stop(!0, !0), i && t.datepicker._datepickerShowing && t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])), !1 !== (o = (s = t.datepicker._get(i, "beforeShow")) ? s.apply(e, [e, i]) : {}) && (n(i.settings, o), i.lastVal = null, t.datepicker._lastInput = e, t.datepicker._setDateFromField(i), t.datepicker._inDialog && (e.value = ""), t.datepicker._pos || (t.datepicker._pos = t.datepicker._findPos(e), t.datepicker._pos[1] += e.offsetHeight), r = !1, t(e).parents().each((function () { return !(r |= "fixed" === t(this).css("position")) })), a = { left: t.datepicker._pos[0], top: t.datepicker._pos[1] }, t.datepicker._pos = null, i.dpDiv.empty(), i.dpDiv.css({ position: "absolute", display: "block", top: "-1000px" }), t.datepicker._updateDatepicker(i), a = t.datepicker._checkOffset(i, a, r), i.dpDiv.css({ position: t.datepicker._inDialog && t.blockUI ? "static" : r ? "fixed" : "absolute", display: "none", left: a.left + "px", top: a.top + "px" }), i.inline || (h = t.datepicker._get(i, "showAnim"), l = t.datepicker._get(i, "duration"), i.dpDiv.css("z-index", function (t) { for (var e, i; t.length && t[0] !== document;) { if (("absolute" === (e = t.css("position")) || "relative" === e || "fixed" === e) && (i = parseInt(t.css("zIndex"), 10), !isNaN(i) && 0 !== i)) return i; t = t.parent() } return 0 }(t(e)) + 1), t.datepicker._datepickerShowing = !0, t.effects && t.effects.effect[h] ? i.dpDiv.show(h, t.datepicker._get(i, "showOptions"), l) : i.dpDiv[h || "show"](h ? l : null), t.datepicker._shouldFocusInput(i) && i.input.trigger("focus"), t.datepicker._curInst = i))) }, _updateDatepicker: function (e) { this.maxRows = 4, h = e, e.dpDiv.empty().append(this._generateHTML(e)), this._attachHandlers(e); var i, n = this._getNumberOfMonths(e), o = n[1], r = e.dpDiv.find("." + this._dayOverClass + " a"); r.length > 0 && s.apply(r.get(0)), e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""), o > 1 && e.dpDiv.addClass("ui-datepicker-multi-" + o).css("width", 17 * o + "em"), e.dpDiv[(1 !== n[0] || 1 !== n[1] ? "add" : "remove") + "Class"]("ui-datepicker-multi"), e.dpDiv[(this._get(e, "isRTL") ? "add" : "remove") + "Class"]("ui-datepicker-rtl"), e === t.datepicker._curInst && t.datepicker._datepickerShowing && t.datepicker._shouldFocusInput(e) && e.input.trigger("focus"), e.yearshtml && (i = e.yearshtml, setTimeout((function () { i === e.yearshtml && e.yearshtml && e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml), i = e.yearshtml = null }), 0)) }, _shouldFocusInput: function (t) { return t.input && t.input.is(":visible") && !t.input.is(":disabled") && !t.input.is(":focus") }, _checkOffset: function (e, i, s) { var n = e.dpDiv.outerWidth(), o = e.dpDiv.outerHeight(), r = e.input ? e.input.outerWidth() : 0, a = e.input ? e.input.outerHeight() : 0, h = document.documentElement.clientWidth + (s ? 0 : t(document).scrollLeft()), l = document.documentElement.clientHeight + (s ? 0 : t(document).scrollTop()); return i.left -= this._get(e, "isRTL") ? n - r : 0, i.left -= s && i.left === e.input.offset().left ? t(document).scrollLeft() : 0, i.top -= s && i.top === e.input.offset().top + a ? t(document).scrollTop() : 0, i.left -= Math.min(i.left, i.left + n > h && h > n ? Math.abs(i.left + n - h) : 0), i.top -= Math.min(i.top, i.top + o > l && l > o ? Math.abs(o + a) : 0), i }, _findPos: function (e) { for (var i, s = this._getInst(e), n = this._get(s, "isRTL"); e && ("hidden" === e.type || 1 !== e.nodeType || t.expr.filters.hidden(e));)e = e[n ? "previousSibling" : "nextSibling"]; return [(i = t(e).offset()).left, i.top] }, _hideDatepicker: function (e) { var i, s, n, o, r = this._curInst; !r || e && r !== t.data(e, "datepicker") || this._datepickerShowing && (i = this._get(r, "showAnim"), s = this._get(r, "duration"), n = function () { t.datepicker._tidyDialog(r) }, t.effects && (t.effects.effect[i] || t.effects[i]) ? r.dpDiv.hide(i, t.datepicker._get(r, "showOptions"), s, n) : r.dpDiv["slideDown" === i ? "slideUp" : "fadeIn" === i ? "fadeOut" : "hide"](i ? s : null, n), i || n(), this._datepickerShowing = !1, (o = this._get(r, "onClose")) && o.apply(r.input ? r.input[0] : null, [r.input ? r.input.val() : "", r]), this._lastInput = null, this._inDialog && (this._dialogInput.css({ position: "absolute", left: "0", top: "-100px" }), t.blockUI && (t.unblockUI(), t("body").append(this.dpDiv))), this._inDialog = !1) }, _tidyDialog: function (t) { t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar") }, _checkExternalClick: function (e) { if (t.datepicker._curInst) { var i = t(e.target), s = t.datepicker._getInst(i[0]); (i[0].id !== t.datepicker._mainDivId && 0 === i.parents("#" + t.datepicker._mainDivId).length && !i.hasClass(t.datepicker.markerClassName) && !i.closest("." + t.datepicker._triggerClass).length && t.datepicker._datepickerShowing && (!t.datepicker._inDialog || !t.blockUI) || i.hasClass(t.datepicker.markerClassName) && t.datepicker._curInst !== s) && t.datepicker._hideDatepicker() } }, _adjustDate: function (e, i, s) { var n = t(e), o = this._getInst(n[0]); this._isDisabledDatepicker(n[0]) || (this._adjustInstDate(o, i + ("M" === s ? this._get(o, "showCurrentAtPos") : 0), s), this._updateDatepicker(o)) }, _gotoToday: function (e) { var i, s = t(e), n = this._getInst(s[0]); this._get(n, "gotoCurrent") && n.currentDay ? (n.selectedDay = n.currentDay, n.drawMonth = n.selectedMonth = n.currentMonth, n.drawYear = n.selectedYear = n.currentYear) : (i = new Date, n.selectedDay = i.getDate(), n.drawMonth = n.selectedMonth = i.getMonth(), n.drawYear = n.selectedYear = i.getFullYear()), this._notifyChange(n), this._adjustDate(s) }, _selectMonthYear: function (e, i, s) { var n = t(e), o = this._getInst(n[0]); o["selected" + ("M" === s ? "Month" : "Year")] = o["draw" + ("M" === s ? "Month" : "Year")] = parseInt(i.options[i.selectedIndex].value, 10), this._notifyChange(o), this._adjustDate(n) }, _selectDay: function (e, i, s, n) { var o, r = t(e); t(n).hasClass(this._unselectableClass) || this._isDisabledDatepicker(r[0]) || ((o = this._getInst(r[0])).selectedDay = o.currentDay = t("a", n).html(), o.selectedMonth = o.currentMonth = i, o.selectedYear = o.currentYear = s, this._selectDate(e, this._formatDate(o, o.currentDay, o.currentMonth, o.currentYear))) }, _clearDate: function (e) { var i = t(e); this._selectDate(i, "") }, _selectDate: function (e, i) { var s, n = t(e), o = this._getInst(n[0]); i = null != i ? i : this._formatDate(o), o.input && o.input.val(i), this._updateAlternate(o), (s = this._get(o, "onSelect")) ? s.apply(o.input ? o.input[0] : null, [i, o]) : o.input && o.input.trigger("change"), o.inline ? this._updateDatepicker(o) : (this._hideDatepicker(), this._lastInput = o.input[0], "object" != typeof o.input[0] && o.input.trigger("focus"), this._lastInput = null) }, _updateAlternate: function (e) { var i, s, n, o = this._get(e, "altField"); o && (i = this._get(e, "altFormat") || this._get(e, "dateFormat"), s = this._getDate(e), n = this.formatDate(i, s, this._getFormatConfig(e)), t(o).val(n)) }, noWeekends: function (t) { var e = t.getDay(); return [e > 0 && 6 > e, ""] }, iso8601Week: function (t) { var e, i = new Date(t.getTime()); return i.setDate(i.getDate() + 4 - (i.getDay() || 7)), e = i.getTime(), i.setMonth(0), i.setDate(1), Math.floor(Math.round((e - i) / 864e5) / 7) + 1 }, parseDate: function (e, i, s) { if (null == e || null == i) throw "Invalid arguments"; if ("" === (i = "object" == typeof i ? "" + i : i + "")) return null; var n, o, r, a, h = 0, l = (s ? s.shortYearCutoff : null) || this._defaults.shortYearCutoff, c = "string" != typeof l ? l : (new Date).getFullYear() % 100 + parseInt(l, 10), u = (s ? s.dayNamesShort : null) || this._defaults.dayNamesShort, d = (s ? s.dayNames : null) || this._defaults.dayNames, p = (s ? s.monthNamesShort : null) || this._defaults.monthNamesShort, f = (s ? s.monthNames : null) || this._defaults.monthNames, g = -1, m = -1, _ = -1, v = -1, b = !1, y = function (t) { var i = e.length > n + 1 && e.charAt(n + 1) === t; return i && n++, i }, w = function (t) { var e = y(t), s = "@" === t ? 14 : "!" === t ? 20 : "y" === t && e ? 4 : "o" === t ? 3 : 2, n = RegExp("^\\d{" + ("y" === t ? s : 1) + "," + s + "}"), o = i.substring(h).match(n); if (!o) throw "Missing number at position " + h; return h += o[0].length, parseInt(o[0], 10) }, k = function (e, s, n) { var o = -1, r = t.map(y(e) ? n : s, (function (t, e) { return [[e, t]] })).sort((function (t, e) { return -(t[1].length - e[1].length) })); if (t.each(r, (function (t, e) { var s = e[1]; return i.substr(h, s.length).toLowerCase() === s.toLowerCase() ? (o = e[0], h += s.length, !1) : void 0 })), -1 !== o) return o + 1; throw "Unknown name at position " + h }, D = function () { if (i.charAt(h) !== e.charAt(n)) throw "Unexpected literal at position " + h; h++ }; for (n = 0; e.length > n; n++)if (b) "'" !== e.charAt(n) || y("'") ? D() : b = !1; else switch (e.charAt(n)) { case "d": _ = w("d"); break; case "D": k("D", u, d); break; case "o": v = w("o"); break; case "m": m = w("m"); break; case "M": m = k("M", p, f); break; case "y": g = w("y"); break; case "@": g = (a = new Date(w("@"))).getFullYear(), m = a.getMonth() + 1, _ = a.getDate(); break; case "!": g = (a = new Date((w("!") - this._ticksTo1970) / 1e4)).getFullYear(), m = a.getMonth() + 1, _ = a.getDate(); break; case "'": y("'") ? D() : b = !0; break; default: D() }if (i.length > h && (r = i.substr(h), !/^\s+/.test(r))) throw "Extra/unparsed characters found in date: " + r; if (-1 === g ? g = (new Date).getFullYear() : 100 > g && (g += (new Date).getFullYear() - (new Date).getFullYear() % 100 + (c >= g ? 0 : -100)), v > -1) for (m = 1, _ = v; !((o = this._getDaysInMonth(g, m - 1)) >= _);)m++, _ -= o; if ((a = this._daylightSavingAdjust(new Date(g, m - 1, _))).getFullYear() !== g || a.getMonth() + 1 !== m || a.getDate() !== _) throw "Invalid date"; return a }, ATOM: "yy-mm-dd", COOKIE: "D, dd M yy", ISO_8601: "yy-mm-dd", RFC_822: "D, d M y", RFC_850: "DD, dd-M-y", RFC_1036: "D, d M y", RFC_1123: "D, d M yy", RFC_2822: "D, d M yy", RSS: "D, d M y", TICKS: "!", TIMESTAMP: "@", W3C: "yy-mm-dd", _ticksTo1970: 864e9 * (718685 + Math.floor(492.5) - Math.floor(19.7) + Math.floor(4.925)), formatDate: function (t, e, i) { if (!e) return ""; var s, n = (i ? i.dayNamesShort : null) || this._defaults.dayNamesShort, o = (i ? i.dayNames : null) || this._defaults.dayNames, r = (i ? i.monthNamesShort : null) || this._defaults.monthNamesShort, a = (i ? i.monthNames : null) || this._defaults.monthNames, h = function (e) { var i = t.length > s + 1 && t.charAt(s + 1) === e; return i && s++, i }, l = function (t, e, i) { var s = "" + e; if (h(t)) for (; i > s.length;)s = "0" + s; return s }, c = function (t, e, i, s) { return h(t) ? s[e] : i[e] }, u = "", d = !1; if (e) for (s = 0; t.length > s; s++)if (d) "'" !== t.charAt(s) || h("'") ? u += t.charAt(s) : d = !1; else switch (t.charAt(s)) { case "d": u += l("d", e.getDate(), 2); break; case "D": u += c("D", e.getDay(), n, o); break; case "o": u += l("o", Math.round((new Date(e.getFullYear(), e.getMonth(), e.getDate()).getTime() - new Date(e.getFullYear(), 0, 0).getTime()) / 864e5), 3); break; case "m": u += l("m", e.getMonth() + 1, 2); break; case "M": u += c("M", e.getMonth(), r, a); break; case "y": u += h("y") ? e.getFullYear() : (10 > e.getFullYear() % 100 ? "0" : "") + e.getFullYear() % 100; break; case "@": u += e.getTime(); break; case "!": u += 1e4 * e.getTime() + this._ticksTo1970; break; case "'": h("'") ? u += "'" : d = !0; break; default: u += t.charAt(s) }return u }, _possibleChars: function (t) { var e, i = "", s = !1, n = function (i) { var s = t.length > e + 1 && t.charAt(e + 1) === i; return s && e++, s }; for (e = 0; t.length > e; e++)if (s) "'" !== t.charAt(e) || n("'") ? i += t.charAt(e) : s = !1; else switch (t.charAt(e)) { case "d": case "m": case "y": case "@": i += "0123456789"; break; case "D": case "M": return null; case "'": n("'") ? i += "'" : s = !0; break; default: i += t.charAt(e) }return i }, _get: function (t, e) { return void 0 !== t.settings[e] ? t.settings[e] : this._defaults[e] }, _setDateFromField: function (t, e) { if (t.input.val() !== t.lastVal) { var i = this._get(t, "dateFormat"), s = t.lastVal = t.input ? t.input.val() : null, n = this._getDefaultDate(t), o = n, r = this._getFormatConfig(t); try { o = this.parseDate(i, s, r) || n } catch (t) { s = e ? "" : s } t.selectedDay = o.getDate(), t.drawMonth = t.selectedMonth = o.getMonth(), t.drawYear = t.selectedYear = o.getFullYear(), t.currentDay = s ? o.getDate() : 0, t.currentMonth = s ? o.getMonth() : 0, t.currentYear = s ? o.getFullYear() : 0, this._adjustInstDate(t) } }, _getDefaultDate: function (t) { return this._restrictMinMax(t, this._determineDate(t, this._get(t, "defaultDate"), new Date)) }, _determineDate: function (e, i, s) { var n = null == i || "" === i ? s : "string" == typeof i ? function (i) { try { return t.datepicker.parseDate(t.datepicker._get(e, "dateFormat"), i, t.datepicker._getFormatConfig(e)) } catch (t) { } for (var s = (i.toLowerCase().match(/^c/) ? t.datepicker._getDate(e) : null) || new Date, n = s.getFullYear(), o = s.getMonth(), r = s.getDate(), a = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g, h = a.exec(i); h;) { switch (h[2] || "d") { case "d": case "D": r += parseInt(h[1], 10); break; case "w": case "W": r += 7 * parseInt(h[1], 10); break; case "m": case "M": o += parseInt(h[1], 10), r = Math.min(r, t.datepicker._getDaysInMonth(n, o)); break; case "y": case "Y": n += parseInt(h[1], 10), r = Math.min(r, t.datepicker._getDaysInMonth(n, o)) }h = a.exec(i) } return new Date(n, o, r) }(i) : "number" == typeof i ? isNaN(i) ? s : function (t) { var e = new Date; return e.setDate(e.getDate() + t), e }(i) : new Date(i.getTime()); return (n = n && "Invalid Date" == "" + n ? s : n) && (n.setHours(0), n.setMinutes(0), n.setSeconds(0), n.setMilliseconds(0)), this._daylightSavingAdjust(n) }, _daylightSavingAdjust: function (t) { return t ? (t.setHours(t.getHours() > 12 ? t.getHours() + 2 : 0), t) : null }, _setDate: function (t, e, i) { var s = !e, n = t.selectedMonth, o = t.selectedYear, r = this._restrictMinMax(t, this._determineDate(t, e, new Date)); t.selectedDay = t.currentDay = r.getDate(), t.drawMonth = t.selectedMonth = t.currentMonth = r.getMonth(), t.drawYear = t.selectedYear = t.currentYear = r.getFullYear(), n === t.selectedMonth && o === t.selectedYear || i || this._notifyChange(t), this._adjustInstDate(t), t.input && t.input.val(s ? "" : this._formatDate(t)) }, _getDate: function (t) { return !t.currentYear || t.input && "" === t.input.val() ? null : this._daylightSavingAdjust(new Date(t.currentYear, t.currentMonth, t.currentDay)) }, _attachHandlers: function (e) { var i = this._get(e, "stepMonths"), s = "#" + e.id.replace(/\\\\/g, "\\"); e.dpDiv.find("[data-handler]").map((function () { var e = { prev: function () { t.datepicker._adjustDate(s, -i, "M") }, next: function () { t.datepicker._adjustDate(s, +i, "M") }, hide: function () { t.datepicker._hideDatepicker() }, today: function () { t.datepicker._gotoToday(s) }, selectDay: function () { return t.datepicker._selectDay(s, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this), !1 }, selectMonth: function () { return t.datepicker._selectMonthYear(s, this, "M"), !1 }, selectYear: function () { return t.datepicker._selectMonthYear(s, this, "Y"), !1 } }; t(this).on(this.getAttribute("data-event"), e[this.getAttribute("data-handler")]) })) }, _generateHTML: function (t) { var e, i, s, n, o, r, a, h, l, c, u, d, p, f, g, m, _, v, b, y, w, k, D, C, x, I, P, M, S, T, z, H, N, A, W, O, F, E, R, Y = new Date, L = this._daylightSavingAdjust(new Date(Y.getFullYear(), Y.getMonth(), Y.getDate())), B = this._get(t, "isRTL"), j = this._get(t, "showButtonPanel"), K = this._get(t, "hideIfNoPrevNext"), U = this._get(t, "navigationAsDateFormat"), q = this._getNumberOfMonths(t), X = this._get(t, "showCurrentAtPos"), $ = this._get(t, "stepMonths"), V = 1 !== q[0] || 1 !== q[1], G = this._daylightSavingAdjust(t.currentDay ? new Date(t.currentYear, t.currentMonth, t.currentDay) : new Date(9999, 9, 9)), Q = this._getMinMaxDate(t, "min"), J = this._getMinMaxDate(t, "max"), Z = t.drawMonth - X, tt = t.drawYear; if (0 > Z && (Z += 12, tt--), J) for (e = this._daylightSavingAdjust(new Date(J.getFullYear(), J.getMonth() - q[0] * q[1] + 1, J.getDate())), e = Q && Q > e ? Q : e; this._daylightSavingAdjust(new Date(tt, Z, 1)) > e;)0 > --Z && (Z = 11, tt--); for (t.drawMonth = Z, t.drawYear = tt, i = this._get(t, "prevText"), i = U ? this.formatDate(i, this._daylightSavingAdjust(new Date(tt, Z - $, 1)), this._getFormatConfig(t)) : i, s = this._canAdjustMonth(t, -1, tt, Z) ? "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (B ? "e" : "w") + "'>" + i + "</span></a>" : K ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + i + "'><span class='ui-icon ui-icon-circle-triangle-" + (B ? "e" : "w") + "'>" + i + "</span></a>", n = this._get(t, "nextText"), n = U ? this.formatDate(n, this._daylightSavingAdjust(new Date(tt, Z + $, 1)), this._getFormatConfig(t)) : n, o = this._canAdjustMonth(t, 1, tt, Z) ? "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='" + n + "'><span class='ui-icon ui-icon-circle-triangle-" + (B ? "w" : "e") + "'>" + n + "</span></a>" : K ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + n + "'><span class='ui-icon ui-icon-circle-triangle-" + (B ? "w" : "e") + "'>" + n + "</span></a>", r = this._get(t, "currentText"), a = this._get(t, "gotoCurrent") && t.currentDay ? G : L, r = U ? this.formatDate(r, a, this._getFormatConfig(t)) : r, h = t.inline ? "" : "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" + this._get(t, "closeText") + "</button>", l = j ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (B ? h : "") + (this._isInRange(t, a) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>" + r + "</button>" : "") + (B ? "" : h) + "</div>" : "", c = parseInt(this._get(t, "firstDay"), 10), c = isNaN(c) ? 0 : c, u = this._get(t, "showWeek"), d = this._get(t, "dayNames"), p = this._get(t, "dayNamesMin"), f = this._get(t, "monthNames"), g = this._get(t, "monthNamesShort"), m = this._get(t, "beforeShowDay"), _ = this._get(t, "showOtherMonths"), v = this._get(t, "selectOtherMonths"), b = this._getDefaultDate(t), y = "", k = 0; q[0] > k; k++) { for (D = "", this.maxRows = 4, C = 0; q[1] > C; C++) { if (x = this._daylightSavingAdjust(new Date(tt, Z, t.selectedDay)), I = " ui-corner-all", P = "", V) { if (P += "<div class='ui-datepicker-group", q[1] > 1) switch (C) { case 0: P += " ui-datepicker-group-first", I = " ui-corner-" + (B ? "right" : "left"); break; case q[1] - 1: P += " ui-datepicker-group-last", I = " ui-corner-" + (B ? "left" : "right"); break; default: P += " ui-datepicker-group-middle", I = "" }P += "'>" } for (P += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + I + "'>" + (/all|left/.test(I) && 0 === k ? B ? o : s : "") + (/all|right/.test(I) && 0 === k ? B ? s : o : "") + this._generateMonthYearHeader(t, Z, tt, Q, J, k > 0 || C > 0, f, g) + "</div><table class='ui-datepicker-calendar'><thead><tr>", M = u ? "<th class='ui-datepicker-week-col'>" + this._get(t, "weekHeader") + "</th>" : "", w = 0; 7 > w; w++)M += "<th scope='col'" + ((w + c + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + "><span title='" + d[S = (w + c) % 7] + "'>" + p[S] + "</span></th>"; for (P += M + "</tr></thead><tbody>", T = this._getDaysInMonth(tt, Z), tt === t.selectedYear && Z === t.selectedMonth && (t.selectedDay = Math.min(t.selectedDay, T)), z = (this._getFirstDayOfMonth(tt, Z) - c + 7) % 7, H = Math.ceil((z + T) / 7), N = V && this.maxRows > H ? this.maxRows : H, this.maxRows = N, A = this._daylightSavingAdjust(new Date(tt, Z, 1 - z)), W = 0; N > W; W++) { for (P += "<tr>", O = u ? "<td class='ui-datepicker-week-col'>" + this._get(t, "calculateWeek")(A) + "</td>" : "", w = 0; 7 > w; w++)F = m ? m.apply(t.input ? t.input[0] : null, [A]) : [!0, ""], R = (E = A.getMonth() !== Z) && !v || !F[0] || Q && Q > A || J && A > J, O += "<td class='" + ((w + c + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + (E ? " ui-datepicker-other-month" : "") + (A.getTime() === x.getTime() && Z === t.selectedMonth && t._keyEvent || b.getTime() === A.getTime() && b.getTime() === x.getTime() ? " " + this._dayOverClass : "") + (R ? " " + this._unselectableClass + " ui-state-disabled" : "") + (E && !_ ? "" : " " + F[1] + (A.getTime() === G.getTime() ? " " + this._currentClass : "") + (A.getTime() === L.getTime() ? " ui-datepicker-today" : "")) + "'" + (E && !_ || !F[2] ? "" : " title='" + F[2].replace(/'/g, "&#39;") + "'") + (R ? "" : " data-handler='selectDay' data-event='click' data-month='" + A.getMonth() + "' data-year='" + A.getFullYear() + "'") + ">" + (E && !_ ? "&#xa0;" : R ? "<span class='ui-state-default'>" + A.getDate() + "</span>" : "<a class='ui-state-default" + (A.getTime() === L.getTime() ? " ui-state-highlight" : "") + (A.getTime() === G.getTime() ? " ui-state-active" : "") + (E ? " ui-priority-secondary" : "") + "' href='#'>" + A.getDate() + "</a>") + "</td>", A.setDate(A.getDate() + 1), A = this._daylightSavingAdjust(A); P += O + "</tr>" } ++Z > 11 && (Z = 0, tt++), D += P += "</tbody></table>" + (V ? "</div>" + (q[0] > 0 && C === q[1] - 1 ? "<div class='ui-datepicker-row-break'></div>" : "") : "") } y += D } return y += l, t._keyEvent = !1, y }, _generateMonthYearHeader: function (t, e, i, s, n, o, r, a) { var h, l, c, u, d, p, f, g, m = this._get(t, "changeMonth"), _ = this._get(t, "changeYear"), v = this._get(t, "showMonthAfterYear"), b = "<div class='ui-datepicker-title'>", y = ""; if (o || !m) y += "<span class='ui-datepicker-month'>" + r[e] + "</span>"; else { for (h = s && s.getFullYear() === i, l = n && n.getFullYear() === i, y += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>", c = 0; 12 > c; c++)(!h || c >= s.getMonth()) && (!l || n.getMonth() >= c) && (y += "<option value='" + c + "'" + (c === e ? " selected='selected'" : "") + ">" + a[c] + "</option>"); y += "</select>" } if (v || (b += y + (!o && m && _ ? "" : "&#xa0;")), !t.yearshtml) if (t.yearshtml = "", o || !_) b += "<span class='ui-datepicker-year'>" + i + "</span>"; else { for (u = this._get(t, "yearRange").split(":"), d = (new Date).getFullYear(), f = (p = function (t) { var e = t.match(/c[+\-].*/) ? i + parseInt(t.substring(1), 10) : t.match(/[+\-].*/) ? d + parseInt(t, 10) : parseInt(t, 10); return isNaN(e) ? d : e })(u[0]), g = Math.max(f, p(u[1] || "")), f = s ? Math.max(f, s.getFullYear()) : f, g = n ? Math.min(g, n.getFullYear()) : g, t.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>"; g >= f; f++)t.yearshtml += "<option value='" + f + "'" + (f === i ? " selected='selected'" : "") + ">" + f + "</option>"; t.yearshtml += "</select>", b += t.yearshtml, t.yearshtml = null } return b += this._get(t, "yearSuffix"), v && (b += (!o && m && _ ? "" : "&#xa0;") + y), b + "</div>" }, _adjustInstDate: function (t, e, i) { var s = t.selectedYear + ("Y" === i ? e : 0), n = t.selectedMonth + ("M" === i ? e : 0), o = Math.min(t.selectedDay, this._getDaysInMonth(s, n)) + ("D" === i ? e : 0), r = this._restrictMinMax(t, this._daylightSavingAdjust(new Date(s, n, o))); t.selectedDay = r.getDate(), t.drawMonth = t.selectedMonth = r.getMonth(), t.drawYear = t.selectedYear = r.getFullYear(), ("M" === i || "Y" === i) && this._notifyChange(t) }, _restrictMinMax: function (t, e) { var i = this._getMinMaxDate(t, "min"), s = this._getMinMaxDate(t, "max"), n = i && i > e ? i : e; return s && n > s ? s : n }, _notifyChange: function (t) { var e = this._get(t, "onChangeMonthYear"); e && e.apply(t.input ? t.input[0] : null, [t.selectedYear, t.selectedMonth + 1, t]) }, _getNumberOfMonths: function (t) { var e = this._get(t, "numberOfMonths"); return null == e ? [1, 1] : "number" == typeof e ? [1, e] : e }, _getMinMaxDate: function (t, e) { return this._determineDate(t, this._get(t, e + "Date"), null) }, _getDaysInMonth: function (t, e) { return 32 - this._daylightSavingAdjust(new Date(t, e, 32)).getDate() }, _getFirstDayOfMonth: function (t, e) { return new Date(t, e, 1).getDay() }, _canAdjustMonth: function (t, e, i, s) { var n = this._getNumberOfMonths(t), o = this._daylightSavingAdjust(new Date(i, s + (0 > e ? e : n[0] * n[1]), 1)); return 0 > e && o.setDate(this._getDaysInMonth(o.getFullYear(), o.getMonth())), this._isInRange(t, o) }, _isInRange: function (t, e) { var i, s, n = this._getMinMaxDate(t, "min"), o = this._getMinMaxDate(t, "max"), r = null, a = null, h = this._get(t, "yearRange"); return h && (i = h.split(":"), s = (new Date).getFullYear(), r = parseInt(i[0], 10), a = parseInt(i[1], 10), i[0].match(/[+\-].*/) && (r += s), i[1].match(/[+\-].*/) && (a += s)), (!n || e.getTime() >= n.getTime()) && (!o || e.getTime() <= o.getTime()) && (!r || e.getFullYear() >= r) && (!a || a >= e.getFullYear()) }, _getFormatConfig: function (t) { var e = this._get(t, "shortYearCutoff"); return { shortYearCutoff: e = "string" != typeof e ? e : (new Date).getFullYear() % 100 + parseInt(e, 10), dayNamesShort: this._get(t, "dayNamesShort"), dayNames: this._get(t, "dayNames"), monthNamesShort: this._get(t, "monthNamesShort"), monthNames: this._get(t, "monthNames") } }, _formatDate: function (t, e, i, s) { e || (t.currentDay = t.selectedDay, t.currentMonth = t.selectedMonth, t.currentYear = t.selectedYear); var n = e ? "object" == typeof e ? e : this._daylightSavingAdjust(new Date(s, i, e)) : this._daylightSavingAdjust(new Date(t.currentYear, t.currentMonth, t.currentDay)); return this.formatDate(this._get(t, "dateFormat"), n, this._getFormatConfig(t)) } }), t.fn.datepicker = function (e) { if (!this.length) return this; t.datepicker.initialized || (t(document).on("mousedown", t.datepicker._checkExternalClick), t.datepicker.initialized = !0), 0 === t("#" + t.datepicker._mainDivId).length && t("body").append(t.datepicker.dpDiv); var i = Array.prototype.slice.call(arguments, 1); return "string" != typeof e || "isDisabled" !== e && "getDate" !== e && "widget" !== e ? "option" === e && 2 === arguments.length && "string" == typeof arguments[1] ? t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this[0]].concat(i)) : this.each((function () { "string" == typeof e ? t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this].concat(i)) : t.datepicker._attachDatepicker(this, e) })) : t.datepicker["_" + e + "Datepicker"].apply(t.datepicker, [this[0]].concat(i)) }, t.datepicker = new e, t.datepicker.initialized = !1, t.datepicker.uuid = (new Date).getTime(), t.datepicker.version = "1.12.1", t.datepicker, t.widget("ui.menu", { version: "1.12.1", defaultElement: "<ul>", delay: 300, options: { icons: { submenu: "ui-icon-caret-1-e" }, items: "> *", menus: "ul", position: { my: "left top", at: "right top" }, role: "menu", blur: null, focus: null, select: null }, _create: function () { this.activeMenu = this.element, this.mouseHandled = !1, this.element.uniqueId().attr({ role: this.options.role, tabIndex: 0 }), this._addClass("ui-menu", "ui-widget ui-widget-content"), this._on({ "mousedown .ui-menu-item": function (t) { t.preventDefault() }, "click .ui-menu-item": function (e) { var i = t(e.target), s = t(t.ui.safeActiveElement(this.document[0])); !this.mouseHandled && i.not(".ui-state-disabled").length && (this.select(e), e.isPropagationStopped() || (this.mouseHandled = !0), i.has(".ui-menu").length ? this.expand(e) : !this.element.is(":focus") && s.closest(".ui-menu").length && (this.element.trigger("focus", [!0]), this.active && 1 === this.active.parents(".ui-menu").length && clearTimeout(this.timer))) }, "mouseenter .ui-menu-item": function (e) { if (!this.previousFilter) { var i = t(e.target).closest(".ui-menu-item"), s = t(e.currentTarget); i[0] === s[0] && (this._removeClass(s.siblings().children(".ui-state-active"), null, "ui-state-active"), this.focus(e, s)) } }, mouseleave: "collapseAll", "mouseleave .ui-menu": "collapseAll", focus: function (t, e) { var i = this.active || this.element.find(this.options.items).eq(0); e || this.focus(t, i) }, blur: function (e) { this._delay((function () { !t.contains(this.element[0], t.ui.safeActiveElement(this.document[0])) && this.collapseAll(e) })) }, keydown: "_keydown" }), this.refresh(), this._on(this.document, { click: function (t) { this._closeOnDocumentClick(t) && this.collapseAll(t), this.mouseHandled = !1 } }) }, _destroy: function () { var e = this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup"); this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(), e.children().each((function () { var e = t(this); e.data("ui-menu-submenu-caret") && e.remove() })) }, _keydown: function (e) { var i, s, n, o, r = !0; switch (e.keyCode) { case t.ui.keyCode.PAGE_UP: this.previousPage(e); break; case t.ui.keyCode.PAGE_DOWN: this.nextPage(e); break; case t.ui.keyCode.HOME: this._move("first", "first", e); break; case t.ui.keyCode.END: this._move("last", "last", e); break; case t.ui.keyCode.UP: this.previous(e); break; case t.ui.keyCode.DOWN: this.next(e); break; case t.ui.keyCode.LEFT: this.collapse(e); break; case t.ui.keyCode.RIGHT: this.active && !this.active.is(".ui-state-disabled") && this.expand(e); break; case t.ui.keyCode.ENTER: case t.ui.keyCode.SPACE: this._activate(e); break; case t.ui.keyCode.ESCAPE: this.collapse(e); break; default: r = !1, s = this.previousFilter || "", o = !1, n = e.keyCode >= 96 && 105 >= e.keyCode ? "" + (e.keyCode - 96) : String.fromCharCode(e.keyCode), clearTimeout(this.filterTimer), n === s ? o = !0 : n = s + n, i = this._filterMenuItems(n), (i = o && -1 !== i.index(this.active.next()) ? this.active.nextAll(".ui-menu-item") : i).length || (n = String.fromCharCode(e.keyCode), i = this._filterMenuItems(n)), i.length ? (this.focus(e, i), this.previousFilter = n, this.filterTimer = this._delay((function () { delete this.previousFilter }), 1e3)) : delete this.previousFilter }r && e.preventDefault() }, _activate: function (t) { this.active && !this.active.is(".ui-state-disabled") && (this.active.children("[aria-haspopup='true']").length ? this.expand(t) : this.select(t)) }, refresh: function () { var e, i, s, n, o = this, r = this.options.icons.submenu, a = this.element.find(this.options.menus); this._toggleClass("ui-menu-icons", null, !!this.element.find(".ui-icon").length), i = a.filter(":not(.ui-menu)").hide().attr({ role: this.options.role, "aria-hidden": "true", "aria-expanded": "false" }).each((function () { var e = t(this), i = e.prev(), s = t("<span>").data("ui-menu-submenu-caret", !0); o._addClass(s, "ui-menu-icon", "ui-icon " + r), i.attr("aria-haspopup", "true").prepend(s), e.attr("aria-labelledby", i.attr("id")) })), this._addClass(i, "ui-menu", "ui-widget ui-widget-content ui-front"), (e = a.add(this.element).find(this.options.items)).not(".ui-menu-item").each((function () { var e = t(this); o._isDivider(e) && o._addClass(e, "ui-menu-divider", "ui-widget-content") })), n = (s = e.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({ tabIndex: -1, role: this._itemRole() }), this._addClass(s, "ui-menu-item")._addClass(n, "ui-menu-item-wrapper"), e.filter(".ui-state-disabled").attr("aria-disabled", "true"), this.active && !t.contains(this.element[0], this.active[0]) && this.blur() }, _itemRole: function () { return { menu: "menuitem", listbox: "option" }[this.options.role] }, _setOption: function (t, e) { if ("icons" === t) { var i = this.element.find(".ui-menu-icon"); this._removeClass(i, null, this.options.icons.submenu)._addClass(i, null, e.submenu) } this._super(t, e) }, _setOptionDisabled: function (t) { this._super(t), this.element.attr("aria-disabled", t + ""), this._toggleClass(null, "ui-state-disabled", !!t) }, focus: function (t, e) { var i, s, n; this.blur(t, t && "focus" === t.type), this._scrollIntoView(e), this.active = e.first(), s = this.active.children(".ui-menu-item-wrapper"), this._addClass(s, null, "ui-state-active"), this.options.role && this.element.attr("aria-activedescendant", s.attr("id")), n = this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"), this._addClass(n, null, "ui-state-active"), t && "keydown" === t.type ? this._close() : this.timer = this._delay((function () { this._close() }), this.delay), (i = e.children(".ui-menu")).length && t && /^mouse/.test(t.type) && this._startOpening(i), this.activeMenu = e.parent(), this._trigger("focus", t, { item: e }) }, _scrollIntoView: function (e) { var i, s, n, o, r, a; this._hasScroll() && (i = parseFloat(t.css(this.activeMenu[0], "borderTopWidth")) || 0, s = parseFloat(t.css(this.activeMenu[0], "paddingTop")) || 0, n = e.offset().top - this.activeMenu.offset().top - i - s, o = this.activeMenu.scrollTop(), r = this.activeMenu.height(), a = e.outerHeight(), 0 > n ? this.activeMenu.scrollTop(o + n) : n + a > r && this.activeMenu.scrollTop(o + n - r + a)) }, blur: function (t, e) { e || clearTimeout(this.timer), this.active && (this._removeClass(this.active.children(".ui-menu-item-wrapper"), null, "ui-state-active"), this._trigger("blur", t, { item: this.active }), this.active = null) }, _startOpening: function (t) { clearTimeout(this.timer), "true" === t.attr("aria-hidden") && (this.timer = this._delay((function () { this._close(), this._open(t) }), this.delay)) }, _open: function (e) { var i = t.extend({ of: this.active }, this.options.position); clearTimeout(this.timer), this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden", "true"), e.show().removeAttr("aria-hidden").attr("aria-expanded", "true").position(i) }, collapseAll: function (e, i) { clearTimeout(this.timer), this.timer = this._delay((function () { var s = i ? this.element : t(e && e.target).closest(this.element.find(".ui-menu")); s.length || (s = this.element), this._close(s), this.blur(e), this._removeClass(s.find(".ui-state-active"), null, "ui-state-active"), this.activeMenu = s }), this.delay) }, _close: function (t) { t || (t = this.active ? this.active.parent() : this.element), t.find(".ui-menu").hide().attr("aria-hidden", "true").attr("aria-expanded", "false") }, _closeOnDocumentClick: function (e) { return !t(e.target).closest(".ui-menu").length }, _isDivider: function (t) { return !/[^\-\u2014\u2013\s]/.test(t.text()) }, collapse: function (t) { var e = this.active && this.active.parent().closest(".ui-menu-item", this.element); e && e.length && (this._close(), this.focus(t, e)) }, expand: function (t) { var e = this.active && this.active.children(".ui-menu ").find(this.options.items).first(); e && e.length && (this._open(e.parent()), this._delay((function () { this.focus(t, e) }))) }, next: function (t) { this._move("next", "first", t) }, previous: function (t) { this._move("prev", "last", t) }, isFirstItem: function () { return this.active && !this.active.prevAll(".ui-menu-item").length }, isLastItem: function () { return this.active && !this.active.nextAll(".ui-menu-item").length }, _move: function (t, e, i) { var s; this.active && (s = "first" === t || "last" === t ? this.active["first" === t ? "prevAll" : "nextAll"](".ui-menu-item").eq(-1) : this.active[t + "All"](".ui-menu-item").eq(0)), s && s.length && this.active || (s = this.activeMenu.find(this.options.items)[e]()), this.focus(i, s) }, nextPage: function (e) { var i, s, n; return this.active ? void (this.isLastItem() || (this._hasScroll() ? (s = this.active.offset().top, n = this.element.height(), this.active.nextAll(".ui-menu-item").each((function () { return 0 > (i = t(this)).offset().top - s - n })), this.focus(e, i)) : this.focus(e, this.activeMenu.find(this.options.items)[this.active ? "last" : "first"]()))) : void this.next(e) }, previousPage: function (e) { var i, s, n; return this.active ? void (this.isFirstItem() || (this._hasScroll() ? (s = this.active.offset().top, n = this.element.height(), this.active.prevAll(".ui-menu-item").each((function () { return (i = t(this)).offset().top - s + n > 0 })), this.focus(e, i)) : this.focus(e, this.activeMenu.find(this.options.items).first()))) : void this.next(e) }, _hasScroll: function () { return this.element.outerHeight() < this.element.prop("scrollHeight") }, select: function (e) { this.active = this.active || t(e.target).closest(".ui-menu-item"); var i = { item: this.active }; this.active.has(".ui-menu").length || this.collapseAll(e, !0), this._trigger("select", e, i) }, _filterMenuItems: function (e) { var i = e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"), s = RegExp("^" + i, "i"); return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter((function () { return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text())) })) } }), t.widget("ui.selectmenu", [t.ui.formResetMixin, { version: "1.12.1", defaultElement: "<select>", options: { appendTo: null, classes: { "ui-selectmenu-button-open": "ui-corner-top", "ui-selectmenu-button-closed": "ui-corner-all" }, disabled: null, icons: { button: "ui-icon-triangle-1-s" }, position: { my: "left top", at: "left bottom", collision: "none" }, width: !1, change: null, close: null, focus: null, open: null, select: null }, _create: function () { var e = this.element.uniqueId().attr("id"); this.ids = { element: e, button: e + "-button", menu: e + "-menu" }, this._drawButton(), this._drawMenu(), this._bindFormResetHandler(), this._rendered = !1, this.menuItems = t() }, _drawButton: function () { var e, i = this, s = this._parseOption(this.element.find("option:selected"), this.element[0].selectedIndex); this.labels = this.element.labels().attr("for", this.ids.button), this._on(this.labels, { click: function (t) { this.button.focus(), t.preventDefault() } }), this.element.hide(), this.button = t("<span>", { tabindex: this.options.disabled ? -1 : 0, id: this.ids.button, role: "combobox", "aria-expanded": "false", "aria-autocomplete": "list", "aria-owns": this.ids.menu, "aria-haspopup": "true", title: this.element.attr("title") }).insertAfter(this.element), this._addClass(this.button, "ui-selectmenu-button ui-selectmenu-button-closed", "ui-button ui-widget"), e = t("<span>").appendTo(this.button), this._addClass(e, "ui-selectmenu-icon", "ui-icon " + this.options.icons.button), this.buttonItem = this._renderButtonItem(s).appendTo(this.button), !1 !== this.options.width && this._resizeButton(), this._on(this.button, this._buttonEvents), this.button.one("focusin", (function () { i._rendered || i._refreshMenu() })) }, _drawMenu: function () { var e = this; this.menu = t("<ul>", { "aria-hidden": "true", "aria-labelledby": this.ids.button, id: this.ids.menu }), this.menuWrap = t("<div>").append(this.menu), this._addClass(this.menuWrap, "ui-selectmenu-menu", "ui-front"), this.menuWrap.appendTo(this._appendTo()), this.menuInstance = this.menu.menu({ classes: { "ui-menu": "ui-corner-bottom" }, role: "listbox", select: function (t, i) { t.preventDefault(), e._setSelection(), e._select(i.item.data("ui-selectmenu-item"), t) }, focus: function (t, i) { var s = i.item.data("ui-selectmenu-item"); null != e.focusIndex && s.index !== e.focusIndex && (e._trigger("focus", t, { item: s }), e.isOpen || e._select(s, t)), e.focusIndex = s.index, e.button.attr("aria-activedescendant", e.menuItems.eq(s.index).attr("id")) } }).menu("instance"), this.menuInstance._off(this.menu, "mouseleave"), this.menuInstance._closeOnDocumentClick = function () { return !1 }, this.menuInstance._isDivider = function () { return !1 } }, refresh: function () { this._refreshMenu(), this.buttonItem.replaceWith(this.buttonItem = this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item") || {})), null === this.options.width && this._resizeButton() }, _refreshMenu: function () { var t, e = this.element.find("option"); this.menu.empty(), this._parseOptions(e), this._renderMenu(this.menu, this.items), this.menuInstance.refresh(), this.menuItems = this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"), this._rendered = !0, e.length && (t = this._getSelectedItem(), this.menuInstance.focus(null, t), this._setAria(t.data("ui-selectmenu-item")), this._setOption("disabled", this.element.prop("disabled"))) }, open: function (t) { this.options.disabled || (this._rendered ? (this._removeClass(this.menu.find(".ui-state-active"), null, "ui-state-active"), this.menuInstance.focus(null, this._getSelectedItem())) : this._refreshMenu(), this.menuItems.length && (this.isOpen = !0, this._toggleAttr(), this._resizeMenu(), this._position(), this._on(this.document, this._documentClick), this._trigger("open", t))) }, _position: function () { this.menuWrap.position(t.extend({ of: this.button }, this.options.position)) }, close: function (t) { this.isOpen && (this.isOpen = !1, this._toggleAttr(), this.range = null, this._off(this.document), this._trigger("close", t)) }, widget: function () { return this.button }, menuWidget: function () { return this.menu }, _renderButtonItem: function (e) { var i = t("<span>"); return this._setText(i, e.label), this._addClass(i, "ui-selectmenu-text"), i }, _renderMenu: function (e, i) { var s = this, n = ""; t.each(i, (function (i, o) { var r; o.optgroup !== n && (r = t("<li>", { text: o.optgroup }), s._addClass(r, "ui-selectmenu-optgroup", "ui-menu-divider" + (o.element.parent("optgroup").prop("disabled") ? " ui-state-disabled" : "")), r.appendTo(e), n = o.optgroup), s._renderItemData(e, o) })) }, _renderItemData: function (t, e) { return this._renderItem(t, e).data("ui-selectmenu-item", e) }, _renderItem: function (e, i) { var s = t("<li>"), n = t("<div>", { title: i.element.attr("title") }); return i.disabled && this._addClass(s, null, "ui-state-disabled"), this._setText(n, i.label), s.append(n).appendTo(e) }, _setText: function (t, e) { e ? t.text(e) : t.html("&#160;") }, _move: function (t, e) { var i, s, n = ".ui-menu-item"; this.isOpen ? i = this.menuItems.eq(this.focusIndex).parent("li") : (i = this.menuItems.eq(this.element[0].selectedIndex).parent("li"), n += ":not(.ui-state-disabled)"), (s = "first" === t || "last" === t ? i["first" === t ? "prevAll" : "nextAll"](n).eq(-1) : i[t + "All"](n).eq(0)).length && this.menuInstance.focus(e, s) }, _getSelectedItem: function () { return this.menuItems.eq(this.element[0].selectedIndex).parent("li") }, _toggle: function (t) { this[this.isOpen ? "close" : "open"](t) }, _setSelection: function () { var t; this.range && (window.getSelection ? ((t = window.getSelection()).removeAllRanges(), t.addRange(this.range)) : this.range.select(), this.button.focus()) }, _documentClick: { mousedown: function (e) { this.isOpen && (t(e.target).closest(".ui-selectmenu-menu, #" + t.ui.escapeSelector(this.ids.button)).length || this.close(e)) } }, _buttonEvents: { mousedown: function () { var t; window.getSelection ? (t = window.getSelection()).rangeCount && (this.range = t.getRangeAt(0)) : this.range = document.selection.createRange() }, click: function (t) { this._setSelection(), this._toggle(t) }, keydown: function (e) { var i = !0; switch (e.keyCode) { case t.ui.keyCode.TAB: case t.ui.keyCode.ESCAPE: this.close(e), i = !1; break; case t.ui.keyCode.ENTER: this.isOpen && this._selectFocusedItem(e); break; case t.ui.keyCode.UP: e.altKey ? this._toggle(e) : this._move("prev", e); break; case t.ui.keyCode.DOWN: e.altKey ? this._toggle(e) : this._move("next", e); break; case t.ui.keyCode.SPACE: this.isOpen ? this._selectFocusedItem(e) : this._toggle(e); break; case t.ui.keyCode.LEFT: this._move("prev", e); break; case t.ui.keyCode.RIGHT: this._move("next", e); break; case t.ui.keyCode.HOME: case t.ui.keyCode.PAGE_UP: this._move("first", e); break; case t.ui.keyCode.END: case t.ui.keyCode.PAGE_DOWN: this._move("last", e); break; default: this.menu.trigger(e), i = !1 }i && e.preventDefault() } }, _selectFocusedItem: function (t) { var e = this.menuItems.eq(this.focusIndex).parent("li"); e.hasClass("ui-state-disabled") || this._select(e.data("ui-selectmenu-item"), t) }, _select: function (t, e) { var i = this.element[0].selectedIndex; this.element[0].selectedIndex = t.index, this.buttonItem.replaceWith(this.buttonItem = this._renderButtonItem(t)), this._setAria(t), this._trigger("select", e, { item: t }), t.index !== i && this._trigger("change", e, { item: t }), this.close(e) }, _setAria: function (t) { var e = this.menuItems.eq(t.index).attr("id"); this.button.attr({ "aria-labelledby": e, "aria-activedescendant": e }), this.menu.attr("aria-activedescendant", e) }, _setOption: function (t, e) { if ("icons" === t) { var i = this.button.find("span.ui-icon"); this._removeClass(i, null, this.options.icons.button)._addClass(i, null, e.button) } this._super(t, e), "appendTo" === t && this.menuWrap.appendTo(this._appendTo()), "width" === t && this._resizeButton() }, _setOptionDisabled: function (t) { this._super(t), this.menuInstance.option("disabled", t), this.button.attr("aria-disabled", t), this._toggleClass(this.button, null, "ui-state-disabled", t), this.element.prop("disabled", t), t ? (this.button.attr("tabindex", -1), this.close()) : this.button.attr("tabindex", 0) }, _appendTo: function () { var e = this.options.appendTo; return e && (e = e.jquery || e.nodeType ? t(e) : this.document.find(e).eq(0)), e && e[0] || (e = this.element.closest(".ui-front, dialog")), e.length || (e = this.document[0].body), e }, _toggleAttr: function () { this.button.attr("aria-expanded", this.isOpen), this._removeClass(this.button, "ui-selectmenu-button-" + (this.isOpen ? "closed" : "open"))._addClass(this.button, "ui-selectmenu-button-" + (this.isOpen ? "open" : "closed"))._toggleClass(this.menuWrap, "ui-selectmenu-open", null, this.isOpen), this.menu.attr("aria-hidden", !this.isOpen) }, _resizeButton: function () { var t = this.options.width; return !1 === t ? void this.button.css("width", "") : (null === t && (t = this.element.show().outerWidth(), this.element.hide()), void this.button.outerWidth(t)) }, _resizeMenu: function () { this.menu.outerWidth(Math.max(this.button.outerWidth(), this.menu.width("").outerWidth() + 1)) }, _getCreateOptions: function () { var t = this._super(); return t.disabled = this.element.prop("disabled"), t }, _parseOptions: function (e) { var i = this, s = []; e.each((function (e, n) { s.push(i._parseOption(t(n), e)) })), this.items = s }, _parseOption: function (t, e) { var i = t.parent("optgroup"); return { element: t, index: e, value: t.val(), label: t.text(), optgroup: i.attr("label") || "", disabled: i.prop("disabled") || t.prop("disabled") } }, _destroy: function () { this._unbindFormResetHandler(), this.menuWrap.remove(), this.button.remove(), this.element.show(), this.element.removeUniqueId(), this.labels.attr("for", this.ids.element) } }]); var c = "ui-effects-", u = "ui-effects-style", d = "ui-effects-animated", p = t; t.effects = { effect: {} }, function (t, e) { function i(t, e, i) { var s = c[e.type] || {}; return null == t ? i || !e.def ? null : e.def : (t = s.floor ? ~~t : parseFloat(t), isNaN(t) ? e.def : s.mod ? (t + s.mod) % s.mod : 0 > t ? 0 : t > s.max ? s.max : t) } function s(i) { var s = h(), n = s._rgba = []; return i = i.toLowerCase(), p(a, (function (t, o) { var r, a = o.re.exec(i), h = a && o.parse(a), c = o.space || "rgba"; return h ? (r = s[c](h), s[l[c].cache] = r[l[c].cache], n = s._rgba = r._rgba, !1) : e })), n.length ? ("0,0,0,0" === n.join() && t.extend(n, o.transparent), s) : o[i] } function n(t, e, i) { return 1 > 6 * (i = (i + 1) % 1) ? t + 6 * (e - t) * i : 1 > 2 * i ? e : 2 > 3 * i ? t + 6 * (e - t) * (2 / 3 - i) : t } var o, r = /^([\-+])=\s*(\d+\.?\d*)/, a = [{ re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/, parse: function (t) { return [t[1], t[2], t[3], t[4]] } }, { re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/, parse: function (t) { return [2.55 * t[1], 2.55 * t[2], 2.55 * t[3], t[4]] } }, { re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/, parse: function (t) { return [parseInt(t[1], 16), parseInt(t[2], 16), parseInt(t[3], 16)] } }, { re: /#([a-f0-9])([a-f0-9])([a-f0-9])/, parse: function (t) { return [parseInt(t[1] + t[1], 16), parseInt(t[2] + t[2], 16), parseInt(t[3] + t[3], 16)] } }, { re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/, space: "hsla", parse: function (t) { return [t[1], t[2] / 100, t[3] / 100, t[4]] } }], h = t.Color = function (e, i, s, n) { return new t.Color.fn.parse(e, i, s, n) }, l = { rgba: { props: { red: { idx: 0, type: "byte" }, green: { idx: 1, type: "byte" }, blue: { idx: 2, type: "byte" } } }, hsla: { props: { hue: { idx: 0, type: "degrees" }, saturation: { idx: 1, type: "percent" }, lightness: { idx: 2, type: "percent" } } } }, c = { byte: { floor: !0, max: 255 }, percent: { max: 1 }, degrees: { mod: 360, floor: !0 } }, u = h.support = {}, d = t("<p>")[0], p = t.each; d.style.cssText = "background-color:rgba(1,1,1,.5)", u.rgba = d.style.backgroundColor.indexOf("rgba") > -1, p(l, (function (t, e) { e.cache = "_" + t, e.props.alpha = { idx: 3, type: "percent", def: 1 } })), h.fn = t.extend(h.prototype, { parse: function (n, r, a, c) { if (n === e) return this._rgba = [null, null, null, null], this; (n.jquery || n.nodeType) && (n = t(n).css(r), r = e); var u = this, d = t.type(n), f = this._rgba = []; return r !== e && (n = [n, r, a, c], d = "array"), "string" === d ? this.parse(s(n) || o._default) : "array" === d ? (p(l.rgba.props, (function (t, e) { f[e.idx] = i(n[e.idx], e) })), this) : "object" === d ? (p(l, n instanceof h ? function (t, e) { n[e.cache] && (u[e.cache] = n[e.cache].slice()) } : function (e, s) { var o = s.cache; p(s.props, (function (t, e) { if (!u[o] && s.to) { if ("alpha" === t || null == n[t]) return; u[o] = s.to(u._rgba) } u[o][e.idx] = i(n[t], e, !0) })), u[o] && 0 > t.inArray(null, u[o].slice(0, 3)) && (u[o][3] = 1, s.from && (u._rgba = s.from(u[o]))) }), this) : e }, is: function (t) { var i = h(t), s = !0, n = this; return p(l, (function (t, o) { var r, a = i[o.cache]; return a && (r = n[o.cache] || o.to && o.to(n._rgba) || [], p(o.props, (function (t, i) { return null != a[i.idx] ? s = a[i.idx] === r[i.idx] : e }))), s })), s }, _space: function () { var t = [], e = this; return p(l, (function (i, s) { e[s.cache] && t.push(i) })), t.pop() }, transition: function (t, e) { var s = h(t), n = s._space(), o = l[n], r = 0 === this.alpha() ? h("transparent") : this, a = r[o.cache] || o.to(r._rgba), u = a.slice(); return s = s[o.cache], p(o.props, (function (t, n) { var o = n.idx, r = a[o], h = s[o], l = c[n.type] || {}; null !== h && (null === r ? u[o] = h : (l.mod && (h - r > l.mod / 2 ? r += l.mod : r - h > l.mod / 2 && (r -= l.mod)), u[o] = i((h - r) * e + r, n))) })), this[n](u) }, blend: function (e) { if (1 === this._rgba[3]) return this; var i = this._rgba.slice(), s = i.pop(), n = h(e)._rgba; return h(t.map(i, (function (t, e) { return (1 - s) * n[e] + s * t }))) }, toRgbaString: function () { var e = "rgba(", i = t.map(this._rgba, (function (t, e) { return null == t ? e > 2 ? 1 : 0 : t })); return 1 === i[3] && (i.pop(), e = "rgb("), e + i.join() + ")" }, toHslaString: function () { var e = "hsla(", i = t.map(this.hsla(), (function (t, e) { return null == t && (t = e > 2 ? 1 : 0), e && 3 > e && (t = Math.round(100 * t) + "%"), t })); return 1 === i[3] && (i.pop(), e = "hsl("), e + i.join() + ")" }, toHexString: function (e) { var i = this._rgba.slice(), s = i.pop(); return e && i.push(~~(255 * s)), "#" + t.map(i, (function (t) { return 1 === (t = (t || 0).toString(16)).length ? "0" + t : t })).join("") }, toString: function () { return 0 === this._rgba[3] ? "transparent" : this.toRgbaString() } }), h.fn.parse.prototype = h.fn, l.hsla.to = function (t) { if (null == t[0] || null == t[1] || null == t[2]) return [null, null, null, t[3]]; var e, i, s = t[0] / 255, n = t[1] / 255, o = t[2] / 255, r = t[3], a = Math.max(s, n, o), h = Math.min(s, n, o), l = a - h, c = a + h, u = .5 * c; return e = h === a ? 0 : s === a ? 60 * (n - o) / l + 360 : n === a ? 60 * (o - s) / l + 120 : 60 * (s - n) / l + 240, i = 0 === l ? 0 : .5 >= u ? l / c : l / (2 - c), [Math.round(e) % 360, i, u, null == r ? 1 : r] }, l.hsla.from = function (t) { if (null == t[0] || null == t[1] || null == t[2]) return [null, null, null, t[3]]; var e = t[0] / 360, i = t[1], s = t[2], o = t[3], r = .5 >= s ? s * (1 + i) : s + i - s * i, a = 2 * s - r; return [Math.round(255 * n(a, r, e + 1 / 3)), Math.round(255 * n(a, r, e)), Math.round(255 * n(a, r, e - 1 / 3)), o] }, p(l, (function (s, n) { var o = n.props, a = n.cache, l = n.to, c = n.from; h.fn[s] = function (s) { if (l && !this[a] && (this[a] = l(this._rgba)), s === e) return this[a].slice(); var n, r = t.type(s), u = "array" === r || "object" === r ? s : arguments, d = this[a].slice(); return p(o, (function (t, e) { var s = u["object" === r ? t : e.idx]; null == s && (s = d[e.idx]), d[e.idx] = i(s, e) })), c ? ((n = h(c(d)))[a] = d, n) : h(d) }, p(o, (function (e, i) { h.fn[e] || (h.fn[e] = function (n) { var o, a = t.type(n), h = "alpha" === e ? this._hsla ? "hsla" : "rgba" : s, l = this[h](), c = l[i.idx]; return "undefined" === a ? c : ("function" === a && (n = n.call(this, c), a = t.type(n)), null == n && i.empty ? this : ("string" === a && ((o = r.exec(n)) && (n = c + parseFloat(o[2]) * ("+" === o[1] ? 1 : -1))), l[i.idx] = n, this[h](l))) }) })) })), h.hook = function (e) { var i = e.split(" "); p(i, (function (e, i) { t.cssHooks[i] = { set: function (e, n) { var o, r, a = ""; if ("transparent" !== n && ("string" !== t.type(n) || (o = s(n)))) { if (n = h(o || n), !u.rgba && 1 !== n._rgba[3]) { for (r = "backgroundColor" === i ? e.parentNode : e; ("" === a || "transparent" === a) && r && r.style;)try { a = t.css(r, "backgroundColor"), r = r.parentNode } catch (t) { } n = n.blend(a && "transparent" !== a ? a : "_default") } n = n.toRgbaString() } try { e.style[i] = n } catch (t) { } } }, t.fx.step[i] = function (e) { e.colorInit || (e.start = h(e.elem, i), e.end = h(e.end), e.colorInit = !0), t.cssHooks[i].set(e.elem, e.start.transition(e.end, e.pos)) } })) }, h.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"), t.cssHooks.borderColor = { expand: function (t) { var e = {}; return p(["Top", "Right", "Bottom", "Left"], (function (i, s) { e["border" + s + "Color"] = t })), e } }, o = t.Color.names = { aqua: "#00ffff", black: "#000000", blue: "#0000ff", fuchsia: "#ff00ff", gray: "#808080", green: "#008000", lime: "#00ff00", maroon: "#800000", navy: "#000080", olive: "#808000", purple: "#800080", red: "#ff0000", silver: "#c0c0c0", teal: "#008080", white: "#ffffff", yellow: "#ffff00", transparent: [null, null, null, 0], _default: "#ffffff" } }(p), function () { function e(e) { var i, s, n = e.ownerDocument.defaultView ? e.ownerDocument.defaultView.getComputedStyle(e, null) : e.currentStyle, o = {}; if (n && n.length && n[0] && n[n[0]]) for (s = n.length; s--;)"string" == typeof n[i = n[s]] && (o[t.camelCase(i)] = n[i]); else for (i in n) "string" == typeof n[i] && (o[i] = n[i]); return o } function i(e, i) { var s, o, r = {}; for (s in i) o = i[s], e[s] !== o && (n[s] || (t.fx.step[s] || !isNaN(parseFloat(o))) && (r[s] = o)); return r } var s = ["add", "remove", "toggle"], n = { border: 1, borderBottom: 1, borderColor: 1, borderLeft: 1, borderRight: 1, borderTop: 1, borderWidth: 1, margin: 1, padding: 1 }; t.each(["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"], (function (e, i) { t.fx.step[i] = function (t) { ("none" !== t.end && !t.setAttr || 1 === t.pos && !t.setAttr) && (p.style(t.elem, i, t.end), t.setAttr = !0) } })), t.fn.addBack || (t.fn.addBack = function (t) { return this.add(null == t ? this.prevObject : this.prevObject.filter(t)) }), t.effects.animateClass = function (n, o, r, a) { var h = t.speed(o, r, a); return this.queue((function () { var o, r = t(this), a = r.attr("class") || "", l = h.children ? r.find("*").addBack() : r; l = l.map((function () { return { el: t(this), start: e(this) } })), (o = function () { t.each(s, (function (t, e) { n[e] && r[e + "Class"](n[e]) })) })(), l = l.map((function () { return this.end = e(this.el[0]), this.diff = i(this.start, this.end), this })), r.attr("class", a), l = l.map((function () { var e = this, i = t.Deferred(), s = t.extend({}, h, { queue: !1, complete: function () { i.resolve(e) } }); return this.el.animate(this.diff, s), i.promise() })), t.when.apply(t, l.get()).done((function () { o(), t.each(arguments, (function () { var e = this.el; t.each(this.diff, (function (t) { e.css(t, "") })) })), h.complete.call(r[0]) })) })) }, t.fn.extend({ addClass: function (e) { return function (i, s, n, o) { return s ? t.effects.animateClass.call(this, { add: i }, s, n, o) : e.apply(this, arguments) } }(t.fn.addClass), removeClass: function (e) { return function (i, s, n, o) { return arguments.length > 1 ? t.effects.animateClass.call(this, { remove: i }, s, n, o) : e.apply(this, arguments) } }(t.fn.removeClass), toggleClass: function (e) { return function (i, s, n, o, r) { return "boolean" == typeof s || void 0 === s ? n ? t.effects.animateClass.call(this, s ? { add: i } : { remove: i }, n, o, r) : e.apply(this, arguments) : t.effects.animateClass.call(this, { toggle: i }, s, n, o) } }(t.fn.toggleClass), switchClass: function (e, i, s, n, o) { return t.effects.animateClass.call(this, { add: i, remove: e }, s, n, o) } }) }(), function () { function e(e, i, s, n) { return t.isPlainObject(e) && (i = e, e = e.effect), e = { effect: e }, null == i && (i = {}), t.isFunction(i) && (n = i, s = null, i = {}), ("number" == typeof i || t.fx.speeds[i]) && (n = s, s = i, i = {}), t.isFunction(s) && (n = s, s = null), i && t.extend(e, i), s = s || i.duration, e.duration = t.fx.off ? 0 : "number" == typeof s ? s : s in t.fx.speeds ? t.fx.speeds[s] : t.fx.speeds._default, e.complete = n || i.complete, e } function i(e) { return !(e && "number" != typeof e && !t.fx.speeds[e]) || ("string" == typeof e && !t.effects.effect[e] || (!!t.isFunction(e) || "object" == typeof e && !e.effect)) } function s(t, e) { var i = e.outerWidth(), s = e.outerHeight(), n = /^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(t) || ["", 0, i, s, 0]; return { top: parseFloat(n[1]) || 0, right: "auto" === n[2] ? i : parseFloat(n[2]), bottom: "auto" === n[3] ? s : parseFloat(n[3]), left: parseFloat(n[4]) || 0 } } t.expr && t.expr.filters && t.expr.filters.animated && (t.expr.filters.animated = function (e) { return function (i) { return !!t(i).data(d) || e(i) } }(t.expr.filters.animated)), !1 !== t.uiBackCompat && t.extend(t.effects, { save: function (t, e) { for (var i = 0, s = e.length; s > i; i++)null !== e[i] && t.data(c + e[i], t[0].style[e[i]]) }, restore: function (t, e) { for (var i, s = 0, n = e.length; n > s; s++)null !== e[s] && (i = t.data(c + e[s]), t.css(e[s], i)) }, setMode: function (t, e) { return "toggle" === e && (e = t.is(":hidden") ? "show" : "hide"), e }, createWrapper: function (e) { if (e.parent().is(".ui-effects-wrapper")) return e.parent(); var i = { width: e.outerWidth(!0), height: e.outerHeight(!0), float: e.css("float") }, s = t("<div></div>").addClass("ui-effects-wrapper").css({ fontSize: "100%", background: "transparent", border: "none", margin: 0, padding: 0 }), n = { width: e.width(), height: e.height() }, o = document.activeElement; try { o.id } catch (t) { o = document.body } return e.wrap(s), (e[0] === o || t.contains(e[0], o)) && t(o).trigger("focus"), s = e.parent(), "static" === e.css("position") ? (s.css({ position: "relative" }), e.css({ position: "relative" })) : (t.extend(i, { position: e.css("position"), zIndex: e.css("z-index") }), t.each(["top", "left", "bottom", "right"], (function (t, s) { i[s] = e.css(s), isNaN(parseInt(i[s], 10)) && (i[s] = "auto") })), e.css({ position: "relative", top: 0, left: 0, right: "auto", bottom: "auto" })), e.css(n), s.css(i).show() }, removeWrapper: function (e) { var i = document.activeElement; return e.parent().is(".ui-effects-wrapper") && (e.parent().replaceWith(e), (e[0] === i || t.contains(e[0], i)) && t(i).trigger("focus")), e } }), t.extend(t.effects, { version: "1.12.1", define: function (e, i, s) { return s || (s = i, i = "effect"), t.effects.effect[e] = s, t.effects.effect[e].mode = i, s }, scaledDimensions: function (t, e, i) { if (0 === e) return { height: 0, width: 0, outerHeight: 0, outerWidth: 0 }; var s = "horizontal" !== i ? (e || 100) / 100 : 1, n = "vertical" !== i ? (e || 100) / 100 : 1; return { height: t.height() * n, width: t.width() * s, outerHeight: t.outerHeight() * n, outerWidth: t.outerWidth() * s } }, clipToBox: function (t) { return { width: t.clip.right - t.clip.left, height: t.clip.bottom - t.clip.top, left: t.clip.left, top: t.clip.top } }, unshift: function (t, e, i) { var s = t.queue(); e > 1 && s.splice.apply(s, [1, 0].concat(s.splice(e, i))), t.dequeue() }, saveStyle: function (t) { t.data(u, t[0].style.cssText) }, restoreStyle: function (t) { t[0].style.cssText = t.data(u) || "", t.removeData(u) }, mode: function (t, e) { var i = t.is(":hidden"); return "toggle" === e && (e = i ? "show" : "hide"), (i ? "hide" === e : "show" === e) && (e = "none"), e }, getBaseline: function (t, e) { var i, s; switch (t[0]) { case "top": i = 0; break; case "middle": i = .5; break; case "bottom": i = 1; break; default: i = t[0] / e.height }switch (t[1]) { case "left": s = 0; break; case "center": s = .5; break; case "right": s = 1; break; default: s = t[1] / e.width }return { x: s, y: i } }, createPlaceholder: function (e) { var i, s = e.css("position"), n = e.position(); return e.css({ marginTop: e.css("marginTop"), marginBottom: e.css("marginBottom"), marginLeft: e.css("marginLeft"), marginRight: e.css("marginRight") }).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()), /^(static|relative)/.test(s) && (s = "absolute", i = t("<" + e[0].nodeName + ">").insertAfter(e).css({ display: /^(inline|ruby)/.test(e.css("display")) ? "inline-block" : "block", visibility: "hidden", marginTop: e.css("marginTop"), marginBottom: e.css("marginBottom"), marginLeft: e.css("marginLeft"), marginRight: e.css("marginRight"), float: e.css("float") }).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"), e.data(c + "placeholder", i)), e.css({ position: s, left: n.left, top: n.top }), i }, removePlaceholder: function (t) { var e = c + "placeholder", i = t.data(e); i && (i.remove(), t.removeData(e)) }, cleanUp: function (e) { t.effects.restoreStyle(e), t.effects.removePlaceholder(e) }, setTransition: function (e, i, s, n) { return n = n || {}, t.each(i, (function (t, i) { var o = e.cssUnit(i); o[0] > 0 && (n[i] = o[0] * s + o[1]) })), n } }), t.fn.extend({ effect: function () { function i(e) { function i() { t.isFunction(h) && h.call(r[0]), t.isFunction(e) && e() } var r = t(this); s.mode = c.shift(), !1 === t.uiBackCompat || o ? "none" === s.mode ? (r[l](), i()) : n.call(r[0], s, (function () { r.removeData(d), t.effects.cleanUp(r), "hide" === s.mode && r.hide(), i() })) : (r.is(":hidden") ? "hide" === l : "show" === l) ? (r[l](), i()) : n.call(r[0], s, i) } var s = e.apply(this, arguments), n = t.effects.effect[s.effect], o = n.mode, r = s.queue, a = r || "fx", h = s.complete, l = s.mode, c = [], u = function (e) { var i = t(this), s = t.effects.mode(i, l) || o; i.data(d, !0), c.push(s), o && ("show" === s || s === o && "hide" === s) && i.show(), o && "none" === s || t.effects.saveStyle(i), t.isFunction(e) && e() }; return t.fx.off || !n ? l ? this[l](s.duration, h) : this.each((function () { h && h.call(this) })) : !1 === r ? this.each(u).each(i) : this.queue(a, u).queue(a, i) }, show: function (t) { return function (s) { if (i(s)) return t.apply(this, arguments); var n = e.apply(this, arguments); return n.mode = "show", this.effect.call(this, n) } }(t.fn.show), hide: function (t) { return function (s) { if (i(s)) return t.apply(this, arguments); var n = e.apply(this, arguments); return n.mode = "hide", this.effect.call(this, n) } }(t.fn.hide), toggle: function (t) { return function (s) { if (i(s) || "boolean" == typeof s) return t.apply(this, arguments); var n = e.apply(this, arguments); return n.mode = "toggle", this.effect.call(this, n) } }(t.fn.toggle), cssUnit: function (e) { var i = this.css(e), s = []; return t.each(["em", "px", "%", "pt"], (function (t, e) { i.indexOf(e) > 0 && (s = [parseFloat(i), e]) })), s }, cssClip: function (t) { return t ? this.css("clip", "rect(" + t.top + "px " + t.right + "px " + t.bottom + "px " + t.left + "px)") : s(this.css("clip"), this) }, transfer: function (e, i) { var s = t(this), n = t(e.to), o = "fixed" === n.css("position"), r = t("body"), a = o ? r.scrollTop() : 0, h = o ? r.scrollLeft() : 0, l = n.offset(), c = { top: l.top - a, left: l.left - h, height: n.innerHeight(), width: n.innerWidth() }, u = s.offset(), d = t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({ top: u.top - a, left: u.left - h, height: s.innerHeight(), width: s.innerWidth(), position: o ? "fixed" : "absolute" }).animate(c, e.duration, e.easing, (function () { d.remove(), t.isFunction(i) && i() })) } }), t.fx.step.clip = function (e) { e.clipInit || (e.start = t(e.elem).cssClip(), "string" == typeof e.end && (e.end = s(e.end, e.elem)), e.clipInit = !0), t(e.elem).cssClip({ top: e.pos * (e.end.top - e.start.top) + e.start.top, right: e.pos * (e.end.right - e.start.right) + e.start.right, bottom: e.pos * (e.end.bottom - e.start.bottom) + e.start.bottom, left: e.pos * (e.end.left - e.start.left) + e.start.left }) } }(), function () { var e = {}; t.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], (function (t, i) { e[i] = function (e) { return Math.pow(e, t + 2) } })), t.extend(e, { Sine: function (t) { return 1 - Math.cos(t * Math.PI / 2) }, Circ: function (t) { return 1 - Math.sqrt(1 - t * t) }, Elastic: function (t) { return 0 === t || 1 === t ? t : -Math.pow(2, 8 * (t - 1)) * Math.sin((80 * (t - 1) - 7.5) * Math.PI / 15) }, Back: function (t) { return t * t * (3 * t - 2) }, Bounce: function (t) { for (var e, i = 4; ((e = Math.pow(2, --i)) - 1) / 11 > t;); return 1 / Math.pow(4, 3 - i) - 7.5625 * Math.pow((3 * e - 2) / 22 - t, 2) } }), t.each(e, (function (e, i) { t.easing["easeIn" + e] = i, t.easing["easeOut" + e] = function (t) { return 1 - i(1 - t) }, t.easing["easeInOut" + e] = function (t) { return .5 > t ? i(2 * t) / 2 : 1 - i(-2 * t + 2) / 2 } })) }(), t.effects, t.effects.define("shake", (function (e, i) { var s = 1, n = t(this), o = e.direction || "left", r = e.distance || 20, a = e.times || 3, h = 2 * a + 1, l = Math.round(e.duration / h), c = "up" === o || "down" === o ? "top" : "left", u = "up" === o || "left" === o, d = {}, p = {}, f = {}, g = n.queue().length; for (t.effects.createPlaceholder(n), d[c] = (u ? "-=" : "+=") + r, p[c] = (u ? "+=" : "-=") + 2 * r, f[c] = (u ? "-=" : "+=") + 2 * r, n.animate(d, l, e.easing); a > s; s++)n.animate(p, l, e.easing).animate(f, l, e.easing); n.animate(p, l, e.easing).animate(d, l / 2, e.easing).queue(i), t.effects.unshift(n, g, h + 1) })) }));
/*!
 * jQuery UI Touch Punch 1.0.8 as modified by RWAP Software
 * based on original touchpunch v0.2.3 which has not been updated since 2014
 *
 * Updates by RWAP Software to take account of various suggested changes on the original code issues
 *
 * Original: https://github.com/furf/jquery-ui-touch-punch
 * Copyright 2011â€“2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Fork: https://github.com/RWAP/jquery-ui-touch-punch
 *
 * Depends:
 * jquery.ui.widget.js
 * jquery.ui.mouse.js
 */
!function (t) { "function" == typeof define && define.amd ? define(["jquery", "jquery.ui"], t) : t(jQuery) }((function (t) { if (t.support.mspointer = window.navigator.msPointerEnabled, t.support.touch = "ontouchstart" in document || "ontouchstart" in window || window.TouchEvent || window.DocumentTouch && document instanceof DocumentTouch || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0, (t.support.touch || t.support.mspointer) && t.ui.mouse) { var o, e = t.ui.mouse.prototype, n = e._mouseInit, u = e._mouseDestroy; e._touchStart = function (t) { this._startedMove = t.timeStamp, this._startPos = i(t), !o && this._mouseCapture(t.originalEvent.changedTouches[0]) && (o = !0, this._touchMoved = !1, s(t, "mouseover"), s(t, "mousemove"), s(t, "mousedown")) }, e._touchMove = function (t) { o && (this._touchMoved = !0, s(t, "mousemove")) }, e._touchEnd = function (t) { if (o) { s(t, "mouseup"), s(t, "mouseout"); var e = t.timeStamp - this._startedMove; if (!this._touchMoved || e < 500) s(t, "click"); else { var n = i(t); Math.abs(n.x - this._startPos.x) < 10 && Math.abs(n.y - this._startPos.y) < 10 && (this._touchMoved && "stylus" !== t.originalEvent.changedTouches[0].touchType || s(t, "click")) } this._touchMoved = !1, o = !1 } }, e._mouseInit = function () { t.support.mspointer && (this.element[0].style.msTouchAction = "none"), this.element.on({ touchstart: t.proxy(this, "_touchStart"), touchmove: t.proxy(this, "_touchMove"), touchend: t.proxy(this, "_touchEnd") }), n.call(this) }, e._mouseDestroy = function () { this.element.off({ touchstart: t.proxy(this, "_touchStart"), touchmove: t.proxy(this, "_touchMove"), touchend: t.proxy(this, "_touchEnd") }), u.call(this) } } function i(t) { return { x: t.originalEvent.changedTouches[0].pageX, y: t.originalEvent.changedTouches[0].pageY } } function s(t, o) { if (!(t.originalEvent.touches.length > 1)) { t.cancelable && t.preventDefault(); var e = t.originalEvent.changedTouches[0], n = document.createEvent("MouseEvents"); n.initMouseEvent(o, !0, !0, window, 1, e.screenX, e.screenY, e.clientX, e.clientY, !1, !1, !1, !1, 0, null), t.target.dispatchEvent(n) } } }));
!function (t) { t.fn.pTooltip = function (i) { var o = { tipCloseDelay: 500, findToolTip: function (i) { return t("#" + i.attr("title")) }, tipPosition: function (t) { return { my: "left center", at: "right+15 center", of: t, collision: "fit flip" } } }; return t.extend(o, i), this.each((function () { var i = t(this), e = o.findToolTip(i); if (0 === e.length) throw "No element with ID " + i.attr("title"); i.removeAttr("title"), i.mouseover((function () { t(":visible:data(pTooltip)").hide(); var n = t.extend(e.data("pTooltip"), { mouseEntered: !1, uid: 0 }); e.data("pTooltip", n), e.show().position(o.tipPosition(i)) })), i.mouseleave((function () { var i = t.now(), n = t.extend(e.data("pTooltip"), { uid: i }); e.data("pTooltip", n), setTimeout((function () { !function (t, i) { var o = t.data("pTooltip"); i !== o.uid || o.mouseEntered || t.hide() }(e, i) }), o.tipCloseDelay) })), e.mouseover((function () { var i = t.extend(e.data("pTooltip"), { mouseEntered: !0 }); e.data("pTooltip", i) })), e.mouseleave((function () { e.hide() })), e.hide().addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content") })) } }(jQuery);
/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 */
!function (e) { "function" == typeof define && define.amd ? define(["jquery"], e) : "object" == typeof exports ? module.exports = e : e(jQuery) }((function (e) { var t, i, n = ["wheel", "mousewheel", "DOMMouseScroll", "MozMousePixelScroll"], o = "onwheel" in document || document.documentMode >= 9 ? ["wheel"] : ["mousewheel", "DomMouseScroll", "MozMousePixelScroll"], l = Array.prototype.slice; if (e.event.fixHooks) for (var s = n.length; s;)e.event.fixHooks[n[--s]] = e.event.mouseHooks; var a = e.event.special.mousewheel = { version: "3.1.12", setup: function () { if (this.addEventListener) for (var t = o.length; t;)this.addEventListener(o[--t], h, !1); else this.onmousewheel = h; e.data(this, "mousewheel-line-height", a.getLineHeight(this)), e.data(this, "mousewheel-page-height", a.getPageHeight(this)) }, teardown: function () { if (this.removeEventListener) for (var t = o.length; t;)this.removeEventListener(o[--t], h, !1); else this.onmousewheel = null; e.removeData(this, "mousewheel-line-height"), e.removeData(this, "mousewheel-page-height") }, getLineHeight: function (t) { var i = e(t), n = i["offsetParent" in e.fn ? "offsetParent" : "parent"](); return n.length || (n = e("body")), parseInt(n.css("fontSize"), 10) || parseInt(i.css("fontSize"), 10) || 16 }, getPageHeight: function (t) { return e(t).height() }, settings: { adjustOldDeltas: !0, normalizeOffset: !0 } }; function h(n) { var o = n || window.event, s = l.call(arguments, 1), h = 0, f = 0, d = 0, c = 0, m = 0, g = 0; if ((n = e.event.fix(o)).type = "mousewheel", "detail" in o && (d = -1 * o.detail), "wheelDelta" in o && (d = o.wheelDelta), "wheelDeltaY" in o && (d = o.wheelDeltaY), "wheelDeltaX" in o && (f = -1 * o.wheelDeltaX), "axis" in o && o.axis === o.HORIZONTAL_AXIS && (f = -1 * d, d = 0), h = 0 === d ? f : d, "deltaY" in o && (h = d = -1 * o.deltaY), "deltaX" in o && (f = o.deltaX, 0 === d && (h = -1 * f)), 0 !== d || 0 !== f) { if (1 === o.deltaMode) { var w = e.data(this, "mousewheel-line-height"); h *= w, d *= w, f *= w } else if (2 === o.deltaMode) { var v = e.data(this, "mousewheel-page-height"); h *= v, d *= v, f *= v } if (c = Math.max(Math.abs(d), Math.abs(f)), (!i || c < i) && (i = c, u(o, c) && (i /= 40)), u(o, c) && (h /= 40, f /= 40, d /= 40), h = Math[h >= 1 ? "floor" : "ceil"](h / i), f = Math[f >= 1 ? "floor" : "ceil"](f / i), d = Math[d >= 1 ? "floor" : "ceil"](d / i), a.settings.normalizeOffset && this.getBoundingClientRect) { var p = this.getBoundingClientRect(); m = n.clientX - p.left, g = n.clientY - p.top } return n.deltaX = f, n.deltaY = d, n.deltaFactor = i, n.offsetX = m, n.offsetY = g, n.deltaMode = 0, s.unshift(n, h, f, d), t && clearTimeout(t), t = setTimeout(r, 200), (e.event.dispatch || e.event.handle).apply(this, s) } } function r() { i = null } function u(e, t) { return a.settings.adjustOldDeltas && "mousewheel" === e.type && t % 120 == 0 } e.fn.extend({ mousewheel: function (e) { return e ? this.bind("mousewheel", e) : this.trigger("mousewheel") }, unmousewheel: function (e) { return this.unbind("mousewheel", e) } }) }));
!function (e) { var t = Array.isArray ? Array.isArray : function (e) { return "[object Array]" === Object.prototype.toString.call(e) }; function s() { this._events = {}, this._conf && i.call(this, this._conf) } function i(e) { e ? (this._conf = e, e.delimiter && (this.delimiter = e.delimiter), this._events.maxListeners = void 0 !== e.maxListeners ? e.maxListeners : 10, e.wildcard && (this.wildcard = e.wildcard), e.newListener && (this.newListener = e.newListener), e.verboseMemoryLeak && (this.verboseMemoryLeak = e.verboseMemoryLeak), this.wildcard && (this.listenerTree = {})) : this._events.maxListeners = 10 } function n(e, t) { var s = "(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit."; this.verboseMemoryLeak ? (s += " Event name: %s.", console.error(s, e, t)) : console.error(s, e), console.trace && console.trace() } function r(e) { this._events = {}, this.newListener = !1, this.verboseMemoryLeak = !1, i.call(this, e) } function l(e, t, s, i) { if (!s) return []; var n, r, h, o, a, c, f, p = [], u = t.length, _ = t[i], v = t[i + 1]; if (i === u && s._listeners) { if ("function" == typeof s._listeners) return e && e.push(s._listeners), [s]; for (n = 0, r = s._listeners.length; n < r; n++)e && e.push(s._listeners[n]); return [s] } if ("*" === _ || "**" === _ || s[_]) { if ("*" === _) { for (h in s) "_listeners" !== h && s.hasOwnProperty(h) && (p = p.concat(l(e, t, s[h], i + 1))); return p } if ("**" === _) { for (h in (f = i + 1 === u || i + 2 === u && "*" === v) && s._listeners && (p = p.concat(l(e, t, s, u))), s) "_listeners" !== h && s.hasOwnProperty(h) && ("*" === h || "**" === h ? (s[h]._listeners && !f && (p = p.concat(l(e, t, s[h], u))), p = p.concat(l(e, t, s[h], i))) : p = h === v ? p.concat(l(e, t, s[h], i + 2)) : p.concat(l(e, t, s[h], i))); return p } p = p.concat(l(e, t, s[_], i + 1)) } if ((o = s["*"]) && l(e, t, o, i + 1), a = s["**"]) if (i < u) for (h in a._listeners && l(e, t, a, u), a) "_listeners" !== h && a.hasOwnProperty(h) && (h === v ? l(e, t, a[h], i + 2) : h === _ ? l(e, t, a[h], i + 1) : ((c = {})[h] = a[h], l(e, t, { "**": c }, i + 1))); else a._listeners ? l(e, t, a, u) : a["*"] && a["*"]._listeners && l(e, t, a["*"], u); return p } function h(e, t) { for (var s = 0, i = (e = "string" == typeof e ? e.split(this.delimiter) : e.slice()).length; s + 1 < i; s++)if ("**" === e[s] && "**" === e[s + 1]) return; for (var r = this.listenerTree, l = e.shift(); void 0 !== l;) { if (r[l] || (r[l] = {}), r = r[l], 0 === e.length) return r._listeners ? ("function" == typeof r._listeners && (r._listeners = [r._listeners]), r._listeners.push(t), !r._listeners.warned && this._events.maxListeners > 0 && r._listeners.length > this._events.maxListeners && (r._listeners.warned = !0, n.call(this, r._listeners.length, l))) : r._listeners = t, !0; l = e.shift() } return !0 } r.EventEmitter2 = r, r.prototype.delimiter = ".", r.prototype.setMaxListeners = function (e) { void 0 !== e && (this._events || s.call(this), this._events.maxListeners = e, this._conf || (this._conf = {}), this._conf.maxListeners = e) }, r.prototype.event = "", r.prototype.once = function (e, t) { return this.many(e, 1, t), this }, r.prototype.many = function (e, t, s) { var i = this; if ("function" != typeof s) throw new Error("many only accepts instances of Function"); function n() { 0 == --t && i.off(e, n), s.apply(this, arguments) } return n._origin = s, this.on(e, n), i }, r.prototype.emit = function () { this._events || s.call(this); var e = arguments[0]; if ("newListener" === e && !this.newListener && !this._events.newListener) return !1; var t, i, n, r, h, o = arguments.length; if (this._all && this._all.length) { if (h = this._all.slice(), o > 3) for (t = new Array(o), r = 0; r < o; r++)t[r] = arguments[r]; for (n = 0, i = h.length; n < i; n++)switch (this.event = e, o) { case 1: h[n].call(this, e); break; case 2: h[n].call(this, e, arguments[1]); break; case 3: h[n].call(this, e, arguments[1], arguments[2]); break; default: h[n].apply(this, t) } } if (this.wildcard) { h = []; var a = "string" == typeof e ? e.split(this.delimiter) : e.slice(); l.call(this, h, a, this.listenerTree, 0) } else { if ("function" == typeof (h = this._events[e])) { switch (this.event = e, o) { case 1: h.call(this); break; case 2: h.call(this, arguments[1]); break; case 3: h.call(this, arguments[1], arguments[2]); break; default: for (t = new Array(o - 1), r = 1; r < o; r++)t[r - 1] = arguments[r]; h.apply(this, t) }return !0 } h && (h = h.slice()) } if (h && h.length) { if (o > 3) for (t = new Array(o - 1), r = 1; r < o; r++)t[r - 1] = arguments[r]; for (n = 0, i = h.length; n < i; n++)switch (this.event = e, o) { case 1: h[n].call(this); break; case 2: h[n].call(this, arguments[1]); break; case 3: h[n].call(this, arguments[1], arguments[2]); break; default: h[n].apply(this, t) }return !0 } if (!this._all && "error" === e) throw arguments[1] instanceof Error ? arguments[1] : new Error("Uncaught, unspecified 'error' event."); return !!this._all }, r.prototype.emitAsync = function () { this._events || s.call(this); var e = arguments[0]; if ("newListener" === e && !this.newListener && !this._events.newListener) return Promise.resolve([!1]); var t, i, n, r, h, o = [], a = arguments.length; if (this._all) { if (a > 3) for (t = new Array(a), r = 1; r < a; r++)t[r] = arguments[r]; for (n = 0, i = this._all.length; n < i; n++)switch (this.event = e, a) { case 1: o.push(this._all[n].call(this, e)); break; case 2: o.push(this._all[n].call(this, e, arguments[1])); break; case 3: o.push(this._all[n].call(this, e, arguments[1], arguments[2])); break; default: o.push(this._all[n].apply(this, t)) } } if (this.wildcard) { h = []; var c = "string" == typeof e ? e.split(this.delimiter) : e.slice(); l.call(this, h, c, this.listenerTree, 0) } else h = this._events[e]; if ("function" == typeof h) switch (this.event = e, a) { case 1: o.push(h.call(this)); break; case 2: o.push(h.call(this, arguments[1])); break; case 3: o.push(h.call(this, arguments[1], arguments[2])); break; default: for (t = new Array(a - 1), r = 1; r < a; r++)t[r - 1] = arguments[r]; o.push(h.apply(this, t)) } else if (h && h.length) { if (a > 3) for (t = new Array(a - 1), r = 1; r < a; r++)t[r - 1] = arguments[r]; for (n = 0, i = h.length; n < i; n++)switch (this.event = e, a) { case 1: o.push(h[n].call(this)); break; case 2: o.push(h[n].call(this, arguments[1])); break; case 3: o.push(h[n].call(this, arguments[1], arguments[2])); break; default: o.push(h[n].apply(this, t)) } } else if (!this._all && "error" === e) return arguments[1] instanceof Error ? Promise.reject(arguments[1]) : Promise.reject("Uncaught, unspecified 'error' event."); return Promise.all(o) }, r.prototype.on = function (e, t) { if ("function" == typeof e) return this.onAny(e), this; if ("function" != typeof t) throw new Error("on only accepts instances of Function"); return this._events || s.call(this), this.emit("newListener", e, t), this.wildcard ? (h.call(this, e, t), this) : (this._events[e] ? ("function" == typeof this._events[e] && (this._events[e] = [this._events[e]]), this._events[e].push(t), !this._events[e].warned && this._events.maxListeners > 0 && this._events[e].length > this._events.maxListeners && (this._events[e].warned = !0, n.call(this, this._events[e].length, e))) : this._events[e] = t, this) }, r.prototype.onAny = function (e) { if ("function" != typeof e) throw new Error("onAny only accepts instances of Function"); return this._all || (this._all = []), this._all.push(e), this }, r.prototype.addListener = r.prototype.on, r.prototype.off = function (e, s) { if ("function" != typeof s) throw new Error("removeListener only takes instances of Function"); var i, n = []; if (this.wildcard) { var r = "string" == typeof e ? e.split(this.delimiter) : e.slice(); n = l.call(this, null, r, this.listenerTree, 0) } else { if (!this._events[e]) return this; i = this._events[e], n.push({ _listeners: i }) } for (var h = 0; h < n.length; h++) { var o = n[h]; if (i = o._listeners, t(i)) { for (var a = -1, c = 0, f = i.length; c < f; c++)if (i[c] === s || i[c].listener && i[c].listener === s || i[c]._origin && i[c]._origin === s) { a = c; break } if (a < 0) continue; return this.wildcard ? o._listeners.splice(a, 1) : this._events[e].splice(a, 1), 0 === i.length && (this.wildcard ? delete o._listeners : delete this._events[e]), this.emit("removeListener", e, s), this } (i === s || i.listener && i.listener === s || i._origin && i._origin === s) && (this.wildcard ? delete o._listeners : delete this._events[e], this.emit("removeListener", e, s)) } return function e(t) { if (void 0 !== t) { var s = Object.keys(t); for (var i in s) { var n = s[i], r = t[n]; r instanceof Function || "object" != typeof r || null === r || (Object.keys(r).length > 0 && e(t[n]), 0 === Object.keys(r).length && delete t[n]) } } }(this.listenerTree), this }, r.prototype.offAny = function (e) { var t, s = 0, i = 0; if (e && this._all && this._all.length > 0) { for (s = 0, i = (t = this._all).length; s < i; s++)if (e === t[s]) return t.splice(s, 1), this.emit("removeListenerAny", e), this } else { for (s = 0, i = (t = this._all).length; s < i; s++)this.emit("removeListenerAny", t[s]); this._all = [] } return this }, r.prototype.removeListener = r.prototype.off, r.prototype.removeAllListeners = function (e) { if (0 === arguments.length) return !this._events || s.call(this), this; if (this.wildcard) for (var t = "string" == typeof e ? e.split(this.delimiter) : e.slice(), i = l.call(this, null, t, this.listenerTree, 0), n = 0; n < i.length; n++) { var r = i[n]; r._listeners = null } else this._events && (this._events[e] = null); return this }, r.prototype.listeners = function (e) { if (this.wildcard) { var i = [], n = "string" == typeof e ? e.split(this.delimiter) : e.slice(); return l.call(this, i, n, this.listenerTree, 0), i } return this._events || s.call(this), this._events[e] || (this._events[e] = []), t(this._events[e]) || (this._events[e] = [this._events[e]]), this._events[e] }, r.prototype.listenerCount = function (e) { return this.listeners(e).length }, r.prototype.listenersAny = function () { return this._all ? this._all : [] }, "function" == typeof define && define.amd ? define((function () { return r })) : "object" == typeof exports ? module.exports = r : window.EventEmitter2 = r }();
!function e(t, i, s) { function n(o, a) { if (!i[o]) { if (!t[o]) { var c = "function" == typeof require && require; if (!a && c) return c(o, !0); if (r) return r(o, !0); var l = new Error("Cannot find module '" + o + "'"); throw l.code = "MODULE_NOT_FOUND", l } var h = i[o] = { exports: {} }; t[o][0].call(h.exports, (function (e) { var i = t[o][1][e]; return n(i || e) }), h, h.exports, e, t, i, s) } return i[o].exports } for (var r = "function" == typeof require && require, o = 0; o < s.length; o++)n(s[o]); return n }({ 1: [function (e, t, i) { !function (e) { function s() { this._events = {}, this._conf && n.call(this, this._conf) } function n(t) { t ? (this._conf = t, t.delimiter && (this.delimiter = t.delimiter), this._events.maxListeners = t.maxListeners !== e ? t.maxListeners : h, t.wildcard && (this.wildcard = t.wildcard), t.newListener && (this.newListener = t.newListener), t.verboseMemoryLeak && (this.verboseMemoryLeak = t.verboseMemoryLeak), this.wildcard && (this.listenerTree = {})) : this._events.maxListeners = h } function r(e, t) { var i = "(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit."; this.verboseMemoryLeak ? (i += " Event name: %s.", console.error(i, e, t)) : console.error(i, e), console.trace && console.trace() } function o(e) { this._events = {}, this.newListener = !1, this.verboseMemoryLeak = !1, n.call(this, e) } function a(e, t, i, s) { if (!i) return []; var n, r, o, c, l, h, u, p = [], f = t.length, m = t[s], v = t[s + 1]; if (s === f && i._listeners) { if ("function" == typeof i._listeners) return e && e.push(i._listeners), [i]; for (n = 0, r = i._listeners.length; n < r; n++)e && e.push(i._listeners[n]); return [i] } if ("*" === m || "**" === m || i[m]) { if ("*" === m) { for (o in i) "_listeners" !== o && i.hasOwnProperty(o) && (p = p.concat(a(e, t, i[o], s + 1))); return p } if ("**" === m) { for (o in (u = s + 1 === f || s + 2 === f && "*" === v) && i._listeners && (p = p.concat(a(e, t, i, f))), i) "_listeners" !== o && i.hasOwnProperty(o) && ("*" === o || "**" === o ? (i[o]._listeners && !u && (p = p.concat(a(e, t, i[o], f))), p = p.concat(a(e, t, i[o], s))) : p = o === v ? p.concat(a(e, t, i[o], s + 2)) : p.concat(a(e, t, i[o], s))); return p } p = p.concat(a(e, t, i[m], s + 1)) } if ((c = i["*"]) && a(e, t, c, s + 1), l = i["**"]) if (s < f) for (o in l._listeners && a(e, t, l, f), l) "_listeners" !== o && l.hasOwnProperty(o) && (o === v ? a(e, t, l[o], s + 2) : o === m ? a(e, t, l[o], s + 1) : ((h = {})[o] = l[o], a(e, t, { "**": h }, s + 1))); else l._listeners ? a(e, t, l, f) : l["*"] && l["*"]._listeners && a(e, t, l["*"], f); return p } function c(t, i) { for (var s = 0, n = (t = "string" == typeof t ? t.split(this.delimiter) : t.slice()).length; s + 1 < n; s++)if ("**" === t[s] && "**" === t[s + 1]) return; for (var o = this.listenerTree, a = t.shift(); a !== e;) { if (o[a] || (o[a] = {}), o = o[a], 0 === t.length) return o._listeners ? ("function" == typeof o._listeners && (o._listeners = [o._listeners]), o._listeners.push(i), !o._listeners.warned && this._events.maxListeners > 0 && o._listeners.length > this._events.maxListeners && (o._listeners.warned = !0, r.call(this, o._listeners.length, a))) : o._listeners = i, !0; a = t.shift() } return !0 } var l = Array.isArray ? Array.isArray : function (e) { return "[object Array]" === Object.prototype.toString.call(e) }, h = 10; o.EventEmitter2 = o, o.prototype.delimiter = ".", o.prototype.setMaxListeners = function (t) { t !== e && (this._events || s.call(this), this._events.maxListeners = t, this._conf || (this._conf = {}), this._conf.maxListeners = t) }, o.prototype.event = "", o.prototype.once = function (e, t) { return this.many(e, 1, t), this }, o.prototype.many = function (e, t, i) { function s() { 0 == --t && n.off(e, s), i.apply(this, arguments) } var n = this; if ("function" != typeof i) throw new Error("many only accepts instances of Function"); return s._origin = i, this.on(e, s), n }, o.prototype.emit = function () { this._events || s.call(this); var e = arguments[0]; if ("newListener" === e && !this.newListener && !this._events.newListener) return !1; var t, i, n, r, o, c = arguments.length; if (this._all && this._all.length) { if (o = this._all.slice(), c > 3) for (t = new Array(c), r = 0; r < c; r++)t[r] = arguments[r]; for (n = 0, i = o.length; n < i; n++)switch (this.event = e, c) { case 1: o[n].call(this, e); break; case 2: o[n].call(this, e, arguments[1]); break; case 3: o[n].call(this, e, arguments[1], arguments[2]); break; default: o[n].apply(this, t) } } if (this.wildcard) { o = []; var l = "string" == typeof e ? e.split(this.delimiter) : e.slice(); a.call(this, o, l, this.listenerTree, 0) } else { if ("function" == typeof (o = this._events[e])) { switch (this.event = e, c) { case 1: o.call(this); break; case 2: o.call(this, arguments[1]); break; case 3: o.call(this, arguments[1], arguments[2]); break; default: for (t = new Array(c - 1), r = 1; r < c; r++)t[r - 1] = arguments[r]; o.apply(this, t) }return !0 } o && (o = o.slice()) } if (o && o.length) { if (c > 3) for (t = new Array(c - 1), r = 1; r < c; r++)t[r - 1] = arguments[r]; for (n = 0, i = o.length; n < i; n++)switch (this.event = e, c) { case 1: o[n].call(this); break; case 2: o[n].call(this, arguments[1]); break; case 3: o[n].call(this, arguments[1], arguments[2]); break; default: o[n].apply(this, t) }return !0 } if (!this._all && "error" === e) throw arguments[1] instanceof Error ? arguments[1] : new Error("Uncaught, unspecified 'error' event."); return !!this._all }, o.prototype.emitAsync = function () { this._events || s.call(this); var e = arguments[0]; if ("newListener" === e && !this.newListener && !this._events.newListener) return Promise.resolve([!1]); var t, i, n, r, o, c = [], l = arguments.length; if (this._all) { if (l > 3) for (t = new Array(l), r = 1; r < l; r++)t[r] = arguments[r]; for (n = 0, i = this._all.length; n < i; n++)switch (this.event = e, l) { case 1: c.push(this._all[n].call(this, e)); break; case 2: c.push(this._all[n].call(this, e, arguments[1])); break; case 3: c.push(this._all[n].call(this, e, arguments[1], arguments[2])); break; default: c.push(this._all[n].apply(this, t)) } } if (this.wildcard) { o = []; var h = "string" == typeof e ? e.split(this.delimiter) : e.slice(); a.call(this, o, h, this.listenerTree, 0) } else o = this._events[e]; if ("function" == typeof o) switch (this.event = e, l) { case 1: c.push(o.call(this)); break; case 2: c.push(o.call(this, arguments[1])); break; case 3: c.push(o.call(this, arguments[1], arguments[2])); break; default: for (t = new Array(l - 1), r = 1; r < l; r++)t[r - 1] = arguments[r]; c.push(o.apply(this, t)) } else if (o && o.length) { if (l > 3) for (t = new Array(l - 1), r = 1; r < l; r++)t[r - 1] = arguments[r]; for (n = 0, i = o.length; n < i; n++)switch (this.event = e, l) { case 1: c.push(o[n].call(this)); break; case 2: c.push(o[n].call(this, arguments[1])); break; case 3: c.push(o[n].call(this, arguments[1], arguments[2])); break; default: c.push(o[n].apply(this, t)) } } else if (!this._all && "error" === e) return arguments[1] instanceof Error ? Promise.reject(arguments[1]) : Promise.reject("Uncaught, unspecified 'error' event."); return Promise.all(c) }, o.prototype.on = function (e, t) { if ("function" == typeof e) return this.onAny(e), this; if ("function" != typeof t) throw new Error("on only accepts instances of Function"); return this._events || s.call(this), this.emit("newListener", e, t), this.wildcard ? (c.call(this, e, t), this) : (this._events[e] ? ("function" == typeof this._events[e] && (this._events[e] = [this._events[e]]), this._events[e].push(t), !this._events[e].warned && this._events.maxListeners > 0 && this._events[e].length > this._events.maxListeners && (this._events[e].warned = !0, r.call(this, this._events[e].length, e))) : this._events[e] = t, this) }, o.prototype.onAny = function (e) { if ("function" != typeof e) throw new Error("onAny only accepts instances of Function"); return this._all || (this._all = []), this._all.push(e), this }, o.prototype.addListener = o.prototype.on, o.prototype.off = function (t, i) { if ("function" != typeof i) throw new Error("removeListener only takes instances of Function"); var s, n = []; if (this.wildcard) { var r = "string" == typeof t ? t.split(this.delimiter) : t.slice(); n = a.call(this, null, r, this.listenerTree, 0) } else { if (!this._events[t]) return this; s = this._events[t], n.push({ _listeners: s }) } for (var o = 0; o < n.length; o++) { var c = n[o]; if (s = c._listeners, l(s)) { for (var h = -1, u = 0, p = s.length; u < p; u++)if (s[u] === i || s[u].listener && s[u].listener === i || s[u]._origin && s[u]._origin === i) { h = u; break } if (h < 0) continue; return this.wildcard ? c._listeners.splice(h, 1) : this._events[t].splice(h, 1), 0 === s.length && (this.wildcard ? delete c._listeners : delete this._events[t]), this.emit("removeListener", t, i), this } (s === i || s.listener && s.listener === i || s._origin && s._origin === i) && (this.wildcard ? delete c._listeners : delete this._events[t], this.emit("removeListener", t, i)) } return function t(i) { if (i !== e) { var s = Object.keys(i); for (var n in s) { var r = s[n], o = i[r]; o instanceof Function || "object" != typeof o || null === o || (Object.keys(o).length > 0 && t(i[r]), 0 === Object.keys(o).length && delete i[r]) } } }(this.listenerTree), this }, o.prototype.offAny = function (e) { var t, i = 0, s = 0; if (e && this._all && this._all.length > 0) { for (i = 0, s = (t = this._all).length; i < s; i++)if (e === t[i]) return t.splice(i, 1), this.emit("removeListenerAny", e), this } else { for (i = 0, s = (t = this._all).length; i < s; i++)this.emit("removeListenerAny", t[i]); this._all = [] } return this }, o.prototype.removeListener = o.prototype.off, o.prototype.removeAllListeners = function (e) { if (0 === arguments.length) return !this._events || s.call(this), this; if (this.wildcard) for (var t = "string" == typeof e ? e.split(this.delimiter) : e.slice(), i = a.call(this, null, t, this.listenerTree, 0), n = 0; n < i.length; n++) { var r = i[n]; r._listeners = null } else this._events && (this._events[e] = null); return this }, o.prototype.listeners = function (e) { if (this.wildcard) { var t = [], i = "string" == typeof e ? e.split(this.delimiter) : e.slice(); return a.call(this, t, i, this.listenerTree, 0), t } return this._events || s.call(this), this._events[e] || (this._events[e] = []), l(this._events[e]) || (this._events[e] = [this._events[e]]), this._events[e] }, o.prototype.listenerCount = function (e) { return this.listeners(e).length }, o.prototype.listenersAny = function () { return this._all ? this._all : [] }, "function" == typeof define && define.amd ? define((function () { return o })) : "object" == typeof i ? t.exports = o : window.EventEmitter2 = o }() }, {}], 2: [function (e, t, i) { "use strict"; function s(e) { if (null == e) throw new TypeError("Object.assign cannot be called with null or undefined"); return Object(e) } var n = Object.getOwnPropertySymbols, r = Object.prototype.hasOwnProperty, o = Object.prototype.propertyIsEnumerable; t.exports = function () { try { if (!Object.assign) return !1; var e = new String("abc"); if (e[5] = "de", "5" === Object.getOwnPropertyNames(e)[0]) return !1; for (var t = {}, i = 0; i < 10; i++)t["_" + String.fromCharCode(i)] = i; if ("0123456789" !== Object.getOwnPropertyNames(t).map((function (e) { return t[e] })).join("")) return !1; var s = {}; return "abcdefghijklmnopqrst".split("").forEach((function (e) { s[e] = e })), "abcdefghijklmnopqrst" === Object.keys(Object.assign({}, s)).join("") } catch (e) { return !1 } }() ? Object.assign : function (e, t) { for (var i, a, c = s(e), l = 1; l < arguments.length; l++) { for (var h in i = Object(arguments[l])) r.call(i, h) && (c[h] = i[h]); if (n) { a = n(i); for (var u = 0; u < a.length; u++)o.call(i, a[u]) && (c[a[u]] = i[a[u]]) } } return c } }, {}], 3: [function (e, t, i) { var s = this.ROSLIB || { REVISION: "0.19.0-SNAPSHOT" }, n = e("object-assign"); n(s, e("./core")), n(s, e("./actionlib")), n(s, e("./math")), n(s, e("./tf")), n(s, e("./urdf")), t.exports = s }, { "./actionlib": 9, "./core": 18, "./math": 23, "./tf": 26, "./urdf": 38, "object-assign": 2 }], 4: [function (e, t, i) { (function (t) { t.ROSLIB = e("./RosLib") }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { "./RosLib": 3 }], 5: [function (e, t, i) { function s(e) { var t = this; e = e || {}, this.ros = e.ros, this.serverName = e.serverName, this.actionName = e.actionName, this.timeout = e.timeout, this.omitFeedback = e.omitFeedback, this.omitStatus = e.omitStatus, this.omitResult = e.omitResult, this.goals = {}; var i = !1, s = new n({ ros: this.ros, name: this.serverName + "/feedback", messageType: this.actionName + "Feedback" }), r = new n({ ros: this.ros, name: this.serverName + "/status", messageType: "actionlib_msgs/GoalStatusArray" }), o = new n({ ros: this.ros, name: this.serverName + "/result", messageType: this.actionName + "Result" }); this.goalTopic = new n({ ros: this.ros, name: this.serverName + "/goal", messageType: this.actionName + "Goal" }), this.cancelTopic = new n({ ros: this.ros, name: this.serverName + "/cancel", messageType: "actionlib_msgs/GoalID" }), this.goalTopic.advertise(), this.cancelTopic.advertise(), this.omitStatus || r.subscribe((function (e) { i = !0, e.status_list.forEach((function (e) { var i = t.goals[e.goal_id.id]; i && i.emit("status", e) })) })), this.omitFeedback || s.subscribe((function (e) { var i = t.goals[e.status.goal_id.id]; i && (i.emit("status", e.status), i.emit("feedback", e.feedback)) })), this.omitResult || o.subscribe((function (e) { var i = t.goals[e.status.goal_id.id]; i && (i.emit("status", e.status), i.emit("result", e.result)) })), this.timeout && setTimeout((function () { i || t.emit("timeout") }), this.timeout) } var n = e("../core/Topic"), r = e("../core/Message"), o = e("eventemitter2").EventEmitter2; s.prototype.__proto__ = o.prototype, s.prototype.cancel = function () { var e = new r; this.cancelTopic.publish(e) }, t.exports = s }, { "../core/Message": 10, "../core/Topic": 17, eventemitter2: 1 }], 6: [function (e, t, i) { function s(e) { var t = this; e = e || {}, this.ros = e.ros, this.serverName = e.serverName, this.actionName = e.actionName, this.timeout = e.timeout, this.omitFeedback = e.omitFeedback, this.omitStatus = e.omitStatus, this.omitResult = e.omitResult; var i = new n({ ros: this.ros, name: this.serverName + "/goal", messageType: this.actionName + "Goal" }), s = new n({ ros: this.ros, name: this.serverName + "/feedback", messageType: this.actionName + "Feedback" }), r = new n({ ros: this.ros, name: this.serverName + "/status", messageType: "actionlib_msgs/GoalStatusArray" }), o = new n({ ros: this.ros, name: this.serverName + "/result", messageType: this.actionName + "Result" }); i.subscribe((function (e) { t.emit("goal", e) })), r.subscribe((function (e) { e.status_list.forEach((function (e) { t.emit("status", e) })) })), s.subscribe((function (e) { t.emit("status", e.status), t.emit("feedback", e.feedback) })), o.subscribe((function (e) { t.emit("status", e.status), t.emit("result", e.result) })) } var n = e("../core/Topic"), r = (e("../core/Message"), e("eventemitter2").EventEmitter2); s.prototype.__proto__ = r.prototype, t.exports = s }, { "../core/Message": 10, "../core/Topic": 17, eventemitter2: 1 }], 7: [function (e, t, i) { function s(e) { var t = this; this.actionClient = e.actionClient, this.goalMessage = e.goalMessage, this.isFinished = !1; var i = new Date; this.goalID = "goal_" + Math.random() + "_" + i.getTime(), this.goalMessage = new n({ goal_id: { stamp: { secs: 0, nsecs: 0 }, id: this.goalID }, goal: this.goalMessage }), this.on("status", (function (e) { t.status = e })), this.on("result", (function (e) { t.isFinished = !0, t.result = e })), this.on("feedback", (function (e) { t.feedback = e })), this.actionClient.goals[this.goalID] = this } var n = e("../core/Message"), r = e("eventemitter2").EventEmitter2; s.prototype.__proto__ = r.prototype, s.prototype.send = function (e) { var t = this; t.actionClient.goalTopic.publish(t.goalMessage), e && setTimeout((function () { t.isFinished || t.emit("timeout") }), e) }, s.prototype.cancel = function () { var e = new n({ id: this.goalID }); this.actionClient.cancelTopic.publish(e) }, t.exports = s }, { "../core/Message": 10, eventemitter2: 1 }], 8: [function (e, t, i) { function s(e) { var t = this; e = e || {}, this.ros = e.ros, this.serverName = e.serverName, this.actionName = e.actionName, this.feedbackPublisher = new n({ ros: this.ros, name: this.serverName + "/feedback", messageType: this.actionName + "Feedback" }), this.feedbackPublisher.advertise(); var i = new n({ ros: this.ros, name: this.serverName + "/status", messageType: "actionlib_msgs/GoalStatusArray" }); i.advertise(), this.resultPublisher = new n({ ros: this.ros, name: this.serverName + "/result", messageType: this.actionName + "Result" }), this.resultPublisher.advertise(); var s = new n({ ros: this.ros, name: this.serverName + "/goal", messageType: this.actionName + "Goal" }), o = new n({ ros: this.ros, name: this.serverName + "/cancel", messageType: "actionlib_msgs/GoalID" }); this.statusMessage = new r({ header: { stamp: { secs: 0, nsecs: 100 }, frame_id: "" }, status_list: [] }), this.currentGoal = null, this.nextGoal = null, s.subscribe((function (e) { t.currentGoal ? (t.nextGoal = e, t.emit("cancel")) : (t.statusMessage.status_list = [{ goal_id: e.goal_id, status: 1 }], t.currentGoal = e, t.emit("goal", e.goal)) })); var a = function (e, t) { return !(e.secs > t.secs) && (e.secs < t.secs || e.nsecs < t.nsecs) }; o.subscribe((function (e) { 0 === e.stamp.secs && 0 === e.stamp.secs && "" === e.id ? (t.nextGoal = null, t.currentGoal && t.emit("cancel")) : (t.currentGoal && e.id === t.currentGoal.goal_id.id ? t.emit("cancel") : t.nextGoal && e.id === t.nextGoal.goal_id.id && (t.nextGoal = null), t.nextGoal && a(t.nextGoal.goal_id.stamp, e.stamp) && (t.nextGoal = null), t.currentGoal && a(t.currentGoal.goal_id.stamp, e.stamp) && t.emit("cancel")) })), setInterval((function () { var e = new Date, s = Math.floor(e.getTime() / 1e3), n = Math.round(1e9 * (e.getTime() / 1e3 - s)); t.statusMessage.header.stamp.secs = s, t.statusMessage.header.stamp.nsecs = n, i.publish(t.statusMessage) }), 500) } var n = e("../core/Topic"), r = e("../core/Message"), o = e("eventemitter2").EventEmitter2; s.prototype.__proto__ = o.prototype, s.prototype.setSucceeded = function (e) { var t = new r({ status: { goal_id: this.currentGoal.goal_id, status: 3 }, result: e }); this.resultPublisher.publish(t), this.statusMessage.status_list = [], this.nextGoal ? (this.currentGoal = this.nextGoal, this.nextGoal = null, this.emit("goal", this.currentGoal.goal)) : this.currentGoal = null }, s.prototype.sendFeedback = function (e) { var t = new r({ status: { goal_id: this.currentGoal.goal_id, status: 1 }, feedback: e }); this.feedbackPublisher.publish(t) }, s.prototype.setPreempted = function () { this.statusMessage.status_list = []; var e = new r({ status: { goal_id: this.currentGoal.goal_id, status: 2 } }); this.resultPublisher.publish(e), this.nextGoal ? (this.currentGoal = this.nextGoal, this.nextGoal = null, this.emit("goal", this.currentGoal.goal)) : this.currentGoal = null }, t.exports = s }, { "../core/Message": 10, "../core/Topic": 17, eventemitter2: 1 }], 9: [function (e, t, i) { var s = e("../core/Ros"); e("../mixin")(s, ["ActionClient", "SimpleActionServer"], t.exports = { ActionClient: e("./ActionClient"), ActionListener: e("./ActionListener"), Goal: e("./Goal"), SimpleActionServer: e("./SimpleActionServer") }) }, { "../core/Ros": 12, "../mixin": 24, "./ActionClient": 5, "./ActionListener": 6, "./Goal": 7, "./SimpleActionServer": 8 }], 10: [function (e, t, i) { var s = e("object-assign"); t.exports = function (e) { s(this, e) } }, { "object-assign": 2 }], 11: [function (e, t, i) { function s(e) { e = e || {}, this.ros = e.ros, this.name = e.name } var n = e("./Service"), r = e("./ServiceRequest"); s.prototype.get = function (e) { var t = new n({ ros: this.ros, name: "/rosapi/get_param", serviceType: "rosapi/GetParam" }), i = new r({ name: this.name }); t.callService(i, (function (t) { var i = JSON.parse(t.value); e(i) })) }, s.prototype.set = function (e, t) { var i = new n({ ros: this.ros, name: "/rosapi/set_param", serviceType: "rosapi/SetParam" }), s = new r({ name: this.name, value: JSON.stringify(e) }); i.callService(s, t) }, s.prototype.delete = function (e) { var t = new n({ ros: this.ros, name: "/rosapi/delete_param", serviceType: "rosapi/DeleteParam" }), i = new r({ name: this.name }); t.callService(i, e) }, t.exports = s }, { "./Service": 13, "./ServiceRequest": 14 }], 12: [function (e, t, i) { function s(e) { e = e || {}, this.socket = null, this.idCounter = 0, this.isConnected = !1, this.transportLibrary = e.transportLibrary || "websocket", this.transportOptions = e.transportOptions || {}, void 0 === e.groovyCompatibility ? this.groovyCompatibility = !0 : this.groovyCompatibility = e.groovyCompatibility, this.setMaxListeners(0), e.url && this.connect(e.url) } var n = e("ws"), r = e("./SocketAdapter.js"), o = e("./Service"), a = e("./ServiceRequest"), c = e("object-assign"), l = e("eventemitter2").EventEmitter2; s.prototype.__proto__ = l.prototype, s.prototype.connect = function (e) { "socket.io" === this.transportLibrary ? (this.socket = c(io(e, { "force new connection": !0 }), r(this)), this.socket.on("connect", this.socket.onopen), this.socket.on("data", this.socket.onmessage), this.socket.on("close", this.socket.onclose), this.socket.on("error", this.socket.onerror)) : "RTCPeerConnection" === this.transportLibrary.constructor.name ? this.socket = c(this.transportLibrary.createDataChannel(e, this.transportOptions), r(this)) : this.socket = c(new n(e), r(this)) }, s.prototype.close = function () { this.socket && this.socket.close() }, s.prototype.authenticate = function (e, t, i, s, n, r, o) { var a = { op: "auth", mac: e, client: t, dest: i, rand: s, t: n, level: r, end: o }; this.callOnConnection(a) }, s.prototype.callOnConnection = function (e) { var t = this, i = JSON.stringify(e), s = null; s = "socket.io" === this.transportLibrary ? function (e) { t.socket.emit("operation", e) } : function (e) { t.socket.send(e) }, this.isConnected ? s(i) : t.once("connection", (function () { s(i) })) }, s.prototype.getActionServers = function (e, t) { var i = new o({ ros: this, name: "/rosapi/action_servers", serviceType: "rosapi/GetActionServers" }), s = new a({}); "function" == typeof t ? i.callService(s, (function (t) { e(t.action_servers) }), (function (e) { t(e) })) : i.callService(s, (function (t) { e(t.action_servers) })) }, s.prototype.getTopics = function (e, t) { var i = new o({ ros: this, name: "/rosapi/topics", serviceType: "rosapi/Topics" }), s = new a; "function" == typeof t ? i.callService(s, (function (t) { e(t) }), (function (e) { t(e) })) : i.callService(s, (function (t) { e(t) })) }, s.prototype.getTopicsForType = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/topics_for_type", serviceType: "rosapi/TopicsForType" }), n = new a({ type: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e.topics) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e.topics) })) }, s.prototype.getServices = function (e, t) { var i = new o({ ros: this, name: "/rosapi/services", serviceType: "rosapi/Services" }), s = new a; "function" == typeof t ? i.callService(s, (function (t) { e(t.services) }), (function (e) { t(e) })) : i.callService(s, (function (t) { e(t.services) })) }, s.prototype.getServicesForType = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/services_for_type", serviceType: "rosapi/ServicesForType" }), n = new a({ type: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e.services) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e.services) })) }, s.prototype.getServiceRequestDetails = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/service_request_details", serviceType: "rosapi/ServiceRequestDetails" }), n = new a({ type: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e) })) }, s.prototype.getServiceResponseDetails = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/service_response_details", serviceType: "rosapi/ServiceResponseDetails" }), n = new a({ type: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e) })) }, s.prototype.getNodes = function (e, t) { var i = new o({ ros: this, name: "/rosapi/nodes", serviceType: "rosapi/Nodes" }), s = new a; "function" == typeof t ? i.callService(s, (function (t) { e(t.nodes) }), (function (e) { t(e) })) : i.callService(s, (function (t) { e(t.nodes) })) }, s.prototype.getNodeDetails = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/node_details", serviceType: "rosapi/NodeDetails" }), n = new a({ node: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e.subscribing, e.publishing, e.services) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e) })) }, s.prototype.getParams = function (e, t) { var i = new o({ ros: this, name: "/rosapi/get_param_names", serviceType: "rosapi/GetParamNames" }), s = new a; "function" == typeof t ? i.callService(s, (function (t) { e(t.names) }), (function (e) { t(e) })) : i.callService(s, (function (t) { e(t.names) })) }, s.prototype.getTopicType = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/topic_type", serviceType: "rosapi/TopicType" }), n = new a({ topic: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e.type) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e.type) })) }, s.prototype.getServiceType = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/service_type", serviceType: "rosapi/ServiceType" }), n = new a({ service: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e.type) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e.type) })) }, s.prototype.getMessageDetails = function (e, t, i) { var s = new o({ ros: this, name: "/rosapi/message_details", serviceType: "rosapi/MessageDetails" }), n = new a({ type: e }); "function" == typeof i ? s.callService(n, (function (e) { t(e.typedefs) }), (function (e) { i(e) })) : s.callService(n, (function (e) { t(e.typedefs) })) }, s.prototype.decodeTypeDefs = function (e) { var t = this, i = function (e, s) { for (var n = {}, r = 0; r < e.fieldnames.length; r++) { var o = e.fieldarraylen[r], a = e.fieldnames[r], c = e.fieldtypes[r]; if (-1 === c.indexOf("/")) n[a] = -1 === o ? c : [c]; else { for (var l = !1, h = 0; h < s.length; h++)if (s[h].type.toString() === c.toString()) { l = s[h]; break } if (l) { var u = i(l, s); -1 === o || (n[a] = [u]) } else t.emit("error", "Cannot find " + c + " in decodeTypeDefs") } } return n }; return i(e[0], e) }, t.exports = s }, { "./Service": 13, "./ServiceRequest": 14, "./SocketAdapter.js": 16, eventemitter2: 1, "object-assign": 2, ws: 39 }], 13: [function (e, t, i) { function s(e) { e = e || {}, this.ros = e.ros, this.name = e.name, this.serviceType = e.serviceType, this.isAdvertised = !1, this._serviceCallback = null } var n = e("./ServiceResponse"), r = (e("./ServiceRequest"), e("eventemitter2").EventEmitter2); s.prototype.__proto__ = r.prototype, s.prototype.callService = function (e, t, i) { if (!this.isAdvertised) { var s = "call_service:" + this.name + ":" + ++this.ros.idCounter; (t || i) && this.ros.once(s, (function (e) { void 0 !== e.result && !1 === e.result ? "function" == typeof i && i(e.values) : "function" == typeof t && t(new n(e.values)) })); var r = { op: "call_service", id: s, service: this.name, args: e }; this.ros.callOnConnection(r) } }, s.prototype.advertise = function (e) { this.isAdvertised || "function" != typeof e || (this._serviceCallback = e, this.ros.on(this.name, this._serviceResponse.bind(this)), this.ros.callOnConnection({ op: "advertise_service", type: this.serviceType, service: this.name }), this.isAdvertised = !0) }, s.prototype.unadvertise = function () { this.isAdvertised && (this.ros.callOnConnection({ op: "unadvertise_service", service: this.name }), this.isAdvertised = !1) }, s.prototype._serviceResponse = function (e) { var t = {}, i = this._serviceCallback(e.args, t), s = { op: "service_response", service: this.name, values: new n(t), result: i }; e.id && (s.id = e.id), this.ros.callOnConnection(s) }, t.exports = s }, { "./ServiceRequest": 14, "./ServiceResponse": 15, eventemitter2: 1 }], 14: [function (e, t, i) { var s = e("object-assign"); t.exports = function (e) { s(this, e) } }, { "object-assign": 2 }], 15: [function (e, t, i) { var s = e("object-assign"); t.exports = function (e) { s(this, e) } }, { "object-assign": 2 }], 16: [function (e, t, i) { "use strict"; var s = e("../util/decompressPng"), n = (e("ws"), null); "undefined" != typeof bson && (n = bson().BSON), t.exports = function (e) { function t(t) { "publish" === t.op ? e.emit(t.topic, t.msg) : "service_response" === t.op ? e.emit(t.id, t) : "call_service" === t.op && e.emit(t.service, t) } function i(e, t) { "png" === e.op ? s(e.data, t) : t(e) } return { onopen: function (t) { e.isConnected = !0, e.emit("connection", t) }, onclose: function (t) { e.isConnected = !1, e.emit("close", t) }, onerror: function (t) { e.emit("error", t) }, onmessage: function (e) { "undefined" != typeof Blob && e.data instanceof Blob ? function (e, t) { if (!n) throw "Cannot process BSON encoded message without BSON header."; var i = new FileReader; i.onload = function () { var e = new Uint8Array(this.result), i = n.deserialize(e); t(i) }, i.readAsArrayBuffer(e) }(e.data, (function (e) { i(e, t) })) : i(JSON.parse("string" == typeof e ? e : e.data), t) } } } }, { "../util/decompressPng": 41, ws: 39 }], 17: [function (e, t, i) { function s(e) { e = e || {}, this.ros = e.ros, this.name = e.name, this.messageType = e.messageType, this.isAdvertised = !1, this.compression = e.compression || "none", this.throttle_rate = e.throttle_rate || 0, this.latch = e.latch || !1, this.queue_size = e.queue_size || 100, this.queue_length = e.queue_length || 0, this.compression && "png" !== this.compression && "none" !== this.compression && this.emit("warning", this.compression + " compression is not supported. No compression will be used."), this.throttle_rate < 0 && (this.emit("warning", this.throttle_rate + " is not allowed. Set to 0"), this.throttle_rate = 0); var t = this; this._messageCallback = function (e) { t.emit("message", new r(e)) } } var n = e("eventemitter2").EventEmitter2, r = e("./Message"); s.prototype.__proto__ = n.prototype, s.prototype.subscribe = function (e) { "function" == typeof e && this.on("message", e), this.subscribeId || (this.ros.on(this.name, this._messageCallback), this.subscribeId = "subscribe:" + this.name + ":" + ++this.ros.idCounter, this.ros.callOnConnection({ op: "subscribe", id: this.subscribeId, type: this.messageType, topic: this.name, compression: this.compression, throttle_rate: this.throttle_rate, queue_length: this.queue_length })) }, s.prototype.unsubscribe = function (e) { e && (this.off("message", e), this.listeners("message").length) || this.subscribeId && (this.ros.off(this.name, this._messageCallback), this.emit("unsubscribe"), this.ros.callOnConnection({ op: "unsubscribe", id: this.subscribeId, topic: this.name }), this.subscribeId = null) }, s.prototype.advertise = function () { this.isAdvertised || (this.advertiseId = "advertise:" + this.name + ":" + ++this.ros.idCounter, this.ros.callOnConnection({ op: "advertise", id: this.advertiseId, type: this.messageType, topic: this.name, latch: this.latch, queue_size: this.queue_size }), this.isAdvertised = !0) }, s.prototype.unadvertise = function () { this.isAdvertised && (this.emit("unadvertise"), this.ros.callOnConnection({ op: "unadvertise", id: this.advertiseId, topic: this.name }), this.isAdvertised = !1) }, s.prototype.publish = function (e) { this.isAdvertised || this.advertise(), this.ros.idCounter++; var t = { op: "publish", id: "publish:" + this.name + ":" + this.ros.idCounter, topic: this.name, msg: e, latch: this.latch }; this.ros.callOnConnection(t) }, t.exports = s }, { "./Message": 10, eventemitter2: 1 }], 18: [function (e, t, i) { var s = e("../mixin"), n = t.exports = { Ros: e("./Ros"), Topic: e("./Topic"), Message: e("./Message"), Param: e("./Param"), Service: e("./Service"), ServiceRequest: e("./ServiceRequest"), ServiceResponse: e("./ServiceResponse") }; s(n.Ros, ["Param", "Service", "Topic"], n) }, { "../mixin": 24, "./Message": 10, "./Param": 11, "./Ros": 12, "./Service": 13, "./ServiceRequest": 14, "./ServiceResponse": 15, "./Topic": 17 }], 19: [function (e, t, i) { function s(e) { e = e || {}, this.position = new n(e.position), this.orientation = new r(e.orientation) } var n = e("./Vector3"), r = e("./Quaternion"); s.prototype.applyTransform = function (e) { this.position.multiplyQuaternion(e.rotation), this.position.add(e.translation); var t = e.rotation.clone(); t.multiply(this.orientation), this.orientation = t }, s.prototype.clone = function () { return new s(this) }, t.exports = s }, { "./Quaternion": 20, "./Vector3": 22 }], 20: [function (e, t, i) { function s(e) { e = e || {}, this.x = e.x || 0, this.y = e.y || 0, this.z = e.z || 0, this.w = "number" == typeof e.w ? e.w : 1 } s.prototype.conjugate = function () { this.x *= -1, this.y *= -1, this.z *= -1 }, s.prototype.norm = function () { return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w) }, s.prototype.normalize = function () { var e = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w); 0 === e ? (this.x = 0, this.y = 0, this.z = 0, this.w = 1) : (e = 1 / e, this.x = this.x * e, this.y = this.y * e, this.z = this.z * e, this.w = this.w * e) }, s.prototype.invert = function () { this.conjugate(), this.normalize() }, s.prototype.multiply = function (e) { var t = this.x * e.w + this.y * e.z - this.z * e.y + this.w * e.x, i = -this.x * e.z + this.y * e.w + this.z * e.x + this.w * e.y, s = this.x * e.y - this.y * e.x + this.z * e.w + this.w * e.z, n = -this.x * e.x - this.y * e.y - this.z * e.z + this.w * e.w; this.x = t, this.y = i, this.z = s, this.w = n }, s.prototype.clone = function () { return new s(this) }, t.exports = s }, {}], 21: [function (e, t, i) { function s(e) { e = e || {}, this.translation = new n(e.translation), this.rotation = new r(e.rotation) } var n = e("./Vector3"), r = e("./Quaternion"); s.prototype.clone = function () { return new s(this) }, t.exports = s }, { "./Quaternion": 20, "./Vector3": 22 }], 22: [function (e, t, i) { function s(e) { e = e || {}, this.x = e.x || 0, this.y = e.y || 0, this.z = e.z || 0 } s.prototype.add = function (e) { this.x += e.x, this.y += e.y, this.z += e.z }, s.prototype.subtract = function (e) { this.x -= e.x, this.y -= e.y, this.z -= e.z }, s.prototype.multiplyQuaternion = function (e) { var t = e.w * this.x + e.y * this.z - e.z * this.y, i = e.w * this.y + e.z * this.x - e.x * this.z, s = e.w * this.z + e.x * this.y - e.y * this.x, n = -e.x * this.x - e.y * this.y - e.z * this.z; this.x = t * e.w + n * -e.x + i * -e.z - s * -e.y, this.y = i * e.w + n * -e.y + s * -e.x - t * -e.z, this.z = s * e.w + n * -e.z + t * -e.y - i * -e.x }, s.prototype.clone = function () { return new s(this) }, t.exports = s }, {}], 23: [function (e, t, i) { t.exports = { Pose: e("./Pose"), Quaternion: e("./Quaternion"), Transform: e("./Transform"), Vector3: e("./Vector3") } }, { "./Pose": 19, "./Quaternion": 20, "./Transform": 21, "./Vector3": 22 }], 24: [function (e, t, i) { t.exports = function (e, t, i) { t.forEach((function (t) { var s = i[t]; e.prototype[t] = function (e) { return e.ros = this, new s(e) } })) } }, {}], 25: [function (e, t, i) { function s(e) { e = e || {}, this.ros = e.ros, this.fixedFrame = e.fixedFrame || "/base_link", this.angularThres = e.angularThres || 2, this.transThres = e.transThres || .01, this.rate = e.rate || 10, this.updateDelay = e.updateDelay || 50; var t = e.topicTimeout || 2, i = Math.floor(t), s = Math.floor(1e9 * (t - i)); this.topicTimeout = { secs: i, nsecs: s }, this.serverName = e.serverName || "/tf2_web_republisher", this.repubServiceName = e.repubServiceName || "/republish_tfs", this.currentGoal = !1, this.currentTopic = !1, this.frameInfos = {}, this.republisherUpdateRequested = !1, this.actionClient = this.ros.ActionClient({ serverName: this.serverName, actionName: "tf2_web_republisher/TFSubscriptionAction", omitStatus: !0, omitResult: !0 }), this.serviceClient = this.ros.Service({ name: this.repubServiceName, serviceType: "tf2_web_republisher/RepublishTFs" }) } var n = (e("../actionlib/ActionClient"), e("../actionlib/Goal")), r = (e("../core/Service.js"), e("../core/ServiceRequest.js")), o = e("../math/Transform"); s.prototype.processTFArray = function (e) { e.transforms.forEach((function (e) { var t = e.child_frame_id; "/" === t[0] && (t = t.substring(1)); var i = this.frameInfos[t]; i && (i.transform = new o({ translation: e.transform.translation, rotation: e.transform.rotation }), i.cbs.forEach((function (e) { e(i.transform) }))) }), this) }, s.prototype.updateGoal = function () { var e = { source_frames: Object.keys(this.frameInfos), target_frame: this.fixedFrame, angular_thres: this.angularThres, trans_thres: this.transThres, rate: this.rate }; if (this.ros.groovyCompatibility) this.currentGoal && this.currentGoal.cancel(), this.currentGoal = new n({ actionClient: this.actionClient, goalMessage: e }), this.currentGoal.on("feedback", this.processTFArray.bind(this)), this.currentGoal.send(); else { e.timeout = this.topicTimeout; var t = new r(e); this.serviceClient.callService(t, this.processResponse.bind(this)) } this.republisherUpdateRequested = !1 }, s.prototype.processResponse = function (e) { this.currentTopic && this.currentTopic.unsubscribe(), this.currentTopic = this.ros.Topic({ name: e.topic_name, messageType: "tf2_web_republisher/TFArray" }), this.currentTopic.subscribe(this.processTFArray.bind(this)) }, s.prototype.subscribe = function (e, t) { "/" === e[0] && (e = e.substring(1)), this.frameInfos[e] ? this.frameInfos[e].transform && t(this.frameInfos[e].transform) : (this.frameInfos[e] = { cbs: [] }, this.republisherUpdateRequested || (setTimeout(this.updateGoal.bind(this), this.updateDelay), this.republisherUpdateRequested = !0)), this.frameInfos[e].cbs.push(t) }, s.prototype.unsubscribe = function (e, t) { "/" === e[0] && (e = e.substring(1)); for (var i = this.frameInfos[e], s = i && i.cbs || [], n = s.length; n--;)s[n] === t && s.splice(n, 1); t && 0 !== s.length || delete this.frameInfos[e] }, t.exports = s }, { "../actionlib/ActionClient": 5, "../actionlib/Goal": 7, "../core/Service.js": 13, "../core/ServiceRequest.js": 14, "../math/Transform": 21 }], 26: [function (e, t, i) { var s = e("../core/Ros"); e("../mixin")(s, ["TFClient"], t.exports = { TFClient: e("./TFClient") }) }, { "../core/Ros": 12, "../mixin": 24, "./TFClient": 25 }], 27: [function (e, t, i) { var s = e("../math/Vector3"), n = e("./UrdfTypes"); t.exports = function (e) { this.dimension = null, this.type = n.URDF_BOX; var t = e.xml.getAttribute("size").split(" "); this.dimension = new s({ x: parseFloat(t[0]), y: parseFloat(t[1]), z: parseFloat(t[2]) }) } }, { "../math/Vector3": 22, "./UrdfTypes": 36 }], 28: [function (e, t, i) { t.exports = function (e) { var t = e.xml.getAttribute("rgba").split(" "); this.r = parseFloat(t[0]), this.g = parseFloat(t[1]), this.b = parseFloat(t[2]), this.a = parseFloat(t[3]) } }, {}], 29: [function (e, t, i) { var s = e("./UrdfTypes"); t.exports = function (e) { this.type = s.URDF_CYLINDER, this.length = parseFloat(e.xml.getAttribute("length")), this.radius = parseFloat(e.xml.getAttribute("radius")) } }, { "./UrdfTypes": 36 }], 30: [function (e, t, i) { t.exports = function (e) { this.name = e.xml.getAttribute("name"), this.type = e.xml.getAttribute("type"); var t = e.xml.getElementsByTagName("limit"); t.length > 0 && (this.minval = parseFloat(t[0].getAttribute("lower")), this.maxval = parseFloat(t[0].getAttribute("upper"))) } }, {}], 31: [function (e, t, i) { var s = e("./UrdfVisual"); t.exports = function (e) { this.name = e.xml.getAttribute("name"), this.visuals = []; for (var t = e.xml.getElementsByTagName("visual"), i = 0; i < t.length; i++)this.visuals.push(new s({ xml: t[i] })) } }, { "./UrdfVisual": 37 }], 32: [function (e, t, i) { function s(e) { this.textureFilename = null, this.color = null, this.name = e.xml.getAttribute("name"); var t = e.xml.getElementsByTagName("texture"); t.length > 0 && (this.textureFilename = t[0].getAttribute("filename")); var i = e.xml.getElementsByTagName("color"); i.length > 0 && (this.color = new n({ xml: i[0] })) } var n = e("./UrdfColor"); s.prototype.isLink = function () { return null === this.color && null === this.textureFilename }; var r = e("object-assign"); s.prototype.assign = function (e) { return r(this, e) }, t.exports = s }, { "./UrdfColor": 28, "object-assign": 2 }], 33: [function (e, t, i) { var s = e("../math/Vector3"), n = e("./UrdfTypes"); t.exports = function (e) { this.scale = null, this.type = n.URDF_MESH, this.filename = e.xml.getAttribute("filename"); var t = e.xml.getAttribute("scale"); if (t) { var i = t.split(" "); this.scale = new s({ x: parseFloat(i[0]), y: parseFloat(i[1]), z: parseFloat(i[2]) }) } } }, { "../math/Vector3": 22, "./UrdfTypes": 36 }], 34: [function (e, t, i) { var s = e("./UrdfMaterial"), n = e("./UrdfLink"), r = e("./UrdfJoint"), o = e("xmldom").DOMParser; t.exports = function (e) { var t = (e = e || {}).xml, i = e.string; this.materials = {}, this.links = {}, this.joints = {}, i && (t = (new o).parseFromString(i, "text/xml")); var a = t.documentElement; this.name = a.getAttribute("name"); for (var c = a.childNodes, l = 0; l < c.length; l++) { var h = c[l]; if ("material" === h.tagName) { var u = new s({ xml: h }); void 0 !== this.materials[u.name] ? this.materials[u.name].isLink() ? this.materials[u.name].assign(u) : console.warn("Material " + u.name + "is not unique.") : this.materials[u.name] = u } else if ("link" === h.tagName) { var p = new n({ xml: h }); if (void 0 !== this.links[p.name]) console.warn("Link " + p.name + " is not unique."); else { for (var f = 0; f < p.visuals.length; f++) { var m = p.visuals[f].material; null !== m && (void 0 !== this.materials[m.name] ? p.visuals[f].material = this.materials[m.name] : this.materials[m.name] = m) } this.links[p.name] = p } } else if ("joint" === h.tagName) { var v = new r({ xml: h }); this.joints[v.name] = v } } } }, { "./UrdfJoint": 30, "./UrdfLink": 31, "./UrdfMaterial": 32, xmldom: 42 }], 35: [function (e, t, i) { var s = e("./UrdfTypes"); t.exports = function (e) { this.type = s.URDF_SPHERE, this.radius = parseFloat(e.xml.getAttribute("radius")) } }, { "./UrdfTypes": 36 }], 36: [function (e, t, i) { t.exports = { URDF_SPHERE: 0, URDF_BOX: 1, URDF_CYLINDER: 2, URDF_MESH: 3 } }, {}], 37: [function (e, t, i) { var s = e("../math/Pose"), n = e("../math/Vector3"), r = e("../math/Quaternion"), o = e("./UrdfCylinder"), a = e("./UrdfBox"), c = e("./UrdfMaterial"), l = e("./UrdfMesh"), h = e("./UrdfSphere"); t.exports = function (e) { var t = e.xml; this.origin = null, this.geometry = null, this.material = null; var i = t.getElementsByTagName("origin"); if (0 === i.length) this.origin = new s; else { var u = i[0].getAttribute("xyz"), p = new n; u && (u = u.split(" "), p = new n({ x: parseFloat(u[0]), y: parseFloat(u[1]), z: parseFloat(u[2]) })); var f = i[0].getAttribute("rpy"), m = new r; if (f) { f = f.split(" "); var v = parseFloat(f[0]) / 2, d = parseFloat(f[1]) / 2, y = parseFloat(f[2]) / 2, g = Math.sin(v) * Math.cos(d) * Math.cos(y) - Math.cos(v) * Math.sin(d) * Math.sin(y), b = Math.cos(v) * Math.sin(d) * Math.cos(y) + Math.sin(v) * Math.cos(d) * Math.sin(y), _ = Math.cos(v) * Math.cos(d) * Math.sin(y) - Math.sin(v) * Math.sin(d) * Math.cos(y), w = Math.cos(v) * Math.cos(d) * Math.cos(y) + Math.sin(v) * Math.sin(d) * Math.sin(y); (m = new r({ x: g, y: b, z: _, w: w })).normalize() } this.origin = new s({ position: p, orientation: m }) } var x = t.getElementsByTagName("geometry"); if (x.length > 0) { for (var T = x[0], S = null, k = 0; k < T.childNodes.length; k++) { var M = T.childNodes[k]; if (1 === M.nodeType) { S = M; break } } var A = S.nodeName; "sphere" === A ? this.geometry = new h({ xml: S }) : "box" === A ? this.geometry = new a({ xml: S }) : "cylinder" === A ? this.geometry = new o({ xml: S }) : "mesh" === A ? this.geometry = new l({ xml: S }) : console.warn("Unknown geometry type " + A) } var N = t.getElementsByTagName("material"); N.length > 0 && (this.material = new c({ xml: N[0] })) } }, { "../math/Pose": 19, "../math/Quaternion": 20, "../math/Vector3": 22, "./UrdfBox": 27, "./UrdfCylinder": 29, "./UrdfMaterial": 32, "./UrdfMesh": 33, "./UrdfSphere": 35 }], 38: [function (e, t, i) { t.exports = e("object-assign")({ UrdfBox: e("./UrdfBox"), UrdfColor: e("./UrdfColor"), UrdfCylinder: e("./UrdfCylinder"), UrdfLink: e("./UrdfLink"), UrdfMaterial: e("./UrdfMaterial"), UrdfMesh: e("./UrdfMesh"), UrdfModel: e("./UrdfModel"), UrdfSphere: e("./UrdfSphere"), UrdfVisual: e("./UrdfVisual") }, e("./UrdfTypes")) }, { "./UrdfBox": 27, "./UrdfColor": 28, "./UrdfCylinder": 29, "./UrdfLink": 31, "./UrdfMaterial": 32, "./UrdfMesh": 33, "./UrdfModel": 34, "./UrdfSphere": 35, "./UrdfTypes": 36, "./UrdfVisual": 37, "object-assign": 2 }], 39: [function (e, t, i) { (function (e) { t.exports = e.WebSocket }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}], 40: [function (e, t, i) { t.exports = function () { return document.createElement("canvas") } }, {}], 41: [function (e, t, i) { (function (i) { "use strict"; var s = e("canvas"), n = s.Image || i.Image; t.exports = function (e, t) { var i = new n; i.onload = function () { var e = new s, n = e.getContext("2d"); e.width = i.width, e.height = i.height, n.imageSmoothingEnabled = !1, n.webkitImageSmoothingEnabled = !1, n.mozImageSmoothingEnabled = !1, n.drawImage(i, 0, 0); for (var r = n.getImageData(0, 0, i.width, i.height).data, o = "", a = 0; a < r.length; a += 4)o += String.fromCharCode(r[a], r[a + 1], r[a + 2]); t(JSON.parse(o)) }, i.src = "data:image/png;base64," + e } }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, { canvas: 40 }], 42: [function (e, t, i) { (function (e) { i.DOMImplementation = e.DOMImplementation, i.XMLSerializer = e.XMLSerializer, i.DOMParser = e.DOMParser }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {}) }, {}] }, {}, [4]);
!function (t, e) { "function" == typeof define && define.amd ? define(["jquery"], (function (n) { return e(t, n) })) : "object" == typeof exports ? e(t, require("jquery")) : e(t, t.jQuery) }("undefined" != typeof window ? window : this, (function (t, e) { "use strict"; var n = t.document, i = Array.prototype.slice, s = /trident\/7./i, o = function () { if (s.test(navigator.userAgent)) return !1; var t = n.createElement("input"); return t.setAttribute("oninput", "return"), "function" == typeof t.oninput }(), a = /([A-Z])/g, r = /^http:[\w\.\/]+svg$/, h = "(\\-?\\d[\\d\\.e-]*)", c = new RegExp("^matrix\\(" + h + "\\,?\\s*" + h + "\\,?\\s*" + h + "\\,?\\s*" + h + "\\,?\\s*" + h + "\\,?\\s*" + h + "\\)$"); function l(t) { var n = { range: !0, animate: !0 }; return "boolean" == typeof t ? n.animate = t : e.extend(n, t), n } function m(t, n, i, s, o, a, r, h, c) { "array" === e.type(t) ? this.elements = [+t[0], +t[2], +t[4], +t[1], +t[3], +t[5], 0, 0, 1] : this.elements = [t, n, i, s, o, a, r || 0, h || 0, c || 1] } function u(t, e, n) { this.elements = [t, e, n] } function f(t, i) { if (!(this instanceof f)) return new f(t, i); 1 !== t.nodeType && e.error("Panzoom called on non-Element node"), e.contains(n, t) || e.error("Panzoom element must be attached to the document"); var s = e.data(t, "__pz__"); if (s) return s; this.options = i = e.extend({}, f.defaults, i), this.elem = t; var o = this.$elem = e(t); this.$set = i.$set && i.$set.length ? i.$set : o, this.$doc = e(t.ownerDocument || n), this.$parent = o.parent(), this.parent = this.$parent[0], this.isSVG = r.test(t.namespaceURI) && "svg" !== t.nodeName.toLowerCase(), this.panning = !1, this._buildTransform(), this._transform = e.cssProps.transform.replace(a, "-$1").toLowerCase(), this._buildTransition(), this.resetDimensions(); var h = e(), c = this; e.each(["$zoomIn", "$zoomOut", "$zoomRange", "$reset"], (function (t, e) { c[e] = i[e] || h })), this.enable(), this.scale = this.getMatrix()[0], this._checkPanWhenZoomed(), e.data(t, "__pz__", this) } return m.prototype = { x: function (t) { var e = t instanceof u, n = this.elements, i = t.elements; return e && 3 === i.length ? new u(n[0] * i[0] + n[1] * i[1] + n[2] * i[2], n[3] * i[0] + n[4] * i[1] + n[5] * i[2], n[6] * i[0] + n[7] * i[1] + n[8] * i[2]) : i.length === n.length && new m(n[0] * i[0] + n[1] * i[3] + n[2] * i[6], n[0] * i[1] + n[1] * i[4] + n[2] * i[7], n[0] * i[2] + n[1] * i[5] + n[2] * i[8], n[3] * i[0] + n[4] * i[3] + n[5] * i[6], n[3] * i[1] + n[4] * i[4] + n[5] * i[7], n[3] * i[2] + n[4] * i[5] + n[5] * i[8], n[6] * i[0] + n[7] * i[3] + n[8] * i[6], n[6] * i[1] + n[7] * i[4] + n[8] * i[7], n[6] * i[2] + n[7] * i[5] + n[8] * i[8]) }, inverse: function () { var t = 1 / this.determinant(), e = this.elements; return new m(t * (e[8] * e[4] - e[7] * e[5]), t * -(e[8] * e[1] - e[7] * e[2]), t * (e[5] * e[1] - e[4] * e[2]), t * -(e[8] * e[3] - e[6] * e[5]), t * (e[8] * e[0] - e[6] * e[2]), t * -(e[5] * e[0] - e[3] * e[2]), t * (e[7] * e[3] - e[6] * e[4]), t * -(e[7] * e[0] - e[6] * e[1]), t * (e[4] * e[0] - e[3] * e[1])) }, determinant: function () { var t = this.elements; return t[0] * (t[8] * t[4] - t[7] * t[5]) - t[3] * (t[8] * t[1] - t[7] * t[2]) + t[6] * (t[5] * t[1] - t[4] * t[2]) } }, u.prototype.e = m.prototype.e = function (t) { return this.elements[t] }, f.rmatrix = c, f.defaults = { eventNamespace: ".panzoom", transition: !0, cursor: "move", disablePan: !1, disableZoom: !1, disableXAxis: !1, disableYAxis: !1, which: 1, increment: .3, linearZoom: !1, panOnlyWhenZoomed: !1, minScale: .3, maxScale: 6, rangeStep: .05, duration: 200, easing: "ease-in-out", contain: !1 }, f.prototype = { constructor: f, instance: function () { return this }, enable: function () { this._initStyle(), this._bind(), this.disabled = !1 }, disable: function () { this.disabled = !0, this._resetStyle(), this._unbind() }, isDisabled: function () { return this.disabled }, destroy: function () { this.disable(), e.removeData(this.elem, "__pz__") }, resetDimensions: function () { this.container = this.parent.getBoundingClientRect(); var t = this.elem, n = t.getBoundingClientRect(), i = Math.abs(this.scale); this.dimensions = { width: n.width, height: n.height, left: e.css(t, "left", !0) || 0, top: e.css(t, "top", !0) || 0, border: { top: e.css(t, "borderTopWidth", !0) * i || 0, bottom: e.css(t, "borderBottomWidth", !0) * i || 0, left: e.css(t, "borderLeftWidth", !0) * i || 0, right: e.css(t, "borderRightWidth", !0) * i || 0 }, margin: { top: e.css(t, "marginTop", !0) * i || 0, left: e.css(t, "marginLeft", !0) * i || 0 } } }, reset: function (t) { t = l(t); var e = this.setMatrix(this._origTransform, t); t.silent || this._trigger("reset", e) }, resetZoom: function (t) { t = l(t); var e = this.getMatrix(this._origTransform); t.dValue = e[3], this.zoom(e[0], t) }, resetPan: function (t) { var e = this.getMatrix(this._origTransform); this.pan(e[4], e[5], l(t)) }, setTransform: function (t) { for (var n = this.$set, i = n.length; i--;)e.style(n[i], "transform", t), this.isSVG && n[i].setAttribute("transform", t) }, getTransform: function (t) { var n = this.$set[0]; return t ? this.setTransform(t) : (t = e.style(n, "transform"), !this.isSVG || t && "none" !== t || (t = e.attr(n, "transform") || "none")), "none" === t || c.test(t) || this.setTransform(t = e.css(n, "transform")), t || "none" }, getMatrix: function (t) { var e = c.exec(t || this.getTransform()); return e && e.shift(), e || [1, 0, 0, 1, 0, 0] }, setMatrix: function (t, n) { if (!this.disabled) { n || (n = {}), "string" == typeof t && (t = this.getMatrix(t)); var i = +t[0], s = void 0 !== n.contain ? n.contain : this.options.contain; if (s) { var o, a, r, h = n.dims; h || (this.resetDimensions(), h = this.dimensions); var c = this.container, l = h.width, m = h.height, u = c.width, f = c.height, p = u / l, d = f / m; "center" !== this.$parent.css("textAlign") || "inline" !== e.css(this.elem, "display") ? (o = (r = (l - this.elem.offsetWidth) / 2) - h.border.left, a = l - u - r + h.border.right) : o = a = (l - u) / 2; var g = (m - f) / 2 + h.border.top, v = (m - f) / 2 - h.border.top - h.border.bottom; t[4] = "invert" === s || "automatic" === s && p < 1.01 ? Math.max(Math.min(t[4], o - h.border.left), -a) : Math.min(Math.max(t[4], o), -a), t[5] = "invert" === s || "automatic" === s && d < 1.01 ? Math.max(Math.min(t[5], g - h.border.top), -v) : Math.min(Math.max(t[5], g), -v) } if ("skip" !== n.animate && this.transition(!n.animate), n.range && this.$zoomRange.val(i), this.options.disableXAxis || this.options.disableYAxis) { var b = this.getMatrix(); this.options.disableXAxis && (t[4] = b[4]), this.options.disableYAxis && (t[5] = b[5]) } return this.setTransform("matrix(" + t.join(",") + ")"), this.scale = i, this._checkPanWhenZoomed(i), n.silent || this._trigger("change", t), t } }, isPanning: function () { return this.panning }, transition: function (t) { if (this._transition) for (var n = t || !this.options.transition ? "none" : this._transition, i = this.$set, s = i.length; s--;)e.style(i[s], "transition") !== n && e.style(i[s], "transition", n) }, pan: function (t, e, n) { if (!this.options.disablePan) { n || (n = {}); var i = n.matrix; i || (i = this.getMatrix()), n.relative && (t += +i[4], e += +i[5]), i[4] = t, i[5] = e, this.setMatrix(i, n), n.silent || this._trigger("pan", i[4], i[5]) } }, zoom: function (t, n) { "object" == typeof t ? (n = t, t = null) : n || (n = {}); var i = e.extend({}, this.options, n); if (!i.disableZoom) { var s = !1, o = i.matrix || this.getMatrix(), a = +o[0]; "number" != typeof t && (t = i.linearZoom ? a + i.increment * (t ? -1 : 1) : t ? a / (1 + i.increment) : a * (1 + i.increment), s = !0), t = Math.max(Math.min(t, i.maxScale), i.minScale); var r = i.focal; if (r && !i.disablePan) { this.resetDimensions(); var h = i.dims = this.dimensions, c = r.clientX, l = r.clientY; this.isSVG || (c -= h.width / a / 2, l -= h.height / a / 2); var f = new u(c, l, 1), p = new m(o), d = this.parentOffset || this.$parent.offset(), g = new m(1, 0, d.left - this.$doc.scrollLeft(), 0, 1, d.top - this.$doc.scrollTop()), v = p.inverse().x(g.inverse().x(f)), b = t / o[0]; p = p.x(new m([b, 0, 0, b, 0, 0])), f = g.x(p.x(v)), o[4] = +o[4] + (c - f.e(0)), o[5] = +o[5] + (l - f.e(1)) } o[0] = t, o[3] = "number" == typeof i.dValue ? i.dValue : t, this.setMatrix(o, { animate: void 0 !== i.animate ? i.animate : s, range: !i.noSetRange }), i.silent || this._trigger("zoom", o[0], i) } }, option: function (t, n) { var i; if (!t) return e.extend({}, this.options); if ("string" == typeof t) { if (1 === arguments.length) return void 0 !== this.options[t] ? this.options[t] : null; (i = {})[t] = n } else i = t; this._setOptions(i) }, _setOptions: function (t) { e.each(t, e.proxy((function (t, n) { switch (t) { case "disablePan": this._resetStyle(); case "$zoomIn": case "$zoomOut": case "$zoomRange": case "$reset": case "disableZoom": case "onStart": case "onChange": case "onZoom": case "onPan": case "onEnd": case "onReset": case "eventNamespace": this._unbind() }switch (this.options[t] = n, t) { case "disablePan": this._initStyle(); case "$zoomIn": case "$zoomOut": case "$zoomRange": case "$reset": this[t] = n; case "disableZoom": case "onStart": case "onChange": case "onZoom": case "onPan": case "onEnd": case "onReset": case "eventNamespace": this._bind(); break; case "cursor": e.style(this.elem, "cursor", n); break; case "minScale": this.$zoomRange.attr("min", n); break; case "maxScale": this.$zoomRange.attr("max", n); break; case "rangeStep": this.$zoomRange.attr("step", n); break; case "startTransform": this._buildTransform(); break; case "duration": case "easing": this._buildTransition(); case "transition": this.transition(); break; case "panOnlyWhenZoomed": this._checkPanWhenZoomed(); break; case "$set": n instanceof e && n.length && (this.$set = n, this._initStyle(), this._buildTransform()) } }), this)) }, _checkPanWhenZoomed: function (t) { var e = this.options; if (e.panOnlyWhenZoomed) { t || (t = this.getMatrix()[0]); var n = t <= e.minScale; e.disablePan !== n && this.option("disablePan", n) } }, _initStyle: function () { var t = { "transform-origin": this.isSVG ? "0 0" : "50% 50%" }; this.options.disablePan || (t.cursor = this.options.cursor), this.$set.css(t); var n = this.$parent; n.length && !e.nodeName(this.parent, "body") && (t = { overflow: "hidden" }, "static" === n.css("position") && (t.position = "relative"), n.css(t)) }, _resetStyle: function () { this.$elem.css({ cursor: "", transition: "" }), this.$parent.css({ overflow: "", position: "" }) }, _bind: function () { var t = this, n = this.options, i = n.eventNamespace, s = "mousedown" + i + " pointerdown" + i + " MSPointerDown" + i, a = "touchstart" + i + " " + s, r = "touchend" + i + " click" + i + " pointerup" + i + " MSPointerUp" + i, h = {}, c = this.$reset, l = this.$zoomRange; if (e.each(["Start", "Change", "Zoom", "Pan", "End", "Reset"], (function () { var t = n["on" + this]; e.isFunction(t) && (h["panzoom" + this.toLowerCase() + i] = t) })), n.disablePan && n.disableZoom || (h[a] = function (e) { var i; ("touchstart" === e.type ? !(i = e.touches || e.originalEvent.touches) || (1 !== i.length || n.disablePan) && 2 !== i.length : n.disablePan || (e.which || e.originalEvent.which) !== n.which) || (e.preventDefault(), e.stopPropagation(), t._startMove(e, i)) }, 3 === n.which && (h.contextmenu = !1)), this.$elem.on(h), c.length && c.on(r, (function (e) { e.preventDefault(), t.reset() })), l.length && l.attr({ step: n.rangeStep === f.defaults.rangeStep && l.attr("step") || n.rangeStep, min: n.minScale, max: n.maxScale }).prop({ value: this.getMatrix()[0] }), !n.disableZoom) { var m = this.$zoomIn, u = this.$zoomOut; m.length && u.length && (m.on(r, (function (e) { e.preventDefault(), t.zoom() })), u.on(r, (function (e) { e.preventDefault(), t.zoom(!0) }))), l.length && ((h = {})[s] = function () { t.transition(!0) }, h[(o ? "input" : "change") + i] = function () { t.zoom(+this.value, { noSetRange: !0 }) }, l.on(h)) } }, _unbind: function () { this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace) }, _buildTransform: function () { return this._origTransform = this.getTransform(this.options.startTransform) }, _buildTransition: function () { if (this._transform) { var t = this.options; this._transition = this._transform + " " + t.duration + "ms " + t.easing } }, _getDistance: function (t) { var e = t[0], n = t[1]; return Math.sqrt(Math.pow(Math.abs(n.clientX - e.clientX), 2) + Math.pow(Math.abs(n.clientY - e.clientY), 2)) }, _getMiddle: function (t) { var e = t[0], n = t[1]; return { clientX: (n.clientX - e.clientX) / 2 + e.clientX, clientY: (n.clientY - e.clientY) / 2 + e.clientY } }, _trigger: function (t) { "string" == typeof t && (t = "panzoom" + t), this.$elem.triggerHandler(t, [this].concat(i.call(arguments, 1))) }, _startMove: function (t, i) { if (!this.panning) { var s, o, a, r, h, c, l, m, u = this, f = this.options, p = f.eventNamespace, d = this.getMatrix(), g = d.slice(0), v = +g[4], b = +g[5], _ = { matrix: d, animate: "skip" }, x = t.type; "pointerdown" === x ? (s = "pointermove", o = "pointerup") : "touchstart" === x ? (s = "touchmove", o = "touchend") : "MSPointerDown" === x ? (s = "MSPointerMove", o = "MSPointerUp") : (s = "mousemove", o = "mouseup"), s += p, o += p, this.transition(!0), this.panning = !0, this._trigger("start", t, i); var $ = function (t, e) { if (e) { if (2 === e.length) { if (null != a) return; return a = u._getDistance(e), r = +d[0], void (h = u._getMiddle(e)) } if (null != c) return; (m = e[0]) && (c = m.pageX, l = m.pageY) } null == c && (c = t.pageX, l = t.pageY) }; $(t, i); e(n).off(p).on(s, (function (t) { var e; if (t.preventDefault(), i = t.touches || t.originalEvent.touches, $(t, i), i) { if (2 === i.length) { var n = u._getMiddle(i), s = u._getDistance(i) - a; return u.zoom(s * (f.increment / 100) + r, { focal: n, matrix: d, animate: "skip" }), u.pan(+d[4] + n.clientX - h.clientX, +d[5] + n.clientY - h.clientY, _), void (h = n) } e = i[0] || { pageX: 0, pageY: 0 } } e || (e = t), u.pan(v + e.pageX - c, b + e.pageY - l, _) })).on(o, (function (t) { t.preventDefault(), e(this).off(p), u.panning = !1, t.type = "panzoomend", u._trigger(t, d, !function (t, e) { for (var n = t.length; --n;)if (Math.round(+t[n]) !== Math.round(+e[n])) return !1; return !0 }(d, g)) })) } } }, e.Panzoom = f, e.fn.panzoom = function (t) { var n, s, o, a; return "string" == typeof t ? (a = [], s = i.call(arguments, 1), this.each((function () { (n = e.data(this, "__pz__")) ? "_" !== t.charAt(0) && "function" == typeof (o = n[t]) && void 0 !== (o = o.apply(n, s)) && a.push(o) : a.push(void 0) })), a.length ? 1 === a.length ? a[0] : a : this) : this.each((function () { new f(this, t) })) }, f }));
for (var k in CanvasSVG = {}, CanvasSVG.Base = function () { }, CanvasSVG.Base.prototype = { ns: "http://www.w3.org/2000/svg", id: 0, wrapCanvas: function (t) { if (!t.canvasSVGWrapper) { var e = this; this.el = t, t._getContext = t.getContext, t.getContext = function (t) { return e.getContext(t) }, t.canvasSVGWrapper = !0, this.canvas = t } }, getContext: function (t) { return "2d" == t || "2D" == t ? (this.context = this.el._getContext(t), this) : this.el._getContext(t) }, makeElement: function (t, e, s, a) { var i = document.createElementNS(this.ns, t); if (e) for (var r in e) i.setAttributeNS(null, r, e[r]); return s && (i.textContent = s), a && a.appendChild(i), i }, addElement: function (t, e, s) { this.svg.appendChild(this.makeElement(t, e, s)) }, processCommon: function (t, e, s, a) { e.opacity = s.globalAlpha, "fill" == t ? this.setFill(e, s) : this.setStroke(e, s), this.processTransforms(e, a), this.processFilters(e, s) }, setFill: function (t, e) { if (/^rgba\(/.test(e.fillStyle)) { var s = /^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(e.fillStyle); t.fill = "rgb(" + s[1] + "," + s[2] + "," + s[3] + ")", t["fill-opacity"] = s[4] } else t.fill = e.fillStyle; t.stroke = "none" }, setStroke: function (t, e) { if (t.fill = "none", /^rgba\(/.test(e.strokeStyle)) { var s = /^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(e.strokeStyle); t.stroke = "rgb(" + s[1] + "," + s[2] + "," + s[3] + ")", t["stroke-opacity"] = s[4] } else t.stroke = e.strokeStyle; t.stroke = e.strokeStyle, t["stroke-width"] = e.lineWidth, t["stroke-linecap"] = e.lineCap, t["stroke-linejoin"] = e.lineJoin, t["stroke-miterlimit"] = e.miterLimit }, addRect: function (t, e, s, a) { var i = { x: s[0], y: s[1], width: s[2], height: s[3] }; this.processCommon(t, i, e, a), this.addElement("rect", i) }, addPath: function (t, e, s, a) { var i = { d: this.buildPath(s) }; this.processCommon(t, i, e, a), this.addElement("path", i) }, addText: function (t, e, s, a) { var i = { x: s[1], y: s[2], style: "font: " + e.font, "text-align": e.textAlign, "alignment-baseline": e.textBaseline }; this.processCommon(t, i, e, a), this.addElement("text", i, s[0]) }, buildPath: function (t) { for (var e = [], s = 0; s < t.length; s++) { var a = Array.prototype.slice.call(t[s]), i = [a.shift()]; if ("A" == i[0]) i.push(a.shift() + "," + a.shift(), a.shift(), a.shift() + "," + a.shift(), a.shift() + "," + a.shift()); else for (; a.length;)i.push(a.shift() + "," + a.shift()); e.push(i.join(" ")) } return e.join(" ") }, processTransforms: function (t, e) { e.length && (t.transform = e.join(" ")) }, processFilters: function (t, e) { if (0 != e.shadowOffsetX || 0 != e.shadowOffsetY || "source-over" != e.globalCompositeOperation) { var s, a = this.newID("fe"), i = this.makeElement("filter", { id: a, width: "150%", height: "150%" }, null, this.svg); if (0 == e.shadowOffsetX && 0 == e.shadowOffsetY || (this.makeElement("feOffset", { in: "SourceGraphic", result: "offsetOut", dx: e.shadowOffsetX, dy: e.shadowOffsetY }, null, i), this.makeElement("feGaussianBlur", { in: "offsetOut", result: "blurOut", stdDeviation: e.shadowBlur }, null, i), s = this.makeElement("feBlend", { in: "SourceGraphic", in2: "blurOut", mode: "normal" }, null, i)), "source-over" != e.globalCompositeOperation) { var r = e.globalCompositeOperation; if ("copy" != r && "lighter" != r) { t = {}; 0 == r.indexOf("source-") || "xor" == r ? (t.in = "SourceGraphic", t.in2 = "BackgroundImage") : 0 == r.indexOf("destination-") && (t.in = "BackgroundImage", t.in2 = "SourceGraphic"), /-in$/.test(r) ? t.operator = "in" : /-out$/.test(r) ? t.operator = "out" : /-atop$/.test(r) ? t.operator = "atop" : /-over$/.test(r) ? t.operator = "over" : "xor" == r && (t.operator = "xor"), this.svg.setAttributeNS(null, "enable-background", "accumulate"); var n = this.makeElement("feComposite", t, null, i); s && (s.setAttributeNS(null, "result", "blendOut"), n.setAttributeNS(null, "in", "blendOut")) } } t.filter = "url(#" + a + ")" } }, doClearRect: function (t) { if (0 != t[0] || 0 != t[1] || t[2] != this.el.width || t[3] != this.el.height) { var e = t[0], s = t[1], a = t[2], i = t[3], r = this.el.width, n = this.el.height, o = this.newID("cp"), h = this.makeElement("clipPath", { id: o }), l = "M 0,0 L " + r + ",0 L" + r + "," + n + " L 0," + n + " z M " + e + "," + s + " L " + (e + a) + "," + s + " L " + (e + a) + "," + (s + i) + " L " + e + "," + (s + i) + " z", c = this.makeElement("path", { d: l, "fill-rule": "evenodd" }); h.appendChild(c); for (var p = this.makeElement("g", { "clip-path": "url(#" + o + ")" }); this.svg.childNodes.length;)p.appendChild(this.svg.firstChild); this.svg.appendChild(h), this.svg.appendChild(p) } else this.svg.textContent = "" }, simpleClone: function (t) { var e = {}; for (var s in t) e[s] = t[s]; return e }, newID: function (t) { return this.id++, t + this.id }, handleCommands: function (t, e) { switch (t) { case "fillStyle": case "strokeStyle": case "globalAlpha": case "globalCompositeOperation": case "lineWidth": case "lineCap": case "lineJoin": case "miterLimit": case "shadowOffsetX": case "shadowOffsetY": case "shadowBlur": case "shadowColor": case "font": case "textAlign": case "textBaseline": this.cur[t] = e; break; case "save": this.stack.push(this.cur, this.trans), this.cur = this.simpleClone(this.defs), this.trans = []; break; case "restore": this.trans = this.stack.pop(), this.cur = this.stack.pop(); break; case "fillRect": this.addRect("fill", this.cur, e, this.trans); break; case "strokeRect": this.addRect("stroke", this.cur, e, this.trans); break; case "scale": this.trans.push("scale(" + e[0] + ", " + e[1] + ")"); break; case "rotate": var s = 180 * e[0] / Math.PI; this.trans.push("rotate(" + s + ")"); break; case "translate": this.trans.push("translate(" + e[0] + ", " + e[1] + ")"); break; case "setTransform": this.trans = []; case "transform": this.trans.push("matrix(" + e[0] + ", " + e[1] + ", " + e[2] + ", " + e[3] + ", " + e[4] + ", " + e[5] + ")"); break; case "createLinearGradient": case "createRadialGradient": case "createPattern": break; case "clearRect": this.doClearRect(e); break; case "beginPath": this.path = []; break; case "closePath": this.path.push(["z"]); break; case "moveTo": this.path.push(["M", e[0], e[1]]); break; case "lineTo": this.path.push(["L", e[0], e[1]]); break; case "quadraticCurveTo": this.path.push(["Q", e[0], e[1], e[2], e[3]]); break; case "bezierCurveTo": this.path.push(["S", e[0], e[1], e[2], e[3]]); break; case "arcTo": break; case "rect": var a = e[0], i = e[1], r = e[2], n = e[3]; this.path.push(["M", a, i], ["L", a + r, i], ["L", a + r, i + n], ["L", a, i + n], ["z"]); break; case "arc": this.pushArcAsA(e[0], e[1], e[2], e[3], e[4], e[5]); break; case "fill": this.addPath("fill", this.cur, this.path, this.trans); break; case "stroke": this.addPath("stroke", this.cur, this.path, this.trans); break; case "clip": break; case "fillText": this.addText("fill", this.cur, this.prm, this.trans); break; case "strokeText": this.addText("stroke", this.cur, this.prm, this.trans); break; case "drawImage": case "createImageData": case "getImageData": case "putImageData": break; case "isPointInPath": case "measureText": break; default: alert("Unknown command: " + t) } }, pushArcAsA: function (t, e, s, a, i, r) { var n = Math.abs(a - i); if (a != i) { var o = t + s * Math.cos(i), h = e + s * Math.sin(i); if (n >= 2 * Math.PI) return this.pushArcAsA(t, e, s, a, a + Math.PI, r), this.pushArcAsA(t, e, s, a + Math.PI, a + 2 * Math.PI, r), void this.path.push(["M", o, h]); var l = t + s * Math.cos(a), c = e + s * Math.sin(a), p = 180 * n / Math.PI, f = r ? 0 : 1, u = p >= 180 == Boolean(r) ? 0 : 1; 0 != this.path.length ? this.path.push(["L", l, c]) : this.path.push(["M", l, c]), this.path.push(["A", s, s, p, u, f, o, h]) } } }, CanvasSVG.Deferred = function () { this.state = [] }, CanvasSVG.Base.prototype) CanvasSVG.Deferred.prototype[k] = CanvasSVG.Base.prototype[k]; for (var k in CanvasSVG.Deferred.prototype.getSVG = function () { this.defs = { fillStyle: "#000", strokeStyle: "#000", globalAlpha: 1, globalCompositeOperation: "source-over", lineWidth: 1, lineCap: "butt", lineJoin: "miter", miterLimit: 10, shadowOffsetX: 0, shadowOffsetY: 0, shadowBlur: 0, shadowColor: "rgba(0,0,0,0)", font: "10px sans-serif", textAlign: "start", textBaseline: "alphabetic" }, this.cur = this.simpleClone(this.defs), this.stack = [], this.path = [], this.trans = [], this.svg = this.makeElement("svg", { width: this.el.width + "px", height: this.el.height + "px", viewBox: "0 0 " + this.el.width + " " + this.el.height }); for (var t = 0; t < this.state.length; t++) { var e = this.state[t].type, s = this.state[t].value; this.handleCommands(e, s) } return this.svg }, CanvasSVG.Deferred.prototype.pushState = function (t, e) { this.state.push({ type: t, value: e }) }, CanvasSVG.Live = function () { this.stack = [], this.cur = this.simpleClone(this.defs), this.stack = [], this.path = [], this.trans = [] }, CanvasSVG.Base.prototype) CanvasSVG.Live.prototype[k] = CanvasSVG.Base.prototype[k]; CanvasSVG.Live.prototype.defs = { fillStyle: "#000", strokeStyle: "#000", globalAlpha: 1, globalCompositeOperation: "source-over", lineWidth: 1, lineCap: "butt", lineJoin: "miter", miterLimit: 10, shadowOffsetX: 0, shadowOffsetY: 0, shadowBlur: 0, shadowColor: "rgba(0,0,0,0)", font: "10px sans-serif", textAlign: "start", textBaseline: "alphabetic" }, CanvasSVG.Live.prototype.setParent = function (t) { this.svg = this.makeElement("svg", { width: this.el.width + "px", height: this.el.height + "px", viewBox: "0 0 " + this.el.width + " " + this.el.height }), t.appendChild(this.svg) }, CanvasSVG.Live.prototype.runCommand = function (t, e) { this.handleCommands(t, e) }, ["fillStyle", "strokeStyle", "globalAlpha", "globalCompositeOperation", "lineWidth", "lineCap", "lineJoin", "miterLimit", "shadowOffsetX", "shadowOffsetY", "shadowBlur", "shadowColor", "font", "textAlign", "textBaseline"].forEach((function (t) { var e = t; CanvasSVG.Deferred.prototype.__defineGetter__(e, (function () { return this.context[e] })), CanvasSVG.Deferred.prototype.__defineSetter__(e, (function (t) { return this.pushState(e, t), this.context[e] = t, t })), CanvasSVG.Live.prototype.__defineGetter__(e, (function () { return this.context[e] })), CanvasSVG.Live.prototype.__defineSetter__(e, (function (t) { return this.cur[e] = t, this.context[e] = t, t })) })), ["fillRect", "strokeRect", "save", "restore", "scale", "rotate", "translate", "setTransform", "transform", "createLinearGradient", "createRadialGradient", "createPattern", "clearRect", "beginPath", "closePath", "moveTo", "lineTo", "quadraticCurveTo", "bezierCurveTo", "arcTo", "rect", "arc", "fill", "stroke", "clip", "isPointInPath", "fillText", "strokeText", "measureText", "drawImage", "createImageData", "getImageData", "putImageData"].forEach((function (t) { var e = t; CanvasSVG.Deferred.prototype[e] = function () { return this.pushState(e, Array.prototype.slice.call(arguments)), this.context[e].apply(this.context, arguments) }, CanvasSVG.Live.prototype[e] = function () { return this.runCommand(e, Array.prototype.slice.call(arguments)), this.context[e].apply(this.context, arguments) } }));
!function (t) { var e = { angle: 0, speed: 0, inertia: 0, minimalSpeed: .001, minimalAngleChange: .1, step: 0, stepTransitionTime: 0, stepTransitionEasing: "linear", rotateParentInstantly: !1, touchElement: null }, i = function (t, e) { if ("string" == typeof t && (t = document.querySelectorAll(t)), t.length > 1) return i.createMany(t, e); 1 === t.length && (t = t[0]), this.element = t, this.active = !1, this.transiting = !1, this.update = this.update.bind(this), this.initCSSPrefix(), this.initAngleGetterSetter(), this.initOptions(e), this.initHardwareAcceleration(), this.initTransition(), this.bindHandlers(), this.addListeners(), this.update() }; i.createMany = function (t, e) { for (var n = [], s = 0; s < t.length; s++)n.push(new i(t[s], e)); return n }; var n = i.prototype; n.initAngleGetterSetter = function () { Object.defineProperty(this, "angle", { get: function () { return this._angle }, set: function (t) { this._angle = t, this.virtualAngle = t, this.updateCSS() } }) }, n.bindHandlers = function () { this.onRotationStart = this.onRotationStart.bind(this), this.onRotationStop = this.onRotationStop.bind(this), this.onRotated = this.onRotated.bind(this) }, n.addListeners = function () { this.listenersInstalled = !0, "ontouchstart" in document.documentElement ? (window.addEventListener("touchend", this.onRotationStop), window.addEventListener("touchcancel", this.onRotationStop), window.addEventListener("touchmove", this.onRotated), this.touchElement.addEventListener("touchstart", this.onRotationStart), this.touchElement.addEventListener("touchmove", this.onRotated), this.touchElement.addEventListener("touchend", this.onRotationStop), this.touchElement.addEventListener("touchcancel", this.onRotationStop), this.touchElement.addEventListener("dragstart", this.returnFalse)) : (window.addEventListener("mouseup", this.onRotationStop), window.addEventListener("mousemove", this.onRotated), this.touchElement.addEventListener("mousedown", this.onRotationStart), this.touchElement.addEventListener("mousemove", this.onRotated), this.touchElement.addEventListener("mouseup", this.onRotationStop), this.touchElement.addEventListener("dragstart", this.returnFalse)), this.touchElement.ondragstart = this.returnFalse }, n.removeListeners = function () { this.listenersInstalled = !1, "ontouchstart" in document.documentElement ? (this.touchElement.removeEventListener("touchstart", this.onRotationStart), this.touchElement.removeEventListener("touchmove", this.onRotated), this.touchElement.removeEventListener("touchend", this.onRotationStop), this.touchElement.removeEventListener("dragstart", this.returnFalse)) : (this.touchElement.removeEventListener("mousedown", this.onRotationStart), this.touchElement.removeEventListener("mousemove", this.onRotated), this.touchElement.removeEventListener("mouseup", this.onRotationStop), this.touchElement.removeEventListener("dragstart", this.returnFalse)) }, n.bind = function () { !0 !== this.listenersInstalled && this.addListeners() }, n.unbind = function () { !0 === this.listenersInstalled && (this.removeListeners(), this.onRotationStop()) }, n.stop = function () { this.speed = 0, this.onRotationStop() }, n.onRotationStart = function (t) { this.initDrag(), this.active = !0, void 0 !== this.onDragStart && this.onDragStart(), !1 === this.rotateParentInstantly && t.stopPropagation() }, n.onRotationStop = function () { void 0 !== this.onDragStop && !0 === this.active && this.onDragStop(), this.active = !1 }, n.onRotated = function (t) { !0 === this.active && (t.stopPropagation(), t.preventDefault(), void 0 !== t.targetTouches && void 0 !== t.targetTouches[0] ? this.lastMouseEvent = { x: t.targetTouches[0].clientX, y: t.targetTouches[0].clientY } : this.lastMouseEvent = { x: t.clientX, y: t.clientY }) }, n.update = function () { void 0 !== this.lastMouseEvent && !0 === this.active && this.updateAngleToMouse(this.lastMouseEvent), this.updateAngle(), this.applySpeed(), this.applyInertia(), Math.abs(this.lastAppliedAngle - this._angle) >= this.minimalAngleChange && !1 === this.transiting && (this.updateCSS(), this.blockTransition(), void 0 !== this.onRotate && "function" == typeof this.onRotate && this.onRotate.bind(this)(), this.lastAppliedAngle = this._angle), window.requestAnimFrame(this.update) }, n.updateAngle = function () { this.step > 0 ? this._angle = this.getAngleFromVirtual() : this._angle = this.normalizeAngle(this.virtualAngle) }, n.getAngleFromVirtual = function () { return Math.ceil(this.virtualAngle / this.step) * this.step }, n.normalizeAngle = function (t) { var e = t; return (e %= 360) < 0 && (e = 360 + e), e }, n.differenceBetweenAngles = function (t, e) { var i = t * (Math.PI / 180), n = e * (Math.PI / 180), s = Math.atan2(Math.sin(i - n), Math.cos(i - n)) * (180 / Math.PI); return Math.round(100 * s) / 100 }, n.applySpeed = function () { this.inertia > 0 && 0 !== this.speed && !1 === this.active && (this.virtualAngle += this.speed) }, n.applyInertia = function () { this.inertia > 0 && (Math.abs(this.speed) >= this.minimalSpeed ? (this.speed = this.speed * this.inertia, !1 === this.active && Math.abs(this.speed) < this.minimalSpeed && void 0 !== this.onStop && this.onStop()) : 0 !== this.speed && (this.speed = 0)) }, n.updateAngleToMouse = function (t) { var n = this.element.getBoundingClientRect(), s = n.left + n.width / 2, o = n.top + n.height / 2, a = (Math.atan2(t.y - o, t.x - s) + Math.PI) * i.radToDegMulti; if (void 0 === this.lastMouseAngle && (this.lastElementAngle = this.virtualAngle, this.lastMouseAngle = a), this.stepTransitionTime !== e.stepTransitionTime) this.speed = this.mouseDiff = this.differenceBetweenAngles(a, this.lastMouseAngle), this.virtualAngle = this.lastElementAngle + this.mouseDiff, this.lastElementAngle = this.virtualAngle, this.lastMouseAngle = a; else { var r = this.virtualAngle; this.mouseDiff = a - this.lastMouseAngle, this.virtualAngle = this.lastElementAngle + this.mouseDiff; var h = this.virtualAngle; this.speed = this.differenceBetweenAngles(h, r) } }, n.initDrag = function () { this.speed = 0, this.lastMouseAngle = void 0, this.lastElementAngle = void 0, this.lastMouseEvent = void 0 }, n.initOptions = function (t) { t = t || e, this.touchElement = document.querySelectorAll(t.touchElement)[0] || this.element, this.onRotate = t.onRotate || t.onrotate, this.onStop = t.onStop || t.onstop, this.onDragStop = t.onDragStop || t.ondragstop, this.onDragStart = t.onDragStart || t.ondragstart, this.step = t.step || e.step, this.stepTransitionTime = t.stepTransitionTime || e.stepTransitionTime, this.stepTransitionEasing = t.stepTransitionEasing || e.stepTransitionEasing, this.angle = t.angle || e.angle, this.speed = t.speed || e.speed, this.inertia = t.inertia || e.inertia, this.minimalSpeed = t.minimalSpeed || e.minimalSpeed, this.lastAppliedAngle = this.virtualAngle = this._angle = t.angle || e.angle, this.minimalAngleChange = this.step !== e.step ? this.step : e.minimalAngleChange, this.rotateParentInstantly = t.rotateParentInstantly || e.rotateParentInstantly }, n.initCSSPrefix = function () { void 0 === i.cssPrefix && (void 0 !== document.body.style.transform ? i.cssPrefix = "" : void 0 !== document.body.style.mozTransform ? i.cssPrefix = "-moz-" : void 0 !== document.body.style.webkitTransform ? i.cssPrefix = "-webkit-" : void 0 !== document.body.style.msTransform && (i.cssPrefix = "-ms-")) }, n.initHardwareAcceleration = function () { this.accelerationPostfix = ""; var t, e = document.createElement("p"), n = { webkitTransform: "-webkit-transform", OTransform: "-o-transform", msTransform: "-ms-transform", MozTransform: "-moz-transform", transform: "transform" }; for (var s in document.body.insertBefore(e, null), n) void 0 !== e.style[s] && (e.style[s] = "translate3d(1px,1px,1px)", t = window.getComputedStyle(e).getPropertyValue(n[s])); document.body.removeChild(e), !0 === (void 0 !== t && t.length > 0 && "none" !== t) && (this.accelerationPostfix = "translateZ(0)", this.element.style[i.cssPrefix + "transform"] = this.accelerationPostfix, this.updateCSS()) }, n.initTransition = function () { if (this.stepTransitionTime !== e.stepTransitionTime) { var t = "all " + this.stepTransitionTime + "ms " + this.stepTransitionEasing; this.element.style[i.cssPrefix + "transition"] = t } }, n.updateCSS = function () { this.element.style[i.cssPrefix + "transform"] = "rotate(" + this._angle + "deg) " + this.accelerationPostfix }, n.blockTransition = function () { if (this.stepTransitionTime !== e.stepTransitionTime) { var t = this; setTimeout((function () { t.transiting = !1 }), this.stepTransitionTime), this.transiting = !0 } }, n.returnFalse = function () { return !1 }, void 0 !== t.$ && ($.Rotate = {}, $.Rotate.Rotates = [], $.fn.rotate = function (t) { return this.each((function () { if (!$.data(this, "plugin_rotate")) { var e = new i(this, t); $.data(this, "plugin_rotate", e), $.Rotate.Rotates.push(e) } })) }), i.deg2radians = 2 * Math.PI / 360, i.radToDegMulti = 57.29577951308232, t.Rotate = i }(window), window.requestAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (t) { window.setTimeout(t, 1e3 / 60) };
var MIR = function () { "use strict"; var t = { is_object: function (t) { return t === Object(t) }, is_string: function (t) { return "string" == typeof t }, is_function: function (t) { return "function" == typeof t }, is_nr: function (t) { return "number" == typeof t }, is_guid: function (t) { return this.is_string(t) && 36 === t.length && /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(t) }, is_defined: function (t) { return void 0 !== t }, is_array: function (t) { return Array.isArray(t) } }, e = function (e, n, i) { var r = this, o = !1, a = function (e) { return t.is_string(e) ? o = function (t) { t.setRequestHeader("mir-auth-token", e) } : t.is_function(e) && (r._authorize = e), r }; a(i); var s = function (e, n, i) { var r = { data: e }; return Object.keys(i.headers_to_get).forEach((function (t) { r[i.headers_to_get[t]] = n.getResponseHeader(t) })), i.headers_to_get["x-total-count"] && (r.total_count = parseInt(r.total_count)), t.is_defined(i.xhr) && (r.xhr = n), r }; return { set_auth: a, ajax: function (i, a, l) { var c = { dataType: "json", async: !0, beforeSend: function (t) { o && o(t) } }, u = $.param(a.query_params, !0); return c.url = e + "/" + n + i + "?" + u, t.is_function(l) ? (c = $.extend(c, { success: function (t, e, n) { l(s(t, n, a.response_process_options)) }, error: function (t) { l(s(t.responseJSON, t, a.response_process_options)) } }, a.ajax_options), $.ajax(c), r) : new Promise((function (t, e) { c = $.extend(c, { success: function (e, n, i) { t(s(e, i, a.response_process_options)) }, error: function (t) { e(s(t.responseJSON, t, a.response_process_options)) } }, a.ajax_options), $.ajax(c) })) } } }, n = function (e, n, i) { var r = { type: e, data: i || {} }, o = { only_data: !0 }, a = { headers_to_get: {} }; return t.is_defined(n) && (t.is_defined(n.limit) && (o.limit = n.limit), t.is_defined(n.offset) && (o.offset = n.offset), t.is_defined(n.only_data) && (o.only_data = n.only_data), t.is_defined(n.whitelist) && (o.whitelist = t.is_array(n.whitelist) ? n.whitelist.join(",") : n.whitelist), t.is_defined(n.sort_by) && (o.sort_by = n.sort_by), t.is_defined(n.allowed_methods) && (t.is_defined(o.whitelist) ? o.whitelist += ",allowed_methods" : o.whitelist = "allowed_methods", o.only_data = !1), t.is_defined(n.total_count) && (a.headers_to_get["x-total-count"] = "total_count"), t.is_defined(n.robot_version) && (a.headers_to_get["robot-version"] = "robot_version"), t.is_defined(n.api_version) && (a.headers_to_get["api-version"] = "api_version"), t.is_defined(n.endpoint_methods) && (a.headers_to_get.allow = "endpoint_methods"), t.is_defined(n.xhr) && (a.xhr = n.xhr)), "GET" !== e && (r.data = JSON.stringify(r.data), r.contentType = "application/json"), { ajax_options: r, query_params: o, response_process_options: a } }, i = function (t) { var i = new e(t.base_url, t.version, t.auth); return { set_auth: function (t) { return i.set_auth(t), this }, get: function (t, e, r) { var o = new n("GET", e); return i.ajax.apply(i, [t, o, r]) }, post: function (t, e, r, o) { var a = new n("POST", r, e); return i.ajax.apply(i, [t, a, o]) }, delete: function (t, e, r) { var o = new n("DELETE", e); return i.ajax.apply(i, [t, o, r]) }, put: function (t, e, r, o) { var a = new n("PUT", r, e); return i.ajax.apply(i, [t, a, o]) }, search: function (t, e, r, o) { var a = new n("POST", r, { filters: e }); return i.ajax.apply(i, [t + "/search", a, o]) } } }, r = function (e) { var n = {}; return { call: function (r) { if (!t.is_defined(n[r])) { if (!t.is_defined(e[r])) throw new Error("Non existent API"); n[r] = new i(e[r]) } return n[r] } } }, o = { MIR100: "MIR100", MIR200: "MIR200", MIR250: "MIR250", MIR500: "MIR500", MIR1000: "MIR1000", MIR600: "MIR600", MIR1350: "MIR1350", FLEET: "FLEET", HOOK: "HOOK" }, a = [o.MIR100, o.MIR200, o.MIR250, o.MIR500, o.MIR1000], s = [o.MIR100, o.MIR200, o.MIR250], l = { "MIR100-200": "MIR100-200", MIR250: "MIR250", "MIR500-1000": "MIR500-1000", "MIR600-1350": "MIR600-1350" }, c = {}; c[o.MIR100] = l["MIR100-200"], c[o.MIR200] = l["MIR100-200"], c[o.MIR250] = l.MIR250, c[o.MIR500] = l["MIR500-1000"], c[o.MIR1000] = l["MIR500-1000"], c[o.MIR600] = l["MIR600-1350"], c[o.MIR1350] = l["MIR600-1350"]; var u = { "MIR100-200": "MIR100-200", "MIR100-200+HOOK": "MIR100-200+HOOK", MIR250: "MIR250", "MIR250+HOOK": "MIR250+HOOK", "MIR500-1000": "MIR500-1000", "MIR600-1350": "MIR600-1350" }, p = {}; p[u["MIR100-200"]] = { length: .89, width: .58, height: .352 }, p[u["MIR100-200+HOOK"]] = { length: .89, width: .58, height: .352 }, p[u.MIR250] = { length: .82, width: .6, height: .352 }, p[u["MIR250+HOOK"]] = { length: .89, width: .58, height: .352 }, p[u["MIR500-1000"]] = { length: 1.35, width: .92, height: .32 }, p[u["MIR600-1350"]] = { length: 1.35, width: .92, height: .32 }; var d = {}; d[u["MIR100-200"]] = { length: 3.5, width: 3, height: 1.8 }, d[u["MIR100-200+HOOK"]] = { length: 3.5, width: 3, height: 1.8 }, d[u.MIR250] = { length: 3, width: 3, height: 1.8 }, d[u["MIR250+HOOK"]] = { length: 3, width: 3, height: 1.8 }, d[u["MIR500-1000"]] = { length: 3.5, width: 3, height: 1.8 }, d[u["MIR600-1350"]] = { length: 3.5, width: 3, height: 1.8 }; var _ = {}; _[u["MIR100-200"]] = { height: .4, length: p[u["MIR100-200"]].length, width: p[u["MIR100-200"]].width }, _[u["MIR100-200+HOOK"]] = { height: .7, length: p[u["MIR100-200+HOOK"]].length, width: p[u["MIR100-200+HOOK"]].width }, _[u.MIR250] = { height: .4, length: p[u.MIR250].length, width: p[u.MIR250].width }, _[u["MIR250+HOOK"]] = { height: .7, length: p[u["MIR250+HOOK"]].length, width: p[u["MIR250+HOOK"]].width }, _[u["MIR500-1000"]] = { height: .5, length: p[u["MIR500-1000"]].length, width: p[u["MIR500-1000"]].width }, _[u["MIR600-1350"]] = { height: .5, length: p[u["MIR600-1350"]].length, width: p[u["MIR600-1350"]].width }; var f = {}; f[u["MIR100-200"]] = [[-.454, .32], [.506, .32], [.506, -.32], [-.454, -.32]], f[u["MIR100-200+HOOK"]] = [[.506, -.32], [.506, .32], [-.454, .32], [-.774, .15], [-.774, -.15], [-.454, -.32]], f[u.MIR250] = [[.54, -.38], [.54, .38], [-.54, .38], [-.54, -.38]], f[u["MIR250+HOOK"]] = [[.54, -.38], [.54, .38], [-.54, .38], [-.774, .15], [-.774, -.15], [-.54, -.38]], f[u["MIR500-1000"]] = [[.75, -.75], [1.05, -.5], [1.05, .5], [.75, .75], [-.75, .75], [-1.05, .5], [-1.05, -.5], [-.75, -.75]], f[u["MIR600-1350"]] = [[.75, -.85], [1.05, -.6], [1.05, .6], [.75, .85], [-.75, .85], [-1.05, .6], [-1.05, -.6], [-.75, -.85]]; var h = { PRODUCT: o, ROBOTS: a, HOOK_ROBOTS: s, CONFIG_IDS: l, ROBOT_CONFIGS_IDS: c, FOOTPRINT_CONFIG_IDS: u, PRODUCT_SIZES: p, MAX_FOOTPRINT: d, MIN_FOOTPRINT: _, DEFAULT_FOOTPRINT: f }, m = { a: "[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇŽÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]", b: "[bâ¢Î²Î’Bà¸¿ðŒá›’]", c: "[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]", d: "[dÄŽÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸Žá¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]", e: "[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]", f: "[fÆ‘Æ’á¸žá¸Ÿ]", g: "[gÉ¢â‚²Ç¤Ç¥ÄœÄÄžÄŸÄ¢Ä£Æ“É Ä Ä¡]", h: "[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]", i: "[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃŽÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]", j: "[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]", k: "[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]", l: "[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]", n: "[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æžáµ°á¶‡É³ÈµÉ´ï¼®ï½ŽÅŠÅ‹]", o: "[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅŽÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»Žá»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]", p: "[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]", q: "[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]", r: "[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]", s: "[sÅšÅ›á¹ á¹¡á¹¢á¹£êž¨êž©ÅœÅÅ Å¡ÅžÅŸÈ˜È™SÌˆsÌˆ]", t: "[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]", u: "[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]", v: "[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êžêŸâ±±Ê‹]", w: "[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]", x: "[xáºŒáºáºŠáº‹Ï‡]", y: "[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºŽáºá»´á»µÉŽÉÆ³Æ´]", z: "[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]" }, v = { ROBOT_POSITION: 0, CART_POSITION: 1, CART_PICKUP_POSITION: 2, CART_LEFT_ENTRY: 3, CART_RIGHT_ENTRY: 4, SHELF_POSITION: 5, SHELF_ENTRY_POSITION: 6, MIRCHARGE_100_200: 7, MIRCHARGE_100_200_ENTRY: 8, V_MARKER: 9, V_MARKER_ENTRY: 10, VL_MARKER: 11, VL_MARKER_ENTRY: 12, L_MARKER: 13, L_MARKER_ENTRY: 14, EMERGENCY_POSITION: 15, PRECISION_DOCKING: 16, PRECISION_DOCKING_ENTRY: 17, PALLETRACK: 18, PALLET_RACK_ENTRY_POSITION: 19, MIRCHARGE_500: 20, MIRCHARGE_500_ENTRY: 21, BAR_MARKER: 22, BAR_MARKER_ENTRY: 23, ELEVATOR_EXIT: 25, ELEVATOR_ENTRY: 26, STAGING_POSITION: 42 }, g = { ROBOT_STATE: { NONE: 0, STARTING: 1, SHUTTINGDOWN: 2, READY: 3, PAUSE: 4, EXECUTING: 5, ABORTED: 6, COMPLETED: 7, DOCKED: 8, DOCKING: 9, EMERGENCYSTOP: 10, MANUALCONTROL: 11, ERROR: 12 }, ROBOT_MODE: { NONE: 0, MAPPING: 3, MAPPING_FINALIZING: 4, MISSION: 7, CHANGING: 255 }, DIACRITICS: m, IO_DEVICE_TYPES: { BLUETOOTH: "bluetooth", WISE: "wise", INTERNAL: "internal" }, LASER_SCANNER_CALIBRATION: { IDLE: 0, START_CALIBRATION: 1, CALIBRATING_ALIGNING_CHECK: 2, CALIBRATING_ALIGNING_MOVE: 3, CALIBRATING_MOVE: 4, CALIBRATING_MEASURE: 5, CALIBRATING_WAIT: 6, CALIBRATION_SUCCESS: 7, CALIBRATION_FAILED: 8, ABORTING_CALIBRATION: 9 }, MOBILE_RES_THRESHOLD: 960, SOUND: { ACTION_PLAY: 0, ACTION_STOP_SOUNDS_OF_PRIORITY: 2, PRIORITY_USER: 2 }, JOYSTICK: { ENABLE_LOW_SPEED_MODE: 2, ENABLE_HIGH_SPEED_MODE: 3 }, MAPPING_ALGORITHM: { HECTOR: "mir_mapping_hector.launch", CARTOGRAPHER: "mir_mapping_cartographer.launch" }, SETTINGS: { MAPPING_ALGORITHM: "/launch/mapping/file" }, MARKER_TYPES: { MIRCHARGE_100_200: v.MIRCHARGE_100_200, V_MARKER: v.V_MARKER, VL_MARKER: v.VL_MARKER, L_MARKER: v.L_MARKER, PALLETRACK: v.PALLETRACK, MIRCHARGE_500: v.MIRCHARGE_500, BAR_MARKER: v.BAR_MARKER, PRECISION_DOCKING: v.PRECISION_DOCKING }, POSITION_TYPES: v, FEATURES: { PRECISION_DOCKING: "precision_docking", HOOK: "hook" } }, y = Object.assign({}, h, g); function b(t, e) { return t(e = { exports: {} }, e.exports), e.exports } var R = b((function (t, e) { var n; n = function () { function t() { for (var t = 0, e = {}; t < arguments.length; t++) { var n = arguments[t]; for (var i in n) e[i] = n[i] } return e } function e(t) { return t.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent) } return function n(i) { function r() { } function o(e, n, o) { if ("undefined" != typeof document) { "number" == typeof (o = t({ path: "/" }, r.defaults, o)).expires && (o.expires = new Date(1 * new Date + 864e5 * o.expires)), o.expires = o.expires ? o.expires.toUTCString() : ""; try { var a = JSON.stringify(n); /^[\{\[]/.test(a) && (n = a) } catch (t) { } n = i.write ? i.write(n, e) : encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent), e = encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent).replace(/[\(\)]/g, escape); var s = ""; for (var l in o) o[l] && (s += "; " + l, !0 !== o[l] && (s += "=" + o[l].split(";")[0])); return document.cookie = e + "=" + n + s } } function a(t, n) { if ("undefined" != typeof document) { for (var r = {}, o = document.cookie ? document.cookie.split("; ") : [], a = 0; a < o.length; a++) { var s = o[a].split("="), l = s.slice(1).join("="); n || '"' !== l.charAt(0) || (l = l.slice(1, -1)); try { var c = e(s[0]); if (l = (i.read || i)(l, c) || e(l), n) try { l = JSON.parse(l) } catch (t) { } if (r[c] = l, t === c) break } catch (t) { } } return t ? r[t] : r } } return r.set = o, r.get = function (t) { return a(t, !1) }, r.getJSON = function (t) { return a(t, !0) }, r.remove = function (e, n) { o(e, "", t(n, { expires: -1 })) }, r.defaults = {}, r.withConverter = n, r }((function () { })) }, t.exports = n() })), I = { debug: !1, apis: {} }; function w() { MIR.config.debug && console.log.apply(this, arguments) } var O = { check_point_in_circle: function (t, e, n) { return !(Math.abs(t.x - n.x) > e) && !(Math.abs(t.y - n.y) > e) }, check_polyline_area_intersect: function (t, e) { for (var n = 0; n < e.length - 1; n++) { var i = { x0: e[n].x, y0: e[n].y, x1: e[n + 1].x, y1: e[n + 1].y }; if (O.check_line_area_intersect(t, i)) return !0 } return !1 }, check_line_area_intersect: function (t, e) { return O.check_lines_intersect(t.top_left.x, t.top_left.y, t.bottom_right.x, t.top_left.y, e.x0, e.y0, e.x1, e.y1) || O.check_lines_intersect(t.bottom_right.x, t.top_left.y, t.bottom_right.x, t.bottom_right.y, e.x0, e.y0, e.x1, e.y1) || O.check_lines_intersect(t.top_left.x, t.bottom_right.y, t.bottom_right.x, t.bottom_right.y, e.x0, e.y0, e.x1, e.y1) || O.check_lines_intersect(t.top_left.x, t.top_left.y, t.top_left.x, t.bottom_right.y, e.x0, e.y0, e.x1, e.y1) }, check_lines_intersect: function (t, e, n, i, r, o, a, s) { function l(t, e, n, i, r, o) { return (t <= r || n <= r) && (r <= t || r <= n) && (e <= o || i <= o) && (o <= e || o <= i) } function c(t, e, n, i, r, o) { var a = (r - t) * (i - e), s = (n - t) * (o - e); return a < s ? -1 : a > s ? 1 : 0 } var u = c(r, o, a, s, t, e), p = c(r, o, a, s, n, i), d = c(t, e, n, i, r, o), _ = c(t, e, n, i, a, s); return (u > 0 && p < 0 || u < 0 && p > 0) && (d > 0 && _ < 0 || d < 0 && _ > 0) || 0 === u && l(r, o, a, s, t, e) || 0 === p && l(r, o, a, s, n, i) || 0 === d && l(t, e, n, i, r, o) || 0 === _ && l(t, e, n, i, a, s) }, check_rectangles_overlap: function (t, e) { return !(Math.max(t.top_left.x, e.top_left.x) > Math.min(t.bottom_right.x, e.bottom_right.x)) && !(Math.max(t.top_left.y, e.top_left.y) > Math.min(t.bottom_right.y, e.bottom_right.y)) }, check_point_in_shape: function (t, e) { var n, i, r = !1, o = e.length; for (n = 0, i = o - 1; n < o; i = n++)e[n].y > t.y != e[i].y > t.y && t.x < (e[i].x - e[n].x) * (t.y - e[n].y) / (e[i].y - e[n].y) + e[n].x && (r = !r); return r }, is_concave_polygon: function (t) { function e(t, e, n) { return (n.y - t.y) * (e.x - t.x) > (e.y - t.y) * (n.x - t.x) } var n = function t(n) { return n.length < 2 ? 0 : (i = n[0], r = n[1], ((o = n[2]).y - i.y) * (r.x - i.x) == (r.y - i.y) * (o.x - i.x) ? t(n.slice(1)) : e(n[0], n[1], n[2]) ? 1 : -1); var i, r, o }(t); if (0 === n) return !0; for (var i = 0; i < t.length; i++) { var r = i + 1 == t.length ? 0 : i + 1, o = r + 1 == t.length ? 0 : r + 1; if (1 === n && !e(t[i], t[r], t[o]) || -1 === n && e(t[i], t[r], t[o])) return !1 } return !0 } }; function E(t) { return (E = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (t) { return typeof t } : function (t) { return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t })(t) } function T(t, e) { if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function") } function x(t, e) { for (var n = 0; n < e.length; n++) { var i = e[n]; i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(t, i.key, i) } } function M(t, e, n) { return e && x(t.prototype, e), n && x(t, n), t } function S(t, e, n) { return e in t ? Object.defineProperty(t, e, { value: n, enumerable: !0, configurable: !0, writable: !0 }) : t[e] = n, t } function A(t) { return (A = Object.setPrototypeOf ? Object.getPrototypeOf : function (t) { return t.__proto__ || Object.getPrototypeOf(t) })(t) } function k(t, e) { return (k = Object.setPrototypeOf || function (t, e) { return t.__proto__ = e, t })(t, e) } function N(t, e) { return !e || "object" != typeof e && "function" != typeof e ? function (t) { if (void 0 === t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return t }(t) : e } function C(t, e) { return function (t) { if (Array.isArray(t)) return t }(t) || function (t, e) { if (!(Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t))) return; var n = [], i = !0, r = !1, o = void 0; try { for (var a, s = t[Symbol.iterator](); !(i = (a = s.next()).done) && (n.push(a.value), !e || n.length !== e); i = !0); } catch (t) { r = !0, o = t } finally { try { i || null == s.return || s.return() } finally { if (r) throw o } } return n }(t, e) || function () { throw new TypeError("Invalid attempt to destructure non-iterable instance") }() } function P(t) { return function (t) { if (Array.isArray(t)) { for (var e = 0, n = new Array(t.length); e < t.length; e++)n[e] = t[e]; return n } }(t) || function (t) { if (Symbol.iterator in Object(t) || "[object Arguments]" === Object.prototype.toString.call(t)) return Array.from(t) }(t) || function () { throw new TypeError("Invalid attempt to spread non-iterable instance") }() } var L = { processes: { BLUETOOTH: "bluetooth", CALIBRATION: "calibration", DOCKING: "docking", FLOOR_CAMERA: "floor_camera", LOCALISATION: "localisation", MAILER: "mailer", MAPPING: "mapping", MIR_BOARD_CONTROLLER: "MiR Board Controller", MIR_ENCODER_TEST: "MiR encoder test", MIR_MODBUS: "MiR Modbus", WISE: "wise", MISSION: "mission", MOTORCONTROLLER: "Motorcontroller", PLANNER: "planner", RELATIVEMOVE: "RelativeMove", ROSBAG_PLAYER: "Rosbag Player", ROSBRIDGE: "rosbridge", SENSORS: "sensors", SERIAL_INTERFACE: "Serial Interface", SERVICE: "service", SOUND: "sound", TOP_CAMERA: "top_camera", UR_INTERFACE: "UR Interface", WEBAPP: "webapp", WIFI_WATCHDOG: "Wifi Watchdog" } }, j = function (t) { function e(t) { var n; return T(this, e), (n = N(this, A(e).call(this, "/mirspawn/", "mirSpawn/", t))).constants = L, n } return function (t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), e && k(t, e) }(e, t), M(e, [{ key: "list", value: function (t) { var e = this.get_service("list", "LaunchList"); return this.call_service(e, {}, t) } }, { key: "list_available", value: function (t) { var e = this.get_service("list_available", "ListAvailable"); return this.call_service(e, {}, t) } }, { key: "list_loaded", value: function (t) { var e = this.get_service("list_loaded", "ListLoaded"); return this.call_service(e, {}, t) } }, { key: "start", value: function (t, e) { var n = this.get_service("start", "NodeAction"); return this.call_service(n, { launch_file_name: t }, e) } }, { key: "stop", value: function (t, e) { var n = this.get_service("stop", "NodeAction"); return this.call_service(n, { launch_file_name: t }, e) } }]), e }(function () { function t(e, n, i) { T(this, t), this.node = e, this.service_type_prefix = n, this.services = {}, this.ros = i } return M(t, [{ key: "get_service", value: function (t, e) { return void 0 === this.services[t] && (this.services[t] = new ROSLIB.Service({ ros: this.ros, name: this.node + t, serviceType: this.service_type_prefix + e })), this.services[t] } }, { key: "call_service", value: function (t, e, n) { return "function" == typeof n ? (t.callService(new ROSLIB.ServiceRequest(e), n, (function (t) { n(void 0, t) })), !0) : new Promise((function (n, i) { t.callService(new ROSLIB.ServiceRequest(e), n, i) })) } }]), t }()), D = { wise_service: null, wise_topic: null, busy_list: {}, error_list: {}, constants: { actions: { GET_STATUS: 0, GET_INPUT_STATE: 1, GET_OUTPUT_STATE: 2, SET_OUTPUT_STATE: 3, CONNECT: 4, DISCONNECT: 5, SEND_COMMAND: 6 }, status: { DONE: 0, ERROR: 1 } }, get_service: function () { return null === this.wise_service && (this.wise_service = new ROSLIB.Service({ ros: ros, name: "/wise_node/command", serviceType: "wise_node/command" })), this.wise_service }, get_topic: function () { return null === this.wise_topic && (this.wise_topic = new ROSLIB.Topic({ ros: ros, name: "/wise_node/status", messageType: "mirWise/WiseDevices", throttle_rate: 100 })), this.wise_topic }, clear_error: function (t) { this.error_list[t] = !1 }, call_service: function (t, e) { if (!e.queue && this.busy_list[t.guid]) return !1; if (this.error_list[t.guid]) return !1; this.busy_list[t.guid] = !0; var n = this, i = $.extend({ on_success: w.log, on_error: w.log }, e), r = function () { n.busy_list[t.guid] = !1, n.error_list[t.guid] = arguments[0], i.on_error.call(n, arguments) }; return this.get_service().callService(new ROSLIB.ServiceRequest(t), (function (e) { e.result ? function () { n.busy_list[t.guid] = !1, i.on_success.call(n, arguments) }(e) : r(e) }), r), !0 }, get_status: function (t, e) { var n = { action: this.constants.actions.GET_STATUS, guid: t }; this.call_service(n, e) }, connect: function (t, e) { var n = { action: this.constants.actions.CONNECT, guid: t }; this.call_service(n, e) }, disconnect: function (t, e) { var n = { action: this.constants.actions.DISCONNECT, guid: t }; this.call_service(n, e) }, get_input_state: function (t, e, n) { var i = { action: this.constants.actions.GET_INPUT_STATE, guid: t, channel: e }; this.call_service(i, n) }, set_output_state: function (t, e, n, i) { var r = { action: this.constants.actions.SET_OUTPUT_STATE, guid: t, channel: e, value: n }; return this.call_service(r, i) }, subscribe_status: function (t) { var e = "function" == typeof t ? t : w.log; return this.get_topic().subscribe(e) }, unsubscribe_status: function (t) { var e = "function" == typeof t ? t : w.log; return this.get_topic().unsubscribe(e) } }, G = { internal_service: null, internal_topic: null, busy_list: {}, error_list: {}, constants: { actions: { GET_STATUS: 0, GET_INPUT_STATE: 1, GET_OUTPUT_STATE: 2, SET_OUTPUT_STATE: 3 }, status: { DONE: 0, STARTING: 1, ERROR: 3 } }, get_service: function () { return null === this.internal_service && (this.internal_service = new ROSLIB.Service({ ros: ros, name: "/internal_ios/command", serviceType: "mir_srvs/InternalIOsCommand" })), this.internal_service }, get_topic: function () { return null === this.internal_topic && (this.internal_topic = new ROSLIB.Topic({ ros: ros, name: "/internal_ios/status", messageType: "mirMsgs/IOs", throttle_rate: 100 })), this.internal_topic }, clear_error: function (t) { this.error_list[t] = !1 }, call_service: function (t, e) { if (!e.queue && this.busy_list[t.guid]) return !1; if (this.error_list[t.guid]) return !1; this.busy_list[t.guid] = !0; var n = this, i = $.extend({ on_success: w.log, on_error: w.log }, e), r = function () { n.busy_list[t.guid] = !1, n.error_list[t.guid] = arguments[0], i.on_error.call(n, arguments) }; return this.get_service().callService(new ROSLIB.ServiceRequest(t), (function (e) { e.result ? function () { n.busy_list[t.guid] = !1, i.on_success.call(n, arguments) }(e) : r(e) }), r), !0 }, get_status: function (t, e) { var n = { action: this.constants.actions.GET_STATUS, guid: t }; this.call_service(n, e) }, set_output_state: function (t, e) { var n = { action: this.constants.actions.SET_OUTPUT_STATE, channel: t, value: !!e, timeout: 0 }; return this.call_service(n, {}) }, subscribe_status: function (t) { var e = "function" == typeof t ? t : w.log; return this.get_topic().subscribe(e) }, unsubscribe_status: function (t) { var e = "function" == typeof t ? t : w.log; return this.get_topic().unsubscribe(e) } }, K = { session_importer_topic: null, constants: { status: { READY: 0, BUSY: 1, ERROR: 2 } }, get_topic: function () { return null === this.session_importer_topic && (this.session_importer_topic = new ROSLIB.Topic({ ros: ros, name: "/session_importer_node/info", messageType: "mirSessionImporter/SessionImportInfo" })), this.session_importer_topic }, subscribe_info: function (t) { var e = "function" == typeof t ? t : w.log; return this.get_topic().subscribe(e) }, unsubscribe_info: function (t) { var e = "function" == typeof t ? t : w.log; return this.get_topic().unsubscribe(e) } }, U = { protocol: "https:" === window.location.protocol ? "wss://" : "ws://", port: "https:" === window.location.protocol ? "443" : "9090", socket_url: "https:" === window.location.protocol ? "wss://" + location.hostname + ":443/rosbridge/" : "ws://" + location.hostname + ":9090", nodes: { spawn: j, wise: D, internal: G, session_importer: K } }, B = { data: { name: "UI_STORAGE", path: window.location.pathname, debug: !1 }, debug: function () { this.data.debug = !0 }, haslocalStorage: function () { var t = "_TMP_SUPPORT_"; try { return localStorage.setItem(t, t), localStorage.removeItem(t), !0 } catch (t) { return this.data.debug && w(t), !1 } }, getPathKey: function () { var t = this.data.path; return this.all().findIndex((function (e) { return e.path == t })) }, getIdKey: function (t, e, n) { return t.findIndex((function (t) { return t.id == e && t.key == n })) }, get: function (t, e) { var n = this.getPathKey(); if (n >= 0) { var i = this.all(), r = (i = i[n].elements).findIndex((function (n) { return n.id == t && n.key == e })); if (r >= 0) return i[r].val } return null }, all: function () { var t = localStorage.getItem(this.data.name); return null != t ? JSON.parse(t) : (localStorage.setItem(this.data.name, JSON.stringify([])), this.all()) }, set: function (t, e, n) { if (!this.haslocalStorage() || "" == this.data.path || !t || !e || void 0 === n) return !1; try { var i = this.all(), r = this.getPathKey(), o = { id: t, key: e, val: n }; if (r >= 0 && i[r].elements) { var a = i[r].elements, s = this.getIdKey(a, t, e); s >= 0 ? a[s].val = n : a.push(o) } else { var l = { path: this.data.path, elements: [] }; l.elements.push(o), i.push(l) } localStorage.setItem(this.data.name, JSON.stringify(i)) } catch (t) { return this.data.debug && w(t), !1 } }, reset: function () { return localStorage.removeItem(this.data.name), !0 } }, F = mir_translate, H = function (t) { var e = $("<button></button>"); return e.mir = { options: $.extend({ label: "press", base_class: "mir-btn", attr: {}, events: {} }, t) }, e.attr(e.mir.options.attr).html(e.mir.options.label).addClass(e.mir.options.base_class), Object.keys(e.mir.options.events).forEach((function (t) { e.on(t, e.mir.options.events[t]) })), e }, q = { NULL_VALUE: "!!!nullvalue!!!", KEY_SPACE: 32, KEY_SHIFT: 16 }, Y = function (t) { var e = $('<input class="mir-field">'); return e.mir = { options: $.extend({ attr: { type: "text" } }, t) }, e.attr(e.mir.options.attr), e.val(e.mir.options.value || e.mir.options.def), e }, z = function (t) { var e = $('<label class="mir-field-nuller"><input type="checkbox">' + t.text + "</label>"); return e.mir = { options: $.extend({}, t) }, e.val = function () { return arguments.length > 0 ? (!0 == !!arguments[0] ? e.find("input").attr("checked", "checked") : e.find("input").removeAttr("checked"), e) : e.find("input").is(":checked") }, e.val(e.mir.options.value || e.mir.options.def), e }, V = function (t) { var e = $('<div class="mir-spinner"></div'); return e.mir = { options: $.extend({ def: 0 }, t), $button_up: $('<div class="mir-bg-duration-up"></div>'), $input: $('<input type="text">'), $button_down: $('<div class="mir-bg-duration-down"></div>'), $label: $('<div class="label">' + t.label + "</div>"), readonly: !1, pad_value: function (t) { var e = String(t); return this.options.size && e.length < this.options.size && (e = new Array(this.options.size - e.length + 1).join("0") + e), e } }, e.append(e.mir.$button_up, e.mir.$input, e.mir.$label, e.mir.$button_down), e.val = function () { var t = this.mir; if (arguments.length > 0) { var n = arguments[0]; return void 0 !== t.options.max && n > t.options.max && (n = t.options.min || t.options.def || 0), void 0 !== t.options.min && n < t.options.min && (n = t.options.max || t.options.def || 0), t.$input.val(t.pad_value(n)), e } return parseInt(t.$input.val()) }, e.mir.$button_up.on("click", (function (t) { if (e.mir.readonly) return t.stopPropagation(), !1; e.val(e.val() + 1).change() })), e.mir.$button_down.on("click", (function (t) { if (e.mir.readonly) return t.stopPropagation(), !1; e.val(e.val() - 1).change() })), e.mir.$input.on("change", (function (t) { if (e.mir.readonly) return t.stopPropagation(), !1; e.val(e.val()) })), e.val(e.mir.options.value || e.mir.options.def), e.disable = function () { this.mir.readonly = !0, this.mir.$input.attr("readonly", "readonly") }, e.enable = function () { this.mir.readonly = !1, this.mir.$input.removeAttr("readonly") }, e }, W = function (t) { var e = $('<div class="mir-duration-field-wrp"><div class="mir-duration-field"></div></div>'), n = $.extend({ type: "hidden" }, t.attr); return e.mir = { options: $.extend({ def: 0 }, t), $hours: V({ label: mir_translate("Hrs"), def: 0, min: 0, max: 24, size: 2 }), $mins: V({ label: mir_translate("Min"), def: 0, min: 0, max: 60, size: 2 }), $secs: V({ label: mir_translate("Sec"), def: 0, min: 0, max: 60, size: 2 }), $input: Y({ attr: n }), $null_field: z({ text: t.null_text }), null_state: !1, update_ui_state: function () { var t = this.$null_field.val(); t !== this.null_state && (t ? (this.$hours.val(0), this.$mins.val(0), this.$secs.val(0), this.$hours.disable(), this.$mins.disable(), this.$secs.disable(), e.find(".mir-duration-field").toggleClass("mir-disabled", !0)) : (this.$hours.enable(), this.$mins.enable(), this.$secs.enable(), e.toggleClass("mir-disabled", !1)), this.null_state = t) }, update_input: function () { this.$null_field.val() ? this.$input.val(q.NULL_VALUE) : (e.find(".mir-duration-field").toggleClass("mir-disabled", !1), this.$input.val(this.$hours.val() + ":" + this.$mins.val() + ":" + this.$secs.val() + ".000000")) } }, e.find(".mir-duration-field").append(e.mir.$input, e.mir.$hours, e.mir.$mins, e.mir.$secs), e.append(e.mir.$null_field), e.on("change", (function () { e.mir.update_ui_state(), e.mir.update_input() })), e.val = function () { var t = this.mir; if (arguments.length > 0) { if (null === arguments[0]) t.$null_field.val(!0); else { var n = arguments[0].split(":"); t.$hours.val(parseInt(n[0])), t.$mins.val(parseInt(n[1])), t.$secs.val(parseInt(n[2])), t.$null_field.val(!1) } return t.update_ui_state(), t.update_input(), e } return t.$input.val() }, e.val(e.mir.options.value || e.mir.options.def), e }, J = function (t) { var e = $('<div class="mir-error"></div>'); return e.mir = { options: $.extend(!0, { attr: {} }, t) }, e.attr(e.mir.options.attr), e.val = function () { return arguments.length > 0 ? (e.html(arguments[0]), e) : e.html() }, e }, X = function (t) { var e = $('<i class="mir-i"></i>'); return e.mir = { options: $.extend({ size: "", type: "" }, t) }, "" !== e.mir.options.type && e.addClass("mir-i-" + e.mir.options.type), "" !== e.mir.options.size && e.addClass("mir-i-" + e.mir.options.size), e }, Z = function (t) { var e = $('<label class="mir-label"></label>'); return e.mir = { options: $.extend({}, t) }, e.mir.options.attr && e.attr(e.mir.options.attr), e.mir.options.text && e.html(e.mir.options.text), e }; var Q = function (t) { var e = $('<select class="mir-field"></select>'), n = e.mir = { options: $.extend({ options: [] }, t), set_options: function (t) { var n = $.map(t, (function (t) { var e, n = $.extend({}, t.attributes, { value: t.value }); return "<option " + (e = n, $.map(e, (function (t, e) { return e + '="' + t + '"' })).join(" ")) + ">" + t.text + "</option>" })); e.html(n.join("")) } }; return n.set_options(n.options.options), n.options.attr && e.attr(n.options.attr), e.val(n.options.value || n.options.def), e }, tt = function (t) { var e = $('<div class="mir-tooltip tooltip ui-tooltip ui-widget ui-corner-all ui-widget-content"></div>'); return e.mir = { options: $.extend({}, t) }, e.mir.options.attr && e.attr(e.mir.options.attr), e.mir.options.text && e.html(e.mir.options.text), e }, et = { input: Y, select: Q, duration: W }, nt = function (t) { var e = $('<div class="mir-overlay"></div>'), n = e.mir = { options: $.extend({ parent: "body", on_click: function (e, i) { e.target === i[0] && t.overlay_remove_on_click && n.options.on_remove(i) }, on_scroll: function (t, e) { if (t.target === e[0]) return !1 }, on_remove: function (t) { t.remove() } }, t) }; return "object" == E(n.options.attributes) && $.each(n.options.attributes, (function (t, n) { e.attr(t, n) })), "string" == typeof n.options.parent && "body" === n.options.parent.toLowerCase() && e.css("position", "fixed"), e.appendTo(n.options.parent).on("click", (function (t) { return n.options.on_click(t, e) })).on("DOMMouseScroll.mir-overlay mousewheel.mir-overlay", (function (t) { return n.options.on_scroll(t, e) })), e.clear = n.clear = function () { n.options.on_remove(e) }, e }, it = { sprintf: b((function (t, e) { !function () { var t = { not_string: /[^s]/, not_bool: /[^t]/, not_type: /[^T]/, not_primitive: /[^v]/, number: /[diefg]/, numeric_arg: /[bcdiefguxX]/, json: /[j]/, not_json: /[^j]/, text: /^[^\x25]+/, modulo: /^\x25{2}/, placeholder: /^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/, key: /^([a-z_][a-z_\d]*)/i, key_access: /^\.([a-z_][a-z_\d]*)/i, index_access: /^\[(\d+)\]/, sign: /^[+-]/ }; function n(t) { return r(a(t), arguments) } function i(t, e) { return n.apply(null, [t].concat(e || [])) } function r(e, i) { var r, o, a, s, l, c, u, p, d, _ = 1, f = e.length, h = ""; for (o = 0; o < f; o++)if ("string" == typeof e[o]) h += e[o]; else if ("object" === E(e[o])) { if ((s = e[o]).keys) for (r = i[_], a = 0; a < s.keys.length; a++) { if (null == r) throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"', s.keys[a], s.keys[a - 1])); r = r[s.keys[a]] } else r = s.param_no ? i[s.param_no] : i[_++]; if (t.not_type.test(s.type) && t.not_primitive.test(s.type) && r instanceof Function && (r = r()), t.numeric_arg.test(s.type) && "number" != typeof r && isNaN(r)) throw new TypeError(n("[sprintf] expecting number but found %T", r)); switch (t.number.test(s.type) && (p = r >= 0), s.type) { case "b": r = parseInt(r, 10).toString(2); break; case "c": r = String.fromCharCode(parseInt(r, 10)); break; case "d": case "i": r = parseInt(r, 10); break; case "j": r = JSON.stringify(r, null, s.width ? parseInt(s.width) : 0); break; case "e": r = s.precision ? parseFloat(r).toExponential(s.precision) : parseFloat(r).toExponential(); break; case "f": r = s.precision ? parseFloat(r).toFixed(s.precision) : parseFloat(r); break; case "g": r = s.precision ? String(Number(r.toPrecision(s.precision))) : parseFloat(r); break; case "o": r = (parseInt(r, 10) >>> 0).toString(8); break; case "s": r = String(r), r = s.precision ? r.substring(0, s.precision) : r; break; case "t": r = String(!!r), r = s.precision ? r.substring(0, s.precision) : r; break; case "T": r = Object.prototype.toString.call(r).slice(8, -1).toLowerCase(), r = s.precision ? r.substring(0, s.precision) : r; break; case "u": r = parseInt(r, 10) >>> 0; break; case "v": r = r.valueOf(), r = s.precision ? r.substring(0, s.precision) : r; break; case "x": r = (parseInt(r, 10) >>> 0).toString(16); break; case "X": r = (parseInt(r, 10) >>> 0).toString(16).toUpperCase() }t.json.test(s.type) ? h += r : (!t.number.test(s.type) || p && !s.sign ? d = "" : (d = p ? "+" : "-", r = r.toString().replace(t.sign, "")), c = s.pad_char ? "0" === s.pad_char ? "0" : s.pad_char.charAt(1) : " ", u = s.width - (d + r).length, l = s.width && u > 0 ? c.repeat(u) : "", h += s.align ? d + r + l : "0" === c ? d + l + r : l + d + r) } return h } var o = Object.create(null); function a(e) { if (o[e]) return o[e]; for (var n, i = e, r = [], a = 0; i;) { if (null !== (n = t.text.exec(i))) r.push(n[0]); else if (null !== (n = t.modulo.exec(i))) r.push("%"); else { if (null === (n = t.placeholder.exec(i))) throw new SyntaxError("[sprintf] unexpected placeholder"); if (n[2]) { a |= 1; var s = [], l = n[2], c = []; if (null === (c = t.key.exec(l))) throw new SyntaxError("[sprintf] failed to parse named argument key"); for (s.push(c[1]); "" !== (l = l.substring(c[0].length));)if (null !== (c = t.key_access.exec(l))) s.push(c[1]); else { if (null === (c = t.index_access.exec(l))) throw new SyntaxError("[sprintf] failed to parse named argument key"); s.push(c[1]) } n[2] = s } else a |= 2; if (3 === a) throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported"); r.push({ placeholder: n[0], param_no: n[1], keys: n[2], sign: n[3], pad_char: n[4], align: n[5], width: n[6], precision: n[7], type: n[8] }) } i = i.substring(n[0].length) } return o[e] = r } e.sprintf = n, e.vsprintf = i, "undefined" != typeof window && (window.sprintf = n, window.vsprintf = i) }() })).sprintf, generate_id: function () { return Math.random().toString(36) }, is_mobile: function () { var t, e = !1; return t = navigator.userAgent || navigator.vendor || window.opera, /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t) && (e = !0), e }, is_small_screen: function () { return $(window).width() < 960 }, escape_regex: function (t) { return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") }, remove_diacritics: function (t) { var e, n, i, r, o = "", a = {}; for (i in m) if (m.hasOwnProperty(i)) for (o += r = m[i].substring(2, m[i].length - 1), e = 0, n = r.length; e < n; e++)a[r.charAt(e)] = i; var s = new RegExp("[" + o + "]", "g"); return t.replace(s, (function (t) { return a[t] })).toLowerCase() }, highlight_text: function (t, e, n, i, r) { return [t.substring(0, e), i || "<b>", t.substring(e, e + n), r || "</b>", t.substring(e + n)].join("") }, throttle: function (t, e) { var n = Date.now(); return function () { n + e - Date.now() < 0 && (t.apply(t, arguments), n = Date.now()) } }, hexToRgb: function (t) { t = t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i, (function (t, e, n, i) { return e + e + n + n + i + i })); var e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t); return e ? { r: parseInt(e[1], 16), g: parseInt(e[2], 16), b: parseInt(e[3], 16) } : null }, mergeObject: function (t) { for (var e = 1; e < arguments.length; e++) { var n = arguments[e]; for (var i in n) n.hasOwnProperty(i) && (t[i] = n[i]) } return t }, intersects: function (t, e, n, i, r, o, a, s) { var l, c, u; return 0 !== (l = (n - t) * (s - o) - (a - r) * (i - e)) && (c = ((e - i) * (a - t) + (n - t) * (s - e)) / l, 0 < (u = ((s - o) * (a - t) + (r - a) * (s - e)) / l) && u < 1 && 0 < c && c < 1) }, getClosestPointOnLines: function (t, e) { function n(t, e) { return e >= 0 ? t[e] : t[t.length + e] } var i, r, o, a, s, l, c; if (e.length > 1) { for (var u = 0; u < e.length; u++) { if (n(e, u)[0] != n(e, u - 1)[0]) { var p = (n(e, u)[1] - n(e, u - 1)[1]) / (n(e, u)[0] - n(e, u - 1)[0]), d = n(e, u)[1] - p * n(e, u)[0]; c = Math.abs(p * t.x + d - t.y) / Math.sqrt(p * p + 1) } else c = Math.abs(t.x - n(e, u)[0]); var _ = Math.pow(n(e, u)[1] - n(e, u - 1)[1], 2) + Math.pow(n(e, u)[0] - n(e, u - 1)[0], 2), f = Math.pow(n(e, u)[1] - t.y, 2) + Math.pow(n(e, u)[0] - t.x, 2), h = Math.pow(n(e, u - 1)[1] - t.y, 2) + Math.pow(n(e, u - 1)[0] - t.x, 2), m = Math.pow(c, 2), v = f - m + h - m; v > _ && (c = Math.sqrt(Math.min(f, h))), (null == i || i > c) && (v > _ ? h < f ? (r = 0, o = 1) : (o = 0, r = 1) : (r = Math.sqrt(h - m) / Math.sqrt(_), o = Math.sqrt(f - m) / Math.sqrt(_)), i = c, l = u) } var g = n(e, l - 1)[0] - n(e, l)[0], y = n(e, l - 1)[1] - n(e, l)[1]; a = n(e, l - 1)[0] - g * r, s = n(e, l - 1)[1] - y * r } return { x: a, y: s, i: l, fTo: r, fFrom: o } }, scaleUp: function (e, n) { switch (E(e)) { case "number": return e * n; case "object": return Object.assign.apply(Object, P(Object.entries(e).map((function (e) { var i = C(e, 2), r = i[0], o = i[1]; return S({}, r, t.is_nr(o) ? o * n : o) })))) }throw Error("Invalid value") }, scaleDown: function (e, n) { switch (E(e)) { case "number": return e / n; case "object": return Object.assign.apply(Object, P(Object.entries(e).map((function (e) { var i = C(e, 2), r = i[0], o = i[1]; return S({}, r, t.is_nr(o) ? o / n : o) })))) }throw Error("Invalid value") }, distance: function (t, e, n, i) { return Math.sqrt(Math.pow(t - n, 2) + Math.pow(e - i, 2)) }, version_compare: function (t, e) { if (E(t) + E(e) != "stringstring") return !1; for (var n = t.split("."), i = e.split("."), r = 0, o = Math.max(n.length, i.length); r < o; r++) { if (n[r] && !i[r] && parseInt(n[r]) > 0 || parseInt(n[r]) > parseInt(i[r])) return 1; if (i[r] && !n[r] && parseInt(i[r]) > 0 || parseInt(n[r]) < parseInt(i[r])) return -1 } return 0 } }, rt = function (t) { var e = $('<div class="mir-dialog mir-search-dialog"></div>'), n = e.mir = { options: $.extend({ timeout: 100, header: "", parent: "body", placeholder: mir_translate("Type to filter text"), on_before_render: function (t) { t.show((function () { n.$dialog_input.focus() })) }, get_overlay: function (t) { return new nt({ parent: t.mir.options.parent }) }, on_set_position: function (t) { t.position({ my: "center", at: "center", of: n.options.parent }) }, on_clear_dialog: function (t) { t.fadeOut(100, (function () { t.remove(), t.mir.$overlay.clear() })), $(window).off("resize.mir-search-dialog") }, on_create_option_node: null, on_create_group_node: null, sort_options: function (t, e) { var n = t.clean_group_name + t.clean_name, i = e.clean_group_name + e.clean_name; return n < i ? -1 : n > i ? 1 : 0 }, on_select: null, on_filter_option: null }, t), groups: [], value: null }; return n.process_options = function () { $.each(n.options.options, (function (t, e) { void 0 !== e.groupname && (e.clean_group_name = it.remove_diacritics(e.groupname.toString())), e.clean_name = it.remove_diacritics(e.name.toString()) })), n.options.options.sort(n.options.sort_options) }, n.create_dialog = function () { var t; n.$header = $("<h1>" + n.options.header + "</h1>"), n.$close_btn = $('<button class="mir-btn mir-btn-sm mir-light close-dialog"><i class="mir-i mir-i-back"></i>&nbsp;' + mir_translate("Cancel") + "</button>"), n.$dialog_label = $('<div class="mir-form-element"><label class="mir-label">' + mir_translate("Filter:") + "</label></div>"), n.$dialog_input = Y({ attr: { type: "search", class: "mir-field", placeholder: n.options.placeholder } }), n.$wrapper = $('<div tabindex="-1" class=scroll-wrap></div>'), n.$list = $('<ul class="mir-list"></ul>'), n.$overlay = n.options.get_overlay(e), e.set_position = function () { n.options.on_set_position(e) }, $.each(n.options.options, (function (e, i) { if (i.groupname && i.groupname !== t) { t = i.groupname; var r = $("<span>" + t + "</span>"), o = $('<li class="mir-list-item group"></li>'), a = { clean_group_name: i.clean_group_name, group_name: i.groupname, $node: o, $text_node: r }; a.$node.append(a.$text_node), "function" == typeof n.options.on_create_group_node && n.options.on_create_group_node(a, e, i), n.groups.push(a), n.$list.append(o) } i.$text_node = $("<span>" + i.name + "</span>"), i.$node = $('<li class="mir-list-item item" data-value="' + i.value + '"></li>'), n.$list.append(i.$node.append(i.$text_node)), "function" == typeof n.options.on_create_option_node && n.options.on_create_option_node(i, e) })), e.append(n.$header.append(n.$close_btn), n.$dialog_label.append(n.$dialog_input), n.$wrapper.append(n.$list)).appendTo(n.$overlay), it.is_mobile() && !it.is_small_screen() || e.set_position(e) }, n.bind_events = function () { var t; e.on("DOMMouseScroll.mir-overlay mousewheel.mir-overlay", (function (t) { t.stopPropagation() })), n.$dialog_input.on("input.mir-search-dialog", n.handle_input).on("keydown.mir-search-dialog", n.handle_keypress).on("focus.mir-search-dialog", (function () { this.select() })), n.$list.on("click.mir-search-dialog", "[data-value]", (function () { var t = $(this).attr("data-value"); n.handle_select(t) })), n.$close_btn.on("click.mir-search-dialog", (function () { n.reset_input(), n.clear_dialog(e) })), $(window).off("resize.mir-search-dialog").on("resize.mir-search-dialog", (function () { if (it.is_mobile() || it.is_small_screen()) return !1; t && clearTimeout(t), t = setTimeout(e.set_position, 50) })) }, n.init_dialog = function () { n.process_options(), n.create_dialog(), n.bind_events(), n.options.on_before_render(e) }, n.handle_select = function (t) { var i = !0, r = $.grep(n.options.options, (function (e) { return e.value === t })).pop(); "function" == typeof n.options.on_select && (i = !1 !== n.options.on_select(t, r)), i && (n.val(t), n.clear_dialog(e)) }, n.clear_dialog = function () { n.options.on_clear_dialog(e) }, n.filter_list = function (t) { var e = it.remove_diacritics(t), i = RegExp(it.escape_regex(e)); $.each(n.groups, (function (e, n) { var r = n.clean_group_name.search(i); -1 !== r ? n.$text_node.html(it.highlight_text(n.group_name, r, t.length)) : n.$text_node.html(n.group_name) })), $.each(n.options.options, (function (e, r) { var o = !0; if ("function" == typeof n.options.on_filter_option && (o = n.options.on_filter_option(r)), !1 !== o) { var a = r.clean_name.search(i); if (-1 !== a) return r.$node.show(), void r.$text_node.html(it.highlight_text(r.name, a, t.length)); if (r.clean_group_name && -1 !== (a = r.clean_group_name.search(i))) return r.$text_node.html(r.name), void r.$node.show(); r.$node.hide(), r.$text_node.html(r.name) } })) }, e.val = n.val = function () { if (arguments.length > 0) { var t = arguments[0], e = $.grep(n.options.options, (function (e) { return e.value === t })).pop(); return e && (n.value = t, n.$dialog_input && n.$dialog_input.val(e.name)), n } return n.value }, n.handle_input = function () { null !== n.timeout && window.clearTimeout(n.timeout), n.timeout = setTimeout((function () { n.filter_list(n.$dialog_input.val()) }), n.options.timeout) }, n.reset_input = function () { var t = n.val(); n.val(t), n.handle_select(t) }, n.handle_keypress = function (t) { function i() { null !== n.timeout && (window.clearTimeout(n.timeout), n.filter_list(n.$dialog_input.val())); var e = n.$list.find(".item:visible:first"); if (0 === e.length) return t.preventDefault(), !1; var i = e.attr("data-value"); n.handle_select(i) } switch (t.keyCode) { case $.ui.keyCode.ESCAPE: t.stopPropagation(), t.preventDefault(), n.reset_input(), n.clear_dialog(e); break; case $.ui.keyCode.ENTER: t.stopPropagation(), t.preventDefault(), i(); break; case $.ui.keyCode.TAB: i() } }, n.init_dialog(), e }, ot = function (t) { var e = nt().attr("class", "overlay_confirm"), n = t.title ? t.title : "undefined", i = t.body ? t.body : "undefined", r = t.submit ? t.submit : mir_translate("Yes"), o = t.cancel ? t.cancel : mir_translate("No"), a = $('<div class="box"></div>'); return t.confirm_type && a.addClass(t.confirm_type), a.append("<h1>" + n + "</h1>"), a.append("<p>" + i + "</p>"), a.append('<div class="buttonholder"><div class="delete" id="confirm-submit">' + r + '</div><div class="cancel" id="confirm-cancel">' + o + "</div></div>"), e.append(a), new Promise((function (t, n) { a.find("#confirm-submit").on("click", (function () { e.remove(), t() })), a.find("#confirm-cancel").on("click", (function () { e.remove() })) })) }; var at = function () { function t(e, n) { T(this, t), this.input = e, this.value = e.value ? e.value : "", this.options = n || {}, this.type = e.type ? e.type.toLowerCase() : "text", void 0 !== e.tagName && "select" == e.tagName.toLowerCase() && (this.type = "select"), this.errors = [], this.parse() } return M(t, [{ key: "parse", value: function () { var t = this, e = ["min", "max"]; t.options.check_type && e.push("type"), t.options.not_empty && e.push("empty"), e.forEach((function (e) { var n, i, r, o, a = t.input.getAttribute(e); !a && "empty" != e || t.check(e, a) || t.errors.push((n = e, i = t.type, r = a, (o = { number: { max: mir_translate("input_number_too_big", { min_value: r }), min: mir_translate("input_number_too_small", { min_value: r }), empty: mir_translate("input_must_be_non_null"), type: mir_translate("input_must_be_a_number") }, text: { max: mir_translate("input_string_too_long", { max_length: r }), min: mir_translate("input_string_too_short", { min_length: r }), empty: mir_translate("input_must_be_non_null"), type: mir_translate("input_must_be_a_string") }, select: { empty: mir_translate("input_must_be_non_null") } })[i][n] ? o[i][n] : mir_translate("invalid_data_supplied"))) })) } }, { key: "check", value: function (t, e) { return { min: "number" == this.type && parseFloat(this.value) >= parseFloat(e) || "number" != this.type && this.value.length >= parseFloat(e), max: "number" == this.type && parseFloat(this.value) <= parseFloat(e) || "number" != this.type && this.value.length <= parseFloat(e), type: !e || "number" != e.toLowerCase() || !isNaN(parseFloat(this.value)), empty: "" != this.value }[t] } }]), t }(), st = { button: H, constants: q, overlay: nt, search_dialog: rt, search_select: function (t) { var e = $("<div></div>"), n = e.mir = { options: $.extend({ attr: {}, header: "", parent: "body", options: [], timeout: 100, extra_dialog_options: {} }, t), blurring_timeout: !1 }; return n.create_search_select = function () { n.$hidden_input = Y({ attr: $.extend({}, n.options.attr, { type: "hidden" }) }), n.$input = Y({ attr: { type: "search" } }), n.is_active = !1, e.append(n.$hidden_input, n.$input) }, n.bind_events = function () { n.$input.on("focus", (function () { if (!n.is_active) { n.is_active = !0, n.is_mobile_or_small = it.is_mobile() || it.is_small_screen(); var t = { options: n.options.options, header: n.options.header }, e = { get_overlay: function () { return n.options.parent }, on_set_position: function (t) { t.position({ my: "left+15px top-65px", at: "right center", of: n.$input, collision: "none" }) }, on_before_render: function (t) { t.val(n.val()), t.addClass("mir-search-select-dialog"), n.$tab = $('<div class="tab mir-only-desktop"></div>'), t.append(n.$tab), n.$tab.position({ my: "left center", at: "right center", of: n.$input, collision: "none" }), t.show((function () { t.mir.$dialog_input.focus() })); var e = !1; $(window).on("resize.mir-search-select", (function () { n.is_active && n.is_mobile_or_small !== (it.is_mobile() || it.is_small_screen()) && (e && clearTimeout(e), e = setTimeout(n.handle_resize, 50)) })) }, on_clear_dialog: function (t) { n.val(t.val()), n.is_active = !1, t.remove(), $(window).off("resize.mir-search-dialog") }, on_select: function (t, e) { n.blurring_timeout && clearTimeout(n.blurring_timeout), n.val(t), n.$dialog.mir.clear_dialog() } }; n.$dialog = new rt($.extend(n.options.extra_dialog_options, t, e)), n.$dialog.mir.$dialog_input.on("input", (function () { n.$input.val($(this).val()) })) } n.is_mobile_or_small || this.select() })).on("input", (function (t) { n.$dialog && n.$dialog.mir.$dialog_input.val(n.$input.val()), n.$dialog.mir.handle_input(t) })).on("keydown", (function (t) { var e = !0; if (n.$dialog && (e = n.$dialog.mir.handle_keypress(t)), !1 === e) return !1; switch (t.keyCode) { case $.ui.keyCode.ESCAPE: case $.ui.keyCode.ENTER: n.$input.blur() } })).on("blur", (function () { n.is_mobile_or_small || (n.blurring_timeout = setTimeout((function () { n.$dialog && document.activeElement !== n.$dialog.mir.$wrapper[0] && (n.$dialog.mir.clear_dialog(), n.is_active = !1) }), 1)) })) }, n.handle_resize = function () { n.$tab && (console.log(n.$tab), n.$tab.position({ my: "left center", at: "right center", of: n.$input, collision: "none" })), n.is_mobile_or_small = it.is_mobile() || it.is_small_screen(), n.is_mobile_or_small ? n.$dialog && n.$dialog.mir.$dialog_input.focus() : n.$input.focus() }, n.init_search_select = function () { n.create_search_select(), n.bind_events() }, e.val = n.val = function () { if (arguments.length > 0) { var t = arguments[0], e = $.grep(n.options.options, (function (e) { return e.value === t })).pop(); return e && (n.$hidden_input.val(e.value), n.$input.val(e.name), n.is_active && n.$dialog.val(e.value)), self } return n.$hidden_input.val() }, n.init_search_select(), e }, select: Q, null_field: z, error: J, input: Y, icon: X, label: Z, tooltip: tt, spinner: V, duration: W, form_element: function (t, e, n, i) { var r = $('<div class="mir-form-element"></div>'), o = e.opts; return r.mir = { $control: et[e.type](o), $label: Z(t), $error: J(), options: $.extend({}, i) }, r.mir.options.attr && r.attr(r.mir.options.attr), o && o.attr && "checkbox" === o.attr.type ? r.append(r.mir.$label.prepend(r.mir.$control), r.mir.$error) : r.append(r.mir.$label, r.mir.$control, r.mir.$error), void 0 !== n && (r.mir.$tooltip = tt(n), r.mir.$tooltip_trigger = X({ size: "1em", type: "info" }), r.mir.$tooltip_trigger.pTooltip({ findToolTip: function () { return r.mir.$tooltip } }), r.append(r.mir.$tooltip), r.mir.$label.append("&nbsp;", r.mir.$tooltip_trigger)), r.val = function () { var t = this.mir; return arguments.length > 0 ? (t.$control.val(arguments[0]), r) : t.$control.val() }, r.error = function () { var t = this.mir; return arguments.length > 0 ? (t.$error.val(arguments[0]), r) : t.$error.val() }, r }, waiter: function (t) { var e = $('<div class="mir-overlay">\t<div class="mir-box mir-waiter">\t\t<h1>' + mir_translate("Please wait...") + '</h1>\t\t<div><i class="mir-i mir-i-spinner"></i></div>\t<div><div>'), n = e.mir = { options: $.extend({}, t) }; return n.$message = $("<div>" + n.options.message + "</div>"), e.val = function () { var t = this.mir; return arguments.length > 0 ? (t.$message.html(arguments[0]), e) : t.$message.html() }, e.find(".mir-waiter").append(n.$message), e }, prompt: function (t) { var e = $.extend({ headline: "headline", message: "message", status_message: "", add_cancel: { label: mir_translate("Cancel"), on_click: function (t) { t.mir.$overlay.remove() } }, overlay_remove_on_click: !0, buttons: [], parent: "body", get_overlay: function (t) { return new nt({ parent: t.mir.options.parent, overlay_remove_on_click: t.mir.options.overlay_remove_on_click }) } }, t), n = $('<div class="mir-box mir-prompt"></div>'); n.mir = { $status_message: $('<p class="encoder_status_message">' + e.status_message + "</p>"), $headline: $("<h1>" + e.headline + "</h1>"), $message: $("<div>" + e.message + "</div>"), $buttons: $('<div class="buttons"></div>'), $overlay: null, options: e }, n.mir.options.add_cancel && n.mir.options.buttons.push(new H({ label: n.mir.options.add_cancel.label, attr: { class: "mir-light" }, events: { click: function (t) { n.mir.options.add_cancel.on_click(n, t) } } })); var i = n.mir; return i.$overlay = i.options.get_overlay(n), i.options.buttons.forEach((function (t) { i.$buttons.append(t) })), n.append(i.$headline, i.$message, i.$status_message, i.$buttons).appendTo(i.$overlay), n }, confirm: ot, input_validate: at, helptext: function (t, e, n) { !0 !== n && (t = mir_translate(t), e = mir_translate(e)); var i = $('<div class="helpboxbg"></div>').attr("data-scroll", "true").attr("id", "helpboxbg"), r = $('<div class="box"></div>'); r.html("<p>" + t + "</p>"), void 0 !== e && e.length > 0 && r.prepend("<h1>" + e + "</h1>"); var o = $('<div class="button">' + mir_translate("Close") + "</div>").click((function () { $(this).closest(".helpboxbg").remove() })); r.append(o), i.append(r), $("body").prepend(i) }, modal: function (t) { var e = nt().attr("class", "overlay_modal"), n = t.title ? t.title : "undefined", i = t.body ? t.body : "undefined", r = t.submit ? t.submit : mir_translate("Send"), o = t.cancel ? t.cancel : mir_translate("Cancel"), a = $('<div class="box"></div>'); t.confirm_type && a.addClass(t.confirm_type), a.append("<h1>" + n + "</h1>"), a.append("<p>" + i + "</p>"); var s = $('<form type="post"></form>').attr("name", t.form.name); return t.form.inputs.forEach((function (t) { s.append($("<input />").attr(t)) })), s.append('<div class="buttonholder"><input type="submit" class="mir-btn mir-btn-primary" value="' + r + '"><a class="mir-btn mir-btn-secondary" id="modal-cancel">' + o + "</a></div>"), a.append(s), e.append(a), new Promise((function (t, n) { s.on("submit", (function () { e.remove(), t($(this)) })), a.find("#modal-cancel").on("click", (function () { e.remove() })) })) } }, lt = { table: { data: function () { return { query: "", pr_page: 10, page: 1, density: 1, rows: {}, fields: {}, current_rows: {}, display_rows: {} } }, template: '\n        <table class="mir-table" v-bind:row-density="density">\n            <thead>\n                <tr>\n                    <th v-for="field in fields" v-bind:key="field.id" v-if="">{{field}}</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr v-for="row in display_rows">\n                    <td v-for="field in field_keys" v-bind:key="field.id" v-html="row[field]"></td>\n                </tr>\n            </tbody>\n        </table>\n    ', mounted: function () { var t = this, e = this; (this.rows = this.$parent.rows, this.fields = this.$parent.fields ? this.$parent.fields : Object.keys(this.rows[0]), this.$parent.excludes) && this.$parent.excludes.forEach((function (t) { delete e.fields[t] })); this.current_rows = this.rows, this.$parent.pr_page && (this.pr_page = this.$parent.pr_page), this.setDisplayRows(), this.$parent.$on("query_change", (function (e) { t.query = e })), this.$parent.$on("page_change", (function (e) { t.page = e })), this.$parent.$on("density", (function (e) { t.density = e })), this.$parent.$on("pr_page_change", (function (e) { t.pr_page = e })) }, computed: { field_keys: function () { return this.$parent.fields ? Object.keys(this.fields) : this.fields } }, methods: { setDisplayRows: function () { this.setPages(); var t = this.page * this.pr_page; this.display_rows = this.current_rows.slice(t - this.pr_page, t), this.$parent.actions && this.setActions() }, setPages: function () { var t = Math.ceil(this.current_rows.length / this.pr_page); this.$parent.$emit("pages_change", t) }, setActions: function () { var t = this, e = this.$parent.actions.links, n = this.$parent.actions.column; this.display_rows.forEach((function (i, r) { for (var o = "", a = 0; a < e.length; a++) { var s = e[a]; i[n].indexOf(s.limit_permission) > -1 && (o += s.content) } t.display_rows[r][n] = o })) } }, watch: { query: function () { var t = this; this.query.length <= 0 ? this.current_rows = this.rows : this.current_rows = jQuery.grep(t.rows, (function (e) { for (var n = Object.keys(e), i = !1, r = 0; r < n.length; r++) { var o = e[n[r]]; if (!(t.$parent.excludes && t.$parent.excludes.indexOf(n[r]) > -1) && (o && o.toString().toLowerCase().indexOf(t.query.toString().toLowerCase()) > -1)) { i = !0; break } } return i })), this.$parent.$emit("page_change", 1), this.setDisplayRows() }, page: function () { this.setDisplayRows() }, pr_page: function () { this.$parent.$emit("page_change", 1), this.setDisplayRows() } } }, pagination: { data: function () { return { page: 1, pages: 0 } }, template: '\n        <div class="mir-pagination">\n            <span class="first" v-on:click="changePage(1)"></span>\n            <span class="prev" v-on:click="prev()"></span>\n            <div class="page-counter">Page {{page}} of {{pages}}</div>\n            <span class="next" v-on:click="next()"></span>\n            <span class="last" v-on:click="changePage(pages)"></span>\n        </div>\n    ', created: function () { var t = this; this.$parent.$on("page_change", (function (e) { t.page = e })), this.$parent.$on("pages_change", (function (e) { t.pages = e })) }, methods: { next: function () { var t = this.page + 1; return !(t > this.pages) && this.changePage(t) }, prev: function () { var t = this.page - 1; return !(t <= 0) && this.changePage(t) }, changePage: function (t) { return this.$parent.$emit("page_change", t), !0 } } }, search: { data: function () { return { query: "" } }, template: '<input type="text" v-model="query" placeholder="Search here.." />', watch: { query: function (t) { this.$parent.$emit("query_change", t) } } }, options: { data: function () { return { pr_page_ranges: [10, 20, 50, 100, 1e3], pr_page: 10 } }, template: '\n    <div class="table-options">\n        <select v-model="pr_page">\n            <option v-for="range in pr_page_ranges" v-bind:value="range">{{range}}</option>\n        </select>\n        <ul class="density-selector">\n            <li v-on:click="setDensity(1)">\n                <span></span>\n                <span></span>\n                <span></span>\n            </li>\n            <li v-on:click="setDensity(2)">\n                <span></span>\n                <span></span>\n                <span></span>\n                <span></span>           \n            </li>\n            <li v-on:click="setDensity(3)">\n                <span></span>\n                <span></span>\n                <span></span>\n                <span></span>\n                <span></span>\n            </li>\n        </ul>\n    </div>', watch: { pr_page: function (t) { this.$parent.$emit("pr_page_change", t) } }, methods: { setDensity: function (t) { this.$parent.$emit("density", t) } } } }, ct = { status: null, sessions_imported: null, sessions_total: null, error_message: null }, ut = { areaEvents: function () { function t() { T(this, t), this.maps = [], this.areas = [], this.definitions = [], this.hidden_parameters = ["turn_around"], this.loaded = !1 } return M(t, [{ key: "init", value: function () { var t = this; return new Promise((function (e, n) { t.loadAreas().then((function () { t.loadDefinitions().then((function () { t.loaded = !0, e() })) })) })) } }, { key: "loadAreas", value: function () { var t = this; return new Promise((function (e, n) { $.post("/?mode=get-area-definitions", (function (n) { t.areas = n.results, e() })) })) } }, { key: "loadDefinitions", value: function () { var t = this; return new Promise((function (e, n) { $.post("/?mode=get-area-events-action-definitions", (function (n) { "object" == E(n.results) && n.results.forEach((function (e) { t.definitions[e.action_type_id] = e })), e() })) })) } }, { key: "getArea", value: function (t, e) { void 0 === e && (e = "name"); for (var n = 0; n < this.areas.length; n++)if (this.areas[n][e] == t) return this.areas[n] } }, { key: "getActionFromShape", value: function (t, e) { for (var n = 0; n < e.actions.length; n++)if (e.actions[n].type_id == t) return e.actions[n]; return !1 } }, { key: "getParameterFromAction", value: function (t, e) { for (var n = 0; n < e.parameters.length; n++)if (e.parameters[n].name == t) return e.parameters[n]; return !1 } }, { key: "getAreaColor", value: function (t) { var e = this.getArea(t, "legacyName"); if ("object" == E(e)) { var n = MIR.util.hexToRgb(e.color); return { hex: e.color, rgb: n, rgb_string: Object.keys(n).map((function (t) { return n[t] })).join(",") } } return !1 } }, { key: "setWindowLayers", value: function (t) { Object.keys(MIR.constants.MAP.choice_layers).forEach((function (e) { void 0 === window["map_" + t + "_metadata"].layers && (window["map_" + t + "_metadata"].layers = {}), void 0 === window["map_" + t + "_metadata"].layers[MIR.constants.MAP.choice_layers[e]] && (window["map_" + t + "_metadata"].layers[MIR.constants.MAP.choice_layers[e]] = { shapes: [] }) })) } }, { key: "settingsModal", value: function (t, e) { var n = this; if (void 0 !== e.modal && void 0 !== e.layer && void 0 !== e.shape_index) { var i = e.layer, r = window["map_" + t + "_metadata"].layers[i].shapes[e.shape_index], o = $(e.modal).find("form"), a = n.getArea(i.replace("areaevents_", ""), "legacyName"); a.actions.length > 1 ? (o.append(n.addActionsSelect(a, r)), "object" == E(r.actions) && r.actions.length >= 1 && r.actions.forEach((function (t) { o.append(n.addAction(t.type_id, r)) }))) : o.append(n.addAction(a.actions[0], r, !0)) } } }, { key: "addActionsSelect", value: function (t, e) { var n = this, i = $('<div class="fieldgroup" group-type="action-select"></div>'), r = $('<div class="fieldholder"></div>'); r.append('<label for="actions_select" class="label">' + mir_translate("Available actions") + "</label>"); var o = $('<div class="input-group"></div>'), a = $('<select class="select"></select>'); t.actions.forEach((function (t) { t = n.definitions[t], a.append('<option value="' + t.action_type_id + '" action-type="' + t.action_type + '">' + t.name + "</option>") })); var s = $('<button class="mir-btn mir-btn-default add_action_button"><i class="mir-i-plus-grey mir-i"></i></button>'); return s.on("click", (function (t) { t.preventDefault(); var r = parseInt(a.val()); i.after(n.addAction(r, e)) })), o.append(a).append(s), r.append(o), i.append(r), i } }, { key: "handleOption", value: function (t, e) { var n = $('.fieldgroup[group-type="action-select"] select'); if (n.length > 0) { var i = n.find('option[value="' + t + '"]'); if (i.length > 0) { "disable" == e && i.attr("disabled", "disabled"), "enable" == e && i.removeAttr("disabled").closest(".input-group").removeClass("disable"); var r = n.find("option:not([disabled])"); r.length > 0 ? n.val(r.val()) : n.closest(".input-group").addClass("disable") } } } }, { key: "addAction", value: function (t, e, n) { var i = this, r = i.definitions[t]; if (!(void 0 === r || $('.fieldgroup[action-type-id="' + r.action_type_id + '"]').length > 0)) { var o = $('<div class="fieldgroup" group-type="action" action-type="' + r.action_type + '" action-type-id="' + r.action_type_id + '"></div>"'); if (!0 !== n) { i.handleOption(t, "disable"); var a = $('<button class="remove-button"></button>'); if (a.on("click", (function (e) { e.preventDefault(), o.remove(), i.handleOption(t, "enable") })), o.append('<div class="fieldholder"><h3>' + r.name + "</h3></div>").append(a), 0 == r.parameters.length) { var s = $('<i class="help-icon"></i>'); s.on("click", (function () { MIR.ui.helptext(r.help, r.name, !0) })), o.find("h3").append(s) } } return r.parameters.forEach((function (t) { o.append(i.addParameter(t, e, r.action_type_id)) })), o } } }, { key: "addParameter", value: function (t, e, n) { var i = $('<div class="fieldholder" parameter-id="' + t.id + '"></div>'), r = $('<label for="param_' + t.id + '" class="label">' + t.name + "</label>"), o = $('<i class="help-icon"></i>'); o.on("click", (function () { MIR.ui.helptext(t.help, t.name, !0) })), r.append(o), i.append(r); var a = { field: "input", attributes: { type: "text", name: t.id, class: "input parameter" } }; "float" != t.type.toLowerCase() && "int" != t.type.toLowerCase() || (a.attributes.type = "number"), "reference" != t.type.toLowerCase() && "selection" != t.type.toLowerCase() || (a.field = "select", a.attributes = { class: "select parameter", name: t.id }), -1 != this.hidden_parameters.indexOf(t.id) && i.addClass("hidden"); var s = "", l = ""; if (void 0 !== t.constraints.default && (s = t.constraints.default), "object" == E(e.actions) && e.actions.length > 0) { var c = this.getActionFromShape(n, e); if (c) { var u = this.getParameterFromAction(t.id, c); u && (void 0 !== u.value && (s = u.value), void 0 !== u.guid && (l = u.guid)) } } if ("input" == a.field) { var p = $("<input mir-validate />"); a.attributes.value = s, a.attributes["parameter-guid"] = l, "object" == E(t.constraints) && (void 0 !== t.constraints.step && "any" != t.constraints.step && (a.attributes.step = t.constraints.step), void 0 !== t.constraints.min && (a.attributes.min = t.constraints.min), void 0 !== t.constraints.max && (a.attributes.max = t.constraints.max)), p.attr(a.attributes), i.append(p) } if ("select" == a.field) { var d = $("<select mir-validate></select>"); void 0 !== t.constraints.choices && t.constraints.choices.forEach((function (t) { d.append('<option value="' + t.value + '">' + t.name + "</option>") })), d.attr(a.attributes), i.append(d), "" != s && d.val(s) } return i } }, { key: "save", value: function (t) { var e = $(t); if (!this.validateParameters(e)) return !1; var n = e.closest(".mapcontainer"); if (n.length <= 0) return console.warn("Warning! Mapcontainer element could not be found!"), !1; var i = n.attr("data-current-layer"), r = n.attr("shape-index"), o = n.attr("data-element-id"); if (void 0 === window["map_" + o + "_metadata"].layers[i].shapes[r]) return console.warn("Warning! Shape was not found in the map metadata!"), !1; var a = e.find('input[name="areaevent_name"]').val(); window["map_" + o + "_metadata"].layers[i].shapes[r].name = a; var s = []; return e.find('.fieldgroup[group-type="action"]').each((function () { var t = $(this), e = {}; e.type_id = parseInt(t.attr("action-type-id")); var n = []; $(this).find(".parameter").each((function () { var t = $(this); n.push({ name: t.attr("name"), value: isNaN(t.val()) ? t.val() : parseFloat(t.val()) }) })), e.parameters = n, s.push(e) })), window["map_" + o + "_metadata"].layers[i].shapes[r].actions = s, window["map_" + o + "_metadata"].layers[i].shapes[r].is_updated = !0, !0 } }, { key: "validateParameters", value: function (t) { var e = !0; return t.find(".fielderror").remove(), t.find(".error").removeClass("error"), t.find("[mir-validate]").each((function () { var t = $(this), n = new MIR.ui.input_validate($(this)[0], { not_empty: !0 }); n.errors.length > 0 && (e = !1, t.closest(".fieldgroup").addClass("error"), n.errors.forEach((function (e) { t.addClass("error").after('<div class="fielderror show"><p>' + e + "</p></div>") }))) })), 0 == t.find('.fieldgroup[group-type="action"]').length && ($('.fieldgroup[group-type="action-select"] .fieldholder').append('<div class="fielderror show"><p>' + mir_translate("shared_popup_dialog_map_areaevent_no_action_selected") + "</p></div>"), e = !1), e } }, { key: "parsedAreas", get: function () { var t = {}; return this.areas.forEach((function (e) { t[e.legacyName] = "areaevents_" + e.legacyName })), t } }]), t }(), shared_data: { session_importer: ct }, table: lt, session_importer_info: { data: function () { return ct }, computed: { is_busy: function () { return this.status === K.constants.status.BUSY }, is_error: function () { return this.status === K.constants.status.ERROR } }, methods: { cancel_import: function () { ot({ title: mir_translate("shared_popup_cancel_site_import_title"), body: mir_translate("shared_popup_cancel_site_import_message") }).then((function () { $.getJSON("?mode=cancel-session-import", (function () { window.location.reload() })) })).catch((function () { })) }, clear_error: function () { $.getJSON("?mode=cancel-session-import", (function () { })) } }, template: '\n<div class="v-session-importer-info" v-if="is_busy || is_error">\n    <div v-if="is_busy">\n        <div>{{ _(\'shared_action_menu_site_import_stats_menu_item %(sessions_imported)s / %(sessions_total)s\', {sessions_imported, sessions_total}) }}</div>\n        <br><span class="mir-btn mir-btn-sm mir-red" v-on:click="cancel_import"> {{ _(\'Cancel\') }}</span>\n    </div>\n    <div v-else-if="is_error">\n        <div>{{ _(error_message) }}</div>\n        <br><span class="mir-btn mir-btn-sm mir-red" v-on:click="clear_error">{{ _(\'Clear\') }}</span>\n    </div>\n</div>' } }, pt = { session_using: "", session_user: R.get("PHPSESSID"), user_token: R.get("joystick_token"), extended_safety_data: { is_enabled: !1, key_state: "", safety_is_muted: !1, is_in_manual: !1, is_manual_mode_restart_required: !1 }, claim: function (t) { "" != t && (this.user_token = t, R.set("joystick_token", t, { expires: 7 })) }, checkClaim: function () { if (this.extended_safety_data.is_enabled) { if ("manual" != this.extended_safety_data.key_state) return "wait_for_key"; if ("" != this.session_using && this.session_using == this.session_user && 1 == this.extended_safety_data.is_manual_mode_restart_required) return "wait_for_button_override" } return "" != this.session_using && this.session_using == this.session_user ? "claimed" : "" != this.session_using && this.session_using != this.session_user ? "locked" : robot_errors.length > 0 ? "robot_has_errors" : "ready" } }; return function (e) { var n = null; return { get: function () { if (null === n) { var i = $.extend(I, e), o = new r(i.apis), a = o.call(i.default_api); n = { apis: o, api: a, components: ut, config: i, constants: y, cookie: R, log: w, math: O, ros: U, storage: B, t: F, runtime: {}, ui: st, util: it, joystick: pt, validate: t, product: {}, wifi: { experimental_mode: !1 } } } return n } } }({ apis: { robot: { base_url: "/api", version: "v2.0.0" } }, default_api: "robot" }).get() }();
/*!
 * Vue.js v2.5.17
 * (c) 2014-2018 Evan You
 * Released under the MIT License.
 */
!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.Vue = t() }(this, (function () { "use strict"; var e = Object.freeze({}); function t(e) { return null == e } function n(e) { return null != e } function r(e) { return !0 === e } function i(e) { return "string" == typeof e || "number" == typeof e || "symbol" == typeof e || "boolean" == typeof e } function o(e) { return null !== e && "object" == typeof e } var a = Object.prototype.toString; function s(e) { return "[object Object]" === a.call(e) } function c(e) { var t = parseFloat(String(e)); return 0 <= t && Math.floor(t) === t && isFinite(e) } function l(e) { return null == e ? "" : "object" == typeof e ? JSON.stringify(e, null, 2) : String(e) } function u(e) { var t = parseFloat(e); return isNaN(t) ? e : t } function f(e, t) { for (var n = Object.create(null), r = e.split(","), i = 0; i < r.length; i++)n[r[i]] = !0; return t ? function (e) { return n[e.toLowerCase()] } : function (e) { return n[e] } } var p = f("slot,component", !0), d = f("key,ref,slot,slot-scope,is"); function v(e, t) { if (e.length) { var n = e.indexOf(t); if (-1 < n) return e.splice(n, 1) } } var h = Object.prototype.hasOwnProperty; function m(e, t) { return h.call(e, t) } function y(e) { var t = Object.create(null); return function (n) { return t[n] || (t[n] = e(n)) } } var g = /-(\w)/g, _ = y((function (e) { return e.replace(g, (function (e, t) { return t ? t.toUpperCase() : "" })) })), b = y((function (e) { return e.charAt(0).toUpperCase() + e.slice(1) })), $ = /\B([A-Z])/g, w = y((function (e) { return e.replace($, "-$1").toLowerCase() })), C = Function.prototype.bind ? function (e, t) { return e.bind(t) } : function (e, t) { function n(n) { var r = arguments.length; return r ? 1 < r ? e.apply(t, arguments) : e.call(t, n) : e.call(t) } return n._length = e.length, n }; function x(e, t) { t = t || 0; for (var n = e.length - t, r = new Array(n); n--;)r[n] = e[n + t]; return r } function k(e, t) { for (var n in t) e[n] = t[n]; return e } function A(e) { for (var t = {}, n = 0; n < e.length; n++)e[n] && k(t, e[n]); return t } function O(e, t, n) { } var S = function (e, t, n) { return !1 }, T = function (e) { return e }; function E(e, t) { if (e === t) return !0; var n = o(e), r = o(t); if (!n || !r) return !n && !r && String(e) === String(t); try { var i = Array.isArray(e), a = Array.isArray(t); if (i && a) return e.length === t.length && e.every((function (e, n) { return E(e, t[n]) })); if (i || a) return !1; var s = Object.keys(e), c = Object.keys(t); return s.length === c.length && s.every((function (n) { return E(e[n], t[n]) })) } catch (n) { return !1 } } function j(e, t) { for (var n = 0; n < e.length; n++)if (E(e[n], t)) return n; return -1 } function N(e) { var t = !1; return function () { t || (t = !0, e.apply(this, arguments)) } } var L = "data-server-rendered", I = ["component", "directive", "filter"], M = ["beforeCreate", "created", "beforeMount", "mounted", "beforeUpdate", "updated", "beforeDestroy", "destroyed", "activated", "deactivated", "errorCaptured"], D = { optionMergeStrategies: Object.create(null), silent: !1, productionTip: !1, devtools: !1, performance: !1, errorHandler: null, warnHandler: null, ignoredElements: [], keyCodes: Object.create(null), isReservedTag: S, isReservedAttr: S, isUnknownElement: S, getTagNamespace: O, parsePlatformTagName: T, mustUseProp: S, _lifecycleHooks: M }; function P(e, t, n, r) { Object.defineProperty(e, t, { value: n, enumerable: !!r, writable: !0, configurable: !0 }) } var F, R = /[^\w.$]/, H = "__proto__" in {}, B = "undefined" != typeof window, U = "undefined" != typeof WXEnvironment && !!WXEnvironment.platform, V = U && WXEnvironment.platform.toLowerCase(), z = B && window.navigator.userAgent.toLowerCase(), K = z && /msie|trident/.test(z), J = z && 0 < z.indexOf("msie 9.0"), q = z && 0 < z.indexOf("edge/"), W = (z && z.indexOf("android"), z && /iphone|ipad|ipod|ios/.test(z) || "ios" === V), G = (z && /chrome\/\d+/.test(z), {}.watch), Z = !1; if (B) try { var X = {}; Object.defineProperty(X, "passive", { get: function () { Z = !0 } }), window.addEventListener("test-passive", null, X) } catch (y) { } var Y = function () { return void 0 === F && (F = !B && !U && "undefined" != typeof global && "server" === global.process.env.VUE_ENV), F }, Q = B && window.__VUE_DEVTOOLS_GLOBAL_HOOK__; function ee(e) { return "function" == typeof e && /native code/.test(e.toString()) } var te, ne = "undefined" != typeof Symbol && ee(Symbol) && "undefined" != typeof Reflect && ee(Reflect.ownKeys); te = "undefined" != typeof Set && ee(Set) ? Set : function () { function e() { this.set = Object.create(null) } return e.prototype.has = function (e) { return !0 === this.set[e] }, e.prototype.add = function (e) { this.set[e] = !0 }, e.prototype.clear = function () { this.set = Object.create(null) }, e }(); var re = O, ie = 0, oe = function () { this.id = ie++, this.subs = [] }; oe.prototype.addSub = function (e) { this.subs.push(e) }, oe.prototype.removeSub = function (e) { v(this.subs, e) }, oe.prototype.depend = function () { oe.target && oe.target.addDep(this) }, oe.prototype.notify = function () { for (var e = this.subs.slice(), t = 0, n = e.length; t < n; t++)e[t].update() }, oe.target = null; var ae = []; function se(e) { oe.target && ae.push(oe.target), oe.target = e } function ce() { oe.target = ae.pop() } var le = function (e, t, n, r, i, o, a, s) { this.tag = e, this.data = t, this.children = n, this.text = r, this.elm = i, this.ns = void 0, this.context = o, this.fnContext = void 0, this.fnOptions = void 0, this.fnScopeId = void 0, this.key = t && t.key, this.componentOptions = a, this.componentInstance = void 0, this.parent = void 0, this.raw = !1, this.isStatic = !1, this.isRootInsert = !0, this.isComment = !1, this.isCloned = !1, this.isOnce = !1, this.asyncFactory = s, this.asyncMeta = void 0, this.isAsyncPlaceholder = !1 }, ue = { child: { configurable: !0 } }; ue.child.get = function () { return this.componentInstance }, Object.defineProperties(le.prototype, ue); var fe = function (e) { void 0 === e && (e = ""); var t = new le; return t.text = e, t.isComment = !0, t }; function pe(e) { return new le(void 0, void 0, void 0, String(e)) } function de(e) { var t = new le(e.tag, e.data, e.children, e.text, e.elm, e.context, e.componentOptions, e.asyncFactory); return t.ns = e.ns, t.isStatic = e.isStatic, t.key = e.key, t.isComment = e.isComment, t.fnContext = e.fnContext, t.fnOptions = e.fnOptions, t.fnScopeId = e.fnScopeId, t.isCloned = !0, t } var ve = Array.prototype, he = Object.create(ve);["push", "pop", "shift", "unshift", "splice", "sort", "reverse"].forEach((function (e) { var t = ve[e]; P(he, e, (function () { for (var n = [], r = arguments.length; r--;)n[r] = arguments[r]; var i, o = t.apply(this, n), a = this.__ob__; switch (e) { case "push": case "unshift": i = n; break; case "splice": i = n.slice(2) }return i && a.observeArray(i), a.dep.notify(), o })) })); var me = Object.getOwnPropertyNames(he), ye = !0; function ge(e) { ye = e } var _e = function (e) { this.value = e, this.dep = new oe, this.vmCount = 0, P(e, "__ob__", this), Array.isArray(e) ? ((H ? be : $e)(e, he, me), this.observeArray(e)) : this.walk(e) }; function be(e, t, n) { e.__proto__ = t } function $e(e, t, n) { for (var r = 0, i = n.length; r < i; r++) { var o = n[r]; P(e, o, t[o]) } } function we(e, t) { var n; if (o(e) && !(e instanceof le)) return m(e, "__ob__") && e.__ob__ instanceof _e ? n = e.__ob__ : ye && !Y() && (Array.isArray(e) || s(e)) && Object.isExtensible(e) && !e._isVue && (n = new _e(e)), t && n && n.vmCount++, n } function Ce(e, t, n, r, i) { var o = new oe, a = Object.getOwnPropertyDescriptor(e, t); if (!a || !1 !== a.configurable) { var s = a && a.get; s || 2 !== arguments.length || (n = e[t]); var c = a && a.set, l = !i && we(n); Object.defineProperty(e, t, { enumerable: !0, configurable: !0, get: function () { var t = s ? s.call(e) : n; return oe.target && (o.depend(), l && (l.dep.depend(), Array.isArray(t) && function e(t) { for (var n = void 0, r = 0, i = t.length; r < i; r++)(n = t[r]) && n.__ob__ && n.__ob__.dep.depend(), Array.isArray(n) && e(n) }(t))), t }, set: function (t) { var r = s ? s.call(e) : n; t === r || t != t && r != r || (c ? c.call(e, t) : n = t, l = !i && we(t), o.notify()) } }) } } function xe(e, t, n) { if (Array.isArray(e) && c(t)) return e.length = Math.max(e.length, t), e.splice(t, 1, n), n; if (t in e && !(t in Object.prototype)) return e[t] = n; var r = e.__ob__; return e._isVue || r && r.vmCount ? n : r ? (Ce(r.value, t, n), r.dep.notify(), n) : e[t] = n } function ke(e, t) { if (Array.isArray(e) && c(t)) e.splice(t, 1); else { var n = e.__ob__; e._isVue || n && n.vmCount || m(e, t) && (delete e[t], n && n.dep.notify()) } } _e.prototype.walk = function (e) { for (var t = Object.keys(e), n = 0; n < t.length; n++)Ce(e, t[n]) }, _e.prototype.observeArray = function (e) { for (var t = 0, n = e.length; t < n; t++)we(e[t]) }; var Ae = D.optionMergeStrategies; function Oe(e, t) { if (!t) return e; for (var n, r, i, o = Object.keys(t), a = 0; a < o.length; a++)r = e[n = o[a]], i = t[n], m(e, n) ? s(r) && s(i) && Oe(r, i) : xe(e, n, i); return e } function Se(e, t, n) { return n ? function () { var r = "function" == typeof t ? t.call(n, n) : t, i = "function" == typeof e ? e.call(n, n) : e; return r ? Oe(r, i) : i } : t ? e ? function () { return Oe("function" == typeof t ? t.call(this, this) : t, "function" == typeof e ? e.call(this, this) : e) } : t : e } function Te(e, t) { return t ? e ? e.concat(t) : Array.isArray(t) ? t : [t] : e } function Ee(e, t, n, r) { var i = Object.create(e || null); return t ? k(i, t) : i } Ae.data = function (e, t, n) { return n ? Se(e, t, n) : t && "function" != typeof t ? e : Se(e, t) }, M.forEach((function (e) { Ae[e] = Te })), I.forEach((function (e) { Ae[e + "s"] = Ee })), Ae.watch = function (e, t, n, r) { if (e === G && (e = void 0), t === G && (t = void 0), !t) return Object.create(e || null); if (!e) return t; var i = {}; for (var o in k(i, e), t) { var a = i[o], s = t[o]; a && !Array.isArray(a) && (a = [a]), i[o] = a ? a.concat(s) : Array.isArray(s) ? s : [s] } return i }, Ae.props = Ae.methods = Ae.inject = Ae.computed = function (e, t, n, r) { if (!e) return t; var i = Object.create(null); return k(i, e), t && k(i, t), i }, Ae.provide = Se; var je = function (e, t) { return void 0 === t ? e : t }; function Ne(e, t, n) { "function" == typeof t && (t = t.options), function (e, t) { var n = e.props; if (n) { var r, i, o = {}; if (Array.isArray(n)) for (r = n.length; r--;)"string" == typeof (i = n[r]) && (o[_(i)] = { type: null }); else if (s(n)) for (var a in n) i = n[a], o[_(a)] = s(i) ? i : { type: i }; e.props = o } }(t), function (e, t) { var n = e.inject; if (n) { var r = e.inject = {}; if (Array.isArray(n)) for (var i = 0; i < n.length; i++)r[n[i]] = { from: n[i] }; else if (s(n)) for (var o in n) { var a = n[o]; r[o] = s(a) ? k({ from: o }, a) : { from: a } } } }(t), function (e) { var t = e.directives; if (t) for (var n in t) { var r = t[n]; "function" == typeof r && (t[n] = { bind: r, update: r }) } }(t); var r = t.extends; if (r && (e = Ne(e, r, n)), t.mixins) for (var i = 0, o = t.mixins.length; i < o; i++)e = Ne(e, t.mixins[i], n); var a, c = {}; for (a in e) l(a); for (a in t) m(e, a) || l(a); function l(r) { var i = Ae[r] || je; c[r] = i(e[r], t[r], n, r) } return c } function Le(e, t, n, r) { if ("string" == typeof n) { var i = e[t]; if (m(i, n)) return i[n]; var o = _(n); if (m(i, o)) return i[o]; var a = b(o); return m(i, a) ? i[a] : i[n] || i[o] || i[a] } } function Ie(e, t, n, r) { var i = t[e], o = !m(n, e), a = n[e], s = Pe(Boolean, i.type); if (-1 < s) if (o && !m(i, "default")) a = !1; else if ("" === a || a === w(e)) { var c = Pe(String, i.type); (c < 0 || s < c) && (a = !0) } if (void 0 === a) { a = function (e, t, n) { if (m(t, "default")) { var r = t.default; return e && e.$options.propsData && void 0 === e.$options.propsData[n] && void 0 !== e._props[n] ? e._props[n] : "function" == typeof r && "Function" !== Me(t.type) ? r.call(e) : r } }(r, i, e); var l = ye; ge(!0), we(a), ge(l) } return a } function Me(e) { var t = e && e.toString().match(/^\s*function (\w+)/); return t ? t[1] : "" } function De(e, t) { return Me(e) === Me(t) } function Pe(e, t) { if (!Array.isArray(t)) return De(t, e) ? 0 : -1; for (var n = 0, r = t.length; n < r; n++)if (De(t[n], e)) return n; return -1 } function Fe(e, t, n) { if (t) for (var r = t; r = r.$parent;) { var i = r.$options.errorCaptured; if (i) for (var o = 0; o < i.length; o++)try { if (!1 === i[o].call(r, e, t, n)) return } catch (e) { Re(e, r, "errorCaptured hook") } } Re(e, t, n) } function Re(e, t, n) { if (D.errorHandler) try { return D.errorHandler.call(null, e, t, n) } catch (e) { He(e, null, "config.errorHandler") } He(e, t, n) } function He(e, t, n) { if (!B && !U || "undefined" == typeof console) throw e; console.error(e) } var Be, Ue, Ve = [], ze = !1; function Ke() { ze = !1; for (var e = Ve.slice(0), t = Ve.length = 0; t < e.length; t++)e[t]() } var Je = !1; if ("undefined" != typeof setImmediate && ee(setImmediate)) Ue = function () { setImmediate(Ke) }; else if ("undefined" == typeof MessageChannel || !ee(MessageChannel) && "[object MessageChannelConstructor]" !== MessageChannel.toString()) Ue = function () { setTimeout(Ke, 0) }; else { var qe = new MessageChannel, We = qe.port2; qe.port1.onmessage = Ke, Ue = function () { We.postMessage(1) } } if ("undefined" != typeof Promise && ee(Promise)) { var Ge = Promise.resolve(); Be = function () { Ge.then(Ke), W && setTimeout(O) } } else Be = Ue; function Ze(e, t) { var n; if (Ve.push((function () { if (e) try { e.call(t) } catch (e) { Fe(e, t, "nextTick") } else n && n(t) })), ze || (ze = !0, Je ? Ue() : Be()), !e && "undefined" != typeof Promise) return new Promise((function (e) { n = e })) } var Xe = new te; function Ye(e) { !function e(t, n) { var r, i, a = Array.isArray(t); if (!(!a && !o(t) || Object.isFrozen(t) || t instanceof le)) { if (t.__ob__) { var s = t.__ob__.dep.id; if (n.has(s)) return; n.add(s) } if (a) for (r = t.length; r--;)e(t[r], n); else for (r = (i = Object.keys(t)).length; r--;)e(t[i[r]], n) } }(e, Xe), Xe.clear() } var Qe, et = y((function (e) { var t = "&" === e.charAt(0), n = "~" === (e = t ? e.slice(1) : e).charAt(0), r = "!" === (e = n ? e.slice(1) : e).charAt(0); return { name: e = r ? e.slice(1) : e, once: n, capture: r, passive: t } })); function tt(e) { function t() { var e = arguments, n = t.fns; if (!Array.isArray(n)) return n.apply(null, arguments); for (var r = n.slice(), i = 0; i < r.length; i++)r[i].apply(null, e) } return t.fns = e, t } function nt(e, n, r, i, o) { var a, s, c, l; for (a in e) s = e[a], c = n[a], l = et(a), t(s) || (t(c) ? (t(s.fns) && (s = e[a] = tt(s)), r(l.name, s, l.once, l.capture, l.passive, l.params)) : s !== c && (c.fns = s, e[a] = c)); for (a in n) t(e[a]) && i((l = et(a)).name, n[a], l.capture) } function rt(e, i, o) { var a; e instanceof le && (e = e.data.hook || (e.data.hook = {})); var s = e[i]; function c() { o.apply(this, arguments), v(a.fns, c) } t(s) ? a = tt([c]) : n(s.fns) && r(s.merged) ? (a = s).fns.push(c) : a = tt([s, c]), a.merged = !0, e[i] = a } function it(e, t, r, i, o) { if (n(t)) { if (m(t, r)) return e[r] = t[r], o || delete t[r], !0; if (m(t, i)) return e[r] = t[i], o || delete t[i], !0 } return !1 } function ot(e) { return i(e) ? [pe(e)] : Array.isArray(e) ? function e(o, a) { var s, c, l, u, f = []; for (s = 0; s < o.length; s++)t(c = o[s]) || "boolean" == typeof c || (u = f[l = f.length - 1], Array.isArray(c) ? 0 < c.length && (at((c = e(c, (a || "") + "_" + s))[0]) && at(u) && (f[l] = pe(u.text + c[0].text), c.shift()), f.push.apply(f, c)) : i(c) ? at(u) ? f[l] = pe(u.text + c) : "" !== c && f.push(pe(c)) : at(c) && at(u) ? f[l] = pe(u.text + c.text) : (r(o._isVList) && n(c.tag) && t(c.key) && n(a) && (c.key = "__vlist" + a + "_" + s + "__"), f.push(c))); return f }(e) : void 0 } function at(e) { return n(e) && n(e.text) && !1 === e.isComment } function st(e, t) { return (e.__esModule || ne && "Module" === e[Symbol.toStringTag]) && (e = e.default), o(e) ? t.extend(e) : e } function ct(e) { return e.isComment && e.asyncFactory } function lt(e) { if (Array.isArray(e)) for (var t = 0; t < e.length; t++) { var r = e[t]; if (n(r) && (n(r.componentOptions) || ct(r))) return r } } function ut(e, t, n) { n ? Qe.$once(e, t) : Qe.$on(e, t) } function ft(e, t) { Qe.$off(e, t) } function pt(e, t, n) { Qe = e, nt(t, n || {}, ut, ft), Qe = void 0 } function dt(e, t) { var n = {}; if (!e) return n; for (var r = 0, i = e.length; r < i; r++) { var o = e[r], a = o.data; if (a && a.attrs && a.attrs.slot && delete a.attrs.slot, o.context !== t && o.fnContext !== t || !a || null == a.slot) (n.default || (n.default = [])).push(o); else { var s = a.slot, c = n[s] || (n[s] = []); "template" === o.tag ? c.push.apply(c, o.children || []) : c.push(o) } } for (var l in n) n[l].every(vt) && delete n[l]; return n } function vt(e) { return e.isComment && !e.asyncFactory || " " === e.text } function ht(e, t) { t = t || {}; for (var n = 0; n < e.length; n++)Array.isArray(e[n]) ? ht(e[n], t) : t[e[n].key] = e[n].fn; return t } var mt = null; function yt(e) { for (; e && (e = e.$parent);)if (e._inactive) return !0; return !1 } function gt(e, t) { if (t) { if (e._directInactive = !1, yt(e)) return } else if (e._directInactive) return; if (e._inactive || null === e._inactive) { e._inactive = !1; for (var n = 0; n < e.$children.length; n++)gt(e.$children[n]); _t(e, "activated") } } function _t(e, t) { se(); var n = e.$options[t]; if (n) for (var r = 0, i = n.length; r < i; r++)try { n[r].call(e) } catch (n) { Fe(n, e, t + " hook") } e._hasHookEvent && e.$emit("hook:" + t), ce() } var bt = [], $t = [], wt = {}, Ct = !1, xt = !1, kt = 0; function At() { var e, t; for (xt = !0, bt.sort((function (e, t) { return e.id - t.id })), kt = 0; kt < bt.length; kt++)t = (e = bt[kt]).id, wt[t] = null, e.run(); var n = $t.slice(), r = bt.slice(); kt = bt.length = $t.length = 0, wt = {}, Ct = xt = !1, function (e) { for (var t = 0; t < e.length; t++)e[t]._inactive = !0, gt(e[t], !0) }(n), function (e) { for (var t = e.length; t--;) { var n = e[t], r = n.vm; r._watcher === n && r._isMounted && _t(r, "updated") } }(r), Q && D.devtools && Q.emit("flush") } var Ot = 0, St = function (e, t, n, r, i) { this.vm = e, i && (e._watcher = this), e._watchers.push(this), r ? (this.deep = !!r.deep, this.user = !!r.user, this.lazy = !!r.lazy, this.sync = !!r.sync) : this.deep = this.user = this.lazy = this.sync = !1, this.cb = n, this.id = ++Ot, this.active = !0, this.dirty = this.lazy, this.deps = [], this.newDeps = [], this.depIds = new te, this.newDepIds = new te, this.expression = "", "function" == typeof t ? this.getter = t : (this.getter = function (e) { if (!R.test(e)) { var t = e.split("."); return function (e) { for (var n = 0; n < t.length; n++) { if (!e) return; e = e[t[n]] } return e } } }(t), this.getter || (this.getter = function () { })), this.value = this.lazy ? void 0 : this.get() }; St.prototype.get = function () { var e; se(this); var t = this.vm; try { e = this.getter.call(t, t) } catch (e) { if (!this.user) throw e; Fe(e, t, 'getter for watcher "' + this.expression + '"') } finally { this.deep && Ye(e), ce(), this.cleanupDeps() } return e }, St.prototype.addDep = function (e) { var t = e.id; this.newDepIds.has(t) || (this.newDepIds.add(t), this.newDeps.push(e), this.depIds.has(t) || e.addSub(this)) }, St.prototype.cleanupDeps = function () { for (var e = this.deps.length; e--;) { var t = this.deps[e]; this.newDepIds.has(t.id) || t.removeSub(this) } var n = this.depIds; this.depIds = this.newDepIds, this.newDepIds = n, this.newDepIds.clear(), n = this.deps, this.deps = this.newDeps, this.newDeps = n, this.newDeps.length = 0 }, St.prototype.update = function () { this.lazy ? this.dirty = !0 : this.sync ? this.run() : function (e) { var t = e.id; if (null == wt[t]) { if (wt[t] = !0, xt) { for (var n = bt.length - 1; kt < n && bt[n].id > e.id;)n--; bt.splice(n + 1, 0, e) } else bt.push(e); Ct || (Ct = !0, Ze(At)) } }(this) }, St.prototype.run = function () { if (this.active) { var e = this.get(); if (e !== this.value || o(e) || this.deep) { var t = this.value; if (this.value = e, this.user) try { this.cb.call(this.vm, e, t) } catch (e) { Fe(e, this.vm, 'callback for watcher "' + this.expression + '"') } else this.cb.call(this.vm, e, t) } } }, St.prototype.evaluate = function () { this.value = this.get(), this.dirty = !1 }, St.prototype.depend = function () { for (var e = this.deps.length; e--;)this.deps[e].depend() }, St.prototype.teardown = function () { if (this.active) { this.vm._isBeingDestroyed || v(this.vm._watchers, this); for (var e = this.deps.length; e--;)this.deps[e].removeSub(this); this.active = !1 } }; var Tt = { enumerable: !0, configurable: !0, get: O, set: O }; function Et(e, t, n) { Tt.get = function () { return this[t][n] }, Tt.set = function (e) { this[t][n] = e }, Object.defineProperty(e, n, Tt) } var jt = { lazy: !0 }; function Nt(e, t, n) { var r = !Y(); "function" == typeof n ? (Tt.get = r ? Lt(t) : n, Tt.set = O) : (Tt.get = n.get ? r && !1 !== n.cache ? Lt(t) : n.get : O, Tt.set = n.set ? n.set : O), Object.defineProperty(e, t, Tt) } function Lt(e) { return function () { var t = this._computedWatchers && this._computedWatchers[e]; if (t) return t.dirty && t.evaluate(), oe.target && t.depend(), t.value } } function It(e, t, n, r) { return s(n) && (n = (r = n).handler), "string" == typeof n && (n = e[n]), e.$watch(t, n, r) } function Mt(e, t) { if (e) { for (var n = Object.create(null), r = ne ? Reflect.ownKeys(e).filter((function (t) { return Object.getOwnPropertyDescriptor(e, t).enumerable })) : Object.keys(e), i = 0; i < r.length; i++) { for (var o = r[i], a = e[o].from, s = t; s;) { if (s._provided && m(s._provided, a)) { n[o] = s._provided[a]; break } s = s.$parent } if (!s && "default" in e[o]) { var c = e[o].default; n[o] = "function" == typeof c ? c.call(t) : c } } return n } } function Dt(e, t) { var r, i, a, s, c; if (Array.isArray(e) || "string" == typeof e) for (r = new Array(e.length), i = 0, a = e.length; i < a; i++)r[i] = t(e[i], i); else if ("number" == typeof e) for (r = new Array(e), i = 0; i < e; i++)r[i] = t(i + 1, i); else if (o(e)) for (s = Object.keys(e), r = new Array(s.length), i = 0, a = s.length; i < a; i++)c = s[i], r[i] = t(e[c], c, i); return n(r) && (r._isVList = !0), r } function Pt(e, t, n, r) { var i, o = this.$scopedSlots[e]; if (o) n = n || {}, r && (n = k(k({}, r), n)), i = o(n) || t; else { var a = this.$slots[e]; a && (a._rendered = !0), i = a || t } var s = n && n.slot; return s ? this.$createElement("template", { slot: s }, i) : i } function Ft(e) { return Le(this.$options, "filters", e) || T } function Rt(e, t) { return Array.isArray(e) ? -1 === e.indexOf(t) : e !== t } function Ht(e, t, n, r, i) { var o = D.keyCodes[t] || n; return i && r && !D.keyCodes[t] ? Rt(i, r) : o ? Rt(o, e) : r ? w(r) !== t : void 0 } function Bt(e, t, n, r, i) { if (n && o(n)) { var a; Array.isArray(n) && (n = A(n)); var s = function (o) { if ("class" === o || "style" === o || d(o)) a = e; else { var s = e.attrs && e.attrs.type; a = r || D.mustUseProp(t, s, o) ? e.domProps || (e.domProps = {}) : e.attrs || (e.attrs = {}) } o in a || (a[o] = n[o], i && ((e.on || (e.on = {}))["update:" + o] = function (e) { n[o] = e })) }; for (var c in n) s(c) } return e } function Ut(e, t) { var n = this._staticTrees || (this._staticTrees = []), r = n[e]; return r && !t || zt(r = n[e] = this.$options.staticRenderFns[e].call(this._renderProxy, null, this), "__static__" + e, !1), r } function Vt(e, t, n) { return zt(e, "__once__" + t + (n ? "_" + n : ""), !0), e } function zt(e, t, n) { if (Array.isArray(e)) for (var r = 0; r < e.length; r++)e[r] && "string" != typeof e[r] && Kt(e[r], t + "_" + r, n); else Kt(e, t, n) } function Kt(e, t, n) { e.isStatic = !0, e.key = t, e.isOnce = n } function Jt(e, t) { if (t && s(t)) { var n = e.on = e.on ? k({}, e.on) : {}; for (var r in t) { var i = n[r], o = t[r]; n[r] = i ? [].concat(i, o) : o } } return e } function qt(e) { e._o = Vt, e._n = u, e._s = l, e._l = Dt, e._t = Pt, e._q = E, e._i = j, e._m = Ut, e._f = Ft, e._k = Ht, e._b = Bt, e._v = pe, e._e = fe, e._u = ht, e._g = Jt } function Wt(t, n, i, o, a) { var s, c = a.options; m(o, "_uid") ? (s = Object.create(o))._original = o : o = (s = o)._original; var l = r(c._compiled), u = !l; this.data = t, this.props = n, this.children = i, this.parent = o, this.listeners = t.on || e, this.injections = Mt(c.inject, o), this.slots = function () { return dt(i, o) }, l && (this.$options = c, this.$slots = this.slots(), this.$scopedSlots = t.scopedSlots || e), c._scopeId ? this._c = function (e, t, n, r) { var i = en(s, e, t, n, r, u); return i && !Array.isArray(i) && (i.fnScopeId = c._scopeId, i.fnContext = o), i } : this._c = function (e, t, n, r) { return en(s, e, t, n, r, u) } } function Gt(e, t, n, r) { var i = de(e); return i.fnContext = n, i.fnOptions = r, t.slot && ((i.data || (i.data = {})).slot = t.slot), i } function Zt(e, t) { for (var n in t) e[_(n)] = t[n] } qt(Wt.prototype); var Xt = { init: function (e, t, r, i) { if (e.componentInstance && !e.componentInstance._isDestroyed && e.data.keepAlive) { var o = e; Xt.prepatch(o, o) } else (e.componentInstance = function (e, t, r, i) { var o = { _isComponent: !0, parent: t, _parentVnode: e, _parentElm: r || null, _refElm: i || null }, a = e.data.inlineTemplate; return n(a) && (o.render = a.render, o.staticRenderFns = a.staticRenderFns), new e.componentOptions.Ctor(o) }(e, mt, r, i)).$mount(t ? e.elm : void 0, t) }, prepatch: function (t, n) { var r = n.componentOptions; !function (t, n, r, i, o) { var a = !!(o || t.$options._renderChildren || i.data.scopedSlots || t.$scopedSlots !== e); if (t.$options._parentVnode = i, t.$vnode = i, t._vnode && (t._vnode.parent = i), t.$options._renderChildren = o, t.$attrs = i.data.attrs || e, t.$listeners = r || e, n && t.$options.props) { ge(!1); for (var s = t._props, c = t.$options._propKeys || [], l = 0; l < c.length; l++) { var u = c[l], f = t.$options.props; s[u] = Ie(u, f, n, t) } ge(!0), t.$options.propsData = n } r = r || e; var p = t.$options._parentListeners; t.$options._parentListeners = r, pt(t, r, p), a && (t.$slots = dt(o, i.context), t.$forceUpdate()) }(n.componentInstance = t.componentInstance, r.propsData, r.listeners, n, r.children) }, insert: function (e) { var t, n = e.context, r = e.componentInstance; r._isMounted || (r._isMounted = !0, _t(r, "mounted")), e.data.keepAlive && (n._isMounted ? ((t = r)._inactive = !1, $t.push(t)) : gt(r, !0)) }, destroy: function (e) { var t = e.componentInstance; t._isDestroyed || (e.data.keepAlive ? function e(t, n) { if (!(n && (t._directInactive = !0, yt(t)) || t._inactive)) { t._inactive = !0; for (var r = 0; r < t.$children.length; r++)e(t.$children[r]); _t(t, "deactivated") } }(t, !0) : t.$destroy()) } }, Yt = Object.keys(Xt); function Qt(i, a, s, c, l) { if (!t(i)) { var u = s.$options._base; if (o(i) && (i = u.extend(i)), "function" == typeof i) { var f, p, d, v, h, m, y; if (t(i.cid) && void 0 === (i = function (e, i, a) { if (r(e.error) && n(e.errorComp)) return e.errorComp; if (n(e.resolved)) return e.resolved; if (r(e.loading) && n(e.loadingComp)) return e.loadingComp; if (!n(e.contexts)) { var s = e.contexts = [a], c = !0, l = function () { for (var e = 0, t = s.length; e < t; e++)s[e].$forceUpdate() }, u = N((function (t) { e.resolved = st(t, i), c || l() })), f = N((function (t) { n(e.errorComp) && (e.error = !0, l()) })), p = e(u, f); return o(p) && ("function" == typeof p.then ? t(e.resolved) && p.then(u, f) : n(p.component) && "function" == typeof p.component.then && (p.component.then(u, f), n(p.error) && (e.errorComp = st(p.error, i)), n(p.loading) && (e.loadingComp = st(p.loading, i), 0 === p.delay ? e.loading = !0 : setTimeout((function () { t(e.resolved) && t(e.error) && (e.loading = !0, l()) }), p.delay || 200)), n(p.timeout) && setTimeout((function () { t(e.resolved) && f(null) }), p.timeout))), c = !1, e.loading ? e.loadingComp : e.resolved } e.contexts.push(a) }(f = i, u, s))) return p = f, d = a, v = s, h = c, m = l, (y = fe()).asyncFactory = p, y.asyncMeta = { data: d, context: v, children: h, tag: m }, y; a = a || {}, un(i), n(a.model) && function (e, t) { var r = e.model && e.model.prop || "value", i = e.model && e.model.event || "input"; (t.props || (t.props = {}))[r] = t.model.value; var o = t.on || (t.on = {}); n(o[i]) ? o[i] = [t.model.callback].concat(o[i]) : o[i] = t.model.callback }(i.options, a); var g = function (e, r, i) { var o = r.options.props; if (!t(o)) { var a = {}, s = e.attrs, c = e.props; if (n(s) || n(c)) for (var l in o) { var u = w(l); it(a, c, l, u, !0) || it(a, s, l, u, !1) } return a } }(a, i); if (r(i.options.functional)) return function (t, r, i, o, a) { var s = t.options, c = {}, l = s.props; if (n(l)) for (var u in l) c[u] = Ie(u, l, r || e); else n(i.attrs) && Zt(c, i.attrs), n(i.props) && Zt(c, i.props); var f = new Wt(i, c, a, o, t), p = s.render.call(null, f._c, f); if (p instanceof le) return Gt(p, i, f.parent, s); if (Array.isArray(p)) { for (var d = ot(p) || [], v = new Array(d.length), h = 0; h < d.length; h++)v[h] = Gt(d[h], i, f.parent, s); return v } }(i, g, a, s, c); var _ = a.on; if (a.on = a.nativeOn, r(i.options.abstract)) { var b = a.slot; a = {}, b && (a.slot = b) } !function (e) { for (var t = e.hook || (e.hook = {}), n = 0; n < Yt.length; n++) { var r = Yt[n]; t[r] = Xt[r] } }(a); var $ = i.options.name || l; return new le("vue-component-" + i.cid + ($ ? "-" + $ : ""), a, void 0, void 0, void 0, s, { Ctor: i, propsData: g, listeners: _, tag: l, children: c }, f) } } } function en(e, a, s, c, l, u) { return (Array.isArray(s) || i(s)) && (l = c, c = s, s = void 0), r(u) && (l = 2), function (e, i, a, s, c) { if (n(a) && n(a.__ob__)) return fe(); if (n(a) && n(a.is) && (i = a.is), !i) return fe(); var l, u, f; (Array.isArray(s) && "function" == typeof s[0] && ((a = a || {}).scopedSlots = { default: s[0] }, s.length = 0), 2 === c ? s = ot(s) : 1 === c && (s = function (e) { for (var t = 0; t < e.length; t++)if (Array.isArray(e[t])) return Array.prototype.concat.apply([], e); return e }(s)), "string" == typeof i) ? (u = e.$vnode && e.$vnode.ns || D.getTagNamespace(i), l = D.isReservedTag(i) ? new le(D.parsePlatformTagName(i), a, s, void 0, void 0, e) : n(f = Le(e.$options, "components", i)) ? Qt(f, a, e, s, i) : new le(i, a, s, void 0, void 0, e)) : l = Qt(i, a, e, s); return Array.isArray(l) ? l : n(l) ? (n(u) && function e(i, o, a) { if (i.ns = o, "foreignObject" === i.tag && (o = void 0, a = !0), n(i.children)) for (var s = 0, c = i.children.length; s < c; s++) { var l = i.children[s]; n(l.tag) && (t(l.ns) || r(a) && "svg" !== l.tag) && e(l, o, a) } }(l, u), n(a) && function (e) { o(e.style) && Ye(e.style), o(e.class) && Ye(e.class) }(a), l) : fe() }(e, a, s, c, l) } var tn, nn, rn, on, an, sn, cn, ln = 0; function un(e) { var t = e.options; if (e.super) { var n = un(e.super); if (n !== e.superOptions) { e.superOptions = n; var r = function (e) { var t, n = e.options, r = e.extendOptions, i = e.sealedOptions; for (var o in n) n[o] !== i[o] && (t || (t = {}), t[o] = fn(n[o], r[o], i[o])); return t }(e); r && k(e.extendOptions, r), (t = e.options = Ne(n, e.extendOptions)).name && (t.components[t.name] = e) } } return t } function fn(e, t, n) { if (Array.isArray(e)) { var r = []; n = Array.isArray(n) ? n : [n], t = Array.isArray(t) ? t : [t]; for (var i = 0; i < e.length; i++)(0 <= t.indexOf(e[i]) || n.indexOf(e[i]) < 0) && r.push(e[i]); return r } return e } function pn(e) { this._init(e) } function dn(e) { return e && (e.Ctor.options.name || e.tag) } function vn(e, t) { return Array.isArray(e) ? -1 < e.indexOf(t) : "string" == typeof e ? -1 < e.split(",").indexOf(t) : (n = e, "[object RegExp]" === a.call(n) && e.test(t)); var n } function hn(e, t) { var n = e.cache, r = e.keys, i = e._vnode; for (var o in n) { var a = n[o]; if (a) { var s = dn(a.componentOptions); s && !t(s) && mn(n, o, r, i) } } } function mn(e, t, n, r) { var i = e[t]; !i || r && i.tag === r.tag || i.componentInstance.$destroy(), e[t] = null, v(n, t) } pn.prototype._init = function (t) { var n, r, i, o, a = this; a._uid = ln++, a._isVue = !0, t && t._isComponent ? function (e, t) { var n = e.$options = Object.create(e.constructor.options), r = t._parentVnode; n.parent = t.parent, n._parentVnode = r, n._parentElm = t._parentElm, n._refElm = t._refElm; var i = r.componentOptions; n.propsData = i.propsData, n._parentListeners = i.listeners, n._renderChildren = i.children, n._componentTag = i.tag, t.render && (n.render = t.render, n.staticRenderFns = t.staticRenderFns) }(a, t) : a.$options = Ne(un(a.constructor), t || {}, a), function (e) { var t = e.$options, n = t.parent; if (n && !t.abstract) { for (; n.$options.abstract && n.$parent;)n = n.$parent; n.$children.push(e) } e.$parent = n, e.$root = n ? n.$root : e, e.$children = [], e.$refs = {}, e._watcher = null, e._inactive = null, e._directInactive = !1, e._isMounted = !1, e._isDestroyed = !1, e._isBeingDestroyed = !1 }((a._renderProxy = a)._self = a), function (e) { e._events = Object.create(null), e._hasHookEvent = !1; var t = e.$options._parentListeners; t && pt(e, t) }(a), function (t) { t._vnode = null, t._staticTrees = null; var n = t.$options, r = t.$vnode = n._parentVnode, i = r && r.context; t.$slots = dt(n._renderChildren, i), t.$scopedSlots = e, t._c = function (e, n, r, i) { return en(t, e, n, r, i, !1) }, t.$createElement = function (e, n, r, i) { return en(t, e, n, r, i, !0) }; var o = r && r.data; Ce(t, "$attrs", o && o.attrs || e, null, !0), Ce(t, "$listeners", n._parentListeners || e, null, !0) }(a), _t(a, "beforeCreate"), (r = Mt((n = a).$options.inject, n)) && (ge(!1), Object.keys(r).forEach((function (e) { Ce(n, e, r[e]) })), ge(!0)), function (e) { e._watchers = []; var t = e.$options; t.props && function (e, t) { var n = e.$options.propsData || {}, r = e._props = {}, i = e.$options._propKeys = []; e.$parent && ge(!1); var o = function (o) { i.push(o); var a = Ie(o, t, n, e); Ce(r, o, a), o in e || Et(e, "_props", o) }; for (var a in t) o(a); ge(!0) }(e, t.props), t.methods && function (e, t) { for (var n in e.$options.props, t) e[n] = null == t[n] ? O : C(t[n], e) }(e, t.methods), t.data ? function (e) { var t = e.$options.data; s(t = e._data = "function" == typeof t ? function (e, t) { se(); try { return e.call(t, t) } catch (e) { return Fe(e, t, "data()"), {} } finally { ce() } }(t, e) : t || {}) || (t = {}); for (var n, r = Object.keys(t), i = e.$options.props, o = (e.$options.methods, r.length); o--;) { var a = r[o]; i && m(i, a) || 36 !== (n = (a + "").charCodeAt(0)) && 95 !== n && Et(e, "_data", a) } we(t, !0) }(e) : we(e._data = {}, !0), t.computed && function (e, t) { var n = e._computedWatchers = Object.create(null), r = Y(); for (var i in t) { var o = t[i], a = "function" == typeof o ? o : o.get; r || (n[i] = new St(e, a || O, O, jt)), i in e || Nt(e, i, o) } }(e, t.computed), t.watch && t.watch !== G && function (e, t) { for (var n in t) { var r = t[n]; if (Array.isArray(r)) for (var i = 0; i < r.length; i++)It(e, n, r[i]); else It(e, n, r) } }(e, t.watch) }(a), (o = (i = a).$options.provide) && (i._provided = "function" == typeof o ? o.call(i) : o), _t(a, "created"), a.$options.el && a.$mount(a.$options.el) }, tn = pn, nn = { get: function () { return this._data } }, rn = { get: function () { return this._props } }, Object.defineProperty(tn.prototype, "$data", nn), Object.defineProperty(tn.prototype, "$props", rn), tn.prototype.$set = xe, tn.prototype.$delete = ke, tn.prototype.$watch = function (e, t, n) { if (s(t)) return It(this, e, t, n); (n = n || {}).user = !0; var r = new St(this, e, t, n); return n.immediate && t.call(this, r.value), function () { r.teardown() } }, an = /^hook:/, (on = pn).prototype.$on = function (e, t) { if (Array.isArray(e)) for (var n = 0, r = e.length; n < r; n++)this.$on(e[n], t); else (this._events[e] || (this._events[e] = [])).push(t), an.test(e) && (this._hasHookEvent = !0); return this }, on.prototype.$once = function (e, t) { var n = this; function r() { n.$off(e, r), t.apply(n, arguments) } return r.fn = t, n.$on(e, r), n }, on.prototype.$off = function (e, t) { var n = this; if (!arguments.length) return n._events = Object.create(null), n; if (Array.isArray(e)) { for (var r = 0, i = e.length; r < i; r++)this.$off(e[r], t); return n } var o = n._events[e]; if (!o) return n; if (!t) return n._events[e] = null, n; if (t) for (var a, s = o.length; s--;)if ((a = o[s]) === t || a.fn === t) { o.splice(s, 1); break } return n }, on.prototype.$emit = function (e) { var t = this, n = t._events[e]; if (n) { n = 1 < n.length ? x(n) : n; for (var r = x(arguments, 1), i = 0, o = n.length; i < o; i++)try { n[i].apply(t, r) } catch (n) { Fe(n, t, 'event handler for "' + e + '"') } } return t }, (sn = pn).prototype._update = function (e, t) { var n = this; n._isMounted && _t(n, "beforeUpdate"); var r = n.$el, i = n._vnode, o = mt; (mt = n)._vnode = e, i ? n.$el = n.__patch__(i, e) : (n.$el = n.__patch__(n.$el, e, t, !1, n.$options._parentElm, n.$options._refElm), n.$options._parentElm = n.$options._refElm = null), mt = o, r && (r.__vue__ = null), n.$el && (n.$el.__vue__ = n), n.$vnode && n.$parent && n.$vnode === n.$parent._vnode && (n.$parent.$el = n.$el) }, sn.prototype.$forceUpdate = function () { this._watcher && this._watcher.update() }, sn.prototype.$destroy = function () { var e = this; if (!e._isBeingDestroyed) { _t(e, "beforeDestroy"), e._isBeingDestroyed = !0; var t = e.$parent; !t || t._isBeingDestroyed || e.$options.abstract || v(t.$children, e), e._watcher && e._watcher.teardown(); for (var n = e._watchers.length; n--;)e._watchers[n].teardown(); e._data.__ob__ && e._data.__ob__.vmCount--, e._isDestroyed = !0, e.__patch__(e._vnode, null), _t(e, "destroyed"), e.$off(), e.$el && (e.$el.__vue__ = null), e.$vnode && (e.$vnode.parent = null) } }, qt((cn = pn).prototype), cn.prototype.$nextTick = function (e) { return Ze(e, this) }, cn.prototype._render = function () { var t, n = this, r = n.$options, i = r.render, o = r._parentVnode; o && (n.$scopedSlots = o.data.scopedSlots || e), n.$vnode = o; try { t = i.call(n._renderProxy, n.$createElement) } catch (r) { Fe(r, n, "render"), t = n._vnode } return t instanceof le || (t = fe()), t.parent = o, t }; var yn, gn, _n, bn = [String, RegExp, Array], $n = { KeepAlive: { name: "keep-alive", abstract: !0, props: { include: bn, exclude: bn, max: [String, Number] }, created: function () { this.cache = Object.create(null), this.keys = [] }, destroyed: function () { for (var e in this.cache) mn(this.cache, e, this.keys) }, mounted: function () { var e = this; this.$watch("include", (function (t) { hn(e, (function (e) { return vn(t, e) })) })), this.$watch("exclude", (function (t) { hn(e, (function (e) { return !vn(t, e) })) })) }, render: function () { var e = this.$slots.default, t = lt(e), n = t && t.componentOptions; if (n) { var r = dn(n), i = this.include, o = this.exclude; if (i && (!r || !vn(i, r)) || o && r && vn(o, r)) return t; var a = this.cache, s = this.keys, c = null == t.key ? n.Ctor.cid + (n.tag ? "::" + n.tag : "") : t.key; a[c] ? (t.componentInstance = a[c].componentInstance, v(s, c), s.push(c)) : (a[c] = t, s.push(c), this.max && s.length > parseInt(this.max) && mn(a, s[0], s, this._vnode)), t.data.keepAlive = !0 } return t || e && e[0] } } }; yn = pn, _n = { get: function () { return D } }, Object.defineProperty(yn, "config", _n), yn.util = { warn: re, extend: k, mergeOptions: Ne, defineReactive: Ce }, yn.set = xe, yn.delete = ke, yn.nextTick = Ze, yn.options = Object.create(null), I.forEach((function (e) { yn.options[e + "s"] = Object.create(null) })), k((yn.options._base = yn).options.components, $n), yn.use = function (e) { var t = this._installedPlugins || (this._installedPlugins = []); if (-1 < t.indexOf(e)) return this; var n = x(arguments, 1); return n.unshift(this), "function" == typeof e.install ? e.install.apply(e, n) : "function" == typeof e && e.apply(null, n), t.push(e), this }, yn.mixin = function (e) { return this.options = Ne(this.options, e), this }, function (e) { e.cid = 0; var t = 1; e.extend = function (e) { e = e || {}; var n = this, r = n.cid, i = e._Ctor || (e._Ctor = {}); if (i[r]) return i[r]; var o = e.name || n.options.name, a = function (e) { this._init(e) }; return ((a.prototype = Object.create(n.prototype)).constructor = a).cid = t++, a.options = Ne(n.options, e), a.super = n, a.options.props && function (e) { var t = e.options.props; for (var n in t) Et(e.prototype, "_props", n) }(a), a.options.computed && function (e) { var t = e.options.computed; for (var n in t) Nt(e.prototype, n, t[n]) }(a), a.extend = n.extend, a.mixin = n.mixin, a.use = n.use, I.forEach((function (e) { a[e] = n[e] })), o && (a.options.components[o] = a), a.superOptions = n.options, a.extendOptions = e, a.sealedOptions = k({}, a.options), i[r] = a } }(yn), gn = yn, I.forEach((function (e) { gn[e] = function (t, n) { return n ? ("component" === e && s(n) && (n.name = n.name || t, n = this.options._base.extend(n)), "directive" === e && "function" == typeof n && (n = { bind: n, update: n }), this.options[e + "s"][t] = n) : this.options[e + "s"][t] } })), Object.defineProperty(pn.prototype, "$isServer", { get: Y }), Object.defineProperty(pn.prototype, "$ssrContext", { get: function () { return this.$vnode && this.$vnode.ssrContext } }), Object.defineProperty(pn, "FunctionalRenderContext", { value: Wt }), pn.version = "2.5.17"; var wn = f("style,class"), Cn = f("input,textarea,option,select,progress"), xn = function (e, t, n) { return "value" === n && Cn(e) && "button" !== t || "selected" === n && "option" === e || "checked" === n && "input" === e || "muted" === n && "video" === e }, kn = f("contenteditable,draggable,spellcheck"), An = f("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"), On = "http://www.w3.org/1999/xlink", Sn = function (e) { return ":" === e.charAt(5) && "xlink" === e.slice(0, 5) }, Tn = function (e) { return Sn(e) ? e.slice(6, e.length) : "" }, En = function (e) { return null == e || !1 === e }; function jn(e, t) { return { staticClass: Nn(e.staticClass, t.staticClass), class: n(e.class) ? [e.class, t.class] : t.class } } function Nn(e, t) { return e ? t ? e + " " + t : e : t || "" } function Ln(e) { return Array.isArray(e) ? function (e) { for (var t, r = "", i = 0, o = e.length; i < o; i++)n(t = Ln(e[i])) && "" !== t && (r && (r += " "), r += t); return r }(e) : o(e) ? function (e) { var t = ""; for (var n in e) e[n] && (t && (t += " "), t += n); return t }(e) : "string" == typeof e ? e : "" } var In = { svg: "http://www.w3.org/2000/svg", math: "http://www.w3.org/1998/Math/MathML" }, Mn = f("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"), Dn = f("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view", !0), Pn = function (e) { return Mn(e) || Dn(e) }; function Fn(e) { return Dn(e) ? "svg" : "math" === e ? "math" : void 0 } var Rn = Object.create(null), Hn = f("text,number,password,search,email,tel,url"); function Bn(e) { return "string" == typeof e ? document.querySelector(e) || document.createElement("div") : e } var Un = Object.freeze({ createElement: function (e, t) { var n = document.createElement(e); return "select" !== e || t.data && t.data.attrs && void 0 !== t.data.attrs.multiple && n.setAttribute("multiple", "multiple"), n }, createElementNS: function (e, t) { return document.createElementNS(In[e], t) }, createTextNode: function (e) { return document.createTextNode(e) }, createComment: function (e) { return document.createComment(e) }, insertBefore: function (e, t, n) { e.insertBefore(t, n) }, removeChild: function (e, t) { e.removeChild(t) }, appendChild: function (e, t) { e.appendChild(t) }, parentNode: function (e) { return e.parentNode }, nextSibling: function (e) { return e.nextSibling }, tagName: function (e) { return e.tagName }, setTextContent: function (e, t) { e.textContent = t }, setStyleScope: function (e, t) { e.setAttribute(t, "") } }), Vn = { create: function (e, t) { zn(t) }, update: function (e, t) { e.data.ref !== t.data.ref && (zn(e, !0), zn(t)) }, destroy: function (e) { zn(e, !0) } }; function zn(e, t) { var r = e.data.ref; if (n(r)) { var i = e.context, o = e.componentInstance || e.elm, a = i.$refs; t ? Array.isArray(a[r]) ? v(a[r], o) : a[r] === o && (a[r] = void 0) : e.data.refInFor ? Array.isArray(a[r]) ? a[r].indexOf(o) < 0 && a[r].push(o) : a[r] = [o] : a[r] = o } } var Kn = new le("", {}, []), Jn = ["create", "activate", "update", "remove", "destroy"]; function qn(e, i) { return e.key === i.key && (e.tag === i.tag && e.isComment === i.isComment && n(e.data) === n(i.data) && function (e, t) { if ("input" !== e.tag) return !0; var r, i = n(r = e.data) && n(r = r.attrs) && r.type, o = n(r = t.data) && n(r = r.attrs) && r.type; return i === o || Hn(i) && Hn(o) }(e, i) || r(e.isAsyncPlaceholder) && e.asyncFactory === i.asyncFactory && t(i.asyncFactory.error)) } function Wn(e, t, r) { var i, o, a = {}; for (i = t; i <= r; ++i)n(o = e[i].key) && (a[o] = i); return a } var Gn = { create: Zn, update: Zn, destroy: function (e) { Zn(e, Kn) } }; function Zn(e, t) { (e.data.directives || t.data.directives) && function (e, t) { var n, r, i, o = e === Kn, a = t === Kn, s = Yn(e.data.directives, e.context), c = Yn(t.data.directives, t.context), l = [], u = []; for (n in c) r = s[n], i = c[n], r ? (i.oldValue = r.value, Qn(i, "update", t, e), i.def && i.def.componentUpdated && u.push(i)) : (Qn(i, "bind", t, e), i.def && i.def.inserted && l.push(i)); if (l.length) { var f = function () { for (var n = 0; n < l.length; n++)Qn(l[n], "inserted", t, e) }; o ? rt(t, "insert", f) : f() } if (u.length && rt(t, "postpatch", (function () { for (var n = 0; n < u.length; n++)Qn(u[n], "componentUpdated", t, e) })), !o) for (n in s) c[n] || Qn(s[n], "unbind", e, e, a) }(e, t) } var Xn = Object.create(null); function Yn(e, t) { var n, r, i, o = Object.create(null); if (!e) return o; for (n = 0; n < e.length; n++)(r = e[n]).modifiers || (r.modifiers = Xn), (o[(i = r, i.rawName || i.name + "." + Object.keys(i.modifiers || {}).join("."))] = r).def = Le(t.$options, "directives", r.name); return o } function Qn(e, t, n, r, i) { var o = e.def && e.def[t]; if (o) try { o(n.elm, e, n, r, i) } catch (r) { Fe(r, n.context, "directive " + e.name + " " + t + " hook") } } var er = [Vn, Gn]; function tr(e, r) { var i = r.componentOptions; if (!(n(i) && !1 === i.Ctor.options.inheritAttrs || t(e.data.attrs) && t(r.data.attrs))) { var o, a, s = r.elm, c = e.data.attrs || {}, l = r.data.attrs || {}; for (o in n(l.__ob__) && (l = r.data.attrs = k({}, l)), l) a = l[o], c[o] !== a && nr(s, o, a); for (o in (K || q) && l.value !== c.value && nr(s, "value", l.value), c) t(l[o]) && (Sn(o) ? s.removeAttributeNS(On, Tn(o)) : kn(o) || s.removeAttribute(o)) } } function nr(e, t, n) { -1 < e.tagName.indexOf("-") ? rr(e, t, n) : An(t) ? En(n) ? e.removeAttribute(t) : (n = "allowfullscreen" === t && "EMBED" === e.tagName ? "true" : t, e.setAttribute(t, n)) : kn(t) ? e.setAttribute(t, En(n) || "false" === n ? "false" : "true") : Sn(t) ? En(n) ? e.removeAttributeNS(On, Tn(t)) : e.setAttributeNS(On, t, n) : rr(e, t, n) } function rr(e, t, n) { if (En(n)) e.removeAttribute(t); else { if (K && !J && "TEXTAREA" === e.tagName && "placeholder" === t && !e.__ieph) { var r = function (t) { t.stopImmediatePropagation(), e.removeEventListener("input", r) }; e.addEventListener("input", r), e.__ieph = !0 } e.setAttribute(t, n) } } var ir = { create: tr, update: tr }; function or(e, r) { var i = r.elm, o = r.data, a = e.data; if (!(t(o.staticClass) && t(o.class) && (t(a) || t(a.staticClass) && t(a.class)))) { var s = function (e) { for (var t = e.data, r = e, i = e; n(i.componentInstance);)(i = i.componentInstance._vnode) && i.data && (t = jn(i.data, t)); for (; n(r = r.parent);)r && r.data && (t = jn(t, r.data)); return function (e, t) { return n(e) || n(t) ? Nn(e, Ln(t)) : "" }(t.staticClass, t.class) }(r), c = i._transitionClasses; n(c) && (s = Nn(s, Ln(c))), s !== i._prevClass && (i.setAttribute("class", s), i._prevClass = s) } } var ar, sr, cr, lr, ur, fr, pr = { create: or, update: or }, dr = /[\w).+\-_$\]]/; function vr(e) { var t, n, r, i, o, a = !1, s = !1, c = !1, l = !1, u = 0, f = 0, p = 0, d = 0; for (r = 0; r < e.length; r++)if (n = t, t = e.charCodeAt(r), a) 39 === t && 92 !== n && (a = !1); else if (s) 34 === t && 92 !== n && (s = !1); else if (c) 96 === t && 92 !== n && (c = !1); else if (l) 47 === t && 92 !== n && (l = !1); else if (124 !== t || 124 === e.charCodeAt(r + 1) || 124 === e.charCodeAt(r - 1) || u || f || p) { switch (t) { case 34: s = !0; break; case 39: a = !0; break; case 96: c = !0; break; case 40: p++; break; case 41: p--; break; case 91: f++; break; case 93: f--; break; case 123: u++; break; case 125: u-- }if (47 === t) { for (var v = r - 1, h = void 0; 0 <= v && " " === (h = e.charAt(v)); v--); h && dr.test(h) || (l = !0) } } else void 0 === i ? (d = r + 1, i = e.slice(0, r).trim()) : m(); function m() { (o || (o = [])).push(e.slice(d, r).trim()), d = r + 1 } if (void 0 === i ? i = e.slice(0, r).trim() : 0 !== d && m(), o) for (r = 0; r < o.length; r++)i = hr(i, o[r]); return i } function hr(e, t) { var n = t.indexOf("("); if (n < 0) return '_f("' + t + '")(' + e + ")"; var r = t.slice(0, n), i = t.slice(n + 1); return '_f("' + r + '")(' + e + (")" !== i ? "," + i : i) } function mr(e) { console.error("[Vue compiler]: " + e) } function yr(e, t) { return e ? e.map((function (e) { return e[t] })).filter((function (e) { return e })) : [] } function gr(e, t, n) { (e.props || (e.props = [])).push({ name: t, value: n }), e.plain = !1 } function _r(e, t, n) { (e.attrs || (e.attrs = [])).push({ name: t, value: n }), e.plain = !1 } function br(e, t, n) { e.attrsMap[t] = n, e.attrsList.push({ name: t, value: n }) } function $r(t, n, r, i, o, a) { var s; (i = i || e).capture && (delete i.capture, n = "!" + n), i.once && (delete i.once, n = "~" + n), i.passive && (delete i.passive, n = "&" + n), "click" === n && (i.right ? (n = "contextmenu", delete i.right) : i.middle && (n = "mouseup")), i.native ? (delete i.native, s = t.nativeEvents || (t.nativeEvents = {})) : s = t.events || (t.events = {}); var c = { value: r.trim() }; i !== e && (c.modifiers = i); var l = s[n]; Array.isArray(l) ? o ? l.unshift(c) : l.push(c) : s[n] = l ? o ? [c, l] : [l, c] : c, t.plain = !1 } function wr(e, t, n) { var r = Cr(e, ":" + t) || Cr(e, "v-bind:" + t); if (null != r) return vr(r); if (!1 !== n) { var i = Cr(e, t); if (null != i) return JSON.stringify(i) } } function Cr(e, t, n) { var r; if (null != (r = e.attrsMap[t])) for (var i = e.attrsList, o = 0, a = i.length; o < a; o++)if (i[o].name === t) { i.splice(o, 1); break } return n && delete e.attrsMap[t], r } function xr(e, t, n) { var r = n || {}, i = r.number, o = "$$v"; r.trim && (o = "(typeof $$v === 'string'? $$v.trim(): $$v)"), i && (o = "_n(" + o + ")"); var a = kr(t, o); e.model = { value: "(" + t + ")", expression: '"' + t + '"', callback: "function ($$v) {" + a + "}" } } function kr(e, t) { var n = function (e) { if (e = e.trim(), ar = e.length, e.indexOf("[") < 0 || e.lastIndexOf("]") < ar - 1) return -1 < (lr = e.lastIndexOf(".")) ? { exp: e.slice(0, lr), key: '"' + e.slice(lr + 1) + '"' } : { exp: e, key: null }; for (sr = e, lr = ur = fr = 0; !Or();)Sr(cr = Ar()) ? Er(cr) : 91 === cr && Tr(cr); return { exp: e.slice(0, ur), key: e.slice(ur + 1, fr) } }(e); return null === n.key ? e + "=" + t : "$set(" + n.exp + ", " + n.key + ", " + t + ")" } function Ar() { return sr.charCodeAt(++lr) } function Or() { return ar <= lr } function Sr(e) { return 34 === e || 39 === e } function Tr(e) { var t = 1; for (ur = lr; !Or();)if (Sr(e = Ar())) Er(e); else if (91 === e && t++, 93 === e && t--, 0 === t) { fr = lr; break } } function Er(e) { for (var t = e; !Or() && (e = Ar()) !== t;); } var jr, Nr = "__r"; function Lr(e, t, n, r, i) { var o, a, s, c, l; t = (o = t)._withTask || (o._withTask = function () { Je = !0; var e = o.apply(null, arguments); return Je = !1, e }), n && (a = t, s = e, c = r, l = jr, t = function e() { null !== a.apply(null, arguments) && Ir(s, e, c, l) }), jr.addEventListener(e, t, Z ? { capture: r, passive: i } : r) } function Ir(e, t, n, r) { (r || jr).removeEventListener(e, t._withTask || t, n) } function Mr(e, r) { if (!t(e.data.on) || !t(r.data.on)) { var i = r.data.on || {}, o = e.data.on || {}; jr = r.elm, function (e) { if (n(e.__r)) { var t = K ? "change" : "input"; e[t] = [].concat(e.__r, e[t] || []), delete e.__r } n(e.__c) && (e.change = [].concat(e.__c, e.change || []), delete e.__c) }(i), nt(i, o, Lr, Ir, r.context), jr = void 0 } } var Dr = { create: Mr, update: Mr }; function Pr(e, r) { if (!t(e.data.domProps) || !t(r.data.domProps)) { var i, o, a, s, c = r.elm, l = e.data.domProps || {}, f = r.data.domProps || {}; for (i in n(f.__ob__) && (f = r.data.domProps = k({}, f)), l) t(f[i]) && (c[i] = ""); for (i in f) { if (o = f[i], "textContent" === i || "innerHTML" === i) { if (r.children && (r.children.length = 0), o === l[i]) continue; 1 === c.childNodes.length && c.removeChild(c.childNodes[0]) } if ("value" === i) { var p = t(c._value = o) ? "" : String(o); s = p, (a = c).composing || "OPTION" !== a.tagName && !function (e, t) { var n = !0; try { n = document.activeElement !== e } catch (e) { } return n && e.value !== t }(a, s) && !function (e, t) { var r = e.value, i = e._vModifiers; if (n(i)) { if (i.lazy) return !1; if (i.number) return u(r) !== u(t); if (i.trim) return r.trim() !== t.trim() } return r !== t }(a, s) || (c.value = p) } else c[i] = o } } } var Fr = { create: Pr, update: Pr }, Rr = y((function (e) { var t = {}, n = /:(.+)/; return e.split(/;(?![^(]*\))/g).forEach((function (e) { if (e) { var r = e.split(n); 1 < r.length && (t[r[0].trim()] = r[1].trim()) } })), t })); function Hr(e) { var t = Br(e.style); return e.staticStyle ? k(e.staticStyle, t) : t } function Br(e) { return Array.isArray(e) ? A(e) : "string" == typeof e ? Rr(e) : e } var Ur, Vr = /^--/, zr = /\s*!important$/, Kr = function (e, t, n) { if (Vr.test(t)) e.style.setProperty(t, n); else if (zr.test(n)) e.style.setProperty(t, n.replace(zr, ""), "important"); else { var r = qr(t); if (Array.isArray(n)) for (var i = 0, o = n.length; i < o; i++)e.style[r] = n[i]; else e.style[r] = n } }, Jr = ["Webkit", "Moz", "ms"], qr = y((function (e) { if (Ur = Ur || document.createElement("div").style, "filter" !== (e = _(e)) && e in Ur) return e; for (var t = e.charAt(0).toUpperCase() + e.slice(1), n = 0; n < Jr.length; n++) { var r = Jr[n] + t; if (r in Ur) return r } })); function Wr(e, r) { var i = r.data, o = e.data; if (!(t(i.staticStyle) && t(i.style) && t(o.staticStyle) && t(o.style))) { var a, s, c = r.elm, l = o.staticStyle, u = o.normalizedStyle || o.style || {}, f = l || u, p = Br(r.data.style) || {}; r.data.normalizedStyle = n(p.__ob__) ? k({}, p) : p; var d = function (e, t) { for (var n, r = {}, i = e; i.componentInstance;)(i = i.componentInstance._vnode) && i.data && (n = Hr(i.data)) && k(r, n); (n = Hr(e.data)) && k(r, n); for (var o = e; o = o.parent;)o.data && (n = Hr(o.data)) && k(r, n); return r }(r); for (s in f) t(d[s]) && Kr(c, s, ""); for (s in d) (a = d[s]) !== f[s] && Kr(c, s, null == a ? "" : a) } } var Gr = { create: Wr, update: Wr }; function Zr(e, t) { if (t && (t = t.trim())) if (e.classList) -1 < t.indexOf(" ") ? t.split(/\s+/).forEach((function (t) { return e.classList.add(t) })) : e.classList.add(t); else { var n = " " + (e.getAttribute("class") || "") + " "; n.indexOf(" " + t + " ") < 0 && e.setAttribute("class", (n + t).trim()) } } function Xr(e, t) { if (t && (t = t.trim())) if (e.classList) -1 < t.indexOf(" ") ? t.split(/\s+/).forEach((function (t) { return e.classList.remove(t) })) : e.classList.remove(t), e.classList.length || e.removeAttribute("class"); else { for (var n = " " + (e.getAttribute("class") || "") + " ", r = " " + t + " "; 0 <= n.indexOf(r);)n = n.replace(r, " "); (n = n.trim()) ? e.setAttribute("class", n) : e.removeAttribute("class") } } function Yr(e) { if (e) { if ("object" == typeof e) { var t = {}; return !1 !== e.css && k(t, Qr(e.name || "v")), k(t, e), t } return "string" == typeof e ? Qr(e) : void 0 } } var Qr = y((function (e) { return { enterClass: e + "-enter", enterToClass: e + "-enter-to", enterActiveClass: e + "-enter-active", leaveClass: e + "-leave", leaveToClass: e + "-leave-to", leaveActiveClass: e + "-leave-active" } })), ei = B && !J, ti = "transition", ni = "animation", ri = "transition", ii = "transitionend", oi = "animation", ai = "animationend"; ei && (void 0 === window.ontransitionend && void 0 !== window.onwebkittransitionend && (ri = "WebkitTransition", ii = "webkitTransitionEnd"), void 0 === window.onanimationend && void 0 !== window.onwebkitanimationend && (oi = "WebkitAnimation", ai = "webkitAnimationEnd")); var si = B ? window.requestAnimationFrame ? window.requestAnimationFrame.bind(window) : setTimeout : function (e) { return e() }; function ci(e) { si((function () { si(e) })) } function li(e, t) { var n = e._transitionClasses || (e._transitionClasses = []); n.indexOf(t) < 0 && (n.push(t), Zr(e, t)) } function ui(e, t) { e._transitionClasses && v(e._transitionClasses, t), Xr(e, t) } function fi(e, t, n) { var r = di(e, t), i = r.type, o = r.timeout, a = r.propCount; if (!i) return n(); var s = i === ti ? ii : ai, c = 0, l = function () { e.removeEventListener(s, u), n() }, u = function (t) { t.target === e && ++c >= a && l() }; setTimeout((function () { c < a && l() }), o + 1), e.addEventListener(s, u) } var pi = /\b(transform|all)(,|$)/; function di(e, t) { var n, r = window.getComputedStyle(e), i = r[ri + "Delay"].split(", "), o = r[ri + "Duration"].split(", "), a = vi(i, o), s = r[oi + "Delay"].split(", "), c = r[oi + "Duration"].split(", "), l = vi(s, c), u = 0, f = 0; return t === ti ? 0 < a && (n = ti, u = a, f = o.length) : t === ni ? 0 < l && (n = ni, u = l, f = c.length) : f = (n = 0 < (u = Math.max(a, l)) ? l < a ? ti : ni : null) ? n === ti ? o.length : c.length : 0, { type: n, timeout: u, propCount: f, hasTransform: n === ti && pi.test(r[ri + "Property"]) } } function vi(e, t) { for (; e.length < t.length;)e = e.concat(e); return Math.max.apply(null, t.map((function (t, n) { return hi(t) + hi(e[n]) }))) } function hi(e) { return 1e3 * Number(e.slice(0, -1)) } function mi(e, r) { var i = e.elm; n(i._leaveCb) && (i._leaveCb.cancelled = !0, i._leaveCb()); var a = Yr(e.data.transition); if (!t(a) && !n(i._enterCb) && 1 === i.nodeType) { for (var s = a.css, c = a.type, l = a.enterClass, f = a.enterToClass, p = a.enterActiveClass, d = a.appearClass, v = a.appearToClass, h = a.appearActiveClass, m = a.beforeEnter, y = a.enter, g = a.afterEnter, _ = a.enterCancelled, b = a.beforeAppear, $ = a.appear, w = a.afterAppear, C = a.appearCancelled, x = a.duration, k = mt, A = mt.$vnode; A && A.parent;)k = (A = A.parent).context; var O = !k._isMounted || !e.isRootInsert; if (!O || $ || "" === $) { var S = O && d ? d : l, T = O && h ? h : p, E = O && v ? v : f, j = O && b || m, L = O && "function" == typeof $ ? $ : y, I = O && w || g, M = O && C || _, D = u(o(x) ? x.enter : x), P = !1 !== s && !J, F = _i(L), R = i._enterCb = N((function () { P && (ui(i, E), ui(i, T)), R.cancelled ? (P && ui(i, S), M && M(i)) : I && I(i), i._enterCb = null })); e.data.show || rt(e, "insert", (function () { var t = i.parentNode, n = t && t._pending && t._pending[e.key]; n && n.tag === e.tag && n.elm._leaveCb && n.elm._leaveCb(), L && L(i, R) })), j && j(i), P && (li(i, S), li(i, T), ci((function () { ui(i, S), R.cancelled || (li(i, E), F || (gi(D) ? setTimeout(R, D) : fi(i, c, R))) }))), e.data.show && (r && r(), L && L(i, R)), P || F || R() } } } function yi(e, r) { var i = e.elm; n(i._enterCb) && (i._enterCb.cancelled = !0, i._enterCb()); var a = Yr(e.data.transition); if (t(a) || 1 !== i.nodeType) return r(); if (!n(i._leaveCb)) { var s = a.css, c = a.type, l = a.leaveClass, f = a.leaveToClass, p = a.leaveActiveClass, d = a.beforeLeave, v = a.leave, h = a.afterLeave, m = a.leaveCancelled, y = a.delayLeave, g = a.duration, _ = !1 !== s && !J, b = _i(v), $ = u(o(g) ? g.leave : g), w = i._leaveCb = N((function () { i.parentNode && i.parentNode._pending && (i.parentNode._pending[e.key] = null), _ && (ui(i, f), ui(i, p)), w.cancelled ? (_ && ui(i, l), m && m(i)) : (r(), h && h(i)), i._leaveCb = null })); y ? y(C) : C() } function C() { w.cancelled || (e.data.show || ((i.parentNode._pending || (i.parentNode._pending = {}))[e.key] = e), d && d(i), _ && (li(i, l), li(i, p), ci((function () { ui(i, l), w.cancelled || (li(i, f), b || (gi($) ? setTimeout(w, $) : fi(i, c, w))) }))), v && v(i, w), _ || b || w()) } } function gi(e) { return "number" == typeof e && !isNaN(e) } function _i(e) { if (t(e)) return !1; var r = e.fns; return n(r) ? _i(Array.isArray(r) ? r[0] : r) : 1 < (e._length || e.length) } function bi(e, t) { !0 !== t.data.show && mi(t) } var $i = function (e) { var o, a, s = {}, c = e.modules, l = e.nodeOps; for (o = 0; o < Jn.length; ++o)for (s[Jn[o]] = [], a = 0; a < c.length; ++a)n(c[a][Jn[o]]) && s[Jn[o]].push(c[a][Jn[o]]); function u(e) { var t = l.parentNode(e); n(t) && l.removeChild(t, e) } function p(e, t, i, o, a, c, u) { if (n(e.elm) && n(c) && (e = c[u] = de(e)), e.isRootInsert = !a, !function (e, t, i, o) { var a = e.data; if (n(a)) { var c = n(e.componentInstance) && a.keepAlive; if (n(a = a.hook) && n(a = a.init) && a(e, !1, i, o), n(e.componentInstance)) return d(e, t), r(c) && function (e, t, r, i) { for (var o, a = e; a.componentInstance;)if (n(o = (a = a.componentInstance._vnode).data) && n(o = o.transition)) { for (o = 0; o < s.activate.length; ++o)s.activate[o](Kn, a); t.push(a); break } v(r, e.elm, i) }(e, t, i, o), !0 } }(e, t, i, o)) { var f = e.data, p = e.children, m = e.tag; n(m) ? (e.elm = e.ns ? l.createElementNS(e.ns, m) : l.createElement(m, e), g(e), h(e, p, t), n(f) && y(e, t)) : r(e.isComment) ? e.elm = l.createComment(e.text) : e.elm = l.createTextNode(e.text), v(i, e.elm, o) } } function d(e, t) { n(e.data.pendingInsert) && (t.push.apply(t, e.data.pendingInsert), e.data.pendingInsert = null), e.elm = e.componentInstance.$el, m(e) ? (y(e, t), g(e)) : (zn(e), t.push(e)) } function v(e, t, r) { n(e) && (n(r) ? r.parentNode === e && l.insertBefore(e, t, r) : l.appendChild(e, t)) } function h(e, t, n) { if (Array.isArray(t)) for (var r = 0; r < t.length; ++r)p(t[r], n, e.elm, null, !0, t, r); else i(e.text) && l.appendChild(e.elm, l.createTextNode(String(e.text))) } function m(e) { for (; e.componentInstance;)e = e.componentInstance._vnode; return n(e.tag) } function y(e, t) { for (var r = 0; r < s.create.length; ++r)s.create[r](Kn, e); n(o = e.data.hook) && (n(o.create) && o.create(Kn, e), n(o.insert) && t.push(e)) } function g(e) { var t; if (n(t = e.fnScopeId)) l.setStyleScope(e.elm, t); else for (var r = e; r;)n(t = r.context) && n(t = t.$options._scopeId) && l.setStyleScope(e.elm, t), r = r.parent; n(t = mt) && t !== e.context && t !== e.fnContext && n(t = t.$options._scopeId) && l.setStyleScope(e.elm, t) } function _(e, t, n, r, i, o) { for (; r <= i; ++r)p(n[r], o, e, t, !1, n, r) } function b(e) { var t, r, i = e.data; if (n(i)) for (n(t = i.hook) && n(t = t.destroy) && t(e), t = 0; t < s.destroy.length; ++t)s.destroy[t](e); if (n(t = e.children)) for (r = 0; r < e.children.length; ++r)b(e.children[r]) } function $(e, t, r, i) { for (; r <= i; ++r) { var o = t[r]; n(o) && (n(o.tag) ? (w(o), b(o)) : u(o.elm)) } } function w(e, t) { if (n(t) || n(e.data)) { var r, i = s.remove.length + 1; for (n(t) ? t.listeners += i : t = function (e, t) { function n() { 0 == --n.listeners && u(e) } return n.listeners = t, n }(e.elm, i), n(r = e.componentInstance) && n(r = r._vnode) && n(r.data) && w(r, t), r = 0; r < s.remove.length; ++r)s.remove[r](e, t); n(r = e.data.hook) && n(r = r.remove) ? r(e, t) : t() } else u(e.elm) } function C(e, t, r, i) { for (var o = r; o < i; o++) { var a = t[o]; if (n(a) && qn(e, a)) return o } } function x(e, i, o, a) { if (e !== i) { var c = i.elm = e.elm; if (r(e.isAsyncPlaceholder)) n(i.asyncFactory.resolved) ? O(e.elm, i, o) : i.isAsyncPlaceholder = !0; else if (r(i.isStatic) && r(e.isStatic) && i.key === e.key && (r(i.isCloned) || r(i.isOnce))) i.componentInstance = e.componentInstance; else { var u, f = i.data; n(f) && n(u = f.hook) && n(u = u.prepatch) && u(e, i); var d = e.children, v = i.children; if (n(f) && m(i)) { for (u = 0; u < s.update.length; ++u)s.update[u](e, i); n(u = f.hook) && n(u = u.update) && u(e, i) } t(i.text) ? n(d) && n(v) ? d !== v && function (e, r, i, o, a) { for (var s, c, u, f = 0, d = 0, v = r.length - 1, h = r[0], m = r[v], y = i.length - 1, g = i[0], b = i[y], w = !a; f <= v && d <= y;)t(h) ? h = r[++f] : t(m) ? m = r[--v] : qn(h, g) ? (x(h, g, o), h = r[++f], g = i[++d]) : qn(m, b) ? (x(m, b, o), m = r[--v], b = i[--y]) : qn(h, b) ? (x(h, b, o), w && l.insertBefore(e, h.elm, l.nextSibling(m.elm)), h = r[++f], b = i[--y]) : (qn(m, g) ? (x(m, g, o), w && l.insertBefore(e, m.elm, h.elm), m = r[--v]) : (t(s) && (s = Wn(r, f, v)), t(c = n(g.key) ? s[g.key] : C(g, r, f, v)) ? p(g, o, e, h.elm, !1, i, d) : qn(u = r[c], g) ? (x(u, g, o), r[c] = void 0, w && l.insertBefore(e, u.elm, h.elm)) : p(g, o, e, h.elm, !1, i, d)), g = i[++d]); v < f ? _(e, t(i[y + 1]) ? null : i[y + 1].elm, i, d, y, o) : y < d && $(0, r, f, v) }(c, d, v, o, a) : n(v) ? (n(e.text) && l.setTextContent(c, ""), _(c, null, v, 0, v.length - 1, o)) : n(d) ? $(0, d, 0, d.length - 1) : n(e.text) && l.setTextContent(c, "") : e.text !== i.text && l.setTextContent(c, i.text), n(f) && n(u = f.hook) && n(u = u.postpatch) && u(e, i) } } } function k(e, t, i) { if (r(i) && n(e.parent)) e.parent.data.pendingInsert = t; else for (var o = 0; o < t.length; ++o)t[o].data.hook.insert(t[o]) } var A = f("attrs,class,staticClass,staticStyle,key"); function O(e, t, i, o) { var a, s = t.tag, c = t.data, l = t.children; if (o = o || c && c.pre, t.elm = e, r(t.isComment) && n(t.asyncFactory)) return t.isAsyncPlaceholder = !0; if (n(c) && (n(a = c.hook) && n(a = a.init) && a(t, !0), n(a = t.componentInstance))) return d(t, i), !0; if (n(s)) { if (n(l)) if (e.hasChildNodes()) if (n(a = c) && n(a = a.domProps) && n(a = a.innerHTML)) { if (a !== e.innerHTML) return !1 } else { for (var u = !0, f = e.firstChild, p = 0; p < l.length; p++) { if (!f || !O(f, l[p], i, o)) { u = !1; break } f = f.nextSibling } if (!u || f) return !1 } else h(t, l, i); if (n(c)) { var v = !1; for (var m in c) if (!A(m)) { v = !0, y(t, i); break } !v && c.class && Ye(c.class) } } else e.data !== t.text && (e.data = t.text); return !0 } return function (e, i, o, a, c, u) { if (!t(i)) { var f, d = !1, v = []; if (t(e)) d = !0, p(i, v, c, u); else { var h = n(e.nodeType); if (!h && qn(e, i)) x(e, i, v, a); else { if (h) { if (1 === e.nodeType && e.hasAttribute(L) && (e.removeAttribute(L), o = !0), r(o) && O(e, i, v)) return k(i, v, !0), e; f = e, e = new le(l.tagName(f).toLowerCase(), {}, [], void 0, f) } var y = e.elm, g = l.parentNode(y); if (p(i, v, y._leaveCb ? null : g, l.nextSibling(y)), n(i.parent)) for (var _ = i.parent, w = m(i); _;) { for (var C = 0; C < s.destroy.length; ++C)s.destroy[C](_); if (_.elm = i.elm, w) { for (var A = 0; A < s.create.length; ++A)s.create[A](Kn, _); var S = _.data.hook.insert; if (S.merged) for (var T = 1; T < S.fns.length; T++)S.fns[T]() } else zn(_); _ = _.parent } n(g) ? $(0, [e], 0, 0) : n(e.tag) && b(e) } } return k(i, v, d), i.elm } n(e) && b(e) } }({ nodeOps: Un, modules: [ir, pr, Dr, Fr, Gr, B ? { create: bi, activate: bi, remove: function (e, t) { !0 !== e.data.show ? yi(e, t) : t() } } : {}].concat(er) }); J && document.addEventListener("selectionchange", (function () { var e = document.activeElement; e && e.vmodel && Ti(e, "input") })); var wi = { inserted: function (e, t, n, r) { "select" === n.tag ? (r.elm && !r.elm._vOptions ? rt(n, "postpatch", (function () { wi.componentUpdated(e, t, n) })) : Ci(e, t, n.context), e._vOptions = [].map.call(e.options, Ai)) : ("textarea" === n.tag || Hn(e.type)) && (e._vModifiers = t.modifiers, t.modifiers.lazy || (e.addEventListener("compositionstart", Oi), e.addEventListener("compositionend", Si), e.addEventListener("change", Si), J && (e.vmodel = !0))) }, componentUpdated: function (e, t, n) { if ("select" === n.tag) { Ci(e, t, n.context); var r = e._vOptions, i = e._vOptions = [].map.call(e.options, Ai); i.some((function (e, t) { return !E(e, r[t]) })) && (e.multiple ? t.value.some((function (e) { return ki(e, i) })) : t.value !== t.oldValue && ki(t.value, i)) && Ti(e, "change") } } }; function Ci(e, t, n) { xi(e, t, n), (K || q) && setTimeout((function () { xi(e, t, n) }), 0) } function xi(e, t, n) { var r = t.value, i = e.multiple; if (!i || Array.isArray(r)) { for (var o, a, s = 0, c = e.options.length; s < c; s++)if (a = e.options[s], i) o = -1 < j(r, Ai(a)), a.selected !== o && (a.selected = o); else if (E(Ai(a), r)) return void (e.selectedIndex !== s && (e.selectedIndex = s)); i || (e.selectedIndex = -1) } } function ki(e, t) { return t.every((function (t) { return !E(t, e) })) } function Ai(e) { return "_value" in e ? e._value : e.value } function Oi(e) { e.target.composing = !0 } function Si(e) { e.target.composing && (e.target.composing = !1, Ti(e.target, "input")) } function Ti(e, t) { var n = document.createEvent("HTMLEvents"); n.initEvent(t, !0, !0), e.dispatchEvent(n) } function Ei(e) { return !e.componentInstance || e.data && e.data.transition ? e : Ei(e.componentInstance._vnode) } var ji = { model: wi, show: { bind: function (e, t, n) { var r = t.value, i = (n = Ei(n)).data && n.data.transition, o = e.__vOriginalDisplay = "none" === e.style.display ? "" : e.style.display; r && i ? (n.data.show = !0, mi(n, (function () { e.style.display = o }))) : e.style.display = r ? o : "none" }, update: function (e, t, n) { var r = t.value; !r != !t.oldValue && ((n = Ei(n)).data && n.data.transition ? (n.data.show = !0, r ? mi(n, (function () { e.style.display = e.__vOriginalDisplay })) : yi(n, (function () { e.style.display = "none" }))) : e.style.display = r ? e.__vOriginalDisplay : "none") }, unbind: function (e, t, n, r, i) { i || (e.style.display = e.__vOriginalDisplay) } } }, Ni = { name: String, appear: Boolean, css: Boolean, mode: String, type: String, enterClass: String, leaveClass: String, enterToClass: String, leaveToClass: String, enterActiveClass: String, leaveActiveClass: String, appearClass: String, appearActiveClass: String, appearToClass: String, duration: [Number, String, Object] }; function Li(e) { var t = e && e.componentOptions; return t && t.Ctor.options.abstract ? Li(lt(t.children)) : e } function Ii(e) { var t = {}, n = e.$options; for (var r in n.propsData) t[r] = e[r]; var i = n._parentListeners; for (var o in i) t[_(o)] = i[o]; return t } function Mi(e, t) { if (/\d-keep-alive$/.test(t.tag)) return e("keep-alive", { props: t.componentOptions.propsData }) } var Di = { name: "transition", props: Ni, abstract: !0, render: function (e) { var t = this, n = this.$slots.default; if (n && (n = n.filter((function (e) { return e.tag || ct(e) }))).length) { var r = this.mode, o = n[0]; if (function (e) { for (; e = e.parent;)if (e.data.transition) return !0 }(this.$vnode)) return o; var a = Li(o); if (!a) return o; if (this._leaving) return Mi(e, o); var s = "__transition-" + this._uid + "-"; a.key = null == a.key ? a.isComment ? s + "comment" : s + a.tag : i(a.key) ? 0 === String(a.key).indexOf(s) ? a.key : s + a.key : a.key; var c, l, u = (a.data || (a.data = {})).transition = Ii(this), f = this._vnode, p = Li(f); if (a.data.directives && a.data.directives.some((function (e) { return "show" === e.name })) && (a.data.show = !0), p && p.data && (c = a, (l = p).key !== c.key || l.tag !== c.tag) && !ct(p) && (!p.componentInstance || !p.componentInstance._vnode.isComment)) { var d = p.data.transition = k({}, u); if ("out-in" === r) return this._leaving = !0, rt(d, "afterLeave", (function () { t._leaving = !1, t.$forceUpdate() })), Mi(e, o); if ("in-out" === r) { if (ct(a)) return f; var v, h = function () { v() }; rt(u, "afterEnter", h), rt(u, "enterCancelled", h), rt(d, "delayLeave", (function (e) { v = e })) } } return o } } }, Pi = k({ tag: String, moveClass: String }, Ni); function Fi(e) { e.elm._moveCb && e.elm._moveCb(), e.elm._enterCb && e.elm._enterCb() } function Ri(e) { e.data.newPos = e.elm.getBoundingClientRect() } function Hi(e) { var t = e.data.pos, n = e.data.newPos, r = t.left - n.left, i = t.top - n.top; if (r || i) { e.data.moved = !0; var o = e.elm.style; o.transform = o.WebkitTransform = "translate(" + r + "px," + i + "px)", o.transitionDuration = "0s" } } delete Pi.mode; var Bi = { Transition: Di, TransitionGroup: { props: Pi, render: function (e) { for (var t = this.tag || this.$vnode.data.tag || "span", n = Object.create(null), r = this.prevChildren = this.children, i = this.$slots.default || [], o = this.children = [], a = Ii(this), s = 0; s < i.length; s++) { var c = i[s]; c.tag && null != c.key && 0 !== String(c.key).indexOf("__vlist") && (o.push(c), ((n[c.key] = c).data || (c.data = {})).transition = a) } if (r) { for (var l = [], u = [], f = 0; f < r.length; f++) { var p = r[f]; p.data.transition = a, p.data.pos = p.elm.getBoundingClientRect(), n[p.key] ? l.push(p) : u.push(p) } this.kept = e(t, null, l), this.removed = u } return e(t, null, o) }, beforeUpdate: function () { this.__patch__(this._vnode, this.kept, !1, !0), this._vnode = this.kept }, updated: function () { var e = this.prevChildren, t = this.moveClass || (this.name || "v") + "-move"; e.length && this.hasMove(e[0].elm, t) && (e.forEach(Fi), e.forEach(Ri), e.forEach(Hi), this._reflow = document.body.offsetHeight, e.forEach((function (e) { if (e.data.moved) { var n = e.elm, r = n.style; li(n, t), r.transform = r.WebkitTransform = r.transitionDuration = "", n.addEventListener(ii, n._moveCb = function e(r) { r && !/transform$/.test(r.propertyName) || (n.removeEventListener(ii, e), n._moveCb = null, ui(n, t)) }) } }))) }, methods: { hasMove: function (e, t) { if (!ei) return !1; if (this._hasMove) return this._hasMove; var n = e.cloneNode(); e._transitionClasses && e._transitionClasses.forEach((function (e) { Xr(n, e) })), Zr(n, t), n.style.display = "none", this.$el.appendChild(n); var r = di(n); return this.$el.removeChild(n), this._hasMove = r.hasTransform } } } }; pn.config.mustUseProp = xn, pn.config.isReservedTag = Pn, pn.config.isReservedAttr = wn, pn.config.getTagNamespace = Fn, pn.config.isUnknownElement = function (e) { if (!B) return !0; if (Pn(e)) return !1; if (e = e.toLowerCase(), null != Rn[e]) return Rn[e]; var t = document.createElement(e); return -1 < e.indexOf("-") ? Rn[e] = t.constructor === window.HTMLUnknownElement || t.constructor === window.HTMLElement : Rn[e] = /HTMLUnknownElement/.test(t.toString()) }, k(pn.options.directives, ji), k(pn.options.components, Bi), pn.prototype.__patch__ = B ? $i : O, pn.prototype.$mount = function (e, t) { return r = e = e && B ? Bn(e) : void 0, i = t, (n = this).$el = r, n.$options.render || (n.$options.render = fe), _t(n, "beforeMount"), new St(n, (function () { n._update(n._render(), i) }), O, null, !0), i = !1, null == n.$vnode && (n._isMounted = !0, _t(n, "mounted")), n; var n, r, i }, B && setTimeout((function () { D.devtools && Q && Q.emit("init", pn) }), 0); var Ui, Vi = /\{\{((?:.|\n)+?)\}\}/g, zi = /[-.*+?^${}()|[\]\/\\]/g, Ki = y((function (e) { var t = e[0].replace(zi, "\\$&"), n = e[1].replace(zi, "\\$&"); return new RegExp(t + "((?:.|\\n)+?)" + n, "g") })), Ji = { staticKeys: ["staticClass"], transformNode: function (e, t) { t.warn; var n = Cr(e, "class"); n && (e.staticClass = JSON.stringify(n)); var r = wr(e, "class", !1); r && (e.classBinding = r) }, genData: function (e) { var t = ""; return e.staticClass && (t += "staticClass:" + e.staticClass + ","), e.classBinding && (t += "class:" + e.classBinding + ","), t } }, qi = { staticKeys: ["staticStyle"], transformNode: function (e, t) { t.warn; var n = Cr(e, "style"); n && (e.staticStyle = JSON.stringify(Rr(n))); var r = wr(e, "style", !1); r && (e.styleBinding = r) }, genData: function (e) { var t = ""; return e.staticStyle && (t += "staticStyle:" + e.staticStyle + ","), e.styleBinding && (t += "style:(" + e.styleBinding + "),"), t } }, Wi = f("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"), Gi = f("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source"), Zi = f("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"), Xi = /^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/, Yi = "[a-zA-Z_][\\w\\-\\.]*", Qi = "((?:" + Yi + "\\:)?" + Yi + ")", eo = new RegExp("^<" + Qi), to = /^\s*(\/?)>/, no = new RegExp("^<\\/" + Qi + "[^>]*>"), ro = /^<!DOCTYPE [^>]+>/i, io = /^<!\--/, oo = /^<!\[/, ao = !1; "x".replace(/x(.)?/g, (function (e, t) { ao = "" === t })); var so, co, lo, uo, fo, po, vo, ho, mo = f("script,style,textarea", !0), yo = {}, go = { "&lt;": "<", "&gt;": ">", "&quot;": '"', "&amp;": "&", "&#10;": "\n", "&#9;": "\t" }, _o = /&(?:lt|gt|quot|amp);/g, bo = /&(?:lt|gt|quot|amp|#10|#9);/g, $o = f("pre,textarea", !0), wo = function (e, t) { return e && $o(e) && "\n" === t[0] }, Co = /^@|^v-on:/, xo = /^v-|^@|^:/, ko = /([^]*?)\s+(?:in|of)\s+([^]*)/, Ao = /,([^,\}\]]*)(?:,([^,\}\]]*))?$/, Oo = /^\(|\)$/g, So = /:(.*)$/, To = /^:|^v-bind:/, Eo = /\.[^.]+/g, jo = y((function (e) { return (Ui = Ui || document.createElement("div")).innerHTML = e, Ui.textContent })); function No(e, t, n) { return { type: 1, tag: e, attrsList: t, attrsMap: function (e) { for (var t = {}, n = 0, r = e.length; n < r; n++)t[e[n].name] = e[n].value; return t }(t), parent: n, children: [] } } function Lo(e, t) { var n, r, i, o; (r = wr(n = e, "key")) && (n.key = r), e.plain = !e.key && !e.attrsList.length, (o = wr(i = e, "ref")) && (i.ref = o, i.refInFor = function (e) { for (var t = e; t;) { if (void 0 !== t.for) return !0; t = t.parent } return !1 }(i)), function (e) { if ("slot" === e.tag) e.slotName = wr(e, "name"); else { var t; "template" === e.tag ? (t = Cr(e, "scope"), e.slotScope = t || Cr(e, "slot-scope")) : (t = Cr(e, "slot-scope")) && (e.slotScope = t); var n = wr(e, "slot"); n && (e.slotTarget = '""' === n ? '"default"' : n, "template" === e.tag || e.slotScope || _r(e, "slot", n)) } }(e), function (e) { var t; (t = wr(e, "is")) && (e.component = t), null != Cr(e, "inline-template") && (e.inlineTemplate = !0) }(e); for (var a = 0; a < lo.length; a++)e = lo[a](e, t) || e; !function (e) { var t, n, r, i, o, a, s, c, l, u, f, p, d, v = e.attrsList; for (t = 0, n = v.length; t < n; t++)if (r = i = v[t].name, o = v[t].value, xo.test(r)) if (e.hasBindings = !0, (a = Do(r)) && (r = r.replace(Eo, "")), To.test(r)) r = r.replace(To, ""), o = vr(o), s = !1, a && (a.prop && (s = !0, "innerHtml" === (r = _(r)) && (r = "innerHTML")), a.camel && (r = _(r)), a.sync && $r(e, "update:" + _(r), kr(o, "$event"))), s || !e.component && vo(e.tag, e.attrsMap.type, r) ? gr(e, r, o) : _r(e, r, o); else if (Co.test(r)) $r(e, r = r.replace(Co, ""), o, a, !1); else { var h = (r = r.replace(xo, "")).match(So), m = h && h[1]; m && (r = r.slice(0, -(m.length + 1))), l = r, u = i, f = o, p = m, d = a, ((c = e).directives || (c.directives = [])).push({ name: l, rawName: u, value: f, arg: p, modifiers: d }), c.plain = !1 } else _r(e, r, JSON.stringify(o)), !e.component && "muted" === r && vo(e.tag, e.attrsMap.type, r) && gr(e, r, "true") }(e) } function Io(e) { var t; if (t = Cr(e, "v-for")) { var n = function (e) { var t = e.match(ko); if (t) { var n = {}; n.for = t[2].trim(); var r = t[1].trim().replace(Oo, ""), i = r.match(Ao); return i ? (n.alias = r.replace(Ao, ""), n.iterator1 = i[1].trim(), i[2] && (n.iterator2 = i[2].trim())) : n.alias = r, n } }(t); n && k(e, n) } } function Mo(e, t) { e.ifConditions || (e.ifConditions = []), e.ifConditions.push(t) } function Do(e) { var t = e.match(Eo); if (t) { var n = {}; return t.forEach((function (e) { n[e.slice(1)] = !0 })), n } } var Po = /^xmlns:NS\d+/, Fo = /^NS\d+:/; function Ro(e) { return No(e.tag, e.attrsList.slice(), e.parent) } var Ho, Bo, Uo, Vo = [Ji, qi, { preTransformNode: function (e, t) { if ("input" === e.tag) { var n, r = e.attrsMap; if (!r["v-model"]) return; if ((r[":type"] || r["v-bind:type"]) && (n = wr(e, "type")), r.type || n || !r["v-bind"] || (n = "(" + r["v-bind"] + ").type"), n) { var i = Cr(e, "v-if", !0), o = i ? "&&(" + i + ")" : "", a = null != Cr(e, "v-else", !0), s = Cr(e, "v-else-if", !0), c = Ro(e); Io(c), br(c, "type", "checkbox"), Lo(c, t), c.processed = !0, c.if = "(" + n + ")==='checkbox'" + o, Mo(c, { exp: c.if, block: c }); var l = Ro(e); Cr(l, "v-for", !0), br(l, "type", "radio"), Lo(l, t), Mo(c, { exp: "(" + n + ")==='radio'" + o, block: l }); var u = Ro(e); return Cr(u, "v-for", !0), br(u, ":type", n), Lo(u, t), Mo(c, { exp: i, block: u }), a ? c.else = !0 : s && (c.elseif = s), c } } } }], zo = { expectHTML: !0, modules: Vo, directives: { model: function (e, t, n) { var r, i, o, a, s, c, l, u, f, p, d, v, h, m, y = t.value, g = t.modifiers, _ = e.tag, b = e.attrsMap.type; if (e.component) return xr(e, y, g), !1; if ("select" === _) h = y, $r(e, "change", 'var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;return ' + ((m = g) && m.number ? "_n(val)" : "val") + "});" + " " + kr(h, "$event.target.multiple ? $$selectedVal : $$selectedVal[0]"), null, !0); else if ("input" === _ && "checkbox" === b) c = e, l = y, f = (u = g) && u.number, p = wr(c, "value") || "null", d = wr(c, "true-value") || "true", v = wr(c, "false-value") || "false", gr(c, "checked", "Array.isArray(" + l + ")?_i(" + l + "," + p + ")>-1" + ("true" === d ? ":(" + l + ")" : ":_q(" + l + "," + d + ")")), $r(c, "change", "var $$a=" + l + ",$$el=$event.target,$$c=$$el.checked?(" + d + "):(" + v + ");if(Array.isArray($$a)){var $$v=" + (f ? "_n(" + p + ")" : p) + ",$$i=_i($$a,$$v);if($$el.checked){$$i<0&&(" + kr(l, "$$a.concat([$$v])") + ")}else{$$i>-1&&(" + kr(l, "$$a.slice(0,$$i).concat($$a.slice($$i+1))") + ")}}else{" + kr(l, "$$c") + "}", null, !0); else if ("input" === _ && "radio" === b) r = e, i = y, a = (o = g) && o.number, s = wr(r, "value") || "null", gr(r, "checked", "_q(" + i + "," + (s = a ? "_n(" + s + ")" : s) + ")"), $r(r, "change", kr(i, s), null, !0); else if ("input" === _ || "textarea" === _) !function (e, t, n) { var r = e.attrsMap.type, i = n || {}, o = i.lazy, a = i.number, s = i.trim, c = !o && "range" !== r, l = o ? "change" : "range" === r ? Nr : "input", u = "$event.target.value"; s && (u = "$event.target.value.trim()"), a && (u = "_n(" + u + ")"); var f = kr(t, u); c && (f = "if($event.target.composing)return;" + f), gr(e, "value", "(" + t + ")"), $r(e, l, f, null, !0), (s || a) && $r(e, "blur", "$forceUpdate()") }(e, y, g); else if (!D.isReservedTag(_)) return xr(e, y, g), !1; return !0 }, text: function (e, t) { t.value && gr(e, "textContent", "_s(" + t.value + ")") }, html: function (e, t) { t.value && gr(e, "innerHTML", "_s(" + t.value + ")") } }, isPreTag: function (e) { return "pre" === e }, isUnaryTag: Wi, mustUseProp: xn, canBeLeftOpenTag: Gi, isReservedTag: Pn, getTagNamespace: Fn, staticKeys: (Ho = Vo, Ho.reduce((function (e, t) { return e.concat(t.staticKeys || []) }), []).join(",")) }, Ko = y((function (e) { return f("type,tag,attrsList,attrsMap,plain,parent,children,attrs" + (e ? "," + e : "")) })); var Jo = /^([\w$_]+|\([^)]*?\))\s*=>|^function\s*\(/, qo = /^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/, Wo = { esc: 27, tab: 9, enter: 13, space: 32, up: 38, left: 37, right: 39, down: 40, delete: [8, 46] }, Go = { esc: "Escape", tab: "Tab", enter: "Enter", space: " ", up: ["Up", "ArrowUp"], left: ["Left", "ArrowLeft"], right: ["Right", "ArrowRight"], down: ["Down", "ArrowDown"], delete: ["Backspace", "Delete"] }, Zo = function (e) { return "if(" + e + ")return null;" }, Xo = { stop: "$event.stopPropagation();", prevent: "$event.preventDefault();", self: Zo("$event.target !== $event.currentTarget"), ctrl: Zo("!$event.ctrlKey"), shift: Zo("!$event.shiftKey"), alt: Zo("!$event.altKey"), meta: Zo("!$event.metaKey"), left: Zo("'button' in $event && $event.button !== 0"), middle: Zo("'button' in $event && $event.button !== 1"), right: Zo("'button' in $event && $event.button !== 2") }; function Yo(e, t, n) { var r = t ? "nativeOn:{" : "on:{"; for (var i in e) r += '"' + i + '":' + Qo(i, e[i]) + ","; return r.slice(0, -1) + "}" } function Qo(e, t) { if (!t) return "function(){}"; if (Array.isArray(t)) return "[" + t.map((function (t) { return Qo(e, t) })).join(",") + "]"; var n = qo.test(t.value), r = Jo.test(t.value); if (t.modifiers) { var i = "", o = "", a = []; for (var s in t.modifiers) if (Xo[s]) o += Xo[s], Wo[s] && a.push(s); else if ("exact" === s) { var c = t.modifiers; o += Zo(["ctrl", "shift", "alt", "meta"].filter((function (e) { return !c[e] })).map((function (e) { return "$event." + e + "Key" })).join("||")) } else a.push(s); return a.length && (i += "if(!('button' in $event)&&" + a.map(ea).join("&&") + ")return null;"), o && (i += o), "function($event){" + i + (n ? "return " + t.value + "($event)" : r ? "return (" + t.value + ")($event)" : t.value) + "}" } return n || r ? t.value : "function($event){" + t.value + "}" } function ea(e) { var t = parseInt(e, 10); if (t) return "$event.keyCode!==" + t; var n = Wo[e], r = Go[e]; return "_k($event.keyCode," + JSON.stringify(e) + "," + JSON.stringify(n) + ",$event.key," + JSON.stringify(r) + ")" } var ta = { on: function (e, t) { e.wrapListeners = function (e) { return "_g(" + e + "," + t.value + ")" } }, bind: function (e, t) { e.wrapData = function (n) { return "_b(" + n + ",'" + e.tag + "'," + t.value + "," + (t.modifiers && t.modifiers.prop ? "true" : "false") + (t.modifiers && t.modifiers.sync ? ",true" : "") + ")" } }, cloak: O }, na = function (e) { this.options = e, this.warn = e.warn || mr, this.transforms = yr(e.modules, "transformCode"), this.dataGenFns = yr(e.modules, "genData"), this.directives = k(k({}, ta), e.directives); var t = e.isReservedTag || S; this.maybeComponent = function (e) { return !t(e.tag) }, this.onceId = 0, this.staticRenderFns = [] }; function ra(e, t) { var n = new na(t); return { render: "with(this){return " + (e ? ia(e, n) : '_c("div")') + "}", staticRenderFns: n.staticRenderFns } } function ia(e, t) { if (e.staticRoot && !e.staticProcessed) return oa(e, t); if (e.once && !e.onceProcessed) return aa(e, t); if (e.for && !e.forProcessed) return f = t, p = (u = e).for, d = u.alias, v = u.iterator1 ? "," + u.iterator1 : "", h = u.iterator2 ? "," + u.iterator2 : "", u.forProcessed = !0, "_l((" + p + "),function(" + d + v + h + "){return " + ia(u, f) + "})"; if (e.if && !e.ifProcessed) return sa(e, t); if ("template" !== e.tag || e.slotTarget) { if ("slot" === e.tag) return function (e, t) { var n = e.slotName || '"default"', r = la(e, t), i = "_t(" + n + (r ? "," + r : ""), o = e.attrs && "{" + e.attrs.map((function (e) { return _(e.name) + ":" + e.value })).join(",") + "}", a = e.attrsMap["v-bind"]; return !o && !a || r || (i += ",null"), o && (i += "," + o), a && (i += (o ? "" : ",null") + "," + a), i + ")" }(e, t); var n; if (e.component) a = e.component, c = t, l = (s = e).inlineTemplate ? null : la(s, c, !0), n = "_c(" + a + "," + ca(s, c) + (l ? "," + l : "") + ")"; else { var r = e.plain ? void 0 : ca(e, t), i = e.inlineTemplate ? null : la(e, t, !0); n = "_c('" + e.tag + "'" + (r ? "," + r : "") + (i ? "," + i : "") + ")" } for (var o = 0; o < t.transforms.length; o++)n = t.transforms[o](e, n); return n } return la(e, t) || "void 0"; var a, s, c, l, u, f, p, d, v, h } function oa(e, t) { return e.staticProcessed = !0, t.staticRenderFns.push("with(this){return " + ia(e, t) + "}"), "_m(" + (t.staticRenderFns.length - 1) + (e.staticInFor ? ",true" : "") + ")" } function aa(e, t) { if (e.onceProcessed = !0, e.if && !e.ifProcessed) return sa(e, t); if (e.staticInFor) { for (var n = "", r = e.parent; r;) { if (r.for) { n = r.key; break } r = r.parent } return n ? "_o(" + ia(e, t) + "," + t.onceId++ + "," + n + ")" : ia(e, t) } return oa(e, t) } function sa(e, t, n, r) { return e.ifProcessed = !0, function e(t, n, r, i) { if (!t.length) return i || "_e()"; var o = t.shift(); return o.exp ? "(" + o.exp + ")?" + a(o.block) + ":" + e(t, n, r, i) : "" + a(o.block); function a(e) { return r ? r(e, n) : e.once ? aa(e, n) : ia(e, n) } }(e.ifConditions.slice(), t, n, r) } function ca(e, t) { var n, r, i = "{", o = function (e, t) { var n = e.directives; if (n) { var r, i, o, a, s = "directives:[", c = !1; for (r = 0, i = n.length; r < i; r++) { o = n[r], a = !0; var l = t.directives[o.name]; l && (a = !!l(e, o, t.warn)), a && (c = !0, s += '{name:"' + o.name + '",rawName:"' + o.rawName + '"' + (o.value ? ",value:(" + o.value + "),expression:" + JSON.stringify(o.value) : "") + (o.arg ? ',arg:"' + o.arg + '"' : "") + (o.modifiers ? ",modifiers:" + JSON.stringify(o.modifiers) : "") + "},") } return c ? s.slice(0, -1) + "]" : void 0 } }(e, t); o && (i += o + ","), e.key && (i += "key:" + e.key + ","), e.ref && (i += "ref:" + e.ref + ","), e.refInFor && (i += "refInFor:true,"), e.pre && (i += "pre:true,"), e.component && (i += 'tag:"' + e.tag + '",'); for (var a = 0; a < t.dataGenFns.length; a++)i += t.dataGenFns[a](e); if (e.attrs && (i += "attrs:{" + pa(e.attrs) + "},"), e.props && (i += "domProps:{" + pa(e.props) + "},"), e.events && (i += Yo(e.events, !1, t.warn) + ","), e.nativeEvents && (i += Yo(e.nativeEvents, !0, t.warn) + ","), e.slotTarget && !e.slotScope && (i += "slot:" + e.slotTarget + ","), e.scopedSlots && (i += (n = e.scopedSlots, r = t, "scopedSlots:_u([" + Object.keys(n).map((function (e) { return function e(t, n, r) { return n.for && !n.forProcessed ? (i = t, a = r, s = (o = n).for, c = o.alias, l = o.iterator1 ? "," + o.iterator1 : "", u = o.iterator2 ? "," + o.iterator2 : "", o.forProcessed = !0, "_l((" + s + "),function(" + c + l + u + "){return " + e(i, o, a) + "})") : "{key:" + t + ",fn:function(" + String(n.slotScope) + "){return " + ("template" === n.tag ? n.if ? n.if + "?" + (la(n, r) || "undefined") + ":undefined" : la(n, r) || "undefined" : ia(n, r)) + "}}"; var i, o, a, s, c, l, u }(e, n[e], r) })).join(",") + "]),")), e.model && (i += "model:{value:" + e.model.value + ",callback:" + e.model.callback + ",expression:" + e.model.expression + "},"), e.inlineTemplate) { var s = function (e, t) { var n = e.children[0]; if (1 === n.type) { var r = ra(n, t.options); return "inlineTemplate:{render:function(){" + r.render + "},staticRenderFns:[" + r.staticRenderFns.map((function (e) { return "function(){" + e + "}" })).join(",") + "]}" } }(e, t); s && (i += s + ",") } return i = i.replace(/,$/, "") + "}", e.wrapData && (i = e.wrapData(i)), e.wrapListeners && (i = e.wrapListeners(i)), i } function la(e, t, n, r, i) { var o = e.children; if (o.length) { var a = o[0]; if (1 === o.length && a.for && "template" !== a.tag && "slot" !== a.tag) return (r || ia)(a, t); var s = n ? function (e, t) { for (var n = 0, r = 0; r < e.length; r++) { var i = e[r]; if (1 === i.type) { if (ua(i) || i.ifConditions && i.ifConditions.some((function (e) { return ua(e.block) }))) { n = 2; break } (t(i) || i.ifConditions && i.ifConditions.some((function (e) { return t(e.block) }))) && (n = 1) } } return n }(o, t.maybeComponent) : 0, c = i || fa; return "[" + o.map((function (e) { return c(e, t) })).join(",") + "]" + (s ? "," + s : "") } } function ua(e) { return void 0 !== e.for || "template" === e.tag || "slot" === e.tag } function fa(e, t) { return 1 === e.type ? ia(e, t) : 3 === e.type && e.isComment ? (r = e, "_e(" + JSON.stringify(r.text) + ")") : "_v(" + (2 === (n = e).type ? n.expression : da(JSON.stringify(n.text))) + ")"; var n, r } function pa(e) { for (var t = "", n = 0; n < e.length; n++) { var r = e[n]; t += '"' + r.name + '":' + da(r.value) + "," } return t.slice(0, -1) } function da(e) { return e.replace(/\u2028/g, "\\u2028").replace(/\u2029/g, "\\u2029") } function va(e, t) { try { return new Function(e) } catch (n) { return t.push({ err: n, code: e }), O } } new RegExp("\\b" + "do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments".split(",").join("\\b|\\b") + "\\b"), new RegExp("\\b" + "delete,typeof,void".split(",").join("\\s*\\([^\\)]*\\)|\\b") + "\\s*\\([^\\)]*\\)"); var ha, ma, ya = (ha = function (e, t) { var n = function (e, t) { so = t.warn || mr, po = t.isPreTag || S, vo = t.mustUseProp || S, ho = t.getTagNamespace || S, lo = yr(t.modules, "transformNode"), uo = yr(t.modules, "preTransformNode"), fo = yr(t.modules, "postTransformNode"), co = t.delimiters; var n, r, i = [], o = !1 !== t.preserveWhitespace, a = !1, s = !1; function c(e) { e.pre && (a = !1), po(e.tag) && (s = !1); for (var n = 0; n < fo.length; n++)fo[n](e, t) } return function (e, t) { for (var n, r, i = [], o = t.expectHTML, a = t.isUnaryTag || S, s = t.canBeLeftOpenTag || S, c = 0; e;) { if (n = e, r && mo(r)) { var l = 0, u = r.toLowerCase(), f = yo[u] || (yo[u] = new RegExp("([\\s\\S]*?)(</" + u + "[^>]*>)", "i")), p = e.replace(f, (function (e, n, r) { return l = r.length, mo(u) || "noscript" === u || (n = n.replace(/<!\--([\s\S]*?)-->/g, "$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g, "$1")), wo(u, n) && (n = n.slice(1)), t.chars && t.chars(n), "" })); c += e.length - p.length, e = p, A(u, c - l, c) } else { var d = e.indexOf("<"); if (0 === d) { if (io.test(e)) { var v = e.indexOf("--\x3e"); if (0 <= v) { t.shouldKeepComment && t.comment(e.substring(4, v)), C(v + 3); continue } } if (oo.test(e)) { var h = e.indexOf("]>"); if (0 <= h) { C(h + 2); continue } } var m = e.match(ro); if (m) { C(m[0].length); continue } var y = e.match(no); if (y) { var g = c; C(y[0].length), A(y[1], g, c); continue } var _ = x(); if (_) { k(_), wo(r, e) && C(1); continue } } var b = void 0, $ = void 0, w = void 0; if (0 <= d) { for ($ = e.slice(d); !(no.test($) || eo.test($) || io.test($) || oo.test($) || (w = $.indexOf("<", 1)) < 0);)d += w, $ = e.slice(d); b = e.substring(0, d), C(d) } d < 0 && (b = e, e = ""), t.chars && b && t.chars(b) } if (e === n) { t.chars && t.chars(e); break } } function C(t) { c += t, e = e.substring(t) } function x() { var t = e.match(eo); if (t) { var n, r, i = { tagName: t[1], attrs: [], start: c }; for (C(t[0].length); !(n = e.match(to)) && (r = e.match(Xi));)C(r[0].length), i.attrs.push(r); if (n) return i.unarySlash = n[1], C(n[0].length), i.end = c, i } } function k(e) { var n = e.tagName, c = e.unarySlash; o && ("p" === r && Zi(n) && A(r), s(n) && r === n && A(n)); for (var l, u, f, p = a(n) || !!c, d = e.attrs.length, v = new Array(d), h = 0; h < d; h++) { var m = e.attrs[h]; ao && -1 === m[0].indexOf('""') && ("" === m[3] && delete m[3], "" === m[4] && delete m[4], "" === m[5] && delete m[5]); var y = m[3] || m[4] || m[5] || "", g = "a" === n && "href" === m[1] ? t.shouldDecodeNewlinesForHref : t.shouldDecodeNewlines; v[h] = { name: m[1], value: (l = y, u = g, f = u ? bo : _o, l.replace(f, (function (e) { return go[e] }))) } } p || (i.push({ tag: n, lowerCasedTag: n.toLowerCase(), attrs: v }), r = n), t.start && t.start(n, v, p, e.start, e.end) } function A(e, n, o) { var a, s; if (null == n && (n = c), null == o && (o = c), e && (s = e.toLowerCase()), e) for (a = i.length - 1; 0 <= a && i[a].lowerCasedTag !== s; a--); else a = 0; if (0 <= a) { for (var l = i.length - 1; a <= l; l--)t.end && t.end(i[l].tag, n, o); i.length = a, r = a && i[a - 1].tag } else "br" === s ? t.start && t.start(e, [], !0, n, o) : "p" === s && (t.start && t.start(e, [], !1, n, o), t.end && t.end(e, n, o)) } A() }(e, { warn: so, expectHTML: t.expectHTML, isUnaryTag: t.isUnaryTag, canBeLeftOpenTag: t.canBeLeftOpenTag, shouldDecodeNewlines: t.shouldDecodeNewlines, shouldDecodeNewlinesForHref: t.shouldDecodeNewlinesForHref, shouldKeepComment: t.comments, start: function (e, o, l) { var u = r && r.ns || ho(e); K && "svg" === u && (o = function (e) { for (var t = [], n = 0; n < e.length; n++) { var r = e[n]; Po.test(r.name) || (r.name = r.name.replace(Fo, ""), t.push(r)) } return t }(o)); var f, p, d, v, h, m = No(e, o, r); u && (m.ns = u), "style" !== (f = m).tag && ("script" !== f.tag || f.attrsMap.type && "text/javascript" !== f.attrsMap.type) || Y() || (m.forbidden = !0); for (var y = 0; y < uo.length; y++)m = uo[y](m, t) || m; if (a || (null != Cr(p = m, "v-pre") && (p.pre = !0), m.pre && (a = !0)), po(m.tag) && (s = !0), a ? function (e) { var t = e.attrsList.length; if (t) for (var n = e.attrs = new Array(t), r = 0; r < t; r++)n[r] = { name: e.attrsList[r].name, value: JSON.stringify(e.attrsList[r].value) }; else e.pre || (e.plain = !0) }(m) : m.processed || (Io(m), function (e) { var t = Cr(e, "v-if"); if (t) e.if = t, Mo(e, { exp: t, block: e }); else { null != Cr(e, "v-else") && (e.else = !0); var n = Cr(e, "v-else-if"); n && (e.elseif = n) } }(m), null != Cr(d = m, "v-once") && (d.once = !0), Lo(m, t)), n ? i.length || n.if && (m.elseif || m.else) && Mo(n, { exp: m.elseif, block: m }) : n = m, r && !m.forbidden) if (m.elseif || m.else) v = m, (h = function (e) { for (var t = e.length; t--;) { if (1 === e[t].type) return e[t]; e.pop() } }(r.children)) && h.if && Mo(h, { exp: v.elseif, block: v }); else if (m.slotScope) { r.plain = !1; var g = m.slotTarget || '"default"'; (r.scopedSlots || (r.scopedSlots = {}))[g] = m } else r.children.push(m), m.parent = r; l ? c(m) : (r = m, i.push(m)) }, end: function () { var e = i[i.length - 1], t = e.children[e.children.length - 1]; t && 3 === t.type && " " === t.text && !s && e.children.pop(), i.length -= 1, r = i[i.length - 1], c(e) }, chars: function (e) { if (r && (!K || "textarea" !== r.tag || r.attrsMap.placeholder !== e)) { var t, n, i = r.children; (e = s || e.trim() ? "script" === (t = r).tag || "style" === t.tag ? e : jo(e) : o && i.length ? " " : "") && (!a && " " !== e && (n = function (e, t) { var n = t ? Ki(t) : Vi; if (n.test(e)) { for (var r, i, o, a = [], s = [], c = n.lastIndex = 0; r = n.exec(e);) { c < (i = r.index) && (s.push(o = e.slice(c, i)), a.push(JSON.stringify(o))); var l = vr(r[1].trim()); a.push("_s(" + l + ")"), s.push({ "@binding": l }), c = i + r[0].length } return c < e.length && (s.push(o = e.slice(c)), a.push(JSON.stringify(o))), { expression: a.join("+"), tokens: s } } }(e, co)) ? i.push({ type: 2, expression: n.expression, tokens: n.tokens, text: e }) : " " === e && i.length && " " === i[i.length - 1].text || i.push({ type: 3, text: e })) } }, comment: function (e) { r.children.push({ type: 3, text: e, isComment: !0 }) } }), n }(e.trim(), t); !1 !== t.optimize && function (e, t) { e && (Bo = Ko(t.staticKeys || ""), Uo = t.isReservedTag || S, function e(t) { if (t.static = function (e) { return 2 !== e.type && (3 === e.type || !(!e.pre && (e.hasBindings || e.if || e.for || p(e.tag) || !Uo(e.tag) || function (e) { for (; e.parent;) { if ("template" !== (e = e.parent).tag) return !1; if (e.for) return !0 } return !1 }(e) || !Object.keys(e).every(Bo)))) }(t), 1 === t.type) { if (!Uo(t.tag) && "slot" !== t.tag && null == t.attrsMap["inline-template"]) return; for (var n = 0, r = t.children.length; n < r; n++) { var i = t.children[n]; e(i), i.static || (t.static = !1) } if (t.ifConditions) for (var o = 1, a = t.ifConditions.length; o < a; o++) { var s = t.ifConditions[o].block; e(s), s.static || (t.static = !1) } } }(e), function e(t, n) { if (1 === t.type) { if ((t.static || t.once) && (t.staticInFor = n), t.static && t.children.length && (1 !== t.children.length || 3 !== t.children[0].type)) return void (t.staticRoot = !0); if (t.staticRoot = !1, t.children) for (var r = 0, i = t.children.length; r < i; r++)e(t.children[r], n || !!t.for); if (t.ifConditions) for (var o = 1, a = t.ifConditions.length; o < a; o++)e(t.ifConditions[o].block, n) } }(e, !1)) }(n, t); var r = ra(n, t); return { ast: n, render: r.render, staticRenderFns: r.staticRenderFns } }, function (e) { function t(t, n) { var r = Object.create(e), i = [], o = []; if (r.warn = function (e, t) { (t ? o : i).push(e) }, n) for (var a in n.modules && (r.modules = (e.modules || []).concat(n.modules)), n.directives && (r.directives = k(Object.create(e.directives || null), n.directives)), n) "modules" !== a && "directives" !== a && (r[a] = n[a]); var s = ha(t, r); return s.errors = i, s.tips = o, s } return { compile: t, compileToFunctions: (n = t, r = Object.create(null), function (e, t, i) { (t = k({}, t)).warn, delete t.warn; var o = t.delimiters ? String(t.delimiters) + e : e; if (r[o]) return r[o]; var a = n(e, t), s = {}, c = []; return s.render = va(a.render, c), s.staticRenderFns = a.staticRenderFns.map((function (e) { return va(e, c) })), r[o] = s }) }; var n, r })(zo).compileToFunctions; function ga(e) { return (ma = ma || document.createElement("div")).innerHTML = e ? '<a href="\n"/>' : '<div a="\n"/>', 0 < ma.innerHTML.indexOf("&#10;") } var _a = !!B && ga(!1), ba = !!B && ga(!0), $a = y((function (e) { var t = Bn(e); return t && t.innerHTML })), wa = pn.prototype.$mount; return pn.prototype.$mount = function (e, t) { if ((e = e && Bn(e)) === document.body || e === document.documentElement) return this; var n = this.$options; if (!n.render) { var r = n.template; if (r) if ("string" == typeof r) "#" === r.charAt(0) && (r = $a(r)); else { if (!r.nodeType) return this; r = r.innerHTML } else e && (r = function (e) { if (e.outerHTML) return e.outerHTML; var t = document.createElement("div"); return t.appendChild(e.cloneNode(!0)), t.innerHTML }(e)); if (r) { var i = ya(r, { shouldDecodeNewlines: _a, shouldDecodeNewlinesForHref: ba, delimiters: n.delimiters, comments: n.comments }, this), o = i.render, a = i.staticRenderFns; n.render = o, n.staticRenderFns = a } } return wa.call(this, e, t) }, pn.compile = ya, pn }));
!function (e, n) { "object" == typeof exports && "undefined" != typeof module ? n() : "function" == typeof define && define.amd ? define(n) : n() }(0, (function () { "use strict"; function e(e) { var n = this.constructor; return this.then((function (t) { return n.resolve(e()).then((function () { return t })) }), (function (t) { return n.resolve(e()).then((function () { return n.reject(t) })) })) } function n() { } function t(e) { if (!(this instanceof t)) throw new TypeError("Promises must be constructed via new"); if ("function" != typeof e) throw new TypeError("not a function"); this._state = 0, this._handled = !1, this._value = void 0, this._deferreds = [], u(e, this) } function o(e, n) { for (; 3 === e._state;)e = e._value; 0 !== e._state ? (e._handled = !0, t._immediateFn((function () { var t = 1 === e._state ? n.onFulfilled : n.onRejected; if (null !== t) { var o; try { o = t(e._value) } catch (e) { return void i(n.promise, e) } r(n.promise, o) } else (1 === e._state ? r : i)(n.promise, e._value) }))) : e._deferreds.push(n) } function r(e, n) { try { if (n === e) throw new TypeError("A promise cannot be resolved with itself."); if (n && ("object" == typeof n || "function" == typeof n)) { var o = n.then; if (n instanceof t) return e._state = 3, e._value = n, void f(e); if ("function" == typeof o) return void u(function (e, n) { return function () { e.apply(n, arguments) } }(o, n), e) } e._state = 1, e._value = n, f(e) } catch (n) { i(e, n) } } function i(e, n) { e._state = 2, e._value = n, f(e) } function f(e) { 2 === e._state && 0 === e._deferreds.length && t._immediateFn((function () { e._handled || t._unhandledRejectionFn(e._value) })); for (var n = 0, r = e._deferreds.length; r > n; n++)o(e, e._deferreds[n]); e._deferreds = null } function u(e, n) { var t = !1; try { e((function (e) { t || (t = !0, r(n, e)) }), (function (e) { t || (t = !0, i(n, e)) })) } catch (e) { if (t) return; t = !0, i(n, e) } } var c = setTimeout; t.prototype.catch = function (e) { return this.then(null, e) }, t.prototype.then = function (e, t) { var r = new this.constructor(n); return o(this, new function (e, n, t) { this.onFulfilled = "function" == typeof e ? e : null, this.onRejected = "function" == typeof n ? n : null, this.promise = t }(e, t, r)), r }, t.prototype.finally = e, t.all = function (e) { return new t((function (n, t) { function o(e, f) { try { if (f && ("object" == typeof f || "function" == typeof f)) { var u = f.then; if ("function" == typeof u) return void u.call(f, (function (n) { o(e, n) }), t) } r[e] = f, 0 == --i && n(r) } catch (e) { t(e) } } if (!e || void 0 === e.length) throw new TypeError("Promise.all accepts an array"); var r = Array.prototype.slice.call(e); if (0 === r.length) return n([]); for (var i = r.length, f = 0; r.length > f; f++)o(f, r[f]) })) }, t.resolve = function (e) { return e && "object" == typeof e && e.constructor === t ? e : new t((function (n) { n(e) })) }, t.reject = function (e) { return new t((function (n, t) { t(e) })) }, t.race = function (e) { return new t((function (n, t) { for (var o = 0, r = e.length; r > o; o++)e[o].then(n, t) })) }, t._immediateFn = "function" == typeof setImmediate && function (e) { setImmediate(e) } || function (e) { c(e, 0) }, t._unhandledRejectionFn = function (e) { void 0 !== console && console && console.warn("Possible Unhandled Promise Rejection:", e) }; var l = function () { if ("undefined" != typeof self) return self; if ("undefined" != typeof window) return window; if ("undefined" != typeof global) return global; throw Error("unable to locate global object") }(); "Promise" in l ? l.Promise.prototype.finally || (l.Promise.prototype.finally = e) : l.Promise = t }));
var ros, ros_cmd_vel, ros_status, ros_diagnostics_listener, robot_cur_x = 0, robot_cur_y = 0, robot_pos_left = 0, robot_pos_top = 0, robot_cur_orientation = 0, robot_cur_degrees = 0, robot_current_mission = -1, robot_current_missiontext = "", robot_current_mission_guid = "", robot_current_mission_action_guid = "", robot_mode_id = "", robot_footprint = "", cart_attached = !1, hook_length = 0, hook_cart_length = 0, hook_cart_width = 0, hook_cur_orientation = 0, cart_center_x = 0, cart_center_y = 0, cart_pos_left = 0, cart_pos_top = 0, cart_center_orientation = 0, cart_center_degrees = 0, cart_front_x = 0, cart_front_y = 0, cart_front_orientation = 0, cart_front_degrees = 0, robot_current_user_prompt = "", robot_current_user_prompt_triggered = !1, robot_current_user_prompt_timeout_total = 0, robot_current_user_prompt_timeout_count = 0, robot_current_user_prompt_timer, robot_cur_mapping_x = 0, robot_cur_mapping_y = 0, robot_cur_mapping_orientation = 0, robot_cur_mapping_img_x = 0, robot_cur_mapping_img_y = 0, robot_errors = Array(), joystick_action = !1, joystick_x = 0, joystick_y = 0, joystick_timer, rescale_timer, text_to_html = document.createElement("textarea"), toplog_timer, toplog_cache = "", ros_reconnecter_time = 0, ros_reconnecter_timer; function ros_reconnect() { Math.round(+new Date / 1e3) - ros_reconnecter_time > 3 ? (ros.connect(MIR.ros.socket_url), ros_reconnecter_time = Math.round(+new Date / 1e3)) : (window.clearTimeout(ros_reconnecter_timer), ros_reconnecter_timer = window.setTimeout((function () { ros_reconnect() }), 1e3)) } function decodeHtml(t) { return text_to_html.innerHTML = t, text_to_html.value } function set_active_menusection(t, e) { return $("div.wrapper > div.menu > div.submenu > div.menusection").hide(), $('div.wrapper > div.menu > div.submenu > div.menusection[data-section="' + t + '"]').show(), $("div.wrapper > div.menu > div.buttonstrip > ul > li").removeAttr("class"), $('div.wrapper > div.menu > div.buttonstrip > ul > li[data-systemname="' + t + '"]').attr("class", "active"), 0 == e && menu_desktop_toggle("show"), !0 } function menu_desktop_toggle(t) { return $.post("/?mode=toggle-desktop-menu", { force: t }, (function (t) { "true" == t ? document.getElementsByTagName("body")[0].setAttribute("data-menu-desktop", "true") : document.getElementsByTagName("body")[0].setAttribute("data-menu-desktop", "false"), topsubbar_paging() })), !0 } function mobilemenu_toggle() { "true" == document.getElementsByTagName("body")[0].getAttribute("data-menu-mobile") ? document.getElementsByTagName("body")[0].setAttribute("data-menu-mobile", "false") : (document.getElementsByTagName("body")[0].setAttribute("data-mobile-status", "false"), document.getElementsByTagName("body")[0].setAttribute("data-menu-mobile", "true")), map_toolbars_place() } function update_battery_ui() { robot_battery_percentage < 25 ? robot_battery_percentage_rounded = 25 : robot_battery_percentage < 50 ? robot_battery_percentage_rounded = 50 : robot_battery_percentage < 75 ? robot_battery_percentage_rounded = 75 : robot_battery_percentage_rounded = 100, document.getElementsByTagName("body")[0].setAttribute("data-battery", robot_battery_percentage_rounded), document.getElementById("topbar_desktop_battery_percentage") && (document.getElementById("topbar_desktop_battery_percentage").innerHTML = robot_battery_percentage + "%") } function robot_regular_info_listen() { "fleet" != systemtype ? (ros_cmd_vel = new ROSLIB.Topic({ ros: ros, name: "/joystick_vel", messageType: "mirMsgs/JoystickVel" }), ros_status = new ROSLIB.Topic({ ros: ros, name: "/robot_status", messageType: "mirMsgs/RobotStatus" }), ros_safety_status = new ROSLIB.Topic({ ros: ros, name: "/safety_status", messageType: "mirMsgs/SafetyStatus" }), ros_safety_status.subscribe((function (t) { MIR.joystick.extended_safety_data.is_in_manual = t.in_manual_mode, MIR.joystick.extended_safety_data.is_manual_mode_restart_required = t.is_manual_mode_restart_required })), ros_status.subscribe((function (message) { var tmp_bat = Math.round(parseInt(message.battery_percentage), 2); isFinite(tmp_bat) && tmp_bat !== robot_battery_percentage && (robot_battery_percentage = tmp_bat, update_battery_ui()), MIR.joystick.session_using = message.joystick_web_session_id, "MIR250" != mir_product && "MIR500" != mir_product && "MIR1000" != mir_product && "MIR600" != mir_product && "MIR1350" != mir_product || (MIR.joystick.extended_safety_data.is_enabled = !0, message.mode_key_state && (MIR.joystick.extended_safety_data.key_state = message.mode_key_state)); var claim = MIR.joystick.checkClaim(); if ("boolean" == typeof message.joystick_low_speed_mode_enabled) { $(".slow-mode-btn-wrap").show(); var reduced_state = "on"; 0 == message.joystick_low_speed_mode_enabled && (reduced_state = "off"), $(".toggle-reduced-speed").attr("data-state", reduced_state) } if ($(".joystick, .hookmanualview_actionsbox, .set-height-dialog").attr("claim-state", claim), message.robot_name !== robot_name && (robot_name = message.robot_name), message.robot_model !== robot_model && (robot_model = message.robot_model), message.serial_number !== robot_serial && (robot_serial = message.serial_number), message.uptime !== robot_uptime && (robot_uptime = message.uptime), message.battery_time_remaining !== robot_battery_time && (robot_battery_time = message.battery_time_remaining), message.moved !== robot_moved_distance && (robot_moved_distance = message.moved), 0 == message.errors.length && "true" == document.getElementsByTagName("body")[0].getAttribute("data-error") ? document.getElementsByTagName("body")[0].setAttribute("data-error", "false") : message.errors.length > 0 && "false" == document.getElementsByTagName("body")[0].getAttribute("data-error") && (document.getElementsByTagName("body")[0].setAttribute("data-error", "true"), errorlog_init(message.errors)), message.errors !== robot_errors && (robot_errors = message.errors), message.map_id !== robot_map_id && (robot_map_id = message.map_id, "dashboards" == window.location.pathname.split("/")[1] && $(".mapcontainer").each((function () { window.pageviewid = "refresh_" + Date.now(), $(this).attr("data-map-guid", robot_map_id); var t = $(this).attr("data-element-id"); map_init(t, robot_map_id, !1, !1) }))), message.mode_id !== robot_mode_id) { if (robot_mode_id = message.mode_id, document.getElementsByTagName("body")[0].setAttribute("data-mode-id", robot_mode_id), window.mode_callbacks[robot_mode_id] && window.mode_callbacks[robot_mode_id].length > 0) for (var ln = window.mode_callbacks[robot_mode_id].length, c = 0; c < ln;)eval(window.mode_callbacks[robot_mode_id][c]), delete window.mode_callbacks[robot_mode_id][c], c++; $("body").attr("data-mapping", String(robot_mode_id === MIR.constants.ROBOT_MODE.MAPPING)), $("body").attr("data-mapping-finalizing", String(robot_mode_id === MIR.constants.ROBOT_MODE.MAPPING_FINALIZING)) } if (1 == message.user_prompt.has_request && 0 == robot_current_user_prompt_triggered && message.user_prompt.user_group == user_group_id ? (robot_current_user_prompt = message.user_prompt, robot_trigger_userprompt()) : 0 == message.user_prompt.has_request && 1 == robot_current_user_prompt_triggered && robot_clear_userprompt(), message.state_id !== robot_state_id && (11 == robot_state_id && 12 == message.state_id ? $("div.dashboard > div.row > div.widget > div.joystick > div.holder > div.stick").draggable("disable") : 12 == message.state_id && joystick_stop(), robot_state_id = message.state_id, document.getElementsByTagName("body")[0].setAttribute("data-state-id", robot_state_id), 10 == robot_state_id ? document.getElementsByTagName("body")[0].setAttribute("data-emergency-stop", "true") : document.getElementsByTagName("body")[0].setAttribute("data-emergency-stop", "false"), 11 == robot_state_id ? $("div.dashboard > div.row > div.widget > div.joystick > div.holder > div.stick").draggable("enable") : 3 != robot_state_id && 4 != robot_state_id || $("div.dashboard > div.row > div.widget > div.joystick > div.holder > div.stick").draggable("disable")), message.mission_text == robot_current_missiontext || (robot_current_missiontext = mir_translate_from_rosbridge(message.mission_text)), "boolean" == typeof is_showing_missionqueue) { var translated_message = mir_translate_from_rosbridge(robot_current_missiontext); $("div.missions_summary_queue > p.missioninfo").each((function () { this.innerHTML = translated_message })) } if (message.mission_queue_id == robot_current_mission); else if (robot_current_mission = message.mission_queue_id, "boolean" == typeof is_showing_missionqueue && $("div.missions_summary").each((function () { missions_summary_check_queue(this.getAttribute("id"), !1) })), -1 == robot_current_mission) robot_current_mission_guid = "", robot_current_mission_action_guid = ""; else { var fields = { mode: "get-active-mission", calltype: "light" }; fields.queue_id = robot_current_mission, $.ajax({ url: "/", data: fields, method: "GET", dataType: "json", success: function (t) { robot_current_mission_guid = t.mission_guid, robot_current_mission_action_guid = t.action_guid } }) } message.position.x != robot_cur_x && (null != document.getElementById("robotcontroller_display_x_value") && (document.getElementById("robotcontroller_display_x_value").innerHTML = number_format(message.position.x, 3, ".", "")), robot_cur_x = message.position.x), message.position.y != robot_cur_y && (null != document.getElementById("robotcontroller_display_y_value") && (document.getElementById("robotcontroller_display_y_value").innerHTML = number_format(message.position.y, 3, ".", "")), robot_cur_y = message.position.y), message.position.orientation != robot_cur_orientation && (null != document.getElementById("robotcontroller_display_orientation_value") && (document.getElementById("robotcontroller_display_orientation_value").innerHTML = number_format(message.position.orientation, 3, ".", "")), robot_cur_orientation = deg_to_rad(message.position.orientation), robot_cur_degrees = rad_to_deg(robot_cur_orientation)); var update_footprint = message.footprint != robot_footprint; if (update_footprint && (robot_footprint = JSON.parse(message.footprint)), cart_attached = message.hook_status.trolley_attached, cart_attached) { hook_length = message.hook_data.length, hook_cart_length = message.hook_status.trolley.length, hook_cart_width = message.hook_status.trolley.width, hook_cur_orientation = deg_to_rad(message.hook_data.angle.angle); var cart_pose = robot_to_cart_center(robot_cur_x, robot_cur_y, robot_cur_orientation, hook_length, hook_cur_orientation, hook_cart_length); cart_center_x = cart_pose[0], cart_center_y = cart_pose[1], cart_center_orientation = cart_pose[2], cart_center_degrees = rad_to_deg(cart_center_orientation), cart_pose = robot_to_cart_center(robot_cur_x, robot_cur_y, robot_cur_orientation, hook_length, hook_cur_orientation, 0), cart_front_x = cart_pose[0], cart_front_y = cart_pose[1], cart_front_orientation = cart_pose[2], cart_front_degrees = rad_to_deg(cart_front_orientation) } String(message.unloaded_map_changes) == unloaded_map_changes && String(message.unloaded_map_changes) == document.getElementsByTagName("body")[0].getAttribute("data-unloaded-map-changes") || (unloaded_map_changes = String(message.unloaded_map_changes), document.getElementsByTagName("body")[0].setAttribute("data-unloaded-map-changes", unloaded_map_changes)), $("div.mapcontainer[data-positioning-robot='false'] > div.mapwrapper > div.mapholder > div.map > div.layer > div.robot").each((function () { var t = this.parentNode.parentNode.parentNode.parentNode.parentNode; if (t.getAttribute("data-map-guid") == robot_map_id || "true" == t.getAttribute("data-mapping")) { var e = $(this), a = e.parent().find(".footprint").find("polygon"), r = t.getAttribute("data-resscale"), n = t.getAttribute("data-origin-x"), i = t.getAttribute("data-origin-y"), o = t.getAttribute("data-map-height"); if (update_footprint) { var s = $.map(robot_footprint, (function (t) { return [t[0] * r + "," + t[1] * r] })).join(" "); a.attr("points", s) } robot_pos_left = robot_cur_x * r - n, robot_pos_top = o - (robot_cur_y * r - i); var d = robot_cur_degrees; d = -(d + 90); var l = r / 20; t.getAttribute("data-map-guid") == robot_map_id ? (t.setAttribute("data-active-map", "true"), "true" == t.getAttribute("data-center-robot") && map_center_robot(t.getAttribute("data-element-id"))) : "true" == t.getAttribute("data-mapping") && "true" == t.getAttribute("data-center-robot") ? map_center_robot(t.getAttribute("data-element-id")) : t.setAttribute("data-active-map", "false"), $(this).css("top", robot_pos_top), $(this).css("left", robot_pos_left), $(this).css("WebkitTransform", "scale(" + l + "," + l + ") rotate(" + d + "deg)"), $(this).css("-moz-transform", "scale(" + l + "," + l + ") rotate(" + d + "deg)"), $(this).css("-ms-transform", "scale(" + l + "," + l + ") rotate(" + d + "deg)"), $(this).css("transform", "scale(" + l + "," + l + ") rotate(" + d + "deg)"), e.parent().find(".footprint").css({ transform: "rotate(" + d + "deg)", left: robot_pos_left, top: robot_pos_top }), $(this).show() } else $(this).hide() })), $("div.mapcontainer[data-positioning-robot='false'] > div.mapwrapper > div.mapholder > div.map > div.layer > div.cart").each((function () { if (cart_attached) { var t = this.parentNode.parentNode.parentNode.parentNode.parentNode, e = t.getAttribute("data-resscale"), a = t.getAttribute("data-origin-x"), r = t.getAttribute("data-origin-y"), n = t.getAttribute("data-map-height"); cart_pos_left = cart_center_x * e - a, cart_pos_top = n - (cart_center_y * e - r); var i = cart_center_degrees; i = -(i + 90); var o = e / 20, s = 19 * hook_cart_width, d = 18 * hook_cart_length, l = d - 16, u = s - 11; $(this).css("top", cart_pos_top - l / 2), $(this).css("left", cart_pos_left - u / 2), $(this).css("width", parseInt(s) + "px"), $(this).css("height", parseInt(d) + "px"), $(this).css("WebkitTransform", "scale(" + o + "," + o + ") rotate(" + i + "deg)"), $(this).css("-moz-transform", "scale(" + o + "," + o + ") rotate(" + i + "deg)"), $(this).css("-ms-transform", "scale(" + o + "," + o + ") rotate(" + i + "deg)"), $(this).css("transform", "scale(" + o + "," + o + ") rotate(" + i + "deg)"), $(this).show() } else $(this).hide() })) }))) : new ROSLIB.Topic({ ros: ros, name: "/prompt_manager/out/prompt_list", messageType: "fleet_prompt_manager/FleetPromptInfoList", latch: !0 }).subscribe((function (t) { var e = t.data.find((function (t) { return t.user_group == window.user_group_id })); if (e) return robot_current_user_prompt = e, void fleet_trigger_userprompt(); robot_clear_userprompt() })) } function markup_api_datatable_filter_trigger(t) { clearTimeout(window["datatable_" + t + "_filter_trigger"]), window["datatable_" + t + "_showresults"] = !1, null != document.getElementById("filter_word_" + t) && document.getElementById("filter_word_" + t).setAttribute("data-spinning", "false"), window["datatable_" + t + "_filter_trigger"] = setTimeout((function () { null != document.getElementById("filter_word_" + t) && document.getElementById("filter_word_" + t).setAttribute("data-spinning", "true"), clearTimeout(window["datatable_" + t + "_filter_trigger"]), window["datatable_" + t + "_showresults"] = !0, markup_api_datatable_get_page(t, !1) }), 300) } function markup_api_datatable_filter_clear(t, e) { var a = e.innerHTML, r = e.getAttribute("data-template"); e.setAttribute("disabled", "disabled"), e.setAttribute("data-template", "submitting"), e.innerHTML = "Please wait..."; var n = document.getElementById("datatable_" + t), i = n.getAttribute("data-endpoint"); if (null != document.getElementById("filter_word_" + t)) var o = document.getElementById("filter_word_" + t); if (null != document.getElementById("filter_group_" + t)) var s = document.getElementById("filter_group_" + t); var d = {}; d["endpoint_" + i + "_current_page"] = 1, d["endpoint_" + i + "_filter"] = "", d["endpoint_" + i + "_group"] = "", $.post("/?mode=set-user-settings&calltype=light", d, (function (i) { null != document.getElementById("filter_word_" + t) && (o.value = ""), null != document.getElementById("filter_group_" + t) && $(s).val(""), n.setAttribute("data-current-page", 1), markup_api_datatable_get_page(t), e.removeAttribute("disabled"), e.setAttribute("data-template", r), e.innerHTML = a })) } function markup_api_datatable_get_page(id, append) { var table = document.getElementById("datatable_" + id), endpoint = table.getAttribute("data-endpoint"); if (table.setAttribute("data-in-progress", "true"), null != document.getElementById("filter_word_" + id)) var filter = document.getElementById("filter_word_" + id).value; else var filter = ""; if (null != document.getElementById("filter_group_" + id)) if (0 == document.getElementById("filter_group_" + id).options.length) var group = ""; else var group = document.getElementById("filter_group_" + id).options[document.getElementById("filter_group_" + id).selectedIndex].value; else var group = ""; var fieldarr = Array(), fieldnames = Array(), fieldlookups = Array(), fieldcounts = Array(); $("#datatable_" + id + " > tbody > tr:first > th").each((function () { fieldarr.push(this.getAttribute("data-field")), fieldnames.push(this.innerHTML), fieldlookups.push(this.getAttribute("data-field-lookup")), fieldcounts.push(this.getAttribute("data-field-count")) })); var subhead_field = table.getAttribute("data-subhead-field"), subhead_field_lookup = table.getAttribute("data-subhead-field-lookup"); dataobject = {}, dataobject.endpoint = endpoint, dataobject.sort = table.getAttribute("data-sort"), dataobject.order = table.getAttribute("data-order"), dataobject.filter = filter, dataobject.group = group, dataobject.fields = fieldarr, dataobject.fieldlookups = fieldlookups, dataobject.fieldcounts = fieldcounts, dataobject.subhead_field = subhead_field, dataobject.subhead_field_lookup = table.getAttribute("data-subhead-field-lookup"), dataobject.filter_fields = table.getAttribute("data-filter-fields"), dataobject.ip = table.getAttribute("data-ip"), dataobject.translate_fields = table.getAttribute("data-translate-fields"), dataobject.limit = table.getAttribute("data-per-page"), dataobject.offset = (parseInt(table.getAttribute("data-current-page")) - 1) * parseInt(table.getAttribute("data-per-page")), $.post("/?mode=get-api-list", dataobject, (function (data) { if (null != document.getElementById("filter_word_" + id) && document.getElementById("filter_word_" + id).setAttribute("data-spinning", "false"), 0 == data.results.length && 1 == window["datatable_" + id + "_showresults"]) { $("#datatable_" + id + ' > tbody > tr[data-elastic="true"],#datatable_' + id + ' > tr[data-elastic="true"]').css("display", "none"), $("#datatable_" + id + ' > tbody > tr[data-elastic="false"],#datatable_' + id + ' > tr[data-elastic="false"]').remove(); var row = document.createElement("tr"); row.setAttribute("class", "noitemsfound"), row.setAttribute("data-elastic", "false"); var cell = document.createElement("td"); cell.setAttribute("class", "noitemsfound"), cell.innerHTML = "<p>" + lang_main_datatable_noitemswasfound + "</p>\n", row.appendChild(cell), table.appendChild(row), document.getElementById("datatable_" + id + "_itemcount").innerHTML = mir_translate("No item(s) found"), document.getElementById("datatable_" + id + "_pagecount").innerHTML = mir_translate("No pages"), $("#datatable_" + id + "_itemcount").parent().attr("data-count", 0); var usersettings = {}; "false" == document.getElementsByTagName("body")[0].getAttribute("data-mobile") && (usersettings["endpoint_" + endpoint + "_current_page"] = curpage), usersettings["endpoint_" + endpoint + "_filter"] = filter, usersettings["endpoint_" + endpoint + "_group"] = group, $.post("/?mode=set-user-settings&calltype=light", usersettings, (function (t) { dataobject.offset > 0 && markup_api_datatable_set_page("previous", id, append) })) } else if (1 == window["datatable_" + id + "_showresults"]) { $("#datatable_header_" + id + " > ul.paging").show(), $("#datatable_" + id + ' > tbody > tr[data-elastic="true"],#datatable_' + id + ' > tr[data-elastic="true"]').css("display", ""); var play_function = table.getAttribute("data-play-function"), listen_function = table.getAttribute("data-listen-function"), queue_function = table.getAttribute("data-queue-function"), watch_url = table.getAttribute("data-watch-url"), permissions_url = table.getAttribute("data-permissions-url"), activate_url = table.getAttribute("data-activate-url"), draw_url = table.getAttribute("data-draw-url"), edit_url = table.getAttribute("data-edit-url"), delete_url = table.getAttribute("data-delete-url"), download_url = table.getAttribute("data-download-url"), active_guid = table.getAttribute("data-active-guid"), data_ident = table.getAttribute("data-ident"), endpoint = table.getAttribute("data-endpoint"), subhead_export_url = table.getAttribute("data-subhead-export-url"), allow_set_item_permissions = table.getAttribute("data-item-permissions"), perpage = parseInt(table.getAttribute("data-per-page")), numitems = parseInt(data.headers["X-Total-Count"]), pictogram = table.getAttribute("data-pictogram"); 0 == pictogram.length && (pictogram = "icon_user_green"), 1 == append ? $("#datatable_" + id + " > tbody > tr.loading,#datatable_" + id + " > tr.loading").remove() : $("#datatable_" + id + ' > tbody > tr[data-elastic="false"],#datatable_' + id + ' > tr[data-elastic="false"]').remove(); var numpages = Math.ceil(numitems / perpage); if (table.setAttribute("data-max-page", numpages), 0 == table.getAttribute("data-current-page")) { table.setAttribute("data-current-page", 1); var curpage = 1 } else { if ("true" == document.getElementsByTagName("body")[0].getAttribute("data-mobile")) var curpage = parseInt(table.getAttribute("data-current-mobile-page")); else var curpage = parseInt(table.getAttribute("data-current-page")); curpage > numpages && (table.setAttribute("data-current-page", numpages), curpage = parseInt(numpages)) } var usersettings = {}; "false" == document.getElementsByTagName("body")[0].getAttribute("data-mobile") && (usersettings["endpoint_" + endpoint + "_current_page"] = curpage), usersettings["endpoint_" + endpoint + "_filter"] = filter, usersettings["endpoint_" + endpoint + "_group"] = group, $.post("/?mode=set-user-settings&calltype=light", usersettings, (function (t) { })); var c_start = (parseInt(curpage) - 1) * parseInt(perpage), c_stop = c_start + parseInt(perpage), c_start = 0, c_stop = parseInt(perpage); c_stop > parseInt(numitems) - (parseInt(curpage) - 1) * parseInt(perpage) && (c_stop = parseInt(numitems) - (parseInt(curpage) - 1) * parseInt(perpage)), document.getElementById("datatable_" + id + "_itemcount").innerHTML = mir_translate("%(numhits)d item(s) found", { numhits: number_format(data.headers["X-Total-Count"], 0, ",", ".") }), document.getElementById("datatable_" + id + "_pagecount").innerHTML = mir_translate("Page %(numpage)d of %(numpages)d", { numpage: number_format(curpage, 0, ",", "."), numpages: number_format(numpages, 0, ",", ".") }), $("#datatable_" + id + "_itemcount").parent().attr("data-count", data.headers["X-Total-Count"]); for (var curhead = "", c = 0; c < c_stop;) { if (subhead_field.length > 0) if (data.results[c].subhead_guid == curhead); else { curhead = data.results[c].subhead_guid; var current_is_active_site = !1; "fleet" == MIR.config.product && "maps" == data_ident && "" != active_guid && active_guid == data.results[c].subhead_guid && (current_is_active_site = !0); var row = document.createElement("tr"); row.setAttribute("data-elastic", "false"), row.setAttribute("class", "subheadrow visible"), table.appendChild(row); var cell = document.createElement("th"); if ("fleet" == MIR.config.product && "maps" == data_ident ? (cell.setAttribute("colspan", 4), cell.setAttribute("class", "subhead map-subhead")) : (cell.setAttribute("colspan", fieldarr.length - 1), cell.setAttribute("class", "subhead")), "fleet" == MIR.config.product && current_is_active_site ? cell.innerHTML = '<div class="active-site">' + data.results[c].subhead + '<span class="active">' + mir_translate("Active") + "</span></div>" : cell.innerHTML = "<div>" + data.results[c].subhead + "</div>", row.appendChild(cell), "fleet" != MIR.config.product) { var cell = document.createElement("th"); cell.setAttribute("class", "subhead_buttons"), row.appendChild(cell) } if (subhead_export_url.length > 0 && "mirconst-guid-0000-0001-areas0000000" !== data.results[c].subhead_guid) { var button = document.createElement("a"); button.setAttribute("href", subhead_export_url.replace("[guid]", data.results[c].subhead_guid)), button.setAttribute("class", "export"), button.setAttribute("title", lang_main_datatable_export), button.innerHTML = "<span>" + lang_main_datatable_export + "</span>", cell.appendChild(button) } if (subhead_export_url.length > 0 && "mirconst-guid-0000-0001-areas0000000" !== data.results[c].subhead_guid && "fleet" == MIR.config.product && !current_is_active_site) { var button = document.createElement("a"), classes = "set_this_site_to_active disable"; data.results[c].allowed_methods.indexOf("PUT") >= 0 && (classes = "set_this_site_to_active"), button.setAttribute("class", classes), button.setAttribute("href", "/setup/maps"), button.setAttribute("data-guid", data.results[c].subhead_guid), button.setAttribute("data-switching-site", "false"), button.innerHTML = "<span>" + mir_translate("activate_site") + "</span>", cell.appendChild(button) } } var row = document.createElement("tr"); row.setAttribute("data-elastic", "false"), row.setAttribute("class", "visible"), data.results[c].guid == table.getAttribute("data-active-guid") && table.getAttribute("data-active-guid").length > 0 ? row.setAttribute("data-active", "true") : row.setAttribute("data-active", "false"), data.results[c].child_positions && data.results[c].child_positions.length > 0 ? row.setAttribute("data-has-children", "true") : row.setAttribute("data-has-children", "false"), row.setAttribute("data-open", "false"), row.setAttribute("data-guid", data.results[c].guid), row.setAttribute("data-id", data.results[c].id), row.onclick = function () { $(window).width() < MIR.constants.MOBILE_RES_THRESHOLD && (this.parentNode.getAttribute("data-edit-url").length > 0 ? location.href = this.parentNode.getAttribute("data-edit-url").replace("[guid]", this.getAttribute("data-guid")).replace("[id]", this.getAttribute("data-id")) : this.parentNode.getAttribute("data-watch-url").length > 0 && (location.href = this.parentNode.getAttribute("data-watch-url").replace("[guid]", this.getAttribute("data-guid")).replace("[id]", this.getAttribute("data-id")))) }; for (var s = 0, len = fieldarr.length; s < len;) { null == data.results[c].allowed_methods && (data.results[c].allowed_methods = []); var cell = document.createElement("td"); if (0 == s) { var pic = document.createElement("img"); pic.setAttribute("src", "/graphics/" + pictogram + ".svg"), pic.setAttribute("width", 16), pic.setAttribute("height", 16), cell.appendChild(pic) } else if (s == len - 1) { var watchbutton_inserted = !1; if ("true" == allow_set_item_permissions) { var button = document.createElement("div"); button.setAttribute("data-guid", data.results[c].guid), button.setAttribute("data-endpoint", endpoint), button.setAttribute("class", "itempermissions"), button.setAttribute("data-active", "true"), button.setAttribute("title", lang_main_datatable_itempermissions), button.innerHTML = "<span>Permissions</span>", button.onclick = function () { launch_item_permissions(this.getAttribute("data-endpoint"), this.getAttribute("data-guid")) }, cell.appendChild(button) } if (play_function.length > 0 && -1 != data.results[c].allowed_methods.indexOf("PUT")) { var button = document.createElement("div"); button.setAttribute("data-play-function", play_function), button.setAttribute("data-guid", data.results[c].guid), button.setAttribute("data-length", data.results[c].length), button.setAttribute("data-volume", data.results[c].volume), button.setAttribute("data-playing", "false"), button.setAttribute("title", mir_translate("Play")), button.setAttribute("class", "play"), button.innerHTML = "<span>Play</span>", button.onclick = function () { eval(this.getAttribute("data-play-function") + "(this,'" + this.getAttribute("data-guid") + "');") }, cell.appendChild(button) } if (listen_function.length > 0) { var button = document.createElement("div"); button.setAttribute("data-listen-function", listen_function), button.setAttribute("data-guid", data.results[c].guid), button.setAttribute("data-playing", "false"), button.setAttribute("title", mir_translate("Listen")), button.setAttribute("class", "listen"), button.innerHTML = "<span>Listen</span>", button.onclick = function () { eval(this.getAttribute("data-listen-function") + "(this,'" + this.getAttribute("data-guid") + "');") }, cell.appendChild(button) } if (queue_function.length > 0) { var button = document.createElement("div"); button.setAttribute("data-queue-function", queue_function), button.setAttribute("data-guid", data.results[c].guid), button.setAttribute("title", mir_translate("Queue")), button.setAttribute("class", "queue"), button.innerHTML = "<span>Queue</span>", button.onclick = function () { eval(this.getAttribute("data-queue-function") + "(null,'" + this.getAttribute("data-guid") + "',null);") }, cell.appendChild(button) } if (permissions_url.length > 0) { var button = document.createElement("a"); button.setAttribute("href", permissions_url.replace("[guid]", data.results[c].guid)), button.setAttribute("class", "permissions"), button.setAttribute("title", lang_main_datatable_permissions), button.innerHTML = "<span>Permissions</span>", -1 == data.results[c].allowed_methods.indexOf("PUT") && (button.onclick = function () { return launch_error(datatable_lang_editnotallowed), !1 }, button.setAttribute("href", ""), button.setAttribute("data-active", "false")), cell.appendChild(button) } if (activate_url.length > 0) { var button = document.createElement("a"); button.setAttribute("href", activate_url.replace("[guid]", data.results[c].guid)), button.setAttribute("class", "activate"), button.setAttribute("title", mir_translate("Activate")), button.setAttribute("data-map-guid", data.results[c].guid), button.innerHTML = "<span>Activate</span>", button.onclick = function () { launch_waiter("The robot is changing map."); var t = this.getAttribute("href"), e = {}; return e.id = this.getAttribute("data-map-guid"), $.ajax({ url: t, data: e, method: "POST", dataType: "json", id: id, success: function (t) { if (200 == t.headers.httpcode) var e = window.setInterval((function () { 255 == robot_mode_id || (window.clearInterval(e), table.setAttribute("data-active-guid", robot_map_id), markup_api_datatable_set_page("first", id, !1, !0), close_waiter()) }), 2e3); else close_waiter(), launch_error(mir_translate(t.results.error_human)) } }), !1 }, cell.appendChild(button) } if (download_url.length > 0) { var button = document.createElement("a"); button.setAttribute("href", download_url.replace("[guid]", data.results[c].guid).replace("[id]", data.results[c].id)), button.setAttribute("class", "download"), button.setAttribute("data-active", "true"), button.setAttribute("title", lang_main_datatable_download), button.innerHTML = "<span>Download</span>", 0 == data.results[c].ready && (button.setAttribute("data-active", "false"), button.onclick = function () { return !1 }), cell.appendChild(button) } if (draw_url.length > 0) { var button = document.createElement("a"); button.setAttribute("href", draw_url.replace("[guid]", data.results[c].guid)), button.setAttribute("class", "draw"), button.setAttribute("data-active", "true"), button.setAttribute("title", lang_main_datatable_draw), button.innerHTML = "<span>Draw</span>", -1 == data.results[c].allowed_methods.indexOf("PUT") && (button.onclick = function () { return launch_error(datatable_lang_editnotallowed), !1 }, button.setAttribute("href", ""), button.setAttribute("data-active", "false")), cell.appendChild(button) } if (watch_url.length > 0 && (0 == edit_url.length || -1 == data.results[c].allowed_methods.indexOf("PUT"))) { var button = document.createElement("a"); button.setAttribute("href", watch_url.replace("[guid]", data.results[c].guid).replace("[id]", data.results[c].id)), button.setAttribute("class", "watch"), button.setAttribute("title", lang_main_datatable_watch), button.innerHTML = "<span>Watch</span>", cell.appendChild(button), 0 == data.results[c].ready && (button.setAttribute("data-active", "false"), button.onclick = function () { return !1 }), watchbutton_inserted = !0 } if (edit_url.length > 0 && 0 == watchbutton_inserted) { var edit_myself_button = !1, button = document.createElement("a"); data.results[c].guid && user_guid && "/users" == endpoint && data.results[c].guid == user_guid ? (button.setAttribute("href", edit_url.replace("[guid]", "me")), edit_myself_button = !0) : button.setAttribute("href", edit_url.replace("[guid]", data.results[c].guid).replace("[id]", data.results[c].id)), button.setAttribute("class", "edit"), button.setAttribute("data-active", "true"), button.setAttribute("title", mir_translate("Edit")), button.innerHTML = "<span>Edit</span>", -1 == data.results[c].allowed_methods.indexOf("PUT") && 0 == edit_myself_button && (button.onclick = function () { return launch_error(datatable_lang_editnotallowed), !1 }, button.setAttribute("href", ""), button.setAttribute("data-active", "false")), cell.appendChild(button) } if (delete_url.length > 0) { var button = document.createElement("a"); button.setAttribute("href", delete_url.replace("[guid]", data.results[c].guid).replace("[id]", data.results[c].id)), button.setAttribute("class", "delete"), button.setAttribute("data-active", "true"), button.setAttribute("title", mir_translate("Delete")), button.innerHTML = "<span>Delete</span>", (-1 == data.results[c].allowed_methods.indexOf("DELETE") || data.results[c].guid == robot_map_id && "/maps" == endpoint) && (button.onclick = function () { return launch_error(datatable_lang_deletenotallowed), !1 }, button.setAttribute("href", ""), button.setAttribute("data-active", "false")), cell.appendChild(button) } } else { if (1 == s && data.results[c].guid == active_guid) var activeindicator = ' <span class="active">' + datatable_lang_active + "</span>"; else var activeindicator = ""; var curcontent = data.results[c][fieldarr[s]]; null == curcontent && (curcontent = "&nbsp;"); var celldiv = document.createElement("div"); celldiv.setAttribute("data-guid", data.results[c].guid), celldiv.innerHTML = curcontent + activeindicator, data.results[c].child_positions && data.results[c].child_positions.length > 0 && (celldiv.onclick = function () { var t = this.parentNode.parentNode, e = this.getAttribute("data-guid"); "true" == t.getAttribute("data-open") ? (t.setAttribute("data-open", "false"), $(t).parent().find("tr[data-child-of='" + e + "'].subrow").attr("data-open", "false")) : (t.setAttribute("data-open", "true"), $(t).parent().find("tr[data-child-of='" + e + "'].subrow").attr("data-open", "true")) }); var cell = document.createElement("td"); cell.innerHTML = fieldnames[s], cell.appendChild(celldiv), row.appendChild(cell) } row.appendChild(cell), s++ } if (table.appendChild(row), data.results[c].child_positions && data.results[c].child_positions.length > 0) for (var t = 0; t < data.results[c].child_positions.length;) { var subrow = document.createElement("tr"); subrow.setAttribute("data-elastic", "false"), subrow.setAttribute("class", "subrow"), subrow.setAttribute("data-open", "false"), subrow.setAttribute("data-child-of", data.results[c].guid), table.appendChild(subrow); var cell = document.createElement("td"); cell.innerHTML = "&nbsp;", subrow.appendChild(cell); var cell = document.createElement("td"); cell.innerHTML = "<div>" + data.results[c].child_positions[t].name + "</div>", subrow.appendChild(cell); var cell = document.createElement("td"); cell.innerHTML = "<div>" + data.results[c].child_positions[t].type_id + "</div>", subrow.appendChild(cell); var cell = document.createElement("td"); cell.innerHTML = "<div>" + data.results[c].child_positions[t].pos_x + "</div>", subrow.appendChild(cell); var cell = document.createElement("td"); cell.innerHTML = "<div>" + data.results[c].child_positions[t].pos_y + "</div>", subrow.appendChild(cell); var cell = document.createElement("td"); cell.innerHTML = "<div>" + data.results[c].child_positions[t].orientation + "</div>", subrow.appendChild(cell); var cell = document.createElement("td"); subrow.appendChild(cell); var button = document.createElement("a"); button.setAttribute("href", edit_url.replace("[guid]", data.results[c].child_positions[t].guid)), button.setAttribute("class", "edit"), button.setAttribute("data-active", "true"), button.innerHTML = "<span>Edit</span>", -1 == data.results[c].child_positions[t].allowed_methods.indexOf("PUT") && (button.onclick = function () { return launch_error(datatable_lang_editnotallowed), !1 }, button.setAttribute("href", ""), button.setAttribute("data-active", "false")), cell.appendChild(button); var button = document.createElement("a"); button.setAttribute("href", ""), button.setAttribute("class", "delete"), button.setAttribute("data-active", "false"), button.innerHTML = "<span>Delete</span>", button.onclick = function () { return !1 }, cell.appendChild(button), t++ } c++ } if (data.unused_subheads && data.unused_subheads.length > 0 && 1 == curpage) for (var c = 0; c < data.unused_subheads.length;) { var row = document.createElement("tr"); row.setAttribute("data-elastic", "false"), row.setAttribute("data-empty", "true"), row.setAttribute("class", "subheadrow visible"), table.appendChild(row); var cell = document.createElement("th"); cell.setAttribute("colspan", fieldarr.length - 1), cell.setAttribute("class", "subhead"), cell.innerHTML = "<div>" + data.unused_subheads[c].name + "</div>", row.appendChild(cell); var cell = document.createElement("th"); cell.setAttribute("class", "subhead_buttons"), row.appendChild(cell); var button = document.createElement("div"); button.setAttribute("class", "delete"), button.setAttribute("title", lang_main_datatable_delete), -1 == data.unused_subheads[c].allowed_methods.indexOf("DELETE") ? button.setAttribute("data-active", "false") : button.setAttribute("data-active", "true"), button.setAttribute("data-endpoint", subhead_field_lookup), button.setAttribute("data-id", data.unused_subheads[c].guid), button.innerHTML = "<span>" + lang_main_datatable_delete + "</span>", data.unused_subheads[c].allowed_methods && data.unused_subheads[c].allowed_methods.indexOf("DELETE") > -1 && (button.onclick = function () { launch_confirm(lang_main_datatable_reallydelete, lang_main_datatable_reallydeletedescription, "instant_delete('" + this.getAttribute("data-endpoint") + "','" + this.getAttribute("data-id") + "','markup_api_datatable_get_page(\"" + id + '",' + append + ");');") }), "/maps" == endpoint && cell.appendChild(button); var row = document.createElement("tr"); row.setAttribute("data-elastic", "false"), row.setAttribute("class", "subheadnodatarow visible"), table.appendChild(row); var cell = document.createElement("td"); if (cell.setAttribute("colspan", fieldarr.length), cell.setAttribute("class", "nosubdata"), cell.innerHTML = "<div>" + lang_main_datatable_noitemsavailable + "</div>", row.appendChild(cell), c++, c == data.unused_subheads.length) { $('tr[data-empty-groups="true"]').length && $('tr[data-empty-groups="true"]').remove(); var row = document.createElement("tr"); row.setAttribute("data-empty-groups", "true"); var cell = document.createElement("th"); cell.setAttribute("colspan", fieldarr.length), cell.innerText = mir_translate("shared_setup_maps_table_heading_title_empty_sites"), $(row).css("padding", "5px 0 5px 0"), $(cell).css("text-align", "left"), $(cell).css("padding-left", "10px"), $(row).append($(cell)); var cell = document.createElement("th"); $(row).prepend($(cell)), $('tr[data-empty="true"]').eq(0).before($(row)) } } } if (window["datatable_" + id + "_fetching"], "false" === table.getAttribute("data-infinite-scroll-mobile")) { var $paging = $(".datatable-paging[data-table-id='" + id + "']"); 0 === $paging.length && ($paging = $(["<div class='datatable-paging' data-table-id='" + id + "'>", "\t<span class='first mir-btn mir-blue'></span>", "\t<span class='prev mir-btn mir-blue'></span>", "\t<span class='info'>" + mir_translate("Previous") + "</span>", "\t<span class='next mir-btn mir-blue'></span>", "\t<span class='last mir-btn mir-blue'></span>", "</div>"].join("\n")).insertBefore(table), $paging.find(".first").click((function () { markup_api_datatable_set_page("first", id) })), $paging.find(".last").click((function () { markup_api_datatable_set_page("last", id) })), $paging.find(".next").click((function () { markup_api_datatable_set_page("next", id) })), $paging.find(".prev").click((function () { markup_api_datatable_set_page("previous", id) }))), $paging.find(".info").html(mir_translate("Page %(numpage)d of %(numpages)d", { numpage: number_format(parseInt(table.getAttribute("data-current-page")), 0, ",", "."), numpages: number_format(parseInt(table.getAttribute("data-max-page")), 0, ",", ".") })), $paging.find(".first,.prev").toggleClass("mir-disabled", 1 == table.getAttribute("data-current-page")), $paging.find(".last,.next").toggleClass("mir-disabled", table.getAttribute("data-current-page") == table.getAttribute("data-max-page")) } else if (table.getAttribute("data-current-page") < table.getAttribute("data-max-page")) { var row = document.createElement("tr"); row.setAttribute("data-elastic", "false"), row.setAttribute("class", "loading"), table.appendChild(row); var cell = document.createElement("td"); cell.innerHTML = "<div>Loading...</div>", row.appendChild(cell) } table.setAttribute("data-in-progress", "false") })) } function markup_api_datatable_set_page(t, e, a, r) { var n = document.getElementById("datatable_" + e); if ("false" == n.getAttribute("data-in-progress")) { n.setAttribute("data-in-progress", "true"); var i = n.getAttribute("data-current-page"), o = n.getAttribute("data-max-page"), s = 0; "first" == t && parseInt(i) > 1 && parseInt(i) > 0 ? s = 1 : "previous" == t && parseInt(i) > 1 && parseInt(i) > 0 ? s = parseInt(i) - 1 : "next" == t && parseInt(i) < parseInt(o) && parseInt(i) > 0 ? s = parseInt(i) + 1 : "last" == t && parseInt(i) < parseInt(o) && parseInt(i) > 0 && (s = parseInt(o)), s > 0 ? (n.setAttribute("data-current-page", s), n.setAttribute("data-current-mobile-page", s)) : n.setAttribute("data-in-progress", "false"), (s > 0 || r) && markup_api_datatable_get_page(e, a) } } function instant_delete(endpoint, id, dowhendone) { var fields = { mode: "instant-delete" }; fields.id = id, fields.endpoint = endpoint, $.ajax({ url: "/", data: fields, method: "GET", dataType: "json", dowhendone: dowhendone, success: function (data) { 204 == data.headers.httpcode && eval(this.dowhendone) } }) } function form_submit(t) { var e = document.getElementById("form_" + t), a = document.getElementById("formholder_" + t); a.setAttribute("data-error", "false"), $(a).find("div.field").attr("data-error", "false"); var r = $(a).find("input[type='submit']").attr("value"), n = $(a).find("input[type='submit']").attr("data-template"); $(a).find("input[type='submit']").attr("data-template", "submitting"), $(a).find("input[type='submit']").attr("value", form_lang_pleasewait), $(a).find("input[type='submit']").prop("disabled", !0), null != document.getElementById(t + "_errorholder") && document.getElementById(t + "_errorholder").parentNode.removeChild(document.getElementById(t + "_errorholder")); var i = {}; return $("#form_" + t + " input, #form_" + t + " select, #form_" + t + " textarea").each((function () { if (this.getAttribute("disabled") && "disabled" == this.getAttribute("disabled")); else { var t = this.getAttribute("name"); this.hasAttribute("data-type") && (t += ":::::" + this.getAttribute("data-type")), this.hasAttribute("data-sort-order") && (t += ":::::" + this.getAttribute("data-sort-order")), this.hasAttribute("data-position-guid") && (t += ":::::" + this.getAttribute("data-position-guid")), 1 == $(this).is("select") ? (i[t] = "", 0 != this.options.length && (i[t] = this.options[this.selectedIndex].value)) : "radio" == this.getAttribute("type") ? 1 == this.checked && (i[t] = this.value) : "checkbox" == this.getAttribute("type") ? 1 == this.checked ? i[t] = this.value : i[t] = "false" : i[t] = this.value } })), $.post(e.getAttribute("action"), i, (function (a) { if (200 == a.headers.httpcode || 201 == a.headers.httpcode) if ("goto" == a.type) resetChanges(), location.href = a.url; else if (void 0 !== a.results.error_code) { if (void 0 !== a.results.field_errors) { var i = 0, o = Array(), s = document.createElement("div"); for (var d in s.setAttribute("class", "errors"), s.setAttribute("id", t + "_errorholder"), a.results.field_errors) o.push(a.results.field_errors[d]), i++; if (1 == i) { (l = document.createElement("p")).innerHTML = "<strong>An error occured:</strong><br />" + mir_translate(o[0].error_human), s.appendChild(l) } else { var l; (l = document.createElement("p")).innerHTML = "<strong>Some errors occured. Please correct the errors and try again.</strong>", s.appendChild(l); var u = document.createElement("ul"); s.appendChild(u); for (var c = 0; c < o.length;) { (d = document.createElement("li")).innerHTML = "<div>" + mir_translate(o[c].error_human) + "</div>", u.appendChild(d), c++ } } s.setAttribute("data-errors", i), e.parentNode.insertBefore(s, e.parentNode.firstChild) } } else { resetChanges(); var m = e.getAttribute("data-end-url"); m = m.replace("[guid]", a.results.guid), location.href = m } else { var p = document.getElementById("formholder_" + t), _ = ""; if (document.getElementById(t + "_errormessage").innerHTML = mir_translate(a.results.error_human), p.setAttribute("data-error", "true"), void 0 !== a.results.field_errors) { for (var b in a.results.field_errors) { 0 == _.length && (_ = b); var g = $(p).find("div.field[data-field='" + b + "'],div.checkfield[data-field='" + b + "']"); $(g).attr("data-error", "true"), $(g).children("div.fielderror").html("<p>" + mir_translate(a.results.field_errors[b].error_human) + "</p>") } _.length > 0 && document.getElementById(_).focus() } } $(p).find("input[type='submit']").attr("data-template", n), $(p).find("input[type='submit']").attr("value", r), $(p).find("input[type='submit']").prop("disabled", !1) })), !1 } function joystick_toggle() { var t = new ROSLIB.Service({ ros: ros, name: "/mirsupervisor/setRobotState", serviceType: "mirSupervisor/SetState" }), e = { robotState: 4 }; 11 != robot_state_id && (e.robotState = 11, e.web_session_id = MIR.joystick.session_user), t.callService(new ROSLIB.ServiceRequest(e), (function (t) { t.joystick_token && "" != t.joystick_token && MIR.joystick.claim(t.joystick_token) })) } function joystick_movement(t, e, a) { a || (a = 1.5); var r = $(e), n = r.closest(".holder"), i = r.closest(".joystick"), o = i.attr("data-speed"), s = (n.height() - r.height()) / a, d = t.originalPosition.top - t.position.top, l = t.originalPosition.left - t.position.left, u = Math.sqrt(d * d + l * l); if (u > s) { var c = u / s; d /= c, l /= c, t.position.top = t.originalPosition.top - d, t.position.left = t.originalPosition.left - l } var m = 20 + d / 6, p = l / 3; r.css("box-shadow", p + "px " + m + "px 5px rgba(0,0,0,0.5)"); var _ = 1; _ = "3" == document.getElementsByTagName("body")[0].getAttribute("data-mode-id") ? 1.1 : "slow" == o ? .5 : "fast" == o && "MiR100" == robot_model ? 1.5 : "fast" == o ? 1.1 : "custom" == o ? parseFloat(i.attr("data-custom-speed")) : 1, "true" == $("body").attr("data-mapping") && $("body").attr("mapping-engine") == MIR.constants.MAPPING_ALGORITHM.HECTOR && (_ = .5); var b = 100 * _; joystick_x = d / s * b, joystick_y = l / s * b } function joystick_start() { joystick_action = !0, null == joystick_timer && (joystick_timer = setInterval((function () { joystick_transmit(!1) }), 100)) } function joystick_stop() { joystick_action = !1, clearInterval(joystick_timer), joystick_timer = null, joystick_transmit(!0) } function joystick_transmit(t) { var e = { joystick_token: MIR.joystick.user_token, speed_command: { linear: { x: 0, y: 0, z: 0 }, angular: { x: 0, y: 0, z: 0 } } }, a = new ROSLIB.Message(e); 1 == t ? (a.speed_command.linear.x = 0, a.speed_command.angular.z = 0) : (a.speed_command.linear.x = joystick_x / 100, a.speed_command.angular.z = joystick_y / 100); try { ros_cmd_vel.publish(a) } catch (t) { } } function number_format(t, e, a, r) { t = (t + "").replace(",", "").replace(" ", ""); var n = isFinite(+t) ? +t : 0, i = isFinite(+e) ? Math.abs(e) : 0, o = void 0 === r ? "," : r, s = void 0 === a ? "." : a, d = ""; return (d = (i ? function (t, e) { var a = Math.pow(10, e); return "" + Math.round(t * a) / a }(n, i) : "" + Math.round(n)).split("."))[0].length > 3 && (d[0] = d[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, o)), (d[1] || "").length < i && (d[1] = d[1] || "", d[1] += new Array(i - d[1].length + 1).join("0")), d.join(s) } function element_in_viewport(t) { for (var e = t.offsetTop, a = t.offsetLeft, r = t.offsetWidth, n = t.offsetHeight; t.offsetParent;)e += (t = t.offsetParent).offsetTop, a += t.offsetLeft; return e < window.pageYOffset + window.innerHeight && a < window.pageXOffset + window.innerWidth && e + n > window.pageYOffset && a + r > window.pageXOffset } function form_launch_minihelp(t) { form_hide_tooltips(); var e = document.createElement("div"); e.setAttribute("class", "helpboxbg"), e.setAttribute("data-scroll", "false"), e.setAttribute("id", "helpboxbg"), document.getElementsByTagName("body")[0].appendChild(e); var a = document.createElement("div"); a.setAttribute("class", "box"), e.appendChild(a); var r = document.createElement("h1"); r.innerHTML = helptexts[t].name, a.appendChild(r); var n = document.createElement("p"); n.innerHTML = helptexts[t].tooltip, a.appendChild(n); var i = document.createElement("p"); i.innerHTML = helptexts[t].explain, a.appendChild(i); var o = document.createElement("div"); return o.setAttribute("class", "button"), o.innerHTML = "Close", a.appendChild(o), o.onclick = function () { document.getElementById("helpboxbg").parentNode.removeChild(parent.document.getElementById("helpboxbg")) }, !0 } function help_launch(t) { t = (t = (t = (t = (t = (t = (t = t.split("&lbrace;lb&rcub;").join("<br />")).split("&lbrace;b&rcub;").join("<strong>")).split("&lbrace;&sol;b&rcub;").join("</strong>")).split("&lbrace;/b&rcub;").join("</strong>")).split("&lbrace;i&rcub;").join("<i>")).split("&lbrace;&sol;i&rcub;").join("</i>")).split("&lbrace;/i&rcub;").join("</i>"); var e = document.createElement("div"); e.setAttribute("class", "helpboxbg"), e.setAttribute("data-scroll", "true"), e.setAttribute("id", "helpboxbg"), document.getElementsByTagName("body")[0].appendChild(e); var a = document.createElement("div"); a.setAttribute("class", "box"), a.innerHTML = decodeHtml(t), e.appendChild(a); var r = document.createElement("div"); return r.setAttribute("class", "button"), r.innerHTML = mir_translate("Close"), a.appendChild(r), r.onclick = function () { document.getElementById("helpboxbg").parentNode.removeChild(parent.document.getElementById("helpboxbg")) }, !0 } function ros_quaternion_to_global_theta(t) { var e = t.w, a = t.x, r = t.y, n = t.z; return Math.atan2(2 * (e * n + a * r), 1 - 2 * (Math.pow(r, 2) + Math.pow(n, 2))) } function deg_to_rad(t) { return .017453293 * t } function rad_to_deg(t) { return 57.29578 * t } function robot_to_cart_center(t, e, a, r, n, i) { var o = a + n, s = r + i / 2; return [t - s * Math.cos(o), e - s * Math.sin(o), o] } function processesview_init() { new ROSLIB.Service({ ros: ros, name: "/mirspawn/list", serviceType: "mirSpawn/LaunchList" }).callService(new ROSLIB.ServiceRequest({}), initProcessesPage) } function processesview_toggle_process(t, e) { var a = document.getElementById(t + "_switch_" + e); if ("pending" == a.getAttribute("data-state")) launch_message(processes_lang_impatience_headline, processes_lang_impatience_text); else { var r = new ROSLIB.Service({ ros: ros, name: "/mirspawn/start", serviceType: "mirSpawn/NodeAction" }), n = new ROSLIB.Service({ ros: ros, name: "/mirspawn/stop", serviceType: "mirSpawn/NodeAction" }); "on" == a.getAttribute("data-state") ? n.callService(new ROSLIB.ServiceRequest({ launch_file_name: e }), (function (t) { a.setAttribute("data-state", "pending"), updateProcessStatus(e, a) })) : "off" == a.getAttribute("data-state") && r.callService(new ROSLIB.ServiceRequest({ launch_file_name: e }), (function (t) { a.setAttribute("data-state", "pending"), updateProcessStatus(e, a) })) } return !0 } function resetPlcStyle(t) { setTimeout((function () { t.removeClass("row--highlight") }), 300) } function plcview_set_filter(t, e, a) { var r = document.getElementById(t + "_plcview_" + e + "_plcholder"); r.setAttribute("data-modbus", check_feature("modbus") ? "true" : "false"); var n = document.getElementById("plcview_" + t + "_" + e + "_filter_minimum"), i = document.getElementById("plcview_" + t + "_" + e + "_filter_maximum"), o = parseInt(n.value), s = parseInt(i.value), d = o, l = s; 0 == is_int(d) && "int" == e ? d = 1 : 0 == is_int(d) && "double" == e ? d = 101 : d < 1 && "int" == e ? d = 1 : d < 101 && "double" == e ? d = 101 : d > 100 && "int" == e ? d = 100 : d > 200 && "double" == e && (d = 200), 0 == is_int(l) && "int" == e ? l = 100 : 0 == is_int(l) && "double" == e ? d = 200 : l < 1 && "int" == e ? l = 1 : l < 101 && "double" == e ? l = 200 : l > 100 && "int" == e ? l = 100 : l > 200 && "double" == e && (l = 200), d > l && "int" == e ? (d = 1, l = 100) : d > l && "double" == e && (d = 101, l = 200), o != d && n !== document.activeElement && (document.getElementById("plcview_" + t + "_" + e + "_filter_minimum").value = d), s != l && i !== document.activeElement && (document.getElementById("plcview_" + t + "_" + e + "_filter_maximum").value = l); var u = {}; u.minimum = d, u.maximum = l, u.systemname = e; var c = check_feature("modbus"); return $.post("/?mode=get-plc-registers&calltype=light", u, (function (a) { if (JSON.stringify(a) == window["plcview_" + t + "_" + e + "_cache"]); else { window["plcview_" + t + "_" + e + "_cache"] = JSON.stringify(a); var n = {}; $(r).find("div.plc").each((function () { n[$(this).attr("data-plc-id")] = {}, n[$(this).attr("data-plc-id")].value = $(this).attr("data-plc-value"), n[$(this).attr("data-plc-id")].label = $(this).attr("data-plc-label") })), r.innerHTML = ""; for (var i = 0; i < a.length;) { var o = document.createElement("div"); o.setAttribute("class", "plc"), o.setAttribute("data-plc-id", a[i].id), o.setAttribute("data-plc-value", a[i].value), o.setAttribute("data-plc-label", a[i].label), r.appendChild(o); var s = document.createElement("div"); s.setAttribute("class", "numholder"), s.innerHTML = a[i].id, o.appendChild(s); var d = document.createElement("div"); d.setAttribute("class", "infowrapper"), o.appendChild(d); var l = document.createElement("div"); l.setAttribute("class", "valholder"), l.innerHTML = a[i].value, d.appendChild(l); var u = document.createElement("div"); u.setAttribute("class", "labelholder"), d.appendChild(u); var m = document.createElement("div"); m.setAttribute("class", "label"), a[i].label.length > 0 ? m.innerHTML = a[i].label : m.innerHTML = mir_translate("PLC register %(id)s", { id: a[i].id }), u.appendChild(m); var p = document.createElement("div"); p.setAttribute("class", "labelbtn"), p.innerHTML = "<span>" + mir_translate("Rename") + "</span>", a[i].allowed_methods.indexOf("PUT") > -1 ? p.setAttribute("data-active", "true") : p.setAttribute("data-active", "false"), p.setAttribute("data-plc-id", a[i].id), p.setAttribute("data-element-id", t), p.setAttribute("data-reggroup", e), a[i].allowed_methods.indexOf("PUT") > -1 && (p.onclick = function () { plcview_set_plc_label(this.getAttribute("data-element-id"), this.getAttribute("data-reggroup"), this.getAttribute("data-plc-id")) }), u.appendChild(p); var _ = document.createElement("div"); _.setAttribute("class", "btnholder"), o.appendChild(_); var b = document.createElement("div"); b.setAttribute("class", "clearbutton"), a[i].allowed_methods.indexOf("PUT") > -1 ? b.setAttribute("data-active", "true") : b.setAttribute("data-active", "false"), b.innerHTML = "<span>" + mir_translate("Clear") + "</span>", b.setAttribute("data-plc-id", a[i].id), a[i].allowed_methods.indexOf("PUT") > -1 && (b.onclick = function () { var e = {}; e.id = this.getAttribute("data-plc-id"), e.value = 0, $.post("/?mode=set-plc-register", e, (function (e) { plcview_set_filter(t, "int"), plcview_set_filter(t, "double") })) }), _.appendChild(b); var g = document.createElement("div"); if (g.innerHTML = "<span>" + mir_translate("Set") + "</span>", g.setAttribute("data-plc-id", a[i].id), a[i].allowed_methods.indexOf("PUT") > -1 ? g.setAttribute("data-active", "true") : g.setAttribute("data-active", "false"), a[i].allowed_methods.indexOf("PUT") > -1 && (g.onclick = function () { plcview_set_plc("plcview", this.getAttribute("data-plc-id")) }), _.appendChild(g), c) { var h = document.createElement("div"); h.setAttribute("class", "modbusholder"), o.appendChild(h); var f = document.createElement("span"); f.setAttribute("class", "modbusregisters"), f.innerHTML = a[i].modbus, h.appendChild(f) } null == n[a[i].id] || a[i].value == n[a[i].id].value && a[i].label == n[a[i].id].label || ($('.plc[data-plc-id="' + a[i].id + '"]').addClass("row--highlight"), resetPlcStyle($('.plc[data-plc-id="' + a[i].id + '"]'))), i++ } } })), 0 == a && setTimeout((function () { plcview_set_filter(t, e, !1) }), 500), !1 } function plcview_set_plc(t, e) { e || (e = ""), document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "true"); var a = document.createElement("div"); a.setAttribute("class", "dialogboxbg"), a.setAttribute("id", "dialogboxbg"), document.getElementsByTagName("body")[0].appendChild(a); var r = document.createElement("div"); r.setAttribute("class", "box"), a.appendChild(r); var n = document.createElement("h1"); n.innerHTML = plcregisters_lang_setplcregister, r.appendChild(n); var i = document.createElement("p"); i.innerHTML = plcregisters_lang_setplcregister_text, r.appendChild(i); var o = document.createElement("p"); o.innerHTML = "", o.setAttribute("class", "error"), r.appendChild(o); var s = document.createElement("form"); s.setAttribute("method", "post"), s.setAttribute("action", "/"), s.onsubmit = function () { var e = {}; return e.id = document.getElementById("dialogbox_field_register").value, e.value = document.getElementById("dialogbox_field_value").value, $.post("/?mode=set-plc-register", e, (function (e) { if ("success" == e.state) plcview_set_filter(t, "int"), plcview_set_filter(t, "double"), document.getElementById("dialogboxbg").parentNode.removeChild(parent.document.getElementById("dialogboxbg")), document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"); else for (var a in $("#dialogboxbg").find("p.error").html(mir_translate(e.response.results.error_human)), e.response.results.field_errors) "value" == a && $("#dialogboxbg").find("p[data-field='dialogbox_field_value'].fielderror").html(mir_translate(e.response.results.field_errors[a].error_human)) })), !1 }, r.appendChild(s); var d = document.createElement("label"); d.setAttribute("for", "dialogbox_field_register"), d.innerHTML = plcregisters_lang_setplcregister_register, s.appendChild(d); var l = document.createElement("input"); l.setAttribute("type", "text"), l.setAttribute("name", "dialogbox_field_register"), l.setAttribute("id", "dialogbox_field_register"), l.setAttribute("placeholder", plcregisters_lang_setplcregister_register_text), l.setAttribute("value", e), s.appendChild(l); var u = document.createElement("p"); u.setAttribute("class", "fielderror"), u.setAttribute("data-field", "dialogbox_field_register"), u.innerHTML = "", s.appendChild(u); var c = document.createElement("label"); c.setAttribute("for", "dialogbox_field_value"), c.innerHTML = plcregisters_lang_setplcregister_value, s.appendChild(c); var m = document.createElement("input"); m.setAttribute("type", "text"), m.setAttribute("name", "dialogbox_field_value"), m.setAttribute("id", "dialogbox_field_value"), m.setAttribute("placeholder", plcregisters_lang_setplcregister_value_text), s.appendChild(m); var p = document.createElement("p"); p.setAttribute("class", "fielderror"), p.setAttribute("data-field", "dialogbox_field_value"), p.innerHTML = "", s.appendChild(p); var _ = document.createElement("div"); _.setAttribute("class", "buttonholder"), s.appendChild(_); var b = document.createElement("input"); b.setAttribute("type", "submit"), b.setAttribute("name", "submit"), b.setAttribute("value", mir_translate("OK")), _.appendChild(b); var g = document.createElement("input"); g.setAttribute("type", "button"), g.setAttribute("name", "cancel"), g.setAttribute("value", mir_translate("Cancel")), _.appendChild(g), "" != e ? $(m).focus() : $(l).focus(), g.onclick = function () { document.getElementById("dialogboxbg").parentNode.removeChild(parent.document.getElementById("dialogboxbg")), document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false") } } function plcview_set_plc_label(t, e, a) { var r = document.getElementById(t + "_plcview_" + e + "_plcholder"), n = $(r).children("div[data-plc-id='" + a + "'].plc").find("div.label").html(); document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "true"); var i = document.createElement("div"); i.setAttribute("class", "dialogboxbg"), i.setAttribute("id", "dialogboxbg"), document.getElementsByTagName("body")[0].appendChild(i); var o = document.createElement("div"); o.setAttribute("class", "box"), i.appendChild(o); var s = document.createElement("h1"); s.innerHTML = mir_translate("Label for PLC #%(id)s", { id: a }), o.appendChild(s); var d = document.createElement("p"); d.innerHTML = mir_translate("You can set or change the label for the selected plc register to better remember what it covers."), o.appendChild(d); var l = document.createElement("p"); l.innerHTML = "", l.setAttribute("class", "error"), o.appendChild(l); var u = document.createElement("form"); u.setAttribute("method", "post"), u.setAttribute("action", "/"), u.setAttribute("data-register-id", a), u.onsubmit = function () { var t = {}; return t.id = this.getAttribute("data-register-id"), t.label = document.getElementById("dialogbox_field_label").value, $.post("/system/plc-registers?mode=set-plc-register-label", t, (function (t) { document.getElementById("dialogboxbg").parentNode.removeChild(parent.document.getElementById("dialogboxbg")), document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false") })), !1 }, o.appendChild(u); var c = document.createElement("label"); c.setAttribute("for", "dialogbox_field_label"), c.innerHTML = mir_translate("Label:"), u.appendChild(c); var m = document.createElement("input"); m.setAttribute("type", "text"), m.setAttribute("name", "dialogbox_field_label"), m.setAttribute("id", "dialogbox_field_label"), m.setAttribute("placeholder", mir_translate("Enter a label for the plc register...")), m.setAttribute("value", n), u.appendChild(m); var p = document.createElement("p"); p.setAttribute("class", "fielderror"), p.setAttribute("data-field", "dialogbox_field_label"), p.innerHTML = "", u.appendChild(p); var _ = document.createElement("div"); _.setAttribute("class", "buttonholder"), u.appendChild(_); var b = document.createElement("input"); b.setAttribute("type", "submit"), b.setAttribute("name", "submit"), b.setAttribute("value", mir_translate("OK")), _.appendChild(b); var g = document.createElement("input"); return g.setAttribute("type", "button"), g.setAttribute("name", "cancel"), g.setAttribute("value", mir_translate("Cancel")), _.appendChild(g), g.onclick = function () { document.getElementById("dialogboxbg").parentNode.removeChild(parent.document.getElementById("dialogboxbg")), document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false") }, $(m).focus(), !0 } function is_int(t) { return !isNaN(t) && parseInt(Number(t)) == t && !isNaN(parseInt(t, 10)) } function minisystemlog_paging(t, e) { t.preventDefault(), t.stopPropagation(); var a = $("div.topbar_desktop > ul.tabs > li.status > div.topbar_desktop_tab_foldout > div.messages")[0], r = $("div.topbar_desktop > ul.tabs > li.status > div.topbar_desktop_tab_foldout > div.bottom > ul.pagingstatus > li > div")[0], n = parseInt(a.getAttribute("data-num-pages")), i = parseInt(a.getAttribute("data-current-page")), o = i, s = $("div.topbar_desktop > ul.tabs > li.status > div.topbar_desktop_tab_foldout > div.bottom > ul.paging > li")[0], d = $("div.topbar_desktop > ul.tabs > li.status > div.topbar_desktop_tab_foldout > div.bottom > ul.paging > li")[1]; "left" == e && i > 1 ? o = i - 1 : "right" == e && i < n ? o = i + 1 : i = o, 1 == o ? $(s).attr("data-enabled", "false") : $(s).attr("data-enabled", "true"), o == n ? $(d).attr("data-enabled", "false") : $(d).attr("data-enabled", "true"), r.innerHTML = "Page " + o + " of " + n, a.setAttribute("data-current-page", o) } function mobile_minisystemlog_paging(t, e) { t.preventDefault(), t.stopPropagation(); var a = $("div.mobilestatus > div.messages")[0], r = $("div.mobilestatus > div.bottom > ul.pagingstatus > li > div")[0], n = parseInt(a.getAttribute("data-num-pages")), i = parseInt(a.getAttribute("data-current-page")), o = i, s = $("div.mobilestatus > div.bottom > ul.paging > li")[0], d = $("div.mobilestatus > div.bottom > ul.paging > li")[1]; "left" == e && i > 1 ? o = i - 1 : "right" == e && i < n ? o = i + 1 : i = o, 1 == o ? $(s).attr("data-enabled", "false") : $(s).attr("data-enabled", "true"), o == n ? $(d).attr("data-enabled", "false") : $(d).attr("data-enabled", "true"), r.innerHTML = "Page " + o + " of " + n, a.setAttribute("data-current-page", o) } function set_innerhtml_from_element_id(t, e) { var a = document.getElementById(t); null == a ? console.log("Failed to locate element with id = " + t) : a.innerHTML = e } function set_innerhtml_from_element_class(t, e) { var a = document.getElementsByClassName(t); null == a ? console.log("Failed to locate element with classname = " + element_id) : a.innerHTML = e } function set_attribute_from_element_id(t, e, a) { var r = document.getElementById(t); null == r ? console.log("Failed to locate element with id = " + t) : r.setAttribute(e, a) } function create_overlayform() { var t = document.createElement("div"); return t.setAttribute("class", "overlayform"), t.setAttribute("id", "overlayform"), t } function create_box() { var t = document.createElement("div"); return t.setAttribute("class", "box"), t } function create_headline(t) { var e = document.createElement("h1"); return e.innerHTML = t, e } function create_text(t) { var e = document.createElement("p"); return e.innerHTML = t, e } function create_form(t) { var e = document.createElement("form"); for (var a in e.setAttribute("method", "post"), e.setAttribute("action", "/"), t) e.setAttribute(a, t[a]); return e } function create_field(t, e, a) { var r = document.createElement(e); for (var n in r.setAttribute("name", t), r.setAttribute("id", t), a) r.setAttribute(n, a[n]); return r } function create_fieldholder(t, e, a) { var r = document.createElement("div"); r.setAttribute("class", "fieldholder"), r.setAttribute("data-error", "false"), r.setAttribute("data-fieldname", t), r.setAttribute("id", "fieldholder_" + t); var n = document.createElement("label"); n.setAttribute("for", t), n.innerHTML = e, r.appendChild(n), r.appendChild(a); var i = document.createElement("p"); return i.setAttribute("id", "error_" + t), i.setAttribute("class", "fielderror"), i.innerHTML = "", r.appendChild(i), r } function create_fieldholder_input(t, e, a) { return create_fieldholder(t, e, create_field(t, "input", a)) } function create_buttonholder() { var t = document.createElement("div"); return t.setAttribute("class", "buttonholder"), t } function create_submit_button() { var t = document.createElement("input"); return t.setAttribute("type", "submit"), t.setAttribute("name", "submit"), t.setAttribute("id", "submit"), t.setAttribute("value", mir_translate("OK")), t } function create_cancel_button() { var t = document.createElement("input"); return t.setAttribute("type", "button"), t.setAttribute("name", "cancel"), t.setAttribute("id", "cancel"), t.setAttribute("value", mir_translate("Cancel")), t.onclick = function () { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"), remove_overlayform() }, t } function remove_overlayform() { document.getElementById("overlayform").parentNode.removeChild(parent.document.getElementById("overlayform")) } function create_simple_dialog(t, e, a, r, n) { var i = create_overlayform(); document.getElementsByTagName("body")[0].appendChild(i); var o = create_box(); i.appendChild(o), o.appendChild(create_headline(t)), o.appendChild(create_text(e)); var s = create_form(n); o.appendChild(s); var d = document.createElement("p"); d.setAttribute("id", "error"), d.setAttribute("class", "error"), d.innerHTML = "", s.appendChild(d); for (var l = 0; l < a.length; ++l)s.appendChild(a[l]); var u = create_buttonholder(); s.appendChild(u); for (l = 0; l < r.length; ++l)u.appendChild(r[l]); return document.getElementById(a[0].getAttribute("data-fieldname")).focus(), s } function create_submit_cancel_dialog(t, e, a, r) { var n = []; return n.push(create_submit_button()), n.push(create_cancel_button()), create_simple_dialog(t, e, a, n, r) } function handle_api_errors(t) { if (void 0 === t.results.field_errors) void 0 === t.results.error_human ? launch_error(mir_translate("Unknown error")) : launch_error(mir_translate(t.results.error_human)); else for (var e in t.results.field_errors) document.getElementById("fieldholder_" + e).setAttribute("data-error", "true"), document.getElementById("error_" + e).innerHTML = mir_translate(t.results.field_errors[e].error_human) } function hookmanualview_state_init(t) { var e = new ROSLIB.Topic({ ros: ros, name: "/hook/data", messageType: "mir_hook_shared_interface/HookData" }), a = { GRIPPER: { 0: "Unknown", 1: "Homing", 2: "Open", 3: "Opening", 4: "Closed", 6: "Closing", 9: "Error" }, BRAKE: { 0: "Unknown", 1: "Initializing", 2: "Homing", 3: "Active", 4: "Inactive", 5: "Activating", 6: "Deactivating", 7: "Error" }, HEIGHT: { 0: "Unknown", 1: "Homing", 2: "Idle", 3: "Changing", 4: "Error" } }; e.subscribe((function (e) { document.getElementById(t + "_state_status_value").innerHTML = a.GRIPPER[e.gripper_state], document.getElementById(t + "_state_height_value").innerHTML = e.height.toFixed(2).toString() + " mm"; var r = 180 * e.angle.angle / Math.PI; document.getElementById(t + "_state_angle_value").innerHTML = r.toFixed(2).toString() + " degrees", document.getElementById(t + "_state_brake_status_value").innerHTML = a.BRAKE[e.brake_state] })) } function hookmanualview_livemarker_update(t, e, a, r, n) { document.getElementById(t + "_livemarker_name_value").innerHTML = e, document.getElementById(t + "_livemarker_x_value").innerHTML = a, document.getElementById(t + "_livemarker_y_value").innerHTML = r, document.getElementById(t + "_livemarker_z_value").innerHTML = n } function hookmanualview_livemarker_init(t) { var e = new ROSLIB.Topic({ ros: ros, name: "/hook/qr_markers", messageType: "geometry_msgs/TransformStamped" }), a = Date.now(); setInterval((function () { Date.now() - a > 999 && hookmanualview_livemarker_update(t, "", "", "", "") }), 1e3), e.subscribe((function (e) { a = Date.now(), hookmanualview_livemarker_update(t, e.child_frame_id, e.transform.translation.x.toFixed(2).toString(), e.transform.translation.y.toFixed(2).toString(), e.transform.translation.z.toFixed(2).toString()) })) } function emptyCallback(t) { console.log(t) } function send_hook_height_command(t, e, a) { var r = new ROSLIB.Service({ ros: ros, name: "/hook/height/cmd/start", serviceType: "mir_hook_shared_interface/ActionGoalHookHeight" }), n = new ROSLIB.ServiceRequest({ height_mm: t, home: e }); r.callService(n, (function (t) { a(t) })) } function send_hook_brake_command(t, e) { var a = new ROSLIB.Service({ ros: ros, name: "/hook/brake/cmd/start", serviceType: "mir_hook_shared_interface/ActionGoalHookBrake" }), r = 1; t && (r = 0); var n = new ROSLIB.ServiceRequest({ brake_cmd: r }); a.callService(n, (function (t) { e(t) })) } function send_hook_gripper_command(t, e) { var a = new ROSLIB.Service({ ros: ros, name: "/hook/gripper/cmd/start", serviceType: "mir_hook_shared_interface/ActionGoalHookGripper" }), r = 1; t && (r = 0); var n = new ROSLIB.ServiceRequest({ gripper_cmd: r }); a.callService(n, (function (t) { e(t) })) } function hookmanualview_change_height(t) { var e = document.createElement("div"); $(e).addClass("request-control-box "); var a = document.createElement("button"); $(a).addClass("set-to-manual mir-btn mir-light"), a.addEventListener("click", (function () { robot_toggle_manual(11, !0, !0) })), a.innerHTML = mir_translate("joystick_manual_control"); var r = document.createElement("p"); r.innerHTML = mir_translate("hook_status_press_button"); var n = create_cancel_button(); $(n).addClass("cancel-request-control mir-btn mir-light"), "11" != $("body").attr("data-state-id") && (e.appendChild(r), e.appendChild(a), e.appendChild(n)), $("#hookcartfieldpicker_overlay").hide(), $("body").attr("data-mobile-dialogue", "true"); var i = []; i.push(create_fieldholder_input("target_height", lang_hookmanual_setheight_heightabovefloor, { type: "text", autocomplete: "off" })); var o = create_submit_cancel_dialog("Set hook height", lang_hookmanual_setheight_text, i, { autocomplete: "off" }); $(o).closest(".box").addClass("set-height-dialog").append(e), o.onsubmit = function () { var t = document.getElementById("target_height"); return send_hook_height_command(parseFloat(t.value), !1, emptyCallback), $("body").attr("data-mobile-dialogue", "false"), $("#hookcartfieldpicker_overlay").show(), remove_overlayform(), !1 } } function robot_change_state(t) { $.get("/", { mode: "set-robot-state", state: t }) } function fleet_robot_change_state(t, e) { $.get("/", { mode: "set-fleet-robot-state", ip: t, state: e }) } function toggle_joystick(t) { var e = $("body"), a = "data-show-joystick"; if (void 0 === t) { var r = e.attr("data-show-joystick"); e.attr(a, "true" == r ? "false" : "true") } else e.attr(a, t) } function robot_toggle_manual(t, e, a) { var r = new ROSLIB.Service({ ros: ros, name: "/mirsupervisor/setRobotState", serviceType: "mirSupervisor/SetState" }), n = new ROSLIB.Service({ ros: ros, name: "/mirsupervisor/refresh_joystick", serviceType: "mirSupervisor/refreshJoystickToken" }), i = { robotState: "integer" == typeof t ? t : 4 }; 11 == robot_state_id && 11 != t || (i.robotState = 11, i.web_session_id = MIR.joystick.session_user), r.callService(new ROSLIB.ServiceRequest(i), (function (t) { var r = 0; if (window.onhashchange = function () { i && (clearInterval(i), window.removeEventListener("hashchange")) }, !e || i || a) { if (a && !i) i = setInterval((function () { n.callService(new ROSLIB.ServiceRequest({ token: t.joystick_token })) }), 9e3) } else var i = setInterval((function () { r += 1, n.callService(new ROSLIB.ServiceRequest({ token: t.joystick_token })), 6 != r || clearInterval(i) }), 9e3); t.joystick_token && "" != t.joystick_token && MIR.joystick.claim(t.joystick_token) })) } function toggleReducedSpeed(t) { var e = new ROSLIB.Service({ ros: ros, name: "/mirsupervisor/joystick_mode", serviceType: "mir_srvs/JoysticksMode" }), a = { command: t ? MIR.constants.JOYSTICK.ENABLE_LOW_SPEED_MODE : MIR.constants.JOYSTICK.ENABLE_HIGH_SPEED_MODE }; e.callService(new ROSLIB.ServiceRequest(a)) } function confirmToggleSpeed(t) { var e = "on" === $(t).attr("data-state"); if (e) var a = { title: mir_translate("operating_mode_1_confirm_title_off"), body: mir_translate("operating_mode_1_confirm_text_off") }; else a = { title: mir_translate("operating_mode_1_confirm_title"), body: mir_translate("operating_mode_1_confirm_text") }; $("body").addClass("joystick-toggle-disable"), MIR.ui.confirm(a).then((function () { toggleReducedSpeed(!e) })).catch((function () { })).finally((function () { setTimeout((function () { $("body").removeClass("joystick-toggle-disable") }), 400) })) } function topbar_desktop_tabs_toggle(t, e) { e.stopPropagation(); var a = t.getAttribute("data-active"), r = $(e.target); if (r.is(".mir-switch")) confirmToggleSpeed(r); else if (!t.classList.contains("fleet_status") || "false" != t.getAttribute("data-error")) return $("div.topbar_desktop > ul.tabs > li").not(".state_continue").not(".state_stop").attr("data-active", "false"), "joystick" == t.getAttribute("class") ? ($(e.target).is(".button") && toggle_joystick(), !0) : (toggle_joystick(!1), "true" == a ? (t.setAttribute("data-active", "false"), "status" == t.getAttribute("class") && toplog_kill()) : ("status" == t.getAttribute("class") && toplog_start(), t.setAttribute("data-active", "true"), "status" == t.getAttribute("class") && errorlog_init(robot_errors)), !0) } function mobile_joystick_toggle(t, e) { return $(e.target).is(".button") && toggle_joystick(), !1 } function fleet_status_init() { new ROSLIB.Topic({ ros: ros, name: "/diagnostics/out/robot_messages", messageType: "fleet_diagnostics/DiagnosticsArray", latch: !0 }).subscribe((function (t) { var e = document.getElementById("topbar_fleet_status"); e.setAttribute("data-active", "false"); var a = document.getElementById("topbar_fleet_status_mobile"), r = $("#topbar_fleet_status > div.button > span"), n = $("#topbar_fleet_status > div.topbar_desktop_tab_foldout"), i = $(".mobilestatus"); if (t.status.length > 0) { if (n.html(""), i.html(""), $.each(t.status, (function (t, e) { if (2 == e.type) if (document.getElementById(e.device_name[0])) { var a = document.createElement("div"); a.classList.add("line2"), a.innerHTML = mir_translate(e.message), document.getElementById(e.device_name[0]).append(a) } else { var r = document.createElement("div"); r.classList.add("message"), r.id = e.device_name[0]; var o = document.createElement("div"); o.classList.add("line1"); var s = document.createElement("div"); s.innerHTML = e.device_name[0]; var d = document.createElement("div"); d.classList.add("button"), d.classList.add("gotorobot"), o.append(s), o.append(d); var l = document.createElement("div"); l.classList.add("line2"), l.innerHTML = mir_translate(e.message), r.append(o), r.append(l), n.append(r), i.append($(r).clone()), d.onclick = function () { window.open(window.location.protocol + "//" + e.device_ip[0]) } } })), n.children().length > 0) { e.setAttribute("data-error", "true"), a.setAttribute("data-error", "true"), r.children("strong.noerror").hide(), r.children("strong.error").show(); var o = document.createElement("div"); o.classList.add("see_all"); var s = document.createElement("a"); if (s.setAttribute("href", "/setup/robots?filter-errors"), s.innerHTML = mir_translate("See all"), o.append(s), n.prepend(o), i.prepend($(o).clone()), $(e).children(".count").length > 0) $(e).children(".count").html(i.children().length - 1), $(a).find(".button > .count").html(i.children().length - 1); else { var d = document.createElement("div"); d.classList.add("count"), d.innerHTML = n.children().length - 1, e.prepend(d); var l = document.createElement("div"); l.classList.add("count"), l.innerHTML = i.children().length - 1, $(a).children(".button").prepend(l) } } } else e.setAttribute("data-error", "false"), a.setAttribute("data-error", "false"), r.children("strong.noerror").show(), r.children("strong.error").hide(), $(e).children("div.count").remove(), $(a).find(".button > .count").remove(), i.html('<div class="statusmessage"><p class="noerror">' + mir_translate("ALL OK") + "</p></div>") })) } function fleet_package_managers_status() { new ROSLIB.Topic({ ros: ros, name: "/node_init" }).subscribe((function (t) { if (!t.init_suc) { var e = $("#fleet_restart_error_msg"); e.addClass("active"); var a = $("#fleet_restart_error_msg_mobile"); if (a.addClass("active"), document.getElementsByTagName("body")[0].setAttribute("data-fleet-error", "true"), 0 == e.html().length) { var r = "<span class='error_packages'>" + t.package_name + " </span><span class='error_msg'>" + mir_translate("fleet_restart_failed_topbarmsg") + " </span><a href='/system/settings/fleet_advanced_settings' class='mir-button blue'>" + mir_translate("fleet_advanced_settings_restart_software_button") + "</a>", n = "<span class='error_notice'>" + mir_translate("Error") + ": </span>" + r; e.html(n), a.html(r) } else e.children(".error_packages").html(mir_translate("fleet_restart_multiple_packages_failed")), a.children(".error_packages").html(mir_translate("fleet_restart_multiple_packages_failed")) } })) } function errorlog_init(t) { var e = $("div.topbar_desktop > ul.tabs > li.status > div.topbar_desktop_tab_foldout > div.errors"), a = $("div.mobilestatus > div.errors"); $(e).html(""), $(a).html(""); var r = t.length; r > 3 && (r = 3); for (var n = 0; n < r;) { (o = document.createElement("div")).setAttribute("class", "error"), $(e).append(o), (s = document.createElement("table")).setAttribute("cellpadding", "0"), s.setAttribute("cellspacing", "0"), o.appendChild(s); var i = document.createElement("tr"); s.appendChild(i), (d = document.createElement("td")).innerHTML = "<div>Code:</div>", i.appendChild(d), (d = document.createElement("td")).innerHTML = "<div>" + t[n].code + "</div>", i.appendChild(d); var o, s; i = document.createElement("tr"); s.appendChild(i), (d = document.createElement("td")).innerHTML = "<div>Module:</div>", i.appendChild(d), (d = document.createElement("td")).innerHTML = "<div>" + t[n].module + "</div>", i.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate_from_rosbridge(t[n].description), o.appendChild(l), (o = document.createElement("div")).setAttribute("class", "error"), $(a).append(o), (s = document.createElement("table")).setAttribute("cellpadding", "0"), s.setAttribute("cellspacing", "0"), o.appendChild(s); i = document.createElement("tr"); s.appendChild(i), (d = document.createElement("td")).innerHTML = "<div>Code:</div>", i.appendChild(d), (d = document.createElement("td")).innerHTML = "<div>" + t[n].code + "</div>", i.appendChild(d); var d, l; i = document.createElement("tr"); s.appendChild(i), (d = document.createElement("td")).innerHTML = "<div>Module:</div>", i.appendChild(d), (d = document.createElement("td")).innerHTML = "<div>" + t[n].module + "</div>", i.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate_from_rosbridge(t[n].description), o.appendChild(l), n++ } } window.mode_callbacks = {}, window.mode_callbacks[3] = [], window.mode_callbacks[7] = [], window.mode_callbacks[255] = [], ros = new ROSLIB.Ros, ros.on("connection", (function () { document.getElementsByTagName("body")[0].setAttribute("data-connection", "true"), robot_regular_info_listen() })), ros.on("error", (function (t) { document.getElementsByTagName("body")[0].setAttribute("data-connection", "false"), ros_reconnect() })), ros.on("close", (function () { document.getElementsByTagName("body")[0].setAttribute("data-connection", "false"), ros_reconnect() })), Array.prototype.findIndex || Object.defineProperty(Array.prototype, "findIndex", { value: function (t) { if (null == this) throw new TypeError('"this" is null or not defined'); var e = Object(this), a = e.length >>> 0; if ("function" != typeof t) throw new TypeError("predicate must be a function"); for (var r = arguments[1], n = 0; n < a;) { var i = e[n]; if (t.call(r, i, n, e)) return n; n++ } return -1 } }), joystick_interrupt = MIR.util.throttle((function () { joystick_stop(), $(".joystick .stick").trigger("mouseup").trigger("dragstop"), document.getElementsByTagName("body")[0].setAttribute("data-show-joystick", "false") }), 100), $(document).ready((function () { $(document).on("visibilitychange", (function () { "hidden" === document.visibilityState && joystick_interrupt() })), $(window).on("touchcancel orientationchange blur", (function () { joystick_interrupt() })), Vue.prototype._ = mir_translate, MIR.runtime.map_finalization_data = { procent: 0, done: 0, total: 0 }, new Vue({ el: "#map-status-topbar-desktop", data: MIR.runtime.map_finalization_data }), new Vue({ el: "#map-status-topbar-mobile", data: MIR.runtime.map_finalization_data }), "fleet" == systemtype && (fleet_status_init(), fleet_package_managers_status()); var t = new ROSLIB.Topic({ ros: ros, name: "/final_optimization_progress", messageType: "std_msgs/Float64MultiArray", latch: !0 }), e = !1, a = !1; t.subscribe((function (t) { if (MIR.runtime.map_finalization_data.procent = t.data[0], MIR.runtime.map_finalization_data.done = t.data[1], MIR.runtime.map_finalization_data.total = t.data[2], t.data[0] > 0 && t.data[0] < 100 && !1 === a && (a = setTimeout((function () { MIR.runtime.map_finalization_data.procent < 20 && (e = MIR.ui.prompt({ headline: "Optimizing map", message: "The new map is being optimized, when finished, you'll be able to edit it.... This might take a while.  Check toolbar for status.", add_cancel: { label: mir_translate("Ok"), on_click: function (t) { t.mir.$overlay.remove() } } })) }), 1e3)), 100 === t.data[0] && t.data[1] === t.data[2]) { e && e.mir.$overlay.remove(); var r = MIR.ui.prompt({ headline: mir_translate("Map optimization complete!"), message: mir_translate("The map will be saved now."), add_cancel: !1, buttons: [new MIR.ui.button({ label: mir_translate("Ok"), attr: { class: "mir-green" }, events: { click: function () { r.mir.$overlay.remove(), $waiter = (new MIR.ui.waiter).append("body"), $.get("/?mode=get-runtime-settings", {}, (function (t) { var e = "true" === t.mapping_append, a = {}; a.id = t.mapping_guid, a.resscale = t.mapping_scale, a.origin_x = t.mapping_origin_x, a.origin_y = t.mapping_origin_y, a.mapping_origin_x = t.mapping_origin_x, a.mapping_origin_y = t.mapping_origin_y, a.append = e, a.append_robot_x = t.mapping_robot_start_x, a.append_robot_y = t.mapping_robot_start_y, a.append_robot_orientation = t.mapping_robot_start_orientation, a.append_mapping_robot_x = t.mapping_robot_end_x, a.append_mapping_robot_y = t.mapping_robot_end_y, a.append_mapping_robot_orientation = t.mapping_robot_end_orientation, a.cartographer = !0, $.ajax({ url: "/?mode=map-save-mapping", data: a, method: "POST", dataType: "json", guid: t.mapping_guid, success: function (a) { runtime_settings = {}, runtime_settings.mapping_state = e ? MIR.constants.MAP.state.APPENDING : MIR.constants.MAP.state.ROTATING, $.post("/?mode=set-runtime-settings", runtime_settings, (function (a) { new ROSLIB.Service({ ros: ros, name: "/mircontrol/setMode", serviceType: "mirControl/SetMode" }).callService(new ROSLIB.ServiceRequest({ robotMode: MIR.constants.ROBOT_MODE.MISSION }), (function (a) { $(".mapcontainer").each((function () { var a = $(this).attr("data-element-id"); map_finalizing_stop(a), e ? map_init(a, t.mapping_guid, !1, !1, !0, !1) : map_init(a, t.mapping_guid, !0, !1, !1, !1) })) })) })) } }) })) } } })] }) } })), Vue.component("session-importer-info", MIR.components.session_importer_info), new Vue({ el: "#session-importer-desktop" }), new Vue({ el: "#session-importer-mobile" }), MIR.ros.nodes.session_importer.subscribe_info((function (t) { MIR.components.shared_data.session_importer = MIR.util.mergeObject(MIR.components.shared_data.session_importer, t) })), $(window).on("keydown", (function (t) { t.keyCode == MIR.ui.constants.KEY_SPACE && t.target == document.body && t.preventDefault() })), ros.connect(MIR.ros.socket_url); var r = !1; ("standalone" in window.navigator && window.navigator.standalone || window.matchMedia("(display-mode: standalone)").matches || (navigator.standalone = navigator.standalone || screen.height - document.documentElement.clientHeight < 40)) && (r = !0), 1 == r ? document.getElementsByTagName("body")[0].setAttribute("data-webapp", "true") : document.getElementsByTagName("body")[0].setAttribute("data-webapp", "false"), $(window).width() < MIR.constants.MOBILE_RES_THRESHOLD ? document.getElementsByTagName("body")[0].setAttribute("data-mobile", "true") : document.getElementsByTagName("body")[0].setAttribute("data-mobile", "false"); var n = navigator.userAgent.toLowerCase().indexOf("android") > -1, i = !!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform); if (1 == i ? document.getElementsByTagName("body")[0].setAttribute("data-os", "ios") : 1 == n ? document.getElementsByTagName("body")[0].setAttribute("data-os", "android") : document.getElementsByTagName("body")[0].setAttribute("data-os", "other"), "undefined" != typeof menusection && set_active_menusection(menusection, !0), 1 == r && 1 == i && $("a").click((function (t) { t.preventDefault(), window.location = $(this).attr("href") })), "ontouchstart" in window) var o = "true"; else o = "false"; document.getElementsByTagName("body")[0].setAttribute("data-touch-support", o) })), $(window).scroll((function (t) { $(window).scrollTop() > 0 ? document.getElementsByTagName("body")[0].setAttribute("data-fixed-top", "true") : "true" == document.getElementsByTagName("body")[0].getAttribute("data-fixed-top") && document.getElementsByTagName("body")[0].setAttribute("data-fixed-top", "false"), $("table.datatable > tr.loading").each((function () { var t = this.parentNode; 1 == element_in_viewport(this) && "false" == t.getAttribute("data-in-progress") && markup_api_datatable_set_page("next", t.getAttribute("data-ident"), !0) })) })), $(window).resize((function () { map_toolbars_place() })), $(document).on("click", "#mobilemenutrigger", (function (t) { if (t.stopPropagation(), t.preventDefault(), !0 === t.handled) return !1; mobilemenu_toggle(), t.handled = !0 })), $("html").click((function () { if ("false" == document.getElementsByTagName("body")[0].getAttribute("data-mobile-status")) { if ($("div.topbar_desktop > ul.tabs > li").not(".state_continue").not(".state_stop").attr("data-active", "false"), toplog_kill(), $("body").hasClass("joystick-toggle-disable")) return; $("body").is("[data-mobile='false']") && toggle_joystick(!1) } })), $(document).on("click", 'div.mobilemenu > ul > li > div[data-collapsable-mobilemenuitem="true"]', (function (t) { if (t.stopPropagation(), t.preventDefault(), !0 === t.handled) return !1; "true" == this.parentNode.getAttribute("data-open") ? this.parentNode.setAttribute("data-open", "false") : this.parentNode.setAttribute("data-open", "true"), t.handled = !0 })); var percentColors = [{ pct: 0, color: { r: 255, g: 0, b: 0 } }, { pct: .5, color: { r: 255, g: 255, b: 0 } }, { pct: 1, color: { r: 0, g: 255, b: 0 } }], getColorForPercentage = function (t) { for (var e = 1; e < percentColors.length - 1 && !(t < percentColors[e].pct); e++); var a = percentColors[e - 1], r = percentColors[e], n = r.pct - a.pct, i = (t - a.pct) / n, o = 1 - i, s = i, d = { r: Math.floor(a.color.r * o + r.color.r * s), g: Math.floor(a.color.g * o + r.color.g * s), b: Math.floor(a.color.b * o + r.color.b * s) }; return "rgb(" + [d.r, d.g, d.b].join(",") + ")" }; function clear_errors(t) { new ROSLIB.Service({ ros: ros, name: "/mirsupervisor/requestErrorReset", serviceType: "std_srv/Empty" }).callService(new ROSLIB.ServiceRequest({}), (function () { })), document.getElementsByTagName("body")[0].setAttribute("data-mobile-status", "false") } function mobile_status_toggle(t) { return t.stopPropagation(), "true" == document.getElementsByTagName("body")[0].getAttribute("data-mobile-status") ? (document.getElementsByTagName("body")[0].setAttribute("data-mobile-status", "false"), toplog_kill()) : (toplog_start(), document.getElementsByTagName("body")[0].setAttribute("data-menu-mobile", "false"), document.getElementsByTagName("body")[0].setAttribute("data-mobile-status", "true")), !0 } function launch_waiter(t) { var e = document.createElement("div"); e.setAttribute("class", "overlay_progress"), e.setAttribute("id", "waiter"), document.getElementsByTagName("body")[0].appendChild(e); var a = document.createElement("div"); a.setAttribute("class", "box"), e.appendChild(a); var r = document.createElement("h1"); r.innerHTML = "Please wait...", a.appendChild(r); var n = document.createElement("p"); return n.innerHTML = decodeEntities(t), a.appendChild(n), !0 } function close_waiter() { return document.getElementById("waiter") && document.getElementById("waiter").parentNode.removeChild(document.getElementById("waiter")), !0 } function launch_error(msg, dowhendone) { if (!$(".overlay_error").length) { var overlay = document.createElement("div"); overlay.setAttribute("class", "overlay_error"), overlay.setAttribute("id", "error"), document.getElementsByTagName("body")[0].appendChild(overlay); var box = document.createElement("div"); box.setAttribute("class", "box"), overlay.appendChild(box); var headline = document.createElement("h1"); headline.innerHTML = "Error(s) occured!", box.appendChild(headline); var text = document.createElement("p"); text.innerHTML = null == msg ? "One or more errors occured in your request." : decodeEntities(msg), box.appendChild(text); var buttonholder = document.createElement("div"); buttonholder.setAttribute("class", "buttonholder"), box.appendChild(buttonholder); var submitbtn = document.createElement("div"); submitbtn.setAttribute("class", "ok"), submitbtn.setAttribute("id", "submitbtn"), submitbtn.innerHTML = "OK", buttonholder.appendChild(submitbtn), submitbtn.onclick = function () { $(overlay).remove(), null == dowhendone || (-1 !== dowhendone.indexOf("(") ? eval(dowhendone) : location.href = dowhendone) } } } function uploadbutton_trigger(t) { $("#" + t).trigger("click") } function launch_message(t, e, a) { var r = document.createElement("div"); r.setAttribute("class", "overlay_message"), r.setAttribute("id", "message"), document.getElementsByTagName("body")[0].appendChild(r); var n = document.createElement("div"); n.setAttribute("class", "box"), r.appendChild(n); var i = document.createElement("h1"); i.innerHTML = t, n.appendChild(i); var o = document.createElement("p"); null == e ? o.innerHTML = "" : (e = decodeEntities(e), o.innerHTML = e), n.appendChild(o); var s = document.createElement("div"); s.setAttribute("class", "buttonholder"), n.appendChild(s); var d = document.createElement("div"); d.setAttribute("class", "ok"), d.setAttribute("id", "submitbtn"), d.innerHTML = "OK", s.appendChild(d), d.onclick = function () { document.getElementById("message").parentNode.removeChild(parent.document.getElementById("message")), null == a || (location.href = a) } } function launch_confirm(headlinemsg, msg, dowhendone, okbutton, cancelbutton) { var overlay = document.createElement("div"); overlay.setAttribute("class", "overlay_confirm"), overlay.setAttribute("id", "message"), document.getElementsByTagName("body")[0].appendChild(overlay); var box = document.createElement("div"); box.setAttribute("class", "box"), overlay.appendChild(box); var headline = document.createElement("h1"); headline.innerHTML = headlinemsg, box.appendChild(headline); var text = document.createElement("p"); text.innerHTML = null == msg ? "" : decodeHtml(msg), box.appendChild(text); var buttonholder = document.createElement("div"); buttonholder.setAttribute("class", "buttonholder"), box.appendChild(buttonholder); var submitbtn = document.createElement("div"); submitbtn.setAttribute("class", "delete"), submitbtn.setAttribute("id", "submitbtn"), submitbtn.innerHTML = okbutton || "Delete", buttonholder.appendChild(submitbtn); var cancelbtn = document.createElement("div"); cancelbtn.setAttribute("class", "cancel"), cancelbtn.setAttribute("id", "cancelbtn"), cancelbtn.innerHTML = cancelbutton || "Cancel", buttonholder.appendChild(cancelbtn), submitbtn.onclick = function () { document.getElementById("message").parentNode.removeChild(parent.document.getElementById("message")), null == dowhendone || (-1 !== dowhendone.indexOf("(") ? eval(dowhendone) : location.href = dowhendone) }, cancelbtn.onclick = function () { document.getElementById("message").parentNode.removeChild(parent.document.getElementById("message")) } } function launch_dialogue(headlinemsg, msg, do_when_yes, do_when_no, okbutton, cancelbutton) { var overlay = document.createElement("div"); overlay.setAttribute("class", "overlay_dialogue"), overlay.setAttribute("id", "message"), document.getElementsByTagName("body")[0].appendChild(overlay); var box = document.createElement("div"); box.setAttribute("class", "box"), overlay.appendChild(box); var headline = document.createElement("h1"); headline.innerHTML = headlinemsg, box.appendChild(headline); var text = document.createElement("p"); text.innerHTML = null == msg ? "" : decodeHtml(msg), box.appendChild(text); var buttonholder = document.createElement("div"); buttonholder.setAttribute("class", "buttonholder"), box.appendChild(buttonholder); var submitbtn = document.createElement("div"); submitbtn.setAttribute("class", "ok"), submitbtn.setAttribute("id", "submitbtn"), submitbtn.innerHTML = okbutton || "OK", buttonholder.appendChild(submitbtn); var cancelbtn = document.createElement("div"); cancelbtn.setAttribute("class", "cancel"), cancelbtn.setAttribute("id", "cancelbtn"), cancelbtn.innerHTML = cancelbutton || "Cancel", buttonholder.appendChild(cancelbtn), submitbtn.onclick = function () { document.getElementById("message").parentNode.removeChild(parent.document.getElementById("message")), null == do_when_yes || (-1 !== do_when_yes.indexOf("(") ? eval(do_when_yes) : location.href = do_when_yes) }, cancelbtn.onclick = function () { document.getElementById("message").parentNode.removeChild(parent.document.getElementById("message")), null == do_when_no || (-1 !== do_when_no.indexOf("(") ? eval(do_when_no) : location.href = do_when_no) } } function check_feature(t) { if (t && features) return t in features && features[t] } function start_process(t) { var e = new ROSLIB.Service({ ros: ros, name: "/mirspawn/list_loaded", serviceType: "mirSpawn/ListLoaded" }), a = new ROSLIB.ServiceRequest({}); e.callService(a, (function (e) { for (var a = !1, r = 0; r < e.nodes.length; ++r)if (e.nodes[r] == t) { a = !0; break } if (!a) { var n = new ROSLIB.Service({ ros: ros, name: "/mirspawn/start", serviceType: "mirSpawn/NodeAction" }), i = new ROSLIB.ServiceRequest({ launch_file_name: {} }); i.launch_file_name = t, n.callService(i, (function (t) { })) } })) } function send_mail(t, e, a, r) { var n = new ROSLIB.Service({ ros: ros, name: "/mir_mailer/send_mail", serviceType: "mirMailer/sendMail" }), i = new ROSLIB.ServiceRequest({ recipients: [t], subject: e, message: a }); n.callService(i, (function (t) { r(t) })) } function send_light_command(t) { var e = new ROSLIB.Topic({ ros: ros, name: "/light_cmd", messageType: "std_msgs/String" }), a = new ROSLIB.Message({ data: {} }); a.data = t, e.publish(a) } function activate_map(t, e) { launch_waiter("The robot is changing map."); var a = {}; a.id = t, $.ajax({ url: "/setup/maps?mode=set-active-map", data: a, method: "POST", dataType: "json", success: function (t) { if (200 == t.headers.httpcode) var a = window.setInterval((function () { 255 == robot_mode_id || ($("div.mapcontainer").each((function () { map_init(this.getAttribute("data-element-id"), this.getAttribute("data-map-guid")) })), window.clearInterval(a), e && $(e).remove(), close_waiter()) }), 1e3); else close_waiter(), launch_error(mir_translate(t.results.error_human)); map_toolbars_place() } }) } function launch_item_permissions(t, e) { launch_waiter(lang_main_loading_permissions); var a = {}; a.endpoint = t, a.guid = e, $.ajax({ url: "/?mode=get-editable-usergroups", data: a, method: "POST", dataType: "json", success: function (a) { if (close_waiter(), 0 == a) launch_error(lang_main_not_permitted_to_set_permissions_for_any_usergroups); else { var r = document.createElement("div"); r.setAttribute("class", "overlay_item_permissions"), r.setAttribute("id", "overlay_item_permissions"), document.getElementsByTagName("body")[0].appendChild(r); var n = document.createElement("div"); n.setAttribute("class", "box"), r.appendChild(n); var i = document.createElement("h1"); i.innerHTML = lang_main_set_permissions_for_element, n.appendChild(i); var o = document.createElement("p"); o.innerHTML = lang_main_set_permissions_for_element_txt, n.appendChild(o); var s = document.createElement("div"); s.setAttribute("class", "permholder"), n.appendChild(s); var d = document.createElement("table"); d.setAttribute("cellpadding", "0"), d.setAttribute("cellspacing", "0"), s.appendChild(d); var l = document.createElement("tr"); d.appendChild(l); for (var u = 0; u < a.length;) { l = document.createElement("tr"); d.appendChild(l), (c = document.createElement("td")).innerHTML = "<div>" + a[u].name + "</div>\n", l.appendChild(c); var c = document.createElement("td"); l.appendChild(c); var m = document.createElement("div"); m.setAttribute("data-guid", a[u].guid), m.setAttribute("data-permission", "update"), m.setAttribute("data-permission-guid", a[u].perm_guid), m.setAttribute("data-endpoint", t), m.setAttribute("data-item", e), m.setAttribute("data-state", a[u].status_update), m.innerHTML = "<span>&#10004;</span>", c.appendChild(m), m.onclick = function () { var t = this.getAttribute("data-state"); if ("true" == t || "false" == t) { this.setAttribute("data-state", "pending"); var e = {}; e.endpoint = this.getAttribute("data-endpoint"), e.item = this.getAttribute("data-item"), e.guid = this.getAttribute("data-guid"), e.perm_guid = this.getAttribute("data-permission-guid"), e.type = "UPDATE", e.action = "true" == t ? "DELETE" : "SET", $.ajax({ url: "/?mode=set-item-permission", data: e, method: "POST", dataType: "json", cfield: this, origstate: t, success: function (t) { 201 == t.headers.httpcode ? (this.cfield.setAttribute("data-permission-guid", t.results.guid), this.cfield.setAttribute("data-state", "true")) : 204 == t.headers.httpcode ? (this.cfield.setAttribute("data-permission-guid", ""), this.cfield.setAttribute("data-state", "false")) : (launch_error(mir_translate(t.results.error_human)), this.cfield.setAttribute("data-state", this.origstate)) } }) } else launch_error(lang_main_set_permissions_for_element_notallowed) }; var p = document.createElement("span"); p.innerHTML = "Write", c.appendChild(p), u++ } var _ = document.createElement("div"); _.setAttribute("class", "buttonholder"), n.appendChild(_); var b = document.createElement("div"); b.setAttribute("class", "ok"), b.setAttribute("id", "submitbtn"), b.innerHTML = "OK", _.appendChild(b), b.onclick = function () { document.getElementById("overlay_item_permissions").parentNode.removeChild(parent.document.getElementById("overlay_item_permissions")) } } } }) } function calculate_angle_between_points(t, e, a, r) { return 180 * Math.atan2(r - e, a - t) / Math.PI } function calculate_point_rotation(t, e, a, r, n) { var i = Math.PI / 180 * n, o = Math.cos(i), s = Math.sin(i), d = {}; return d.x = o * (a - t) + s * (r - e) + t, d.y = o * (r - e) - s * (a - t) + e, d } function calculate_line_intersection(t, e, a, r, n, i, o, s) { var d, l, u, c = { x: null, y: null, online_a: !1, online_b: !1 }, m = (s - i) * (a - t) - (o - n) * (r - e); return 0 == m || (u = (a - t) * (d = e - i) - (r - e) * (l = t - n), d = ((o - n) * d - (s - i) * l) / m, l = u / m, c.x = t + d * (a - t), c.y = e + d * (r - e), d > 0 && d < 1 && (c.online_a = !0), l > 0 && l < 1 && (c.online_b = !0)), c } function fleet_trigger_userprompt() { robot_current_user_prompt_triggered = !0; var t = document.createElement("div"); t.setAttribute("class", "missionuserprompt_overlay"), t.setAttribute("id", "missionuserprompt_overlay"), document.getElementsByTagName("body")[0].appendChild(t); var e = document.createElement("div"); e.setAttribute("class", "box"), t.appendChild(e); var a = document.createElement("h1"); a.innerHTML = "Please reply...", e.appendChild(a); var r = document.createElement("p"); r.innerHTML = robot_current_user_prompt.question, e.appendChild(r); var n = document.createElement("p"); n.setAttribute("class", "timeinfo"), n.setAttribute("id", "missionuserprompt_overlay_timeinfo"), e.appendChild(n); var i = document.createElement("div"); i.setAttribute("class", "timebar"), e.appendChild(i); var o = document.createElement("div"); o.setAttribute("class", "timebar_inner"), o.setAttribute("id", "missionuserprompt_overlay_timebar_inner"), i.appendChild(o); var s = document.createElement("div"); s.setAttribute("class", "buttonholder"), e.appendChild(s); for (var d = 0; d < robot_current_user_prompt.options.length;) { var l = document.createElement("input"); l.setAttribute("type", "button"), l.setAttribute("name", "missionuserprompt_button"), l.setAttribute("data-guid", robot_current_user_prompt.guid), l.setAttribute("data-value", robot_current_user_prompt.options[d]), l.setAttribute("value", robot_current_user_prompt.options[d]), s.appendChild(l), l.onclick = function () { var t = {}; t.guid = robot_current_user_prompt.prompt_guid, t.value = this.getAttribute("data-value"), $.ajax({ url: "/?mode=fleet-prompt-reply", data: t, method: "POST", dataType: "json", success: function (t) { robot_current_user_prompt_timer && clearInterval(robot_current_user_prompt_timer), $("#missionuserprompt_overlay").remove() } }) }, d++ } var u = new Date(robot_current_user_prompt.deadline_iso8601), c = new Date, m = c.toISOString(); c = m.substring(0, m.indexOf(".")), c = new Date(c); var p = (u.getTime() - c.getTime()) / 1e3; robot_current_user_prompt_timer = setInterval((function () { var t = new Date, e = t.toISOString(); t = e.substring(0, e.indexOf(".")), t = new Date(t); var a = Math.floor((u.getTime() - t.getTime()) / 1e3), r = Math.round(a / p * 100); r > 100 && (r = 100), $("#missionuserprompt_overlay_timebar_inner").css("width", "calc(" + r + "% - 2px)"), $("#missionuserprompt_overlay_timeinfo").html(mir_translate("%(secondsLeft)s seconds left to reply...", { secondsLeft: a })) }), 1e3) } function robot_trigger_userprompt() { robot_current_user_prompt_triggered = !0; var t = document.createElement("div"); t.setAttribute("class", "missionuserprompt_overlay"), t.setAttribute("id", "missionuserprompt_overlay"), document.getElementsByTagName("body")[0].appendChild(t); var e = document.createElement("div"); e.setAttribute("class", "box"), t.appendChild(e); var a = document.createElement("h1"); a.innerHTML = "Please reply...", e.appendChild(a); var r = document.createElement("p"); r.innerHTML = robot_current_user_prompt.question, e.appendChild(r); var n = document.createElement("p"); n.setAttribute("class", "timeinfo"), n.setAttribute("id", "missionuserprompt_overlay_timeinfo"), e.appendChild(n); var i = document.createElement("div"); i.setAttribute("class", "timebar"), e.appendChild(i); var o = document.createElement("div"); o.setAttribute("class", "timebar_inner"), o.setAttribute("id", "missionuserprompt_overlay_timebar_inner"), i.appendChild(o); var s = document.createElement("div"); s.setAttribute("class", "buttonholder"), e.appendChild(s); for (var d = 0; d < robot_current_user_prompt.options.length;) { var l = document.createElement("input"); l.setAttribute("type", "button"), l.setAttribute("name", "missionuserprompt_button"), l.setAttribute("data-guid", robot_current_user_prompt.guid), l.setAttribute("data-value", robot_current_user_prompt.options[d]), l.setAttribute("value", robot_current_user_prompt.options[d]), s.appendChild(l), l.onclick = function () { var t = {}; t.guid = this.getAttribute("data-guid"), t.value = this.getAttribute("data-value"), $.ajax({ url: "/?mode=reply-userprompt", data: t, method: "POST", dataType: "json", success: function (t) { } }), robot_current_user_prompt_timer && clearInterval(robot_current_user_prompt_timer), $("#missionuserprompt_overlay").remove() }, d++ } return robot_current_user_prompt_timeout_total = parseInt(robot_current_user_prompt.timeout.secs + 1), robot_current_user_prompt_timeout_count = 0, robot_current_user_prompt_timer = setInterval((function () { robot_current_user_prompt_timeout_count < robot_current_user_prompt_timeout_total && (robot_current_user_prompt_timeout_count += .1); var t = Math.round(robot_current_user_prompt_timeout_count / robot_current_user_prompt_timeout_total * 100); t > 100 && (t = 100), $("#missionuserprompt_overlay_timebar_inner").css("width", "calc(" + t + "% - 2px)"); var e = Math.round(robot_current_user_prompt_timeout_total - robot_current_user_prompt_timeout_count); if (e > 0) var a = e + " seconds left to reply..."; else a = "Hurry up!"; $("#missionuserprompt_overlay_timeinfo").html(a) }), 100), !0 } function robot_clear_userprompt() { return robot_current_user_prompt_triggered = !1, robot_current_user_prompt_timer && clearInterval(robot_current_user_prompt_timer), $("#missionuserprompt_overlay").remove(), !0 } function capitalize(t) { return t[0].toUpperCase() + t.slice(1) } var align_heights = function () { for (var t = 0, e = 0; e < arguments.length;) { var a = $("#" + arguments[e]).height(); a > t && (t = a), e++ } for (e = 0; e < arguments.length;) { var r = t, n = String($("#" + arguments[e]).css("padding-top")); n = n.replace("px", ""), n = parseInt(n); var i = String($("#" + arguments[e]).css("padding-bottom")); i = i.replace("px", ""), r -= n, r -= i = parseInt(i), $("#" + arguments[e]).height(r), e++ } }; function mir_translate_from_rosbridge(t) { try { var e = null; if ("{" == t.charAt(0)) { var a = JSON.parse(t); t = a.message, e = a.args } mir_lang[t] && (t = mir_lang[t]), e && (t = sprintf(t, e)) } catch (t) { } return t } String.prototype.toSec = function () { if (!this) return 0; for (var t = this.split(":"), e = 0, a = 1; t.length > 0;)e += a * parseInt(t.pop(), 10), a *= 60; return e }; var decodeEntities = function () { var t = document.createElement("div"); return function (e) { return e && "string" == typeof e && (e = (e = e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim, "")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim, ""), t.innerHTML = e, e = t.textContent, t.textContent = ""), e } }(); function mir_translate() { var t = arguments[0]; if (n = arguments[1]) { if (mir_lang[t]) var e = mir_lang[t]; else e = t; for (var a = 1; a < arguments.length;) { for (var r in arguments[a]) "{" == r.charAt(0) ? (t = (i = JSON.parse(r)).message, n = i.args, e = sprintf(t, n)) : e = (e = (e = e.replace("%(" + r + ")s", arguments[a][r])).replace("%(" + r + ")d", arguments[a][r])).replace("%(" + r + ")f", arguments[a][r]); a++ } } else { var n = {}; if ("{" == t.charAt(0)) try { var i = JSON.parse(t); t = i.message, n = i.args } catch (e) { return t } if (mir_lang[t]) t = mir_lang[t]; try { e = sprintf(t, n) } catch (e) { return t } } return e } var toplog_is_query_running = !1, toplog_state = !1; function toplog_start() { !1 === toplog_state && (toplog_state = !0, toplog_refresh()) } function toplog_refresh() { if (!1 === toplog_is_query_running) { toplog_is_query_running = !0; var t = { mode: "get-top-log", max: 10 }; $.ajax({ url: "/", data: t, method: "GET", dataType: "json", success: function (t) { if (JSON.stringify(t) == toplog_cache); else { if ($("div.topbar_desktop_tab_foldout > div.allokinfo").html(""), t.status.length > 0 || t.queue.length > 0) { if (t.status.length > 0) { var e = document.createElement("p"); e.setAttribute("class", "status"), e.innerHTML = t.status, $("div.topbar_desktop_tab_foldout > div.allokinfo").append(e) } if (t.queue.length > 0) { var a = document.createElement("table"); a.setAttribute("cellpadding", "0"), a.setAttribute("cellspacing", "0"); for (var r = 0; r < t.queue.length;) { var n = document.createElement("tr"); n.setAttribute("data-state", t.queue[r].state), a.appendChild(n); var i = document.createElement("td"); "Executing" == t.queue[r].state ? i.innerHTML = '<img src="/graphics/spinner.svg" width="20" height="20" />' : i.innerHTML = '<img src="/graphics/icon_mission_green.svg" width="16" height="16" />', n.appendChild(i), (i = document.createElement("td")).innerHTML = "<div>" + t.queue[r].name + "</div>", n.appendChild(i), (i = document.createElement("td")).innerHTML = "<div>" + mir_translate(t.queue[r].state) + "</div>", n.appendChild(i), r++ } $("div.topbar_desktop_tab_foldout > div.allokinfo").append(a) } } $("div.mobilestatus > div.allokinfo").html($("div.topbar_desktop_tab_foldout > div.allokinfo").html()), toplog_is_query_running = !1, toplog_state && (toplog_timer = window.setTimeout(toplog_refresh, 1e3)) } } }) } return !0 } function toplog_kill() { return toplog_state = !1, !0 } var base64 = { characters: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (t) { base64.characters; var e = "", a = 0; do { var r = t.charCodeAt(a++), n = t.charCodeAt(a++), i = t.charCodeAt(a++), o = (r = r || 0) >> 2 & 63, s = (3 & r) << 4 | (n = n || 0) >> 4 & 15, d = (15 & n) << 2 | (i = i || 0) >> 6 & 3, l = 63 & i; n ? i || (l = 64) : d = l = 64, e += base64.characters.charAt(o) + base64.characters.charAt(s) + base64.characters.charAt(d) + base64.characters.charAt(l) } while (a < t.length); return e }, decode: function (t) { base64.characters; var e = "", a = 0; do { var r = base64.characters.indexOf(t.charAt(a++)), n = base64.characters.indexOf(t.charAt(a++)), i = base64.characters.indexOf(t.charAt(a++)), o = (63 & r) << 2 | n >> 4 & 3, s = (15 & n) << 4 | i >> 2 & 15, d = (3 & i) << 6 | 63 & base64.characters.indexOf(t.charAt(a++)); e += String.fromCharCode(o) + (s ? String.fromCharCode(s) : "") + (d ? String.fromCharCode(d) : "") } while (a < t.length); return e } }; function watchInputsForChanges(t) { setTimeout((function () { $(t).find(":input").each((function () { $(this).attr("data-val", $(this).val()) })), $(t).on("change paste keyup", ":input", (function (t) { $(this).val() !== $(this).attr("data-val") ? ($(this).attr("data-newVal", $(this).val()), $(this).attr("data-changed", 1)) : $(this).attr("data-changed", -1) })) }), 200) } function resetChanges() { $("[has-changed]").attr("has-changed", 0) } function replace_int(t, e) { return "number" == typeof e ? e.toString() : e } function hasUnsavedChanges(t, e, a, r) { if (null != e) { var n = []; if ($(".grid-stack-item").each((function () { n.push($(this).attr("data-guid")) })), JSON.stringify(e) != JSON.stringify(n)) return !0 } if (window.location.href.indexOf("missions/") > -1) { if (JSON.stringify(missions_missionview_fetch_actions("missionview", "missionview_missionview_actionlist"), replace_int) != t) return !0 } return 1 === $('[has-changed="1"]:first').length } function submitwarn_set() { } function playbar_load_name() { if (playbar_mission_id !== robot_current_mission) { playbar_mission_id = robot_current_mission; var t = { mode: "get-current-mission", calltype: "light" }; $.ajax({ url: "/", data: t, method: "GET", dataType: "json", error: function () { window.setTimeout((function () { playbar_load_name() }), 3e3) }, success: function (t) { if (t.name == $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").html()); else { if ($("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").html().length > 0) var e = 400; else e = 1; $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").fadeOut(e, (function () { $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").html(t.name), $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").fadeIn(400, (function () { playbar_start_textscroll() })) })) } window.setTimeout((function () { playbar_load_name() }), 3e3) } }) } else window.setTimeout(playbar_load_name, 3e3); return !0 } function playbar_start_textscroll() { if (playbar_stop_textscroll(), playbar_reset_textscroll(), window.clearTimeout(playbar_timer), $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").width() > $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning").width()) { var t = Math.ceil($("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning").width() - 10), e = Math.ceil($("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").width()); e -= t; var a = Math.ceil(25 * e); a < 2e3 && (a = 2e3), e = 0 - e, e = String(e) + "px", $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > div.hider_left").animate({ opacity: "1" }, 400, (function () { })), $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").animate({ left: e }, a, (function () { $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").animate({ left: "0" }, a, (function () { $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > div.hider_left").animate({ opacity: "0" }, 200, (function () { playbar_timer = window.setTimeout((function () { $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").animate({ left: "0" }, 3e3, (function () { playbar_start_textscroll() })) }), 3e3) })) })) })) } return !0 } function playbar_stop_textscroll() { return $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").stop(), $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > div.hider_left").stop(), !0 } function playbar_reset_textscroll() { return $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > p").css("left", "0"), $("div.topbar_desktop > div.playbar > div.subbar > div.currentlyrunning > div.hider_left").css("opacity", "0"), !0 } function playbar_highlight() { return "4" == document.getElementsByTagName("body")[0].getAttribute("data-state-id") && ($("div.playbar").effect("shake", { times: 4, distance: 15 }, 500), $("div.playbar > div[data-type='continue'].button,li.state_continue").animate({ "background-color": "rgba(255,255,255,0.9)" }, 150, (function () { $("div.playbar > div[data-type='continue'].button,li.state_continue").animate({ "background-color": "#002446" }, 450) }))), !0 } function generate_uuid() { var t = (new Date).getTime(); return "undefined" != typeof performance && "function" == typeof performance.now && (t += performance.now()), "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function (e) { var a = (t + 16 * Math.random()) % 16 | 0; return t = Math.floor(t / 16), ("x" === e ? a : 3 & a | 8).toString(16) })) } function topsubbar_paging() { $("#system_content").find(".topsubbar").each((function () { var t = this.getAttribute("data-element-id"), e = document.getElementById("topsubbar_" + t), a = $(e).width(), r = document.getElementById("topsubbar_" + t + "_list"), n = document.getElementById("topsubbar_" + t + "_paging"), i = document.getElementById("topsubbar_" + t + "_scroll_left"), o = document.getElementById("topsubbar_" + t + "_scroll_right"), s = $(n).width(), d = Math.floor(a - s); $(r).css("width", d + "px"); var l = 0, u = 1; $(r).children("li").each((function () { l + Math.ceil($(this).width()) < d - 20 || (l = 0, u++), l += Math.ceil($(this).width()), this.setAttribute("data-page", u) })); var c = u; (u = document.getElementById("topsubbar_" + t).getAttribute("data-current-page")) < 1 ? u = 1 : u > c && (u = c), document.getElementById("topsubbar_" + t).setAttribute("data-num-pages", c), document.getElementById("topsubbar_" + t).setAttribute("data-current-page", u), $(r).children("li").hide(), $(r).children('li[data-page="' + u + '"]').show(), i.onclick = function () { topsubbar_scroll(this.parentNode.parentNode.getAttribute("data-element-id"), "left") }, o.onclick = function () { topsubbar_scroll(this.parentNode.parentNode.getAttribute("data-element-id"), "right") } })) } function topsubbar_scroll(t, e) { var a = document.getElementById("topsubbar_" + t), r = parseInt(a.getAttribute("data-num-pages")), n = parseInt(a.getAttribute("data-current-page")), i = document.getElementById("topsubbar_" + t + "_list"); "left" == e ? (n -= 1) < 1 && (n = r) : (n += 1) > r && (n = 1), a.setAttribute("data-current-page", n), $(i).children("li").hide(), $(i).children('li[data-page="' + n + '"]').show() } function topsubbar_group_paging_init(t) { document.getElementById("topsubbar_" + t); var e = document.getElementById("topsubbar_" + t + "_list"), a = parseInt(e.getAttribute("data-per-page")); return $(e).children("li").not(".paging").find("ul").each((function () { var t = $(this).children("li").not("li.paging"); if ($(this).attr("data-num-pages", Math.ceil(t.length / a)), $(this).attr("data-cur-page", "1"), t.length > a) { $(this).children("li[data-page='1']").css("display", "block"); $(this).children("li.paging").height(); $(this).css("padding-bottom", "32px") } else $(this).children("li").not("li.paging").css("display", "block") })), !0 } function topsubbar_group_paging_change(t, e, a) { "back" == t || (t = "forward"); var r = $(a).parent().parent().parent().parent(), n = $(r).height(), i = -1; return "forward" == t && parseInt($(r).attr("data-cur-page")) < parseInt($(r).attr("data-num-pages")) ? i = parseInt($(r).attr("data-cur-page")) + 1 : "back" == t && parseInt($(r).attr("data-cur-page")) > 1 && (i = parseInt($(r).attr("data-cur-page")) - 1), i > -1 && ($(r).attr("data-cur-page", i), $(r).children("li").not(".paging").css("display", "none"), $(r).children("li[data-page='" + i + "']").not(".paging").css("display", "block"), 1 == i ? $(a).parent().parent().find("li.back").attr("data-active", "false") : $(a).parent().parent().find("li.back").attr("data-active", "true"), i == parseInt($(r).attr("data-num-pages")) ? $(a).parent().parent().find("li.forward").attr("data-active", "false") : $(a).parent().parent().find("li.forward").attr("data-active", "true"), $(a).parent().parent().find("li.status").children("div").children("span").html(mir_translate("Page %(numpage)d of %(numpages)d", { numpage: number_format(i, 0, ",", "."), numpages: parseInt($(r).attr("data-num-pages")) })), $(r).css("min-height", n + "px")), !0 } function check_running_status(t, e) { void 0 === t && (t = 0); var a = !1; setTimeout((function () { ros.isConnected ? (0 == $("#api_status").length && ($(".mir-waiter").append('<div id="api_status" class="api_status waiting">' + mir_translate("fleet_api_waiting") + "</div>"), initial_package_managers()), new ROSLIB.Topic({ ros: ros, name: "/node_init" }).subscribe((function (t) { var e = t.init_suc ? "started" : "notstarted", a = t.init_suc ? mir_translate("fleet_restart_package_started") : mir_translate("fleet_restart_package_notstarted"), r = '<span class="msg_icon ' + e + '"></span>' + t.package_name + " " + a; $("#" + t.package_name).html(r) })), new Promise((function (t, e) { !function e() { var r = new XMLHttpRequest; r.open("GET", "/api/v2.0.0/status", !0), r.onload = function () { t() }, r.onerror = function () { a = !0, setTimeout((function () { e() }), 1e3) }, r.send() }() })).then((function () { a ? check_running_status(t, e) : ($("#api_status").removeClass("waiting").addClass("ready"), $("#api_status").html(mir_translate("fleet_api_ready")), "function" == typeof e && setTimeout((function () { e() }), 1e3)) }))) : setTimeout((function () { check_running_status(t, e) }), 1e3) }), t) } function initial_package_managers() { for (var t = ["position_locks_manager", "area_manager", "charging_manager", "evacuation_manager", "mission_schedule_manager", "lift_manager"], e = 0; e < t.length; e++) { var a = '<span class="msg_icon waiting"></span>' + t[e] + " " + mir_translate("fleet_restart_package_starting"); $(".mir-waiter").append('<div class="init_node_msg" id=' + t[e] + ">" + a + "</div>") } } function topsubbar_init(t) { return $("#topsubbar_" + t).on("mouseenter", "li.headitem", (function (e) { var a = this; $("#topsubbar_" + t).find("li.headitem").each((function () { void 0 !== this.timer && (clearTimeout(this.timer), this.timer = void 0), a !== this && $(this).attr("data-state", "close") })), $(this).attr("data-state", "open") })).on("mouseleave", "li.headitem", (function (t) { var e = this, a = "ontouchstart" in window ? 0 : 600; void 0 === e.timer && (e.timer = setTimeout((function () { $(e).attr("data-state", "close") }), a)) })), !0 } $((function () { $("form :input").each((function () { $(this).attr("origin-value", $(this).val()).attr("has-changed", 0) })), $(document).on("change keyup", "[has-changed]", (function () { var t = $(this).val(), e = $(this).attr("origin-value"); $(this).attr("has-changed", t != e ? 1 : 0) })) })), window.onload = function () { this.existing_mission_actions = null; var t = null, e = !!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform), a = mir_translate("Are you sure you want to leave this page with unsaved data?"), r = !1; function n() { var t = this; setTimeout((function () { t.existing_mission_actions = JSON.stringify(missions_missionview_fetch_actions("missionview", "missionview_missionview_actionlist"), replace_int) }), 500) } if (window.location.href.indexOf("missions/") > -1) { $(document).on("click", ".mirbutton[data-template=submit]", (function () { n() })); var i = setInterval((function () { n(), null !== this.existing_mission_actions && this.existing_mission_actions.length > 0 && clearInterval(i) }), 200); setTimeout((function () { clearInterval(i) }), 2e3) } if (-1 != location.href.indexOf("/designer")) var o = setInterval((function () { if (null != (t = $(".grid-stack-item")) && t.length > 0) { clearInterval(o); var e = []; $(".grid-stack-item").each((function () { e.push($(this).attr("data-guid")) })), t = e } setTimeout((function () { clearInterval(o), t.length > 0 || (t = null) }), 3e3) }), 200); if ($(document).on("click", ".delete", (function () { r = !0 })), -1 == location.href.indexOf("maps/") || -1 != location.href.indexOf("create-map")) window.addEventListener("beforeunload", (function (n) { if (!$(".loginwrapper").length && -1 == location.href.indexOf("login") && !r && hasUnsavedChanges(this.existing_mission_actions, t, n)) return (n || window.event).returnValue = a, e ? window.confirm(a) : a })); else { var s = null, d = setInterval((function () { null != (s = JSON.stringify(window["map_" + $(".mapcontainer").attr("data-element-id") + "_metadata"].layers)) && clearInterval(d) }), 200); window.addEventListener("beforeunload", (function (t) { s !== JSON.stringify(window["map_" + $(".mapcontainer").attr("data-element-id") + "_metadata"].layers) && "saved" != $(".mapcontainer").attr("data-save-state") && ((t || window.event).returnValue = a) })) } }, playbar_mission_id = null; var refreshEvacuationZoneButton = function (t) { setTimeout((function () { $.get("/?mode=get-evacuations", (function (e) { var a = t.hasClass("is-evacuating"); if (a !== e.isEvacuating) { if (a) return t.removeClass("is-evacuating"), t.attr("onclick", e.onClickEvent), void refreshEvacuationZoneButton(t); t.addClass("is-evacuating"), t.attr("onclick", e.onClickEvent) } refreshEvacuationZoneButton(t) })) }), 3e3) }, _overlay; function trigger_evacuation_permission_error_modal() { launch_error(mir_translate("fleet_dialog_evacuate_insufficient_permission_error_message")) } function start_evacuation() { var t = { title: mir_translate("fleet_dialog_evacuate_all_zones_title"), body: mir_translate("fleet_dialog_evacuate_all_zones_subtitle"), extra_confirm: mir_translate("fleet_dialog_evacuate_all_zones_confirm_box_label") }; MIR.ui.confirm(t).then((function () { $.ajax({ url: "/system/settings?mode=toggle-evacuation", method: "POST", dataType: "json", data: { evacuate: !0 }, success: function (t) { 201 == t.headers.httpcode && $(".evacuate_all_button").addClass("is-evacuating").attr("onclick", "stop_evacuation()"), t.results.error_human && launch_error(t.results.error_human), $(".mir-overlay").remove() } }) })) } function stop_evacuation() { var t = { title: mir_translate("fleet_dialog_stop_evacuate_all_zones_title"), body: mir_translate("fleet_dialog_stop_evacuate_all_zones_subtitle"), extra_confirm: mir_translate("fleet_dialog_stop_evacuate_all_zones_confirm_box_label") }; MIR.ui.confirm(t).then((function () { $.ajax({ url: "/system/settings?mode=toggle-evacuation", method: "POST", dataType: "json", data: { evacuate: !1 }, success: function (t) { 201 == t.headers.httpcode && $(".evacuate_all_button").removeClass("is-evacuating").attr("onclick", "start_evacuation()"), t.results.error_human && launch_error(t.results.error_human), $(".mir-overlay").remove() } }) })) } function get_robot_groups() { return new Promise((function (t, e) { $.ajax({ url: "/setup/robots?mode=get-robotgroups&calltype=light", method: "POST", success: function (a) { 200 != a.headers.httpcode ? e() : t(a.results) } }) })) } function get_robots() { return new Promise((function (t, e) { $.ajax({ url: "/setup/schedule?mode=get-robots&calltype=light", method: "POST", success: function (a) { 200 != a.headers.httpcode ? e() : t(a.results) } }) })) } function fleet_schedule_modal(t, e) { var a = "schedule_mission_modal_overlay"; _overlay = MIR.ui.overlay({ attributes: { id: a } }); var r = {}; e && (r.edit_id = e), r.mission_guid = t, a = "#" + a, $.ajax({ url: "/setup/schedule?mode=schedule-modal&calltype=light", method: "POST", data: r, success: function (t) { $(a).append(t), $(".datetime_date").datepicker({ dateFormat: "yy-mm-dd" }) } }) } function set_mapping_engine() { $.get("/?mode=get-setting&whitelist=value&calltype=light&ros_name=" + MIR.constants.SETTINGS.MAPPING_ALGORITHM, (function (t) { "object" == typeof t.headers && 200 == t.headers.httpcode && $("body").attr("mapping-engine", t.results.value) })) } $(document).ready((function () { if ($("html").addClass(MIR.util.is_mobile() ? "mir-device-mobile" : "mir-device-desktop"), $(".evacuate_all_button").length) { var t = $(".evacuate_all_button")[0]; refreshEvacuationZoneButton($(t)) } })), $(document).on("submit", "#schedule_form", (function (t) { t.preventDefault(); var e = $(this).serialize(); $.ajax({ url: "/setup/schedule?mode=schedule-mission&calltype=light", data: e, method: "POST", success: function (t) { if (201 == t.headers.httpcode || 200 == t.headers.httpcode) return _overlay.clear(), void ("undefined" != typeof fleet_schedule && fleet_schedule.fetchAll(!0, t.results.id)); $("#missionqueue_error").html(t.results.error_human) } }) })), $(document).on("change", "#run_asap_toggle", (function () { var t = $(this); $("#earliest_start_time").toggleClass("disable", !!t.is(":checked")) })), $(document).on("click", "#missionqueuequestions_cancelbtn", (function () { _overlay.clear() })), set_mapping_engine(), $(document).on("click", "[trigger-element]", (function () { var t = $(this).attr("trigger-element"); $(t).trigger("click") }));
function map_toggle_layerpicker(t) { map_itemselector_stop(t), map_itemeraser_stop(t), map_shapedrawer_stop(t); var e = document.getElementById(t + "_mapcontainer"); "true" == e.getAttribute("data-show-layers") ? e.setAttribute("data-show-layers", "false") : (e.setAttribute("data-show-layers", "true"), e.setAttribute("data-show-mobiletoolbar", "false"), e.setAttribute("data-show-joystick", "false")) } function map_toggle_joystick(t) { map_itemselector_stop(t), map_itemeraser_stop(t), map_shapedrawer_stop(t); var e = document.getElementById(t + "_mapcontainer"); "true" == e.getAttribute("data-show-joystick") ? e.setAttribute("data-show-joystick", "false") : (e.setAttribute("data-show-joystick", "true"), e.setAttribute("data-show-mobiletoolbar", "false"), e.setAttribute("data-show-layers", "false")) } function map_adjust_robot(t) { var e = new ROSLIB.Service({ ros: ros, name: "/mircontrol/command", serviceType: "mirControl/Command" }), a = new ROSLIB.ServiceRequest({ cmd: "adjust:6" }); return e.callService(a, (function (t) { })), !0 } function map_rotate_start(t) { var e = {}; e["map_" + t + "_rotate"] = "true", $.post("/?mode=set-runtime-settings", e); var a, r = $("#" + t + "_map"), i = $("#" + t + "_layer_robotmap"), o = $("#" + t + "_layer_draw"), n = document.getElementById(t + "_mapcontainer"); n.setAttribute("data-rotating", "true"), n.setAttribute("data-show-mobiletoolbar", "false"), document.getElementById(t + "_mapgridscreen").setAttribute("data-visible", "true"), r.draggable("disable"), map_center_map(t, !1, !0), r.children().hide(), i.show(), o.show(), o.rotate({ onRotate: function () { a = this.angle, window.map_shift_holding && (a = 11.25 * Math.round(a / 11.25)), i.css("WebkitTransform", "rotate(" + a + "deg)"), i.css("-moz-transform", "rotate(" + a + "deg)"), i.css("-ms-transform", "rotate(" + a + "deg)"), i.css("transform", "rotate(" + a + "deg)"), n.setAttribute("data-rotation", a) }, onDragStop: function () { o.css("WebkitTransform", "rotate(" + a + "deg)"), o.css("-moz-transform", "rotate(" + a + "deg)"), o.css("-ms-transform", "rotate(" + a + "deg)"), o.css("transform", "rotate(" + a + "deg)") } }) } function map_rotate_stop(t) { var e = document.getElementById(t + "_mapcontainer"), a = document.getElementById(t + "_map"); $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw"), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw"), $(document).off("mouseout pointerleave", "#" + t + "_layer_draw"), $(document).off("touchstart mousedown pointerdown", "#" + t + "_layer_draw"); var r = document.getElementById(t + "_mapgridscreen"); e.setAttribute("data-rotating", "false"), e.setAttribute("data-show-mobiletoolbar", "false"), r.setAttribute("data-visible", "false"), $(a).draggable("enable"), $("#" + t + "_layer_draw").data("draggable") && $("#" + t + "_layer_draw").draggable("destroy"), e.setAttribute("data-initializing", "true"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p>" + map_lang_savingrotation + "</p>"; var i = {}; i.id = e.getAttribute("data-map-guid"), i.rotation = e.getAttribute("data-rotation"), i.origin_x = Math.round(e.getAttribute("data-origin-x")), i.origin_y = Math.round(e.getAttribute("data-origin-y")), i.resscale = Math.round(e.getAttribute("data-resscale")), i.orig_w = Math.round(e.getAttribute("data-map-width")), i.orig_h = Math.round(e.getAttribute("data-map-height")); var o = e.getAttribute("data-map-guid"); return $.ajax({ url: "/?mode=map-save-rotation", data: i, method: "POST", dataType: "json", id: t, guid: o, success: function (a) { var r = {}; r["map_" + t + "_rotate"] = "false", r.mapping_state = MIR.constants.MAP.state.READY, $.post("/?mode=set-runtime-settings", r), e.setAttribute("data-initializing", "false"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p>" + map_lang_initing + "</p>", e.setAttribute("data-rotating", "false"), e.setAttribute("data-rotation", "0"), o == robot_map_id ? map_init(this.id, this.guid, !1) : launch_dialogue(map_lang_donemapping_headline, map_lang_donemapping_text, "map_init('" + this.id + "','" + this.guid + "',false); activate_map('" + this.guid + "',null);", "map_init('" + this.id + "','" + this.guid + "',false);", map_lang_donemapping_yes, map_lang_donemapping_no) } }), !0 } function map_rotate_sethorizon(t) { var e = document.getElementById(t + "_mapcontainer"), a = (document.getElementById(t + "_map"), document.getElementById(t + "_layer_robotmap")); if ("rotate_sethorizon" == e.getAttribute("data-current-tool")) { var r = document.getElementById(t + "_layer_tmpsvg"); $(r).children("#tmpsvg_sethorizontmp_" + t).remove(), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw"), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw"), $(document).off("touchstart mousedown pointerdown", "#" + t + "_layer_draw"), $(document).off("mouseout pointerleave", "#" + t + "_layer_draw"), i = null, o = null, n = null, s = null, 0, map_rotate_start(t), e.setAttribute("data-current-tool", "navigator") } else { e.setAttribute("data-current-tool", "rotate_sethorizon"), map_show_all_layers(t), map_layercontrol_toggle_view(t, "robotmap"), map_set_guide(t, mir_translate("Drag a line to define a horizontal or vertical line.")), $("#" + t + "_layer_draw").data("draggable") && $("#" + t + "_layer_draw").draggable("destroy"), $("#" + t + "_layer_draw").show(); var i = null, o = null, n = null, s = null, d = parseFloat(e.getAttribute("data-rotation")), l = document.getElementById(t + "_layer_draw_canvas"); r = document.getElementById(t + "_layer_tmpsvg"); $(document).on("touchstart mousedown pointerdown", "#" + t + "_layer_draw", (function (p) { if (p.stopPropagation(), p.preventDefault(), !0 !== p.handled) { $(r).children("#tmpsvg_sethorizontmp_" + t).remove(), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw"), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw"), $(document).off("mouseout pointerleave", "#" + t + "_layer_draw"); var m = parseFloat(e.getAttribute("data-zoom-scale")); if (null == p.originalEvent.offsetX && p.originalEvent.touches.length > -1) { var u = document.getElementById(t + "_layer_draw").getBoundingClientRect(); i = (p.originalEvent.touches[0].clientX - u.left) / m, n = (p.originalEvent.touches[0].clientY - u.top) / m } else i = p.originalEvent.offsetX, n = p.originalEvent.offsetY; var c = document.createElementNS("http://www.w3.org/2000/svg", "svg"); c.setAttribute("id", "tmpsvg_sethorizontmp_" + t), c.setAttribute("x", "0px"), c.setAttribute("y", "0px"), c.setAttribute("width", l.getAttribute("width") + "px"), c.setAttribute("height", l.getAttribute("height") + "px"), c.setAttribute("viewbox", "0 0 " + l.getAttribute("width") + " " + l.getAttribute("height")), c.setAttribute("version", "1.1"), c.setAttribute("xml:space", "preserve"), r.appendChild(c); var _ = document.createElementNS("http://www.w3.org/2000/svg", "polyline"); _.setAttribute("id", "tmpsvg_sethorizontmpline_" + t), _.setAttribute("polygon", ""), _.setAttribute("fill", "none"), _.setAttribute("stroke-width", "1"), _.setAttribute("opacity", "0.8"), _.setAttribute("stroke-linejoin", "square"), _.setAttribute("stroke-linecap", "square"), _.setAttribute("stroke-dasharray", "0"), _.setAttribute("stroke", "#BB0000"), c.append(_); var g = document.createElementNS("http://www.w3.org/2000/svg", "ellipse"); g.setAttribute("cx", i), g.setAttribute("cy", n), g.setAttribute("rx", 1), g.setAttribute("ry", 1), g.setAttribute("fill", "#BB0000"), g.setAttribute("id", "tmpsvg_sethorizontmpstart_" + t), c.append(g); var h = document.createElementNS("http://www.w3.org/2000/svg", "ellipse"); h.setAttribute("cx", i), h.setAttribute("cy", n), h.setAttribute("rx", 1), h.setAttribute("ry", 1), h.setAttribute("fill", "#BB0000"), h.setAttribute("id", "tmpsvg_sethorizontmpend_" + t), c.append(h), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw", (function (e) { if (!0 !== e.handled) { if (e.stopPropagation(), e.preventDefault(), null == e.originalEvent.offsetX) { var a = document.getElementById(t + "_layer_draw").getBoundingClientRect(); o = (e.originalEvent.touches[0].clientX - a.left) / m, s = (e.originalEvent.touches[0].clientY - a.top) / m } else o = e.originalEvent.offsetX, s = e.originalEvent.offsetY; _.setAttribute("polygon", i + " " + n + "," + o + " " + s), h.setAttribute("cx", o), h.setAttribute("cy", s) } else e.handled = !0 })), $(document).on("mouseout pointerleave", "#" + t + "_layer_draw", (function (a) { !0 !== a.handled ? (a.stopPropagation(), a.preventDefault(), $(_).remove(), $(g).remove(), $(h).remove(), $(c).remove(), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw"), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw"), $(document).off("touchstart mousedown pointerdown", "#" + t + "_layer_draw"), $(document).off("mouseout pointerleave", "#" + t + "_layer_draw"), i = null, o = null, n = null, s = null, 0, map_rotate_start(t), e.setAttribute("data-current-tool", "navigator")) : a.handled = !0 })), $(document).on("touchend mouseup mouseout pointerup", "#" + t + "_layer_draw", (function (r) { if (!0 !== r.handled) { if (r.stopPropagation(), r.preventDefault(), null == r.originalEvent.offsetX && r.originalEvent.touches[0]) { var l = document.getElementById(t + "_layer_draw").getBoundingClientRect(); o = (r.originalEvent.touches[0].clientX - l.left) / m, s = (r.originalEvent.touches[0].clientY - l.top) / m } else r.originalEvent.offsetX && (o = r.originalEvent.offsetX, s = r.originalEvent.offsetY); var p = calculate_angle_between_points(i, n, o, s); if ((p += 90) < 0 && (p += 360), p >= 0 && p < 45); else if (p >= 315 && p <= 360) { p -= 360 } else if (p >= 135 && p < 225) { p -= 180 } else if (p >= 45 && p < 135) { p -= 90 } else if (p >= 225 && p < 315) { p -= 270 } var u = d - p; $(a).css("WebkitTransform", "rotate(" + u + "deg)"), $(a).css("-moz-transform", "rotate(" + u + "deg)"), $(a).css("-ms-transform", "rotate(" + u + "deg)"), $(a).css("transform", "rotate(" + u + "deg)"), e.setAttribute("data-rotation", u), $(_).remove(), $(g).remove(), $(h).remove(), $(c).remove(), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw"), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw"), $(document).off("touchstart mousedown pointerdown", "#" + t + "_layer_draw"), $(document).off("mouseout pointerleave", "#" + t + "_layer_draw"), i = null, o = null, n = null, s = null, p = 0, map_rotate_start(t), e.setAttribute("data-current-tool", "navigator") } else r.handled = !0 })) } else p.handled = !0 })) } return !0 } function map_record_start_check(t, e) { var a = document.getElementById(t + "_mapcontainer").getAttribute("data-custommap"); return e = 1 == e, launch_waiter(map_lang_mapping_checking_laserscanners), ros_diagnostics_listener = new ROSLIB.Topic({ ros: ros, name: "/diagnostics_agg", messageType: "diagnostic_msgs/DiagnosticArray" }), ros_diagnostics_listener.subscribe((function (r) { ros_diagnostics_listener.unsubscribe(); for (var i = !1, o = !1, n = 0; n < r.status.length;)"/Sensors/Laserscanner (Back)/Communication" == r.status[n].name && 0 == r.status[n].level && (i = !0), "/Sensors/Laserscanner (Front)/Communication" == r.status[n].name && 0 == r.status[n].level && (o = !0), n++; close_waiter(), 0 == i || 0 == o ? launch_error(map_lang_mapping_checking_laserscanners_nogood) : "false" == a ? map_record_start(t, !1, e) : 1 == e ? map_record_start(t, !1, !0) : launch_confirm(map_lang_mapping_confirm_headline, map_lang_mapping_confirm_text, "map_record_start('" + t + "');", map_lang_mapping_confirm_startmapping, map_lang_mapping_confirm_cancel) })), !0 } function map_record_start(t, e, a) { var r = MIR.runtime.maps[t].mir, i = r.get_guid(); if (!e) { var o = {}; o.mapping_guid = i, o.mapping_origin_x = r.get_origin().x, o.mapping_origin_y = r.get_origin().y, o.mapping_scale = r.get_scale(), o.mapping_robot_start_x = robot_cur_x, o.mapping_robot_start_y = robot_cur_y, o.mapping_robot_start_orientation = robot_cur_degrees, o.mapping_state = MIR.constants.MAP.state.MAPPING, o.mapping_append = Boolean(a), o["map_" + t + "_appendmapping"] = Boolean(a), o["map_" + t + "_appendmapping_robot_x"] = robot_cur_x, o["map_" + t + "_appendmapping_robot_y"] = robot_cur_y, o["map_" + t + "_appendmapping_robot_orientation"] = robot_cur_degrees, $.post("/?mode=set-runtime-settings", o, (function (t) { })) } map_reset_mychoice(t), map_center_map(t), $("div.joystick > div.holder > div.stick").draggable("enable"); var n = document.getElementById(t + "_mapcontainer"); n.setAttribute("data-initializing", "true"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p>" + map_lang_mapping_starting + "</p>", $(n).find("div.recording_indicator").hide(), n.setAttribute("data-mapping", "true"), a ? n.setAttribute("data-append-mapping", "true") : n.setAttribute("data-append-mapping", "false"), n.setAttribute("data-show-mobiletoolbar", "false"), n.setAttribute("data-center-robot", "true"), map_set_guide(t, map_lang_guide_record); var s = document.createElement("img"); (s.setAttribute("class", "mapping-part"), s.setAttribute("id", "mapping-part"), document.getElementById(t + "_layer_mapping").appendChild(s), e) || new ROSLIB.Service({ ros: ros, name: "/mircontrol/setMode", serviceType: "mirControl/SetMode" }).callService(new ROSLIB.ServiceRequest({ robotMode: MIR.constants.ROBOT_MODE.MAPPING, modeData: i }), (function (t) { })); window["map_" + t + "_recorder_key"] = -1, new ROSLIB.Topic({ ros: ros, name: "/mapping_metadata", messageType: "mirMsgs/LocalMapStat", throttle_rate: 10 }).subscribe((function (e) { if (-1 == window["map_" + t + "_recorder_key"]) { var a = new Date, r = Math.floor(a.getTime() / 1e3); window["map_" + t + "_recorder_key"] = r, robot_cur_mapping_img_x = Math.round(e.x), robot_cur_mapping_img_y = Math.round(e.y); var i = document.getElementById("mapping-part"); i && (i.onload = function () { var a = parseInt(n.getAttribute("data-map-height")) - (this.height + e.y), r = e.x; $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype="mapping"] > img.mapping-part').css("top", a + "px"), $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype="mapping"] > img.mapping-part').css("left", r + "px"), $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype="positions"]').show(), window["map_" + t + "_recorder_key"] = -1 }, i.onerror = function () { window["map_" + t + "_recorder_key"] = -1 }, i.src = "/?mode=get-tmp-png&f=mir_map_part.png&t=" + r) } })), new ROSLIB.Topic({ ros: ros, name: "/map_metadata", messageType: "nav_msgs/MapMetaData" }).subscribe((function (t) { var e = 1 / t.resolution, a = t.width, r = t.height; $("div.mapcontainer").attr("data-resscale", e), $("div.mapcontainer").attr("data-origin-x", Math.round(t.origin.position.x * e)), $("div.mapcontainer").attr("data-origin-y", Math.round(t.origin.position.y * e)), $("div.mapcontainer").attr("data-map-width", Math.round(t.width)), $("div.mapcontainer").attr("data-map-height", Math.round(t.height)), $("div.mapcontainer").attr("data-resolution", t.resolution), $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype="mapping"]').css("width", a + "px"), $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype="mapping"]').css("height", r + "px") })), map_record_start_statuscheck(t) } function map_record_start_statuscheck(t) { var e = document.getElementById(t + "_mapcontainer"); if ("11" == document.getElementsByTagName("body")[0].getAttribute("data-state-id") && "3" == document.getElementsByTagName("body")[0].getAttribute("data-mode-id")) e.setAttribute("data-initializing", "false"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p>" + map_lang_initing + "</p>", $(e).children("#" + t + "_mapwrapper").children("#" + t + "_mapholder").children("div.map").children("div.layer").each((function () { "mapping" == this.getAttribute("data-layertype") || "robot" == this.getAttribute("data-layertype") || $(this).hide() })), $(e).find("div.recording_indicator").show(), map_center_robot(t); else window.setTimeout((function () { map_record_start_statuscheck(t) }), 2e3); return !0 } function map_record_stop(t) { submitwarn_set(), robot_cur_mapping_x = robot_cur_x, robot_cur_mapping_y = robot_cur_y, robot_cur_mapping_orientation = robot_cur_degrees, launch_waiter(mir_translate("Stopping mapping-engine...")); clearInterval(window["map_" + t + "_mapping_backmap_timer"]); var e = document.getElementById(t + "_mapcontainer"); e.setAttribute("data-mapping", "false"), e.setAttribute("data-show-mobiletoolbar", "false"), e.setAttribute("data-center-robot", "false"), e.setAttribute("data-append-mapping", "false"); var a = e.getAttribute("data-origin-x"), r = e.getAttribute("data-origin-y"); $.get("/?mode=get-runtime-settings", {}, (function (e) { var i = e["map_" + t + "_appendmapping"]; if (e["map_" + t + "_appendmapping_robot_x"]) var o = e["map_" + t + "_appendmapping_robot_x"]; else o = 0; if (e["map_" + t + "_appendmapping_robot_y"]) var n = e["map_" + t + "_appendmapping_robot_y"]; else n = 0; if (e["map_" + t + "_appendmapping_robot_orientation"]) var s = e["map_" + t + "_appendmapping_robot_orientation"]; else s = 0; var d = new ROSLIB.Service({ ros: ros, name: "/mircontrol/setMode", serviceType: "mirControl/SetMode" }), l = {}; $.get("/?mode=get-setting&calltype=light&whitelist=value&ros_name=" + MIR.constants.SETTINGS.MAPPING_ALGORITHM, (function (e) { e.results.value === MIR.constants.MAPPING_ALGORITHM.HECTOR ? d.callService(new ROSLIB.ServiceRequest({ robotMode: MIR.constants.ROBOT_MODE.MISSION }), (function (e) { $("#" + t + "_layer_mapping").find("img")[0].remove(), window.mode_callbacks[7].push("map_record_stop_terminate('" + t + "'," + i + ",'" + o + "','" + n + "','" + s + "','" + robot_cur_mapping_x + "','" + robot_cur_mapping_y + "','" + robot_cur_mapping_orientation + "'," + a + "," + r + ");") })) : (l.mapping_robot_end_x = robot_cur_x, l.mapping_robot_end_y = robot_cur_y, l.mapping_robot_end_orientation = robot_cur_degrees, l.mapping_state = MIR.constants.MAP.state.FINALIZING, $.post("/?mode=set-runtime-settings", l, (function (e) { d.callService(new ROSLIB.ServiceRequest({ robotMode: MIR.constants.ROBOT_MODE.MAPPING_FINALIZING }), (function (e) { resetChanges(), close_waiter(), map_finalizing_start(t) })) }))) })) })) } function map_record_stop_terminate(t, e, a, r, i, o, n, s, d, l) { close_waiter(), launch_waiter(mir_translate("Please wait...")); var p = document.getElementById(t + "_mapcontainer"), m = p.getAttribute("data-origin-x"), u = p.getAttribute("data-origin-y"), c = (p.getAttribute("data-map-width"), p.getAttribute("data-map-height"), {}); c.id = p.getAttribute("data-map-guid"), c.resscale = p.getAttribute("data-resscale"), c.origin_x = m, c.origin_y = u, c.mapping_origin_x = d, c.mapping_origin_y = l, c.append = e, c.append_robot_x = a, c.append_robot_y = r, c.append_robot_orientation = i, c.append_mapping_robot_x = o, c.append_mapping_robot_y = n, c.append_mapping_robot_orientation = s, $.ajax({ url: "/?mode=map-save-mapping", data: c, method: "POST", dataType: "json", id: t, guid: p.getAttribute("data-map-guid"), success: function (t) { resetChanges(), 1 == e ? map_init(this.id, this.guid, !1, null, !0) : map_init(this.id, this.guid, !0), close_waiter() } }) } function map_upload(t, e) { if (e) { var a = {}; a["map_" + t + "_appendmapping"] = String(e), a["map_" + t + "_appendmapping_robot_x"] = robot_cur_x, a["map_" + t + "_appendmapping_robot_y"] = robot_cur_y, a["map_" + t + "_appendmapping_robot_orientation"] = robot_cur_degrees, $.post("/?mode=set-runtime-settings", a, (function (t) { })) } map_itemselector_stop(t), map_itemeraser_stop(t), map_shapedrawer_stop(t), map_navigator(t); for (var r = document.getElementById(t + "_mapcontainer"), i = document.getElementById("map_" + t + "_uploader"), o = document.getElementById("map_" + t + "_uploadform"), n = document.getElementById("map_" + t + "_uploader_iframe"), s = "/", d = o.getAttribute("action").split("?")[1].split("&"), l = 0; l < d.length;) { var p = d[l].split("="); "append" == p[0] || (s += 0 == l ? "?" : "&", s += String(p[0]) + "=" + String(p[1])), l++ } s += 1 == e ? "&append=true" : "&append=false", o.setAttribute("action", s), r.setAttribute("data-show-mobiletoolbar", "false"), map_reset_mychoice(t), n.onload = function () { $(i).val(null), r.setAttribute("data-initializing", "false"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p>" + map_lang_initing + "</p>", 1 == e ? map_init(t, r.getAttribute("data-map-guid"), !1, null, !0) : map_init(t, r.getAttribute("data-map-guid"), !0) }, i.onchange = function () { r.setAttribute("data-initializing", "true"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p>" + map_lang_uploading + "</p>", document.getElementById("map_" + t + "_uploadform").submit() }, $(i).trigger("click") } function map_download(t) { map_itemselector_stop(t), map_itemeraser_stop(t), map_shapedrawer_stop(t), map_navigator(t); var e = document.getElementById(t + "_mapcontainer"), a = e.getAttribute("data-map-guid"); e.setAttribute("data-show-mobiletoolbar", "false"), location.href = "/?mode=download-map&id=" + a } function map_save(t, e) { var a = document.getElementById(t + "_mapcontainer"); if ("saved" == a.getAttribute("data-save-state")); else if ("savable" == a.getAttribute("data-save-state") || 1 == e) { map_set_save_state(t, "saving", !0), 1 == e || (map_reset_mychoice(t), map_itemselector_stop(t), map_itemeraser_stop(t), map_shapedrawer_stop(t), map_navigator(t)); var r = a.getAttribute("data-map-guid"); a.setAttribute("data-show-mobiletoolbar", "false"); document.getElementById(t + "_real_basemap_floor"), document.getElementById(t + "_real_basemap_walls"); var i = {}; for (var o in i.id = a.getAttribute("data-map-guid"), i.metadata = window["map_" + t + "_metadata"], i.metadata.layers) if (i.metadata.layers[o].shapes.length) for (var n = 0; n < i.metadata.layers[o].shapes.length; n++)if ("DELETED" != i.metadata.layers[o].shapes[n]) { var s = i.metadata.layers[o].shapes[n].polygon; if (s && s.length) { for (var d = 0; d < s.length; d++)"DELETED" == s[d] && (s.splice(d, 1), d -= 1); i.metadata.layers[o].shapes[n].polygon = s } } i.metadata = JSON.stringify(i.metadata), i.basemap_floor = document.getElementById(t + "_real_basemap_floor_img").src, i.basemap_walls = document.getElementById(t + "_real_basemap_walls_img").src, $.post("/?mode=save-map", i, (function (i) { if (updateMapZones(t, r), 1 == e) { var o = new Date; document.getElementById(t + "_real_robotmap").src = "/?mode=get-map&pageviewid=" + pageviewid + "&id=" + r + "&t=" + Math.floor(o.getTime() / 1e3) + "&silent=true" } else { o = new Date; document.getElementById(t + "_real_robotmap").src = "/?mode=get-map&pageviewid=" + pageviewid + "&id=" + r + "&t=" + Math.floor(o.getTime() / 1e3) } pageviewid = generate_uuid(), map_set_save_state(t, "saved", !0), "true" == a.getAttribute("data-active-map") && (document.getElementsByTagName("body")[0].setAttribute("data-unloaded-map-changes", "true"), launch_dialogue(map_lang_reloadmap, map_lang_reloadmap_text, "activate_map('" + a.getAttribute("data-map-guid") + "',null);", null, map_lang_reloadmap_yes, map_lang_reloadmap_no)) })) } return !0 } function map_pointinserter(t) { var e = document.getElementById(t + "_mapcontainer"), a = e.getAttribute("data-current-layer"); map_itemeraser_stop(t), e.setAttribute("data-show-layers", "false"), e.setAttribute("data-show-joystick", "false"), e.setAttribute("data-show-mobiletoolbar", "false"), e.setAttribute("data-current-tool", "pointinserter"), map_set_guide(t, map_lang_guide_pointinserter_a); var r = parseFloat(e.getAttribute("data-zoom-scale")), i = document.getElementById(t + "_layer_" + a), o = $(i).find("iframe"), n = $(o).contents(); if (map_toolbars_place(), e.getAttribute("data-selected-shape").length > 0) { var s = document.getElementById(t + "_mapdrawer"), d = e.getAttribute("data-selected-shape"); d = Math.round(d.replace(t + "_" + a + "_", "")); var l = JSON.parse(JSON.stringify(window["map_" + t + "_metadata"].layers[a].shapes[d])); $(".refigurepathhandle").draggable("disable"), $(document).on("touchstart mousedown pointerdown", "#" + t + "_mapdrawer > .refigurepathhandle", (function (i) { $(this).attr("data-color", "yellow"); var o = this, d = parseInt(this.getAttribute("data-point")) + 1; $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer > .refigurepathhandle"), map_set_guide(t, map_lang_guide_pointinserter_b), window.setTimeout((function () { $(document).on("touchstart mousedown pointerdown", "#" + t + "_mapdrawer", (function (i) { if ("mapdrawer" == i.target.getAttribute("class")) { if (i.stopPropagation(), i.preventDefault(), $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer"), null == i.originalEvent.offsetX && i.originalEvent.touches.length > -1) var p = document.getElementById(map_id + "_layer_draw_canvas").getBoundingClientRect(), m = (i.originalEvent.touches[0].clientX - p.left) / r, u = (i.originalEvent.touches[0].clientY - p.top) / r; else m = i.originalEvent.offsetX, u = i.originalEvent.offsetY; var c = e.getAttribute("data-selected-shape"); c = Math.round(c.replace(t + "_" + a + "_", "")); var _ = { type: "insert_point" }; _.layer = a, _.path_id = c, _.point_id = d, _.svgdata = $(n).find("#" + t + "_" + a + "_" + c).attr("d"), _.old_obj = l, map_add_to_history(t, _); var g = document.createElement("div"); g.setAttribute("class", "refigurepathhandle"), g.setAttribute("data-layer", a), g.setAttribute("data-path", c), g.setAttribute("data-point", d), g.setAttribute("data-element-id", t), $(s).find(".refigurepathhandle").each((function () { (parseInt(this.getAttribute("data-point")) == d || parseInt(this.getAttribute("data-point")) > d) && this.setAttribute("data-point", parseInt(this.getAttribute("data-point")) + 1) })), s.appendChild(g); var h = parseFloat(e.getAttribute("data-zoom-scale")), f = {}; f.x = m, f.y = u, f.x = f.x - parseFloat(e.getAttribute("data-zoom-offset-left")), f.y = f.y - parseFloat(e.getAttribute("data-zoom-offset-top")), f.x = Math.round(f.x / h), f.y = Math.round(f.y / h), window["map_" + t + "_metadata"].layers[a].shapes[c].polygon.splice(d, 0, f), window["map_" + t + "_metadata"].layers[a].shapes[c].is_updated = !0, map_set_save_state(t, "savable", !1); for (var v = "", b = !1, y = 0; y < window["map_" + t + "_metadata"].layers[a].shapes[c].polygon.length;)"DELETED" == window["map_" + t + "_metadata"].layers[a].shapes[c].polygon[y] || (0 == b ? (b = !0, v += "M") : v += "L", v += window["map_" + t + "_metadata"].layers[a].shapes[c].polygon[y].x + " " + window["map_" + t + "_metadata"].layers[a].shapes[c].polygon[y].y), y++; "shape" == window["map_" + t + "_metadata"].layers[a].shapes[c].type && (v += "z"), $(n).find("#" + t + "_" + a + "_" + c).attr("d", v), map_update_ghost(t, a, c), $(g).css("top", u + "px"), $(g).css("left", m + "px"), $(o).attr("data-color", "green"), map_itemselector(t), $(n).find("#" + t + "_" + a + "_" + c).trigger("touchstart"), map_toolbars_place() } })) }), 300) })) } } function checkShapePermission(t, e, a) { var r = function (t) { switch (t) { case "DELETE": launch_error(map_lang_area_nopermdel); break; default: launch_error(map_lang_area_noperm) } }; if (Array.isArray(t.allowed_methods)) { if (t.allowed_methods.indexOf(e) < 0) return r(e), !1 } else if (a && ($mapcontainer = $("#" + a + "_mapcontainer"), $mapcontainer.length > 0 && "false" == $mapcontainer.attr("data-allow-edit"))) return r(e), !1; return !0 } function map_itemeraser(t) { var e = document.getElementById(t + "_mapcontainer"); e.getAttribute("data-selected-shape").length > 0 ? map_autoselect_layer(t, "vectors", !0) : (map_autoselect_layer(t, "vectors"), map_clean_tempshapes(t), map_shapedrawer_stop(t)); var a = e.getAttribute("data-current-layer"); e.getAttribute("data-selected-shape").length <= 0 && map_isolate_layer(t, a), e.setAttribute("data-show-layers", "false"), e.setAttribute("data-show-joystick", "false"), e.setAttribute("data-show-mobiletoolbar", "false"), e.setAttribute("data-current-tool", "itemeraser"); var r = document.getElementById(t + "_layer_" + a), i = $(r).find("iframe"); $(i).contents(); if (map_toolbars_place(), e.getAttribute("data-selected-shape").length > 0) { map_set_guide(t, map_lang_guide_itemeraser_point); var o = document.getElementById(t + "_mapdrawer"); $(".refigurepathhandle").draggable("disable"), $(o).find(".refigurepathhandle").click((function (e) { var a = this.getAttribute("data-element-id"); document.getElementById(a + "_mapcontainer"); map_set_save_state(a, "savable", !1); var r = this.getAttribute("data-point"), i = this.getAttribute("data-layer"), n = this.getAttribute("data-path"); if (!checkShapePermission(window["map_" + t + "_metadata"].layers[i].shapes[n], "DELETE")) return !1; var s = { type: "delete_point" }; s.layer = i, s.path_id = n, s.point_id = r, s.old_obj = window["map_" + a + "_metadata"].layers[i].shapes[n].polygon[r], map_add_to_history(t, s); var d = window["map_" + a + "_metadata"].layers[i].shapes[n].polygon; window["map_" + a + "_metadata"].layers[i].shapes[n].is_updated = !0; for (var l = "", p = 0, m = 0, u = !1; m < d.length;)m == r || "DELETED" == d[m] || (0 == u ? (l += "M", u = !0) : l += "L", l += d[m].x + " " + d[m].y, p++), m++; "stroke" == window["map_" + a + "_metadata"].layers[i].shapes[n].type || (l += "z"); var c = document.getElementById(a + "_layer_" + i), _ = $(c).find("iframe"), g = $(_).contents(); $(g).find("#" + a + "_" + i + "_" + n).attr("d", l), map_update_ghost(a, i, n), window["map_" + a + "_metadata"].layers[i].shapes[n].polygon[r] = "DELETED", $(this).remove(), "stroke" == window["map_" + a + "_metadata"].layers[i].shapes[n].type || p < 3 && (map_clean_tempshapes(t), map_shapedrawer_stop(t), window["map_" + a + "_metadata"].layers[i].shapes[n] = "DELETED", $(o).find(".refigurepathhandle").remove()) })) } else map_set_guide(t, map_lang_guide_itemeraser_shape) } function map_delete_shape(t, e, a) { var r = t.getAttribute("id"); r = r.replace("_ghost", ""); var i = t.getAttribute("id"); i = i.replace("_ghost", ""), i = Math.round(i.replace(e + "_" + a + "_", "")); var o = window["map_" + e + "_metadata"].layers[a].shapes, n = { type: "delete_shape", layer: a, path_id: i, svgdata: t.getAttribute("d"), old_obj: JSON.parse(JSON.stringify(o[i])) }; if (!checkShapePermission(o[i], "DELETE")) return !1; map_add_to_history(e, n), map_set_save_state(e, "savable", !1), o[i] = "DELETED", $(t).parent().find("#" + r).remove(), map_update_ghost(e, a, i), map_toolbars_place() } function map_itemeraser_stop(t) { var e = document.getElementById(t + "_mapdrawer"), a = document.getElementById(t + "_mapcontainer"); $(e).find(".refigurepathhandle").off("click"), $(a).find("iframe").each((function () { var e = $(this).contents().find("svg"); $(e).off("touchstart mousedown pointerdown", "." + t + "_svgpath, ." + t + "_svgpath_ghost") })) } function map_clean_tempshapes(t) { var e = document.getElementById(t + "_mapcontainer"); window[t + "_localpoints"] = []; $(e).find("iframe").each((function () { var t = $(this).contents().find("svg"); $(t).find("#tempshape").remove() })); var a = document.getElementById(t + "_mapdrawer"); return $(a).find(".refigurepathhandle").remove(), !0 } function reset_all_layer_opacity(t) { $("#" + t + "_mapholder div.layer").css({ opacity: "1" }) } function map_itemselector(t) { var e = document.getElementById(t + "_mapcontainer"), a = e.getAttribute("data-current-layer"), r = e.getAttribute("data-current-tool"), i = e.getAttribute("data-selected-shape"), o = document.getElementById(t + "_map"); e.setAttribute("data-show-mobiletoolbar", "false"), map_clean_tempshapes(t), map_eraser_stop(t), map_itemselector_stop(t), map_itemeraser_stop(t), map_shapedrawer_stop(t), map_set_guide(t, map_lang_guide_itemselector), "" != a && ("" == i ? map_isolate_layer(t, a) : map_show_all_layers(t), $("#" + t + "_layer_" + a).addClass("current_layer")), map_toolbars_place(), e.setAttribute("data-show-layers", "false"), e.setAttribute("data-show-joystick", "false"), e.setAttribute("data-selected-shape", ""), e.setAttribute("data-selected-shape-type", ""), $(o).draggable("disable"), e.setAttribute("data-current-tool", "itemselector"); var n = document.getElementById(t + "_layer_" + a), s = $(n).find("iframe"), d = $(s).contents(); $(d).off("touchstart mousedown click", "." + t + "_svgpath, ." + t + "_svgpath_ghost"), $(d).on("touchstart mousedown click", "." + t + "_svgpath, ." + t + "_svgpath_ghost", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = this.getAttribute("id"); r = r.replace("_ghost", ""); var i = this.getAttribute("id"); if (i = i.replace("_ghost", ""), i = Math.round(i.replace(t + "_" + a + "_", "")), !checkShapePermission(window["map_" + t + "_metadata"].layers[a].shapes[i], "PUT")) return !1; $(d).off("touchstart mousedown pointerdown", "." + t + "_svgpath, ." + t + "_svgpath_ghost"), $(d).find("." + t + "_svgpath").each((function () { var t = String($(this).attr("style")); t = t.replace("1.0", "0.8"), $(this).attr("style", t) })), map_set_guide(t, map_lang_guide_itemselector_selected), $(t + "_layer_draw").show(), map_draw_shape_on_canvas(t, r), map_toolbars_place() } else e.handled = !0 })), "itemeraser" == r && i.length > 0 && $(d).find("#" + i).length > 0 && $(d).find("#" + i).click() } function map_itemselector_stop(t) { var e = document.getElementById(t + "_mapcontainer"); $(e).find(".toolbarbutton_areaeventsettings").hide(); var a = e.getAttribute("data-current-layer"); e.setAttribute("data-selected-shape", ""), e.setAttribute("data-selected-shape-type", ""); var r = document.getElementById(t + "_layer_" + a), i = $(r).find("iframe"), o = $(i).contents(); $(o).find("." + t + "_svgpath").off("click"), $(o).find("." + t + "_svgpath").each((function () { var t = String($(this).attr("style")); t = t.replace("1.0", "0.8"), $(this).attr("style", t) })); var n = document.getElementById(t + "_mapdrawer"); n.innerHTML = "", $(n).hide() } function map_shapedrawer(t) { function e(t, e, a, r) { var i = ""; $.each(e, (function (t, e) { i += 0 == t ? "M" : "L", i += e.x + " " + e.y })), i += "z"; var o = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); $(o).find("#tempshape").remove(); var n = document.createElementNS("http://www.w3.org/2000/svg", "path"); n.setAttribute("d", i), "areaevents_evacuation" == a ? n.setAttribute("fill", "url(#pattern_emergency)") : n.setAttribute("fill", r), n.setAttribute("opacity", "0.8"), n.setAttribute("id", "tempshape"), o.append(n) } map_clean_tempshapes(t), map_autoselect_layer(t, "vectors"), map_shapedrawer_stop(t), map_show_all_layers(t); var a = document.getElementById(t + "_mapcontainer"), r = a.getAttribute("data-current-layer"); a.getAttribute("data-current-tool"), a.getAttribute("data-selected-shape"); a.setAttribute("data-show-mobiletoolbar", "false"); var i = document.getElementById(t + "_mapdrawer"); $(i).show(), map_itemselector_stop(t), map_itemeraser_stop(t), a.setAttribute("data-show-layers", "false"), a.setAttribute("data-show-joystick", "false"), a.setAttribute("data-selected-shape", ""), a.setAttribute("data-selected-shape-type", ""), a.setAttribute("data-current-tool", "shapedrawer"), map_set_guide(t, map_lang_guide_shapedrawer), map_toolbars_place(), $("#" + t + "_layer_draw").show(), $(i).css("cursor", "crosshair"); var o = document.getElementById(t + "_layer_" + r), n = $(o).find("iframe"); $(n).contents(); window[t + "_localpoints"] = []; $(i).show(); var s = window["map_" + t + "_metadata"].layers[r].shapes.length, d = a.getAttribute("data-current-layer"); if ("floor" == d) color = "#FFFFFF"; else if ("walls" == d) color = "#000000"; else if ("areaprefs_preferred" == d) color = "#c8ffc8"; else if ("areaprefs_unpreferred" == d) color = "#c8c8ff"; else if ("areaprefs_critical" == d) color = "#f5d8a2"; else if ("areaprefs_forbidden" == d) color = "#ffc8c8"; else if ("oneway" == d) color = "#EEEEEE"; else { var l = area_events.getAreaColor(r.replace("areaevents_", "")); color = "#" + l.hex } $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer"), $(document).on("touchstart mousedown pointerdown", "#" + t + "_mapdrawer", (function (o) { if (o.stopPropagation(), o.preventDefault(), !0 !== o.handled) { var n = parseFloat(a.getAttribute("data-zoom-scale")); if (null == o.originalEvent.offsetX) var d = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), l = o.originalEvent.touches[0].clientX - d.left, p = o.originalEvent.touches[0].clientY - d.top; else l = o.originalEvent.offsetX, p = o.originalEvent.offsetY; var m = {}; m.x = l, m.y = p, m.color = color, m.value = void 0, m.x = m.x - parseFloat(a.getAttribute("data-zoom-offset-left")), m.y = m.y - parseFloat(a.getAttribute("data-zoom-offset-top")), m.x = Math.round(m.x / n), m.y = Math.round(m.y / n); var u = -1, c = Math.round(10 / n); c < 3 && (c = 3); for (var _ = 0; _ < window[t + "_localpoints"].length;)m.x > window[t + "_localpoints"][_].x - c && m.x < window[t + "_localpoints"][_].x + c && m.y > window[t + "_localpoints"][_].y - c && m.y < window[t + "_localpoints"][_].y + c && (u = _), _++; if (u > -1 && 0 == window.map_shift_holding) $(document).on("touchmove mousemove pointermove", "#" + t + "_mapdrawer", (function (o) { if (o.stopPropagation(), o.preventDefault(), !0 !== o.handled) { var n = parseFloat(a.getAttribute("data-zoom-scale")); if (null == o.originalEvent.offsetX && o.originalEvent.touches.length > -1) var s = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), d = o.originalEvent.touches[0].clientX - s.left, l = o.originalEvent.touches[0].clientY - s.top; else d = o.originalEvent.offsetX, l = o.originalEvent.offsetY; $(i).children("div[data-point='" + u + "'].refigurepathhandle").css("top", l + "px"), $(i).children("div[data-point='" + u + "'].refigurepathhandle").css("left", d + "px"); var p = {}; p.x = d, p.y = l, p.color = color, p.value = void 0, p.x = p.x - parseFloat(a.getAttribute("data-zoom-offset-left")), p.y = p.y - parseFloat(a.getAttribute("data-zoom-offset-top")), p.x = Math.round(p.x / n), p.y = Math.round(p.y / n), window[t + "_localpoints"][u] = p, e(t, window[t + "_localpoints"], r, color) } else o.handled = !0 })), $(document).on("touchend mouseup pointerup", "#" + t + "_mapdrawer", (function (i) { if (!0 !== i.handled) { $(document).off("touchmove mousemove pointermove", "#" + t + "_mapdrawer"), $(document).off("touchend mouseup pointerup", "#" + t + "_mapdrawer"); var o = parseFloat(a.getAttribute("data-zoom-scale")); if (null == i.originalEvent.offsetX && i.originalEvent.touches.length > -1) var n = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), s = i.originalEvent.touches[0].clientX - n.left, d = i.originalEvent.touches[0].clientY - n.top; else s = i.originalEvent.offsetX, d = i.originalEvent.offsetY; var l = {}; l.x = s, l.y = d, l.color = color, l.value = void 0, l.x = l.x - parseFloat(a.getAttribute("data-zoom-offset-left")), l.y = l.y - parseFloat(a.getAttribute("data-zoom-offset-top")), l.x = Math.round(l.x / o), l.y = Math.round(l.y / o), window[t + "_localpoints"][u] = l, e(t, window[t + "_localpoints"], r, color) } else i.handled = !0 })); else { if (1 == window.map_shift_holding && window[t + "_localpoints"].length > 0) { var g = calculate_angle_between_points(m.x, m.y, window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x, window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y), h = ""; h = g >= -45 && g <= 45 ? "y" : g >= 45 && g <= 135 ? "x" : g >= 135 || g <= -135 ? "y" : "x"; var f = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x, v = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y; f *= n, v *= n, f += parseFloat(a.getAttribute("data-zoom-offset-left")), v += parseFloat(a.getAttribute("data-zoom-offset-top")), "x" == h ? (m.x = f, l = m.x, m.x = m.x - parseFloat(a.getAttribute("data-zoom-offset-left")), m.x = Math.round(m.x / n)) : (m.y = v, p = m.y, m.y = m.y - parseFloat(a.getAttribute("data-zoom-offset-top")), m.y = Math.round(m.y / n)) } var b = s, y = document.createElement("div"); y.setAttribute("class", "refigurepathhandle"), y.setAttribute("data-layer", r), y.setAttribute("data-path", b), y.setAttribute("data-point", window[t + "_localpoints"].length), y.setAttribute("data-element-id", t), i.appendChild(y), $(y).css("pointer-events", "none"); if (window[t + "_localpoints"].length > 2 && m.x > window[t + "_localpoints"][0].x - 10 && m.x < window[t + "_localpoints"][0].x + 10 && m.y > window[t + "_localpoints"][0].y - 10 && m.y < window[t + "_localpoints"][0].y + 10 ? (m.x = window[t + "_localpoints"][0].x, m.y = window[t + "_localpoints"][0].y, l = (m.x + parseFloat(a.getAttribute("data-zoom-offset-left"))) * n, p = (m.x + parseFloat(a.getAttribute("data-zoom-offset-top"))) * n, !0) : window[t + "_localpoints"].push(m), $(y).css("top", p + "px"), $(y).css("left", l + "px"), window[t + "_localpoints"].length > 2) { a.getAttribute("data-resscale"), a.getAttribute("data-origin-x"), a.getAttribute("data-origin-y"), a.getAttribute("data-map-height"); e(t, window[t + "_localpoints"], r, color) } } } else o.handled = !0 })) } function map_shapedrawer_stop(t) { var e = document.getElementById(t + "_mapcontainer"), a = e.getAttribute("data-current-layer"), r = document.getElementById(t + "_mapdrawer"); $(r).hide(); var i = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); e.setAttribute("data-selected-shape", ""), e.setAttribute("data-selected-shape-type", ""), $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer"), $(r).off("click"); var o = {}, n = !1; if (null != window[t + "_localpoints"] && window[t + "_localpoints"].length > 1) { n = !0; i = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); var s = MIR.runtime.maps[t].mir.layer2choice(a), d = $("#" + t + "_toolbutton_mychoice_selector").find('option[value="' + s + '"]').html(), l = window["map_" + t + "_metadata"].layers[a].shapes.length + 1; o.name = d + " (" + l + ")", o.type = "shape", "oneway" == a ? (o.direction = e.getAttribute("data-oneway-direction"), o.color = "url(#pattern_arrow_" + e.getAttribute("data-oneway-direction") + ")") : o.color = "areaevents_evacuation" == a ? "url(#pattern_emergency)" : window[t + "_localpoints"][window[t + "_localpoints"].length - 1].color, o.value = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].value, o.polygon = []; for (var p = 0; p < window[t + "_localpoints"].length;) { var m = {}; m.x = window[t + "_localpoints"][p].x, m.y = window[t + "_localpoints"][p].y, o.polygon.push(m), p++ } for (var u = 0; u < o.polygon.length;)0 == u ? "M" : "L", o.polygon[u].x + " " + o.polygon[u].y, u++; "z"; var c = window["map_" + t + "_metadata"].layers[a].shapes.length; if ("#FFFFFF" == o.color || "#000000" == o.color) var _ = 1; else _ = .8; e.setAttribute("shape-index", c), $(i).find("#tempshape").attr("class", t + "_svgpath"), $(i).find("#tempshape").attr("style", "fill: " + o.color + "; stroke: none; opacity: " + String(_) + ";"), $(i).find("#tempshape").attr("id", t + "_" + a + "_" + c), $(i).find("#tempshape").removeAttr("fill"), $(i).find("#tempshape").attr("opacity", _), window["map_" + t + "_metadata"].layers[a].shapes.push(o); var g = { type: "create_shape" }; g.layer = a, g.path_id = t + "_" + a + "_" + c, g.removeid = c, map_add_to_history(t, g), map_set_save_state(t, "savable", !1) } if (window[t + "_localpoints"] = [], map_clean_tempshapes(t), map_navigator(t), map_toolbars_place(), n) { var h = [t, a, c].join("_"); map_draw_shape_on_canvas(t, h), window["map_" + t + "_metadata"].layers[a].shapes[c].allowed_methods = ["GET", "PUT", "UPDATE", "DELETE"]; -1 == ["oneway", "areaprefs_preferred", "areaprefs_unpreferred", "areaprefs_forbidden", "areaprefs_critical", "floor", "walls"].indexOf(a) ? (MIR.runtime.maps[t].find(".toolbarbutton_areaeventsettings").show().trigger("click"), $("#" + t + "_mapcontainer").attr("navigator-on-close", 1)) : map_navigator(t) } return !0 } function map_linedrawer_start(t) { map_clean_tempshapes(t), map_autoselect_layer(t, "vectors"), map_linedrawer_stop(t); var e = document.getElementById(t + "_mapcontainer"), a = e.getAttribute("data-current-layer"); e.getAttribute("data-current-tool"), e.getAttribute("data-selected-shape"); e.setAttribute("data-show-mobiletoolbar", "false"); var r = document.getElementById(t + "_mapdrawer"); $(r).show(), map_itemselector_stop(t), map_itemeraser_stop(t), e.setAttribute("data-show-layers", "false"), e.setAttribute("data-show-joystick", "false"), e.setAttribute("data-selected-shape", ""), e.setAttribute("data-selected-shape-type", ""), e.setAttribute("data-current-tool", "linedrawer"), map_set_guide(t, map_lang_guide_linedrawer), map_toolbars_place(), $("#" + t + "_layer_draw").show(), $(r).css("cursor", "crosshair"); var i = document.getElementById(t + "_layer_" + a), o = $(i).find("iframe"); $(o).contents(); window[t + "_localpoints"] = []; $(r).show(); var n = window["map_" + t + "_metadata"].layers[a].shapes.length; $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer"), $(document).on("touchstart mousedown pointerdown", "#" + t + "_mapdrawer", (function (i) { if (i.stopPropagation(), i.preventDefault(), !0 !== i.handled) { i.handled = !0; var o = "#CCCCCC"; "floor" == e.getAttribute("data-current-layer") ? o = "#FFFFFF" : "walls" == e.getAttribute("data-current-layer") ? o = "#000000" : "areaprefs_preferred" == e.getAttribute("data-current-layer") ? o = "#c8ffc8" : "areaprefs_unpreferred" == e.getAttribute("data-current-layer") ? o = "#c8c8ff" : "areaprefs_critical" == e.getAttribute("data-current-layer") ? o = "#f5d8a2" : "areaprefs_forbidden" == e.getAttribute("data-current-layer") && (o = "#ffc8c8"); var s = parseFloat(e.getAttribute("data-zoom-scale")); if (null == i.originalEvent.offsetX) var d = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), l = i.originalEvent.touches[0].clientX - d.left, p = i.originalEvent.touches[0].clientY - d.top; else l = i.originalEvent.offsetX, p = i.originalEvent.offsetY; (_ = {}).x = l, _.y = p, _.color = o, _.value = "", _.x = _.x - parseFloat(e.getAttribute("data-zoom-offset-left")), _.y = _.y - parseFloat(e.getAttribute("data-zoom-offset-top")), _.x = Math.round(_.x / s), _.y = Math.round(_.y / s); var m = -1, u = Math.round(10 / s); u < 3 && (u = 3), "true" == document.body.getAttribute("data-touch-support") && (u = Math.round(30 / s)); for (var c = 0; c < window[t + "_localpoints"].length;)_.x > window[t + "_localpoints"][c].x - u && _.x < window[t + "_localpoints"][c].x + u && _.y > window[t + "_localpoints"][c].y - u && _.y < window[t + "_localpoints"][c].y + u && (m = c), c++; if (m > -1 && 0 == window.map_shift_holding) { window["map_" + t + "_hitpoint"] = !0; var _, g = parseFloat(e.getAttribute("data-zoom-scale")); if (null == i.originalEvent.offsetX) d = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), l = i.originalEvent.touches[0].clientX - d.left, p = i.originalEvent.touches[0].clientY - d.top; else l = i.originalEvent.offsetX, p = i.originalEvent.offsetY; $(r).children("div[data-point='" + m + "'].refigurepathhandle").css("top", p + "px"), $(r).children("div[data-point='" + m + "'].refigurepathhandle").css("left", l + "px"), (_ = {}).x = l, _.y = p, _.color = o, _.value = "", _.x = _.x - parseFloat(e.getAttribute("data-zoom-offset-left")), _.y = _.y - parseFloat(e.getAttribute("data-zoom-offset-top")), _.x = Math.round(_.x / g), _.y = Math.round(_.y / g), window[t + "_localpoints"][m] = _; var h = ""; for (c = 0; c < window[t + "_localpoints"].length;)h += 0 == c ? "M" : "L", h += window[t + "_localpoints"][c].x + " " + window[t + "_localpoints"][c].y, c++; var f = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); $(f).find("#tempshape").remove(), (x = document.createElementNS("http://www.w3.org/2000/svg", "path")).setAttribute("d", h), x.setAttribute("fill", "none"), x.setAttribute("stroke", o), x.setAttribute("stroke-width", e.getAttribute("data-current-linesize") + "px"), x.setAttribute("stroke-linecap", "butt"), x.setAttribute("stroke-linejoin", "bevel"), x.setAttribute("opacity", "0.8"), x.setAttribute("id", "tempshape"), f.append(x), $(document).on("touchmove mousemove pointermove", "#" + t + "_mapdrawer", (function (i) { if (i.stopPropagation(), i.preventDefault(), !0 !== i.handled && 0 == window.map_shift_holding) { var n = parseFloat(e.getAttribute("data-zoom-scale")); if (null == i.originalEvent.offsetX) var s = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), d = i.originalEvent.touches[0].clientX - s.left, l = i.originalEvent.touches[0].clientY - s.top; else d = i.originalEvent.offsetX, l = i.originalEvent.offsetY; $(r).children("div[data-point='" + m + "'].refigurepathhandle").css("top", l + "px"), $(r).children("div[data-point='" + m + "'].refigurepathhandle").css("left", d + "px"); var p = {}; p.x = d, p.y = l, p.color = o, p.value = "", p.x = p.x - parseFloat(e.getAttribute("data-zoom-offset-left")), p.y = p.y - parseFloat(e.getAttribute("data-zoom-offset-top")), p.x = Math.round(p.x / n), p.y = Math.round(p.y / n), window[t + "_localpoints"][m] = p; for (var u = "", c = 0; c < window[t + "_localpoints"].length;)u += 0 == c ? "M" : "L", u += window[t + "_localpoints"][c].x + " " + window[t + "_localpoints"][c].y, c++; var _ = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); $(_).find("#tempshape").remove(); var g = document.createElementNS("http://www.w3.org/2000/svg", "path"); g.setAttribute("d", u), g.setAttribute("fill", "none"), g.setAttribute("stroke", o), g.setAttribute("stroke-width", e.getAttribute("data-current-linesize") + "px"), g.setAttribute("stroke-linecap", "butt"), g.setAttribute("stroke-linejoin", "bevel"), g.setAttribute("opacity", "0.8"), g.setAttribute("id", "tempshape"), _.append(g) } else i.handled = !0; return !1 })), $(document).on("touchend mouseup pointerup", "#" + t + "_mapdrawer", (function (r) { if (r.stopPropagation(), r.preventDefault(), !0 !== r.handled && 0 == window.map_shift_holding) { $(document).off("touchmove mousemove pointermove", "#" + t + "_mapdrawer"), $(document).off("touchend mouseup pointerup", "#" + t + "_mapdrawer"); var i = parseFloat(e.getAttribute("data-zoom-scale")); if (null == r.originalEvent.offsetX) var n = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), s = r.originalEvent.touches[0].clientX - n.left, d = r.originalEvent.touches[0].clientY - n.top; else s = r.originalEvent.offsetX, d = r.originalEvent.offsetY; var l = {}; l.x = s, l.y = d, l.color = o, l.value = "", l.x = l.x - parseFloat(e.getAttribute("data-zoom-offset-left")), l.y = l.y - parseFloat(e.getAttribute("data-zoom-offset-top")), l.x = Math.round(l.x / i), l.y = Math.round(l.y / i), window[t + "_localpoints"][m] = l; for (var p = "", u = 0; u < window[t + "_localpoints"].length;)p += 0 == u ? "M" : "L", p += window[t + "_localpoints"][u].x + " " + window[t + "_localpoints"][u].y, u++; var c = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); $(c).find("#tempshape").remove(); var _ = document.createElementNS("http://www.w3.org/2000/svg", "path"); _.setAttribute("d", p), _.setAttribute("fill", "none"), _.setAttribute("stroke", o), _.setAttribute("stroke-width", e.getAttribute("data-current-linesize") + "px"), _.setAttribute("stroke-linecap", "butt"), _.setAttribute("stroke-linejoin", "bevel"), _.setAttribute("opacity", "0.8"), _.setAttribute("id", "tempshape"), c.append(_), window["map_" + t + "_hitpoint"] = !1 } else r.handled = !0 })) } else { if (1 == window.map_shift_holding && window[t + "_localpoints"].length > 0) { var v = calculate_angle_between_points(_.x, _.y, window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x, window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y), b = ""; b = v >= -45 && v <= 45 ? "y" : v >= 45 && v <= 135 ? "x" : v >= 135 || v <= -135 ? "y" : "x"; var y = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x, w = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y; y *= s, w *= s, y += parseFloat(e.getAttribute("data-zoom-offset-left")), w += parseFloat(e.getAttribute("data-zoom-offset-top")), "x" == b ? (_.x = y, l = _.x, _.x = _.x - parseFloat(e.getAttribute("data-zoom-offset-left")), _.x = Math.round(_.x / s)) : (_.y = w, p = _.y, _.y = _.y - parseFloat(e.getAttribute("data-zoom-offset-top")), _.y = Math.round(_.y / s)) } var A = n, E = document.createElement("div"); if (E.setAttribute("class", "refigurepathhandle"), E.setAttribute("data-layer", a), E.setAttribute("data-path", A), E.setAttribute("data-point", window[t + "_localpoints"].length), E.setAttribute("data-element-id", t), r.appendChild(E), $(E).css("pointer-events", "none"), window[t + "_localpoints"].push(_), $(E).css("top", p + "px"), $(E).css("left", l + "px"), window[t + "_localpoints"].length > 1) { for (e.getAttribute("data-resscale"), e.getAttribute("data-origin-x"), e.getAttribute("data-origin-y"), e.getAttribute("data-map-height"), h = "", c = 0; c < window[t + "_localpoints"].length;)h += 0 == c ? "M" : "L", h += window[t + "_localpoints"][c].x + " " + window[t + "_localpoints"][c].y, c++; var x; f = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); $(f).find("#tempshape").remove(), (x = document.createElementNS("http://www.w3.org/2000/svg", "path")).setAttribute("d", h), x.setAttribute("fill", "none"), x.setAttribute("stroke", o), x.setAttribute("stroke-width", e.getAttribute("data-current-linesize") + "px"), x.setAttribute("stroke-linecap", "butt"), x.setAttribute("stroke-linejoin", "bevel"), x.setAttribute("opacity", "0.8"), x.setAttribute("id", "tempshape"), f.append(x) } } } else i.handled = !0 })) } function map_linedrawer_stop(t) { var e = document.getElementById(t + "_mapcontainer"), a = e.getAttribute("data-current-layer"), r = document.getElementById(t + "_mapdrawer"); $(r).hide(); var i = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); if ($(i).find("#tempshape").remove(), e.setAttribute("data-selected-shape", ""), e.setAttribute("data-selected-shape-type", ""), $(r).off("click"), null != window[t + "_localpoints"] && window[t + "_localpoints"].length > 1) { !0; i = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"); var o = parseInt(e.getAttribute("data-current-linesize")), n = {}, s = MIR.runtime.maps[t].mir.layer2choice(a), d = $("#" + t + "_toolbutton_mychoice_selector").find('option[value="' + s + '"]').html(), l = window["map_" + t + "_metadata"].layers[a].shapes.length + 1; n.name = d + " (" + l + ")", n.type = "stroke", n.brushsize = o, n.color = "oneway" == a ? "#EEEEEE" : window[t + "_localpoints"][0].color, n.polygon = []; for (var p = 0; p < window[t + "_localpoints"].length;) { var m = {}; m.x = window[t + "_localpoints"][p].x, m.y = window[t + "_localpoints"][p].y, n.polygon.push(m), p++ } for (var u = "", c = 0; c < n.polygon.length;)u += 0 == c ? "M" : "L", u += n.polygon[c].x + " " + n.polygon[c].y, c++; var _, g = window["map_" + t + "_metadata"].layers[a].shapes.length; if ("#FFFFFF" == n.color || "#000000" == n.color) var h = 1; else h = .8; (_ = document.createElementNS("http://www.w3.org/2000/svg", "path")).setAttribute("d", u), _.setAttribute("style", "fill: none; stroke: #FF0000; stroke-width: 30px; stroke-linecap: butt; stroke-linejoin: bevel; opacity: 0;"), _.setAttribute("id", t + "_" + a + "_" + g + "_ghost"), _.setAttribute("class", t + "_svgpath_ghost"), i.append(_), (_ = document.createElementNS("http://www.w3.org/2000/svg", "path")).setAttribute("d", u), _.setAttribute("style", "fill: none; stroke: " + n.color + "; stroke-width: " + n.brushsize + "px; stroke-linecap: butt; stroke-linejoin: bevel; opacity: " + String(h) + ";"), _.setAttribute("id", t + "_" + a + "_" + g), _.setAttribute("class", t + "_svgpath"), "oneway" == a && (_.setAttribute("marker-mid", "url(#mid_arrow)"), _.setAttribute("marker-start", "url(#start_arrow)"), _.setAttribute("marker-end", "url(#end_arrow)")), i.append(_), window["map_" + t + "_metadata"].layers[a].shapes.push(n); var f = { type: "create_shape" }; f.layer = a, f.path_id = t + "_" + a + "_" + g, f.removeid = g, map_add_to_history(t, f), map_set_save_state(t, "savable", !1) } window[t + "_localpoints"] = [], map_navigator(t), map_toolbars_place() } function map_pathdrawer_start(t, e) { map_clean_tempshapes(t), map_autoselect_layer(t, "vectors"), map_linedrawer_stop(t); var a = document.getElementById(t + "_mapcontainer"); a.getAttribute("data-current-layer"), a.getAttribute("data-current-tool"), a.getAttribute("data-selected-shape"); a.setAttribute("data-show-mobiletoolbar", "false"); var r = document.getElementById(t + "_mapdrawer"); $(r).show(), map_itemselector_stop(t), map_itemeraser_stop(t), a.setAttribute("data-show-layers", "false"), a.setAttribute("data-show-joystick", "false"), a.setAttribute("data-selected-shape", ""), a.setAttribute("data-selected-shape-type", ""), a.setAttribute("data-current-tool", "pathdrawer"), map_set_guide(t, map_lang_guide_linedrawer), $("#" + t + "_layer_draw").show(), $(r).css("cursor", "crosshair"), window[t + "_localpoints"] = []; $(r).show(); parseFloat(a.getAttribute("data-zoom-scale")); var i = $(a).find("div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype='positions'] > div.position[data-guid='" + e + "']"), o = $(i).attr("data-guid"), n = $("#" + t + "_layer_paths").find("iframe").contents().find("svg"), s = parseFloat($(i).css("left").replace("px", "")), d = parseFloat($(i).css("top").replace("px", "")), l = {}; return l.x = s, l.y = d, l.orientatation = 0, window[t + "_localpoints"].push(l), $(document).off("touchmove mousemove pointermove", "#" + t + "_mapdrawer"), $(document).on("touchmove mousemove pointermove", "#" + t + "_mapdrawer", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = parseFloat(a.getAttribute("data-zoom-scale")); if (null == e.originalEvent.offsetX) var i = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), o = e.originalEvent.touches[0].clientX - i.left, s = e.originalEvent.touches[0].clientY - i.top; else o = e.originalEvent.offsetX, s = e.originalEvent.offsetY; o -= parseFloat(a.getAttribute("data-zoom-offset-left")), s -= parseFloat(a.getAttribute("data-zoom-offset-top")), o = Math.round(o / r), s = Math.round(s / r); for (var d = "", l = 0; l < window[t + "_localpoints"].length;)d += 0 == l ? "M" : "L", d += window[t + "_localpoints"][l].x + " " + window[t + "_localpoints"][l].y, l++; d += "L" + o + " " + s, $(n).find("#tempshape").remove(); var p = document.createElementNS("http://www.w3.org/2000/svg", "path"); p.setAttribute("d", d), p.setAttribute("fill", "none"), p.setAttribute("stroke", "#BBBB00"), p.setAttribute("stroke-width", "2px"), p.setAttribute("stroke-linecap", "butt"), p.setAttribute("stroke-linejoin", "bevel"), p.setAttribute("stroke-dasharray", "2,2"), p.setAttribute("opacity", "0.8"), p.setAttribute("id", "tempshape"), n.append(p) } else e.handled = !0 })), $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer"), $(document).on("touchstart mousedown pointerdown", "#" + t + "_mapdrawer", (function (r) { if (r.stopPropagation(), r.preventDefault(), !0 !== r.handled) { var i = parseFloat(a.getAttribute("data-zoom-scale")); if (null == r.originalEvent.offsetX) var s = document.getElementById(t + "_mapdrawer").getBoundingClientRect(), d = r.originalEvent.touches[0].clientX - s.left, l = r.originalEvent.touches[0].clientY - s.top; else d = r.originalEvent.offsetX, l = r.originalEvent.offsetY; d -= parseFloat(a.getAttribute("data-zoom-offset-left")), l -= parseFloat(a.getAttribute("data-zoom-offset-top")), d = Math.round(d / i), l = Math.round(l / i); var p = ""; if ($(a).find("div.mapwrapper > div.mapholder > div.map > div.layer[data-layertype='positions'] > div.position").each((function () { var t = parseFloat($(this).css("left").replace("px", "")), e = parseFloat($(this).css("top").replace("px", "")); d > t - 10 && d < t + 10 && l > e - 10 && l < e + 10 && (p = $(this).attr("data-guid")) })), p.length > 0) { $(document).off("touchstart mousedown pointerdown", "#" + t + "_mapdrawer"), $(document).off("touchmove mousemove pointermove", "#" + t + "_mapdrawer"), $(n).find("#tempshape").remove(); for (var m = [], u = 0; u < window[t + "_localpoints"].length;) { (g = {}).x = window[t + "_localpoints"].x, g.y = window[t + "_localpoints"].y, m.push(g), u++ } var c = new ROSLIB.Service({ ros: ros, name: "/move_base_node/make_plan", serviceType: "mirMoveBase/CalculatePath" }), _ = new ROSLIB.ServiceRequest({ start: o, waypoints: m, goal: p }); c.callService(_, (function (t) { })), map_pathdrawer_stop(t, e, p, !0) } else { var g; (g = {}).x = d, g.y = l, g.orientatation = 0, window[t + "_localpoints"].push(g) } } else r.handled = !0 })), !0 } function map_pathdrawer_stop(t, e, a, r) { document.getElementById(t + "_mapcontainer").getAttribute("data-current-layer"); var i = document.getElementById(t + "_mapdrawer"); $(i).hide(), window[t + "_localpoints"] = []; return map_navigator(t), !0 } function map_toggle_mobiletoolbar(t) { var e = document.getElementById(t + "_mapcontainer"); "true" == e.getAttribute("data-show-mobiletoolbar") ? e.setAttribute("data-show-mobiletoolbar", "false") : e.setAttribute("data-show-mobiletoolbar", "true") } function map_toggle_center_robot(t, e) { var a = MIR.runtime.maps[t]; if ("true" == a.attr("data-active-map") || "true" == a.attr("data-mapping")) { void 0 === e && (e = !("true" === a.attr("data-center-robot"))), a.attr("data-center-robot", Boolean(e).toString()), e && map_center_robot(t, { interval: 100, callback: function () { a.mir.get_zoom() < .5 && map_zoom(t, 1) } }); var r = a.mir.get_storage_id(); MIR.storage.set(r, "data-center-robot", e) } } function map_center_robot(t, e) { var a = MIR.runtime.maps[t], r = $.extend({ interval: 50, callback: !1 }, e); if ("fleet" == systemtype) { var i = a.attr("data-robotlock"), o = a.find('.robot[robot-id="' + i + '"]'); void 0 !== i && a.mir.center_coords({ x: parseFloat(o.css("left")), y: parseFloat(o.css("top")) }, MIR.constants.MAP.world.MAP, r) } else a.mir.center_coords({ x: robot_cur_x, y: robot_cur_y }, MIR.constants.MAP.world.REAL, r) } function map_center_map(t, e, a) { var r = MIR.runtime.maps[t]; a || (map_clean_tempshapes(t), map_itemselector_stop(t), map_itemeraser_stop(t), map_navigator(t), map_toggle_center_robot(t, !1)), "false" == r.attr("data-mapping") && r.attr("data-show-mobiletoolbar", "false"); var i = r.mir.get_map_size(), o = r.mir.get_viewport_size(), n = (o.width - 20) / i.width, s = (o.height - 20) / i.height, d = n < s ? n : s, l = 200; !1 === e && (l = 0); var p = r.mir.get_storage_id(); return MIR.storage.set(p, "data-center-robot", !1), r.mir.center_coords({ x: i.width / 2, y: i.height / 2 }, MIR.constants.MAP.world.MAP, { callback: function () { map_zoom(t, d) }, interval: l }), !0 } function map_zoom(t, e, a) { var r = $.extend({ interval: 100, callback: !1, zoom_to_coords: !1 }, a), i = document.getElementById(t + "_mapcontainer"), o = parseFloat(i.getAttribute("data-zoom-scale")), n = o; "in" == e ? n = 2 * o : "out" == e ? n = o / 2 : void 0 !== e && (n = e), n < .1 ? n = .1 : n > 10 && (n = 10); var s = document.getElementById(t + "_mapwrapper"); i.setAttribute("data-show-mobiletoolbar", "false"); var d = document.getElementById(t + "_map"), l = document.getElementById(t + "_layer_robotmap"), p = $(l).width() / 2, m = $(l).height() / 2, u = parseFloat(i.getAttribute("data-zoom-offset-left")), c = parseFloat(i.getAttribute("data-zoom-offset-top")); if (r.zoom_to_coords) var _ = r.zoom_to_coords.x, g = r.zoom_to_coords.y; else _ = $(s).width() / 2, g = $(s).height() / 2; var h = (g - c) / m, f = (_ - u) / p; i.setAttribute("data-zoom-scale", n), u -= (p / o * n - p) * f, c -= (m / o * n - m) * h, i.setAttribute("data-zoom-offset-top", c), i.setAttribute("data-zoom-offset-left", u), d.transformScale = o; var v = $(d); return d.transformScale = o, v.finish().animate({ transformScale: n, top: c + "px", left: u + "px" }, { step: function (t, e) { "transformScale" === e.prop && v.css("transform", "scale(" + t + ")") }, easing: "linear", duration: r.interval, complete: function () { map_update_handles(t), determine_marker_images(t); var e = MIR.runtime.maps[t].mir.get_storage_id(); MIR.storage.set(e, "data-zoom-scale", n), MIR.storage.set(e, "data-zoom-offset-left", u), MIR.storage.set(e, "data-zoom-offset-top", c), "function" == typeof r.callback && r.callback() } }), !0 } function map_update_handles(t) { var e = document.getElementById(t + "_mapcontainer"), a = parseFloat(e.getAttribute("data-zoom-scale")), r = e.getAttribute("data-selected-shape"), i = -1; if (r.indexOf("_") > -1) { var o = r.split("_"); i = o[o.length - 1] } var n = e.getAttribute("data-current-layer"), s = 0; return $(".refigurepathhandle").each((function () { if (window[t + "_localpoints"][s]) { var r = window[t + "_localpoints"][s], o = parseFloat(r.y), d = parseFloat(r.x); o *= a, d *= a, o += parseFloat(e.getAttribute("data-zoom-offset-top")), d += parseFloat(e.getAttribute("data-zoom-offset-left")), $(this).css("top", o + "px"), $(this).css("left", d + "px") } else if (window["map_" + t + "_metadata"].layers[n].shapes[i].polygon[s]) { if ("DELETED" == (r = window["map_" + t + "_metadata"].layers[n].shapes[i].polygon[this.getAttribute("data-point")])); else { o = parseFloat(r.y), d = parseFloat(r.x); o *= a, d *= a, o += parseFloat(e.getAttribute("data-zoom-offset-top")), d += parseFloat(e.getAttribute("data-zoom-offset-left")), $(this).css("top", o + "px"), $(this).css("left", d + "px") } } s++ })), !0 } function map_navigator(t, e) { !0 !== e && (map_clean_tempshapes(t), map_itemselector_stop(t), map_itemeraser_stop(t)), map_eraser_stop(t), map_deleteselection_stop(t); var a = document.getElementById(t + "_mapcontainer"), r = document.getElementById(t + "_mapholder"), i = document.getElementById(t + "_map"); a.getAttribute("data-map-guid"); a.setAttribute("data-positioning-robot", "false"); var o = document.getElementById(t + "_layer_robot"); $(o).children("div.ghost").remove(), map_set_guide(t, map_lang_guide_navigator), a.setAttribute("data-show-mobiletoolbar", "false"), a.setAttribute("data-is-drawing", "false"), a.setAttribute("data-current-tool", "navigator"), map_show_all_layers(t); var n = MIR.runtime.maps[t].mir.get_storage_id(); $(i).draggable({ start: function (t, e) { a.setAttribute("data-center-robot", "false"), MIR.storage.set(n, "data-center-robot", !1) }, stop: function (e, r) { a.setAttribute("data-zoom-offset-left", r.position.left), a.setAttribute("data-zoom-offset-top", r.position.top), map_update_handles(t), MIR.storage.set(n, "data-zoom-offset-left", r.position.left), MIR.storage.set(n, "data-zoom-offset-top", r.position.top) }, delay: 80 }), $(i).draggable("enable"), map_toolbars_place(), determine_marker_images(t), $(r).off("touchstart.pinchzoom pointerstart.pinchzoom").off("touchmove.pinchzoom pointermove.pinchzoom").off("touchend.pinchzoom touchend.pinchzoom").on("touchstart.pinchzoom pointerstart.pinchzoom", (function (e) { if (!0 !== e.handled) { if (2 == e.targetTouches.length) { e.stopPropagation(), e.preventDefault(); var a = !1, i = MIR.runtime.maps[t].mir, o = i.get_zoom(), n = MIR.constants.MAP.world, s = null; $(r).on("touchmove.pinchzoom pointermove.pinchzoom", (function (e) { if (!0 !== e.handled) { if (e.stopPropagation(), e.preventDefault(), void 0 === e.originalEvent.touches); else if (2 == e.originalEvent.touches.length) { var r = e.targetTouches.item(0), d = e.targetTouches.item(1), l = Math.sqrt(Math.pow(r.pageX - d.pageX, 2) + Math.pow(r.pageY - d.pageY, 2)); !1 === a && (a = l, s = i.convert_coords({ x: (r.pageX + d.pageX) / 2, y: (r.pageY + d.pageY) / 2 }, n.DOM, n.VIEWPORT)), map_zoom(t, o * (l / a), { interval: 1, zoom_to_coords: s }) } } else e.handled = !0 })), $(r).on("touchend.pinchzoom touchend.pinchzoom", (function (t) { !0 !== t.handled ? (t.stopPropagation(), t.preventDefault(), $(r).off("touchmove.pinchzoom pointermove.pinchzoom").off("touchend.pinchzoom touchend.pinchzoom")) : t.handled = !0 })) } } else e.handled = !0 })), "true" == a.getAttribute("data-locked") && $(i).draggable("disable") } function map_move_item(t) { var e = document.getElementById(t + "_mapcontainer"); e.getAttribute("data-current-layer"); e.setAttribute("data-current-tool", "moveitem") } function map_delete_item(t) { document.getElementById(t + "_mapcontainer").setAttribute("data-current-tool", "deleteitem") } function map_draw_square(t) { var e = document.getElementById(t + "_mapcontainer"); e.setAttribute("data-current-tool", "drawsquare"), $("#" + t + "_layer_navigation").hide(); var a = document.getElementById(t + "_layer_draw_canvas"), r = document.getElementById(t + "_layer_tmpsvg"); $(r).show(); var i = e.getAttribute("data-current-layer"); $("#" + t + "_layer_draw").show(), $(a).css("cursor", "crosshair"); a.getContext("2d"); $(document).on("touchstart click", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var a = this.parentNode.parentNode.parentNode.parentNode.parentNode, o = (a.getAttribute("data-map-guid"), a.getAttribute("data-resscale"), a.getAttribute("data-origin-x"), a.getAttribute("data-origin-y"), a.getAttribute("data-map-width"), a.getAttribute("data-map-height"), e.originalEvent.offsetX), n = e.originalEvent.offsetY, s = 0, d = 0, l = document.createElement("div"); l.setAttribute("id", t + "_tmp_svg"), $(l).css("background-color", "rgba(255,0,0,0.6)"), $(l).css("width", "0px"), $(l).css("height", "0px"), $(l).css("position", "absolute"), $(l).css("top", n + "px"), $(l).css("left", o + "px"), r.appendChild(l), $(document).off("touchstart click", "#" + t + "_layer_draw_canvas"), $(document).on("touchmove mousemove", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { s = e.originalEvent.offsetX, d = e.originalEvent.offsetY; var a = document.getElementById(t + "_tmp_svg"); $(a).css("background-color", "rgba(255,0,0,0.6)"), $(a).css("width", s - o + "px"), $(a).css("height", d - n + "px"), $(a).css("position", "absolute"), $(a).css("top", n + "px"), $(a).css("left", o + "px") } else e.handled = !0 })), $(document).on("touchstart click", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { $(document).off("touchmove mousemove", "#" + t + "_layer_draw_canvas"), $(document).off("touchstart click", "#" + t + "_layer_draw_canvas"), s = e.originalEvent.offsetX, d = e.originalEvent.offsetY, $("#" + t + "_tmp_svg").remove(); var a = document.getElementById(t + "_mapcontainer"), r = a.getAttribute("data-current-layer"); a.setAttribute("data-current-tool", "navigator"), $("#" + t + "_layer_draw_canvas").css("cursor", "auto"), $("#" + t + "_layer_navigation").show(), $("#" + t + "_layer_draw").hide(); var l = $("#" + t + "_layer_" + i).find("iframe").contents().find("svg"), p = ""; p += "M" + o + "," + n, p += " " + s + "," + n, p += " " + s + "," + d, p += " " + o + "," + d, p += " " + o + "," + n, p += "z"; var m = document.createElementNS("http://www.w3.org/2000/svg", "path"); m.setAttribute("d", p), m.setAttribute("fill", "red"), l.append(m); var u, c = []; (u = {}).x = o, u.y = n, c.push(u), (u = {}).x = s, u.y = n, c.push(u), (u = {}).x = s, u.y = d, c.push(u), (u = {}).x = o, u.y = d, c.push(u), (u = {}).x = o, u.y = n, c.push(u), window["map_" + t + "_metadata"].layers[r].shapes.push(c) } else e.handled = !0 })) } else e.handled = !0 })) } function map_draw_pencil(t) { var e = document.getElementById(t + "_mapcontainer"); e.setAttribute("data-current-tool", "drawpencil"); var a = e.getAttribute("data-current-layer"); $("#" + t + "_layer_navigation").hide(); var r = document.getElementById(t + "_layer_draw_canvas"); $("#" + t + "_layer_draw").show(), $(r).css("cursor", "crosshair"), (new CanvasSVG.Deferred).wrapCanvas(r); var i = r.getContext("2d"); i.webkitImageSmoothingEnabled = !1, i.msImageSmoothingEnabled = !1, i.imageSmoothingEnabled = !1, $(document).on("touchstart mousedown pointerdown", "#" + t + "_layer_draw_canvas", (function (t) { t.stopPropagation(), t.preventDefault(), !0 !== t.handled ? (t.originalEvent.offsetX, t.originalEvent.offsetY, e.setAttribute("data-is-drawing", "true")) : t.handled = !0 })), $(document).on("touchend mouseup pointerup touchleave mouseleave pointerleave", "#" + t + "_layer_draw_canvas", (function (r) { if (r.stopPropagation(), r.preventDefault(), !0 !== r.handled) { if ("true" == e.getAttribute("data-is-drawing")) { e.setAttribute("data-is-drawing", "false"), e.setAttribute("data-current-tool", "navigator"), $("#" + t + "_layer_draw_canvas").css("cursor", "auto"), $("#" + t + "_layer_navigation").show(), $("#" + t + "_layer_draw").hide(); var o = $("#" + t + "_layer_" + a).find("iframe").contents().find("svg"), n = i.getSVG(); $(n).find("path").each((function () { o.append(this); for (var e = this.getAttribute("d").split(" "), r = [], i = 0; i < e.length;) { if ("M" == e[i] || "L" == e[i] || "z" == e[i]); else { var n = e[i].split(","), s = {}; s.x = n[0], s.y = n[1], r.push(s) } i++ } window["map_" + t + "_metadata"].layers[a].shapes.push(r) })) } } else r.handled = !0 })), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas", (function (t) { if (t.stopPropagation(), t.preventDefault(), !0 !== t.handled) { if ("true" == e.getAttribute("data-is-drawing")) { var a = t.originalEvent.offsetX, r = t.originalEvent.offsetY; i.beginPath(), i.rect(a, r, 2, 2), i.closePath(), i.fillStyle = "red", i.fill(), a, r } } else t.handled = !0 })) } function map_eraser_start(t) { map_autoselect_layer(t, "pixels"); var e = document.getElementById(t + "_map"), a = document.getElementById(t + "_mapcontainer"); a.setAttribute("data-show-mobiletoolbar", "false"), a.setAttribute("data-current-tool", "eraser"), map_deleteselection_stop(t), map_set_guide(t, map_lang_guide_eraser), $(e).draggable("disable"), $("#" + t + "_layer_navigation").hide(), $("#" + t + "_layer_draw").show(); var r = document.getElementById(t + "_layer_" + a.getAttribute("data-current-layer")), i = document.createElement("div"); i.setAttribute("class", "pseudocursor"), document.getElementById(t + "_layer_draw").appendChild(i), $("#" + t + "_layer_draw").css("cursor", "none"); var o = r.getElementsByTagName("canvas"), n = r.getElementsByTagName("img"); if (map_toolbars_place(), 1 == o.length && 1 == n.length) { var s = o[0], d = n[0]; s.setAttribute("width", d.getAttribute("width")), s.setAttribute("height", d.getAttribute("height")); var l = s.getContext("2d"); l.clearRect(0, 0, d.getAttribute("width"), d.getAttribute("height")), l.drawImage(d, 0, 0, d.getAttribute("width"), d.getAttribute("height")), l.webkitImageSmoothingEnabled = !1, l.msImageSmoothingEnabled = !1, l.imageSmoothingEnabled = !1, $(s).show(), $(d).hide(); var p = !1; $(document).off("touchstart pointerdown mousedown", "#" + t + "_layer_draw_canvas"), $(document).on("touchstart pointerdown mousedown", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = parseFloat(a.getAttribute("data-zoom-scale")); if (null == e.originalEvent.offsetX) var i = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), o = (e.originalEvent.touches[0].clientX - i.left) / r, n = (e.originalEvent.touches[0].clientY - i.top) / r; else o = e.originalEvent.offsetX, n = e.originalEvent.offsetY; p = !0, a.setAttribute("data-is-drawing", "true"); var d = { type: "delete_pixels" }; d.layer = a.getAttribute("data-current-layer"), d.data = s.toDataURL(), map_add_to_history(t, d); var m = parseInt(a.getAttribute("data-current-brushsize")), u = parseInt(a.getAttribute("data-current-brushsize")), c = o - m / 2, _ = n - u / 2; l.globalCompositeOperation = "destination-out", l.beginPath(), l.moveTo(o, n), l.rect(c, _, m, u), l.closePath(), l.fillStyle = "#c8c8c8", l.fill(), map_set_save_state(t, "savable", !1) } else e.handled = !0 })), $(document).off("touchend mouseup pointerup mouseleave", "#" + t + "_layer_draw_canvas"), $(document).on("touchend mouseup pointerup mouseleave", "#" + t + "_layer_draw_canvas", (function (t) { t.stopPropagation(), t.preventDefault(), !0 !== t.handled ? "true" == a.getAttribute("data-is-drawing") && 1 == p && (p = !1) : t.handled = !0 })), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = parseFloat(a.getAttribute("data-zoom-scale")); if (null == e.originalEvent.offsetX) var o = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), n = (e.originalEvent.touches[0].clientX - o.left) / r, s = (e.originalEvent.touches[0].clientY - o.top) / r; else n = e.originalEvent.offsetX, s = e.originalEvent.offsetY; var d = parseInt(a.getAttribute("data-current-brushsize")), m = parseInt(a.getAttribute("data-current-brushsize")), u = n - d / 2, c = s - m / 2; $(i).css("top", c), $(i).css("left", u), $(i).css("width", d), $(i).css("height", m), "true" == a.getAttribute("data-is-drawing") && 1 == p && (l.globalCompositeOperation = "destination-out", l.beginPath(), l.moveTo(n, s), l.rect(u, c, d, m), l.closePath(), l.fillStyle = "#c8c8c8", l.fill(), n, s) } else e.handled = !0 })) } else map_navigator(t), map_toolbars_place() } function map_eraser_stop(t) { var e = document.getElementById(t + "_mapcontainer"); $("#" + t + "_layer_navigation").show(), $("#" + t + "_layer_draw").hide(), $("#" + t + "_layer_draw").find("div.pseudocursor").remove(); var a = e.getAttribute("data-current-layer"); "walls" == a ? a = "basemap_walls" : "floor" == a && (a = "basemap_floor"); var r = document.getElementById(t + "_layer_" + a); if (1 == $(r).children("canvas").is(":visible")) { var i = r.getElementsByTagName("canvas")[0], o = r.getElementsByTagName("img")[0]; $(o).show(), $(i).hide(), o.src = i.toDataURL() } return e.setAttribute("data-is-drawing", "false"), $("#" + t + "_layer_draw").css("cursor", "auto"), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchend mouseup pointerup mouseleave", "#" + t + "_layer_draw_canvas"), $(document).off("touchstart pointerdown mousedown", "#" + t + "_layer_draw_canvas"), !0 } function map_deleteselection_start(t) { map_autoselect_layer(t, "pixels"); var e = document.getElementById(t + "_map"), a = document.getElementById(t + "_mapcontainer"); a.setAttribute("data-show-mobiletoolbar", "false"), a.setAttribute("data-current-tool", "deleteselection"), map_eraser_stop(t), map_set_guide(t, map_lang_guide_deleteselection), $("#" + t + "_layer_draw").css("cursor", "crosshair"), $(e).draggable("disable"), $("#" + t + "_layer_navigation").hide(), $("#" + t + "_layer_draw").show(); var r = document.getElementById(t + "_layer_" + a.getAttribute("data-current-layer")), i = r.getElementsByTagName("canvas"), o = r.getElementsByTagName("img"); if (1 == i.length && 1 == o.length) { var n = i[0], s = o[0]; n.setAttribute("width", s.getAttribute("width")), n.setAttribute("height", s.getAttribute("height")); var d, l, p, m, u, c, _ = n.getContext("2d"); _.clearRect(0, 0, s.getAttribute("width"), s.getAttribute("height")), _.drawImage(s, 0, 0, s.getAttribute("width"), s.getAttribute("height")), _.webkitImageSmoothingEnabled = !1, _.msImageSmoothingEnabled = !1, _.imageSmoothingEnabled = !1, $(n).show(), $(s).hide(); var g; $(document).off("touchstart pointerdown mousedown", "#" + t + "_layer_draw_canvas"), $(document).on("touchstart pointerdown mousedown", "#" + t + "_layer_draw_canvas", (function (e) { if (window.map_space_holding) return !0; if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = parseFloat(a.getAttribute("data-zoom-scale")); if (null == e.originalEvent.offsetX) var i = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), o = (e.originalEvent.touches[0].clientX - i.left) / r, s = (e.originalEvent.touches[0].clientY - i.top) / r; else o = e.originalEvent.offsetX, s = e.originalEvent.offsetY; a.setAttribute("data-is-drawing", "true"), (g = document.createElement("div")).setAttribute("class", "draw_square"), document.getElementById(t + "_layer_draw").appendChild(g); $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = parseFloat(a.getAttribute("data-zoom-scale")); if (null == e.originalEvent.offsetX) var i = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), n = (e.originalEvent.touches[0].clientX - i.left) / r, _ = (e.originalEvent.touches[0].clientY - i.top) / r; else n = e.originalEvent.offsetX, _ = e.originalEvent.offsetY; o < n ? (d = o, p = n) : (d = n, p = o), s < _ ? (l = s, m = _) : (l = _, m = s), d = Math.round(d), l = Math.round(l), p = Math.round(p), m = Math.round(m), u = p - d, c = m - l, "true" == a.getAttribute("data-is-drawing") && ($(g).css("opacity", .6), $(g).css("top", l), $(g).css("left", d), $(g).css("width", u), $(g).css("height", c)) } else e.handled = !0 })), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw_canvas"), $(document).on("touchend mouseup pointerup", "#" + t + "_layer_draw_canvas", (function (e) { if ($(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw_canvas"), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { var r = { type: "delete_pixels" }; r.layer = a.getAttribute("data-current-layer"), r.data = n.toDataURL(), map_add_to_history(t, r), _.globalCompositeOperation = "destination-out", _.beginPath(), _.rect(d, l, u, c), _.closePath(), _.fillStyle = "#c8c8c8", _.fill(), $("#" + t + "_layer_draw").find("div.draw_square").remove(), a.setAttribute("data-is-drawing", "false"), map_set_save_state(t, "savable", !1) } else e.handled = !0 })) } else e.handled = !0 })) } } function map_deleteselection_stop(t) { var e = document.getElementById(t + "_mapcontainer"); $("#" + t + "_layer_navigation").show(), $("#" + t + "_layer_draw").hide(), $("#" + t + "_layer_draw").find("div.draw_square").remove(), $("#" + t + "_layer_draw").css("cursor", "auto"); var a = e.getAttribute("data-current-layer"); "walls" == a ? a = "basemap_walls" : "floor" == a && (a = "basemap_floor"); var r = document.getElementById(t + "_layer_" + a); if (1 == $(r).children("canvas").is(":visible")) { var i = r.getElementsByTagName("canvas")[0], o = r.getElementsByTagName("img")[0]; $(o).show(), $(i).hide(), o.src = i.toDataURL() } (e = document.getElementById(t + "_mapcontainer")).setAttribute("data-is-drawing", "false"), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchend mouseup pointerup", "#" + t + "_layer_draw_canvas"), $(document).off("touchstart pointerdown mousedown", "#" + t + "_layer_draw_canvas") } function map_draw_path(t) { document.getElementById(t + "_mapcontainer").setAttribute("data-current-tool", "drawpath") } function map_settarget(t) { map_reset_mychoice(t), map_clean_tempshapes(t), map_itemselector_stop(t), map_itemeraser_stop(t); var e = document.getElementById(t + "_mapcontainer"); e.setAttribute("data-positioning-robot", "false"); var a = parseFloat(e.getAttribute("data-zoom-scale")), r = document.getElementById(t + "_layer_robot"); $(r).children("div.ghost").remove(); var i = document.getElementById(t + "_map"), o = document.getElementById(t + "_layer_draw_canvas"); $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), "settarget" == e.getAttribute("data-current-tool") ? ($(o).css("cursor", ""), map_navigator(t)) : (map_set_guide(t, map_lang_guide_settarget_a), e.setAttribute("data-current-tool", "settarget"), $("#" + t + "_layer_draw_canvas").parents(".layer").siblings(".layer").each((function () { var t = $(this); t.data("pointer-events", t.css("pointer-events")).css("pointer-events", "none") })), $(i).draggable("disable"), $("#" + t + "_layer_draw").show(), $(o).css("cursor", "crosshair"), $("#" + t + "_layer_navigation").hide(), $(document).on("touchstart pointerstart click", "#" + t + "_layer_draw_canvas", (function (i) { if ($(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), map_set_guide(t, map_lang_guide_settarget_b), i.stopPropagation(), i.preventDefault(), !0 !== i.handled) { if (null == i.originalEvent.offsetX) var o = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), n = (i.originalEvent.touches[0].clientX - o.left) / a, s = (i.originalEvent.touches[0].clientY - o.top) / a; else n = i.originalEvent.offsetX, s = i.originalEvent.offsetY; var d = document.createElement("div"); d.setAttribute("class", "ghost"), r.appendChild(d); var l = 0, p = 0; $(d).css("left", n + "px"), $(d).css("top", s + "px"), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { if (null == e.originalEvent.offsetX) { var r = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(); l = (e.originalEvent.touches[0].clientX - r.left) / a, p = (e.originalEvent.touches[0].clientY - r.top) / a } else l = e.originalEvent.offsetX, p = e.originalEvent.offsetY; var i = s - p, o = n - l, m = Math.atan2(i, o); m *= 180 / Math.PI, m -= 90, m += 180, $(d).css("WebkitTransform", "rotate(" + m + "deg)"), $(d).css("-moz-transform", "rotate(" + m + "deg)"), $(d).css("-ms-transform", "rotate(" + m + "deg)"), $(d).css("transform", "rotate(" + m + "deg)") } else e.handled = !0 })) } else i.handled = !0; $(document).on("touchend pointerend click", "#" + t + "_layer_draw_canvas", (function (a) { if (a.stopPropagation(), a.preventDefault(), !0 !== a.handled) { $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), null == a.originalEvent.offsetX || (l = a.originalEvent.offsetX, p = a.originalEvent.offsetY); var r = s - p, i = n - l, o = Math.atan2(r, i); o *= 180 / Math.PI; var m = o -= 90; o < -180 && (o += 360), m += 180, $(d).css("WebkitTransform", "rotate(" + m + "deg)"), $(d).css("-moz-transform", "rotate(" + m + "deg)"), $(d).css("-ms-transform", "rotate(" + m + "deg)"), $(d).css("transform", "rotate(" + m + "deg)"); var u = e.getAttribute("data-resscale"), c = e.getAttribute("data-origin-x"), _ = e.getAttribute("data-origin-y"), g = e.getAttribute("data-map-height"), h = n / parseFloat(u) + parseFloat(c) / parseFloat(u), f = (g - s) / parseFloat(u) + parseFloat(_) / parseFloat(u), v = {}; v.x = h, v.y = f, v.orientation = 90 - o, v.orientation < -180 ? v.orientation = v.orientation + 360 : v.orientation > 180 && (v.orientation = v.orientation - 360), calculated_pos_orientation = v.orientation, v.mode = "map-go-to-coordinates", $.ajax({ url: "/", data: v, method: "GET", dataType: "json", x: h, y: f, orientation: calculated_pos_orientation, success: function (t) { "question" == t.status && MIR.runtime.get_mission_queue_prompt((function () { map_go_to_coordinates(h, f, calculated_pos_orientation, !0) }), (function () { map_go_to_coordinates(h, f, calculated_pos_orientation, !1) })) } }), map_settarget(t) } else a.handled = !0 })) }))) } function map_go_to_coordinates(t, e, a, r) { var i = {}; return i.clearall = 1 == r ? "yes" : "no", i.x = t, i.y = e, i.orientation = a, i.mode = "map-go-to-coordinates", $.ajax({ url: "/", data: i, method: "GET", dataType: "json", x: t, y: e, orientation: a, success: function (t) { } }), !0 } function map_position_robot(t) { map_reset_mychoice(t); var e = document.getElementById(t + "_mapcontainer"); if ("true" == e.getAttribute("data-positioning-robot")) e.setAttribute("data-positioning-robot", "false"), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchend pointerend click", "#" + t + "_layer_draw_canvas"), map_clean_tempshapes(t), map_itemselector_stop(t), map_itemeraser_stop(t), map_navigator(t); else { map_clean_tempshapes(t), map_itemselector_stop(t), map_itemeraser_stop(t), map_navigator(t), e.setAttribute("data-current-tool", "position-robot"), $("#" + t + "_layer_draw_canvas").parents(".layer").siblings(".layer").each((function () { var t = $(this); t.data("pointer-events", t.css("pointer-events")).css("pointer-events", "none") })), e.setAttribute("data-show-mobiletoolbar", "false"), e.setAttribute("data-positioning-robot", "true"), map_set_guide(t, map_lang_guide_positionrobot_a), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchend pointerend click", "#" + t + "_layer_draw_canvas"); var a = parseFloat(e.getAttribute("data-zoom-scale")); $("#" + t + "_layer_navigation").hide(); var r = document.getElementById(t + "_layer_draw_canvas"); $("#" + t + "_layer_draw").show(), $(r).css("cursor", "crosshair"); var i = r.getContext("2d"); i.webkitImageSmoothingEnabled = !1, i.msImageSmoothingEnabled = !1, i.imageSmoothingEnabled = !1, $(document).on("touchstart pointerstart click", "#" + t + "_layer_draw_canvas", (function (o) { if (o.stopPropagation(), o.preventDefault(), !0 === o.handled) return !1; map_set_guide(t, map_lang_guide_positionrobot_b); var n = this.parentNode.parentNode.parentNode.parentNode.parentNode, s = (n.getAttribute("data-map-guid"), n.getAttribute("data-resscale")), d = n.getAttribute("data-origin-x"), l = n.getAttribute("data-origin-y"), p = n.getAttribute("data-map-height"); if (null == o.originalEvent.offsetX) var m = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), u = (o.originalEvent.touches[0].clientX - m.left) / a, c = (o.originalEvent.touches[0].clientY - m.top) / a; else u = o.originalEvent.offsetX, c = o.originalEvent.offsetY; var _ = 0, g = 0, h = document.getElementById(t + "_layer_robot_robot"); $(h).css("left", u + "px"), $(h).css("top", c + "px"), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 !== e.handled) { if (i.clearRect(0, 0, r.width, r.height), null == e.originalEvent.offsetX) { var o = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(); _ = (e.originalEvent.touches[0].clientX - o.left) / a, g = (e.originalEvent.touches[0].clientY - o.top) / a } else _ = e.originalEvent.offsetX, g = e.originalEvent.offsetY; var n = c - g, s = u - _, d = Math.atan2(n, s); d *= 180 / Math.PI, d -= 90, d += 180, $(h).css("WebkitTransform", "rotate(" + d + "deg)"), $(h).css("-moz-transform", "rotate(" + d + "deg)"), $(h).css("-ms-transform", "rotate(" + d + "deg)"), $(h).css("transform", "rotate(" + d + "deg)") } else e.handled = !0 })), $(document).on("touchend pointerend click", "#" + t + "_layer_draw_canvas", (function (a) { if (a.stopPropagation(), a.preventDefault(), !0 !== a.handled) { $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), $(document).off("touchend pointerend click", "#" + t + "_layer_draw_canvas"), null == a.originalEvent.offsetX || (_ = a.originalEvent.offsetX, g = a.originalEvent.offsetY); var r = c - g, i = u - _, o = Math.atan2(r, i); o *= 180 / Math.PI; var n = o -= 90; o < -180 && (o += 360), n += 180, $(h).css("WebkitTransform", "rotate(" + n + "deg)"), $(h).css("-moz-transform", "rotate(" + n + "deg)"), $(h).css("-ms-transform", "rotate(" + n + "deg)"), $(h).css("transform", "rotate(" + n + "deg)"); var m = u / parseFloat(s) + parseFloat(d) / parseFloat(s), f = (p - c) / parseFloat(s) + parseFloat(l) / parseFloat(s), v = {}; v.x = m, v.y = f, v.orientation = 90 - o, v.orientation < -180 ? v.orientation = v.orientation + 360 : v.orientation > 180 && (v.orientation = v.orientation - 360), $.ajax({ url: "/?mode=set-robot-position", data: v, method: "POST", dataType: "json", element_id: t, success: function (a) { $(h).hide(), map_navigator(t), $("#" + t + "_layer_draw").hide(), e.setAttribute("data-positioning-robot", "false"), map_clear_guide(t) } }) } else a.handled = !0 })), o.handled = !0 })) } } function map_draw_marker(t) { map_itemselector_stop(t), map_itemeraser_stop(t); var e = document.getElementById(t + "_mapcontainer"); return e.setAttribute("data-show-mobiletoolbar", "false"), map_position_dialogue(t, e.getAttribute("data-map-guid"), null, "marker"), !0 } function map_draw_position(t, e, a) { var r = document.getElementById(t + "_mapcontainer"); if ("true" == r.getAttribute("data-mapping")) { var i = r.getAttribute("data-map-guid"), o = {}; o.map_id = i, o.name = "", o.guid = "", o.orientation = robot_cur_degrees, o.pos_x = robot_cur_x, o.pos_y = robot_cur_y, o.type_id = 0, map_position_dialogue(t, i, o, "position") } else { map_itemselector_stop(t), map_itemeraser_stop(t), r.setAttribute("data-show-mobiletoolbar", "false"), r.setAttribute("data-current-tool", "drawposition"), r.setAttribute("data-positioning-robot", "false"), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), $("#" + t + "_layer_draw_canvas").parents(".layer").siblings(".layer").each((function () { var t = $(this); t.data("pointer-events", t.css("pointer-events")).css("pointer-events", "none") })); var n = document.getElementById(t + "_map"); parseFloat(r.getAttribute("data-zoom-scale")); $("#" + t + "_layer_navigation").hide(); var s = document.getElementById(t + "_layer_draw_canvas"); $("#" + t + "_layer_draw").show(), $(s).css("cursor", "crosshair"); var d = s.getContext("2d"); $(n).draggable("disable"), map_set_guide(t, map_lang_guide_drawposition_a), d.webkitImageSmoothingEnabled = !1, d.msImageSmoothingEnabled = !1, d.imageSmoothingEnabled = !1, $(document).on("touchstart pointerstart click", "#" + t + "_layer_draw_canvas", (function (i) { if (i.stopPropagation(), i.preventDefault(), !0 === i.handled) return !1; var o = this.parentNode.parentNode.parentNode.parentNode.parentNode, n = parseFloat(r.getAttribute("data-zoom-scale")), l = o.getAttribute("data-map-guid"), p = o.getAttribute("data-resscale"), m = o.getAttribute("data-origin-x"), u = o.getAttribute("data-origin-y"), c = o.getAttribute("data-map-height"); if (null == e || ($("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.position[data-guid='" + e + "']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + e + "']").hide()), null == i.originalEvent.offsetX) var _ = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(), g = (i.originalEvent.touches[0].clientX - _.left) / n, h = (i.originalEvent.touches[0].clientY - _.top) / n; else g = i.originalEvent.offsetX, h = i.originalEvent.offsetY; if (g > robot_pos_left - 10 && g < robot_pos_left + 10 && h < robot_pos_top + 10 && h > robot_pos_top - 10) $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), (f = {}).map_id = l, f.name = "", f.guid = "", f.orientation = robot_cur_degrees, f.pos_x = robot_cur_x, f.pos_y = robot_cur_y, f.type_id = 0, map_position_dialogue(t, l, f, "position"); else if (g > cart_pos_left - 10 && g < cart_pos_left + 10 && h < cart_pos_top + 10 && h > cart_pos_top - 10) { var f; $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), (f = {}).map_id = l, f.name = "", f.guid = "", f.orientation = cart_front_degrees, f.pos_x = cart_front_x, f.pos_y = cart_front_y, f.type_id = 1, map_position_dialogue(t, l, f, "position") } else { var v = 0, b = 0, y = document.getElementById(t + "_layer_positions"), w = document.createElement("img"); w.setAttribute("src", "/graphics/icon_mapposition_grey.svg"); var A = document.createElement("div"); A.setAttribute("class", "position"), A.setAttribute("id", "tmp_pos"), A.appendChild(w), y.appendChild(A), $(A).css("left", g + "px"), $(A).css("top", h + "px"), map_set_guide(t, map_lang_guide_drawposition_b), $(document).off("touchstart pointerstart click", "#" + t + "_layer_draw_canvas"), $(document).on("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas", (function (e) { d.clearRect(0, 0, s.width, s.height); var a = parseFloat(r.getAttribute("data-zoom-scale")); if (null == e.originalEvent.offsetX) { var i = document.getElementById(t + "_layer_draw_canvas").getBoundingClientRect(); v = (e.originalEvent.touches[0].clientX - i.left) / a, b = (e.originalEvent.touches[0].clientY - i.top) / a } else v = e.originalEvent.offsetX, b = e.originalEvent.offsetY; var o = h - b, n = g - v, l = Math.atan2(o, n); l *= 180 / Math.PI, l -= 90, $(w).css("WebkitTransform", "rotate(" + l + "deg)"), $(w).css("-moz-transform", "rotate(" + l + "deg)"), $(w).css("-ms-transform", "rotate(" + l + "deg)"), $(w).css("transform", "rotate(" + l + "deg)") })), $(document).on("touchend pointerend mouseup click", "#" + t + "_layer_draw_canvas", (function (r) { if (r.stopPropagation(), r.preventDefault(), !0 !== r.handled) { $(document).off("touchmove mousemove pointermove", "#" + t + "_layer_draw_canvas"), $(document).off("touchend pointerend mouseup click", "#" + t + "_layer_draw_canvas"); var i = h - b, o = g - v, n = Math.atan2(i, o); n *= 180 / Math.PI, (n -= 90) < -180 && (n += 360), $(w).css("WebkitTransform", "rotate(" + n + "deg)"), $(w).css("-moz-transform", "rotate(" + n + "deg)"), $(w).css("-ms-transform", "rotate(" + n + "deg)"), $(w).css("transform", "rotate(" + n + "deg)"); var s = g / parseFloat(p) + parseFloat(m) / parseFloat(p), d = (c - h) / parseFloat(p) + parseFloat(u) / parseFloat(p), _ = {}; _.map_id = l, _.name = null == e ? "" : a, _.guid = null == e ? "" : e, _.pos_x = s, _.pos_y = d, _.orientation = 90 - n, _.orientation < -180 ? _.orientation = _.orientation + 360 : _.orientation > 180 && (_.orientation = _.orientation - 360), _.orientation = number_format(_.orientation, 3, ".", ""), _.pos_x = number_format(_.pos_x, 3, ".", ""), _.pos_y = number_format(_.pos_y, 3, ".", ""), $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.position[data-guid='" + e + "']").attr("data-type-id") ? _.type_id = $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.position[data-guid='" + e + "']").attr("data-type-id") : $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + e + "']").attr("data-type-id") ? _.type_id = $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + e + "']").attr("data-type-id") : _.type_id = 0, $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + e + "']").attr("data-parent-id") ? _.parent_id = $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + e + "']").attr("data-parent-id") : _.parent_id = "", map_position_dialogue(t, l, _, "position"), null == e || ($("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.position[data-guid='" + e + "']").show(), $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + e + "']").show()) } else r.handled = !0 })) } i.handled = !0 })) } } function map_layercontrol_toggle_view(t, e) { var a = document.getElementById(t + "_maplayercontroller_viewcontrol_" + e), r = document.getElementById(t + "_layer_" + e), i = document.getElementById(t + "_layer_robotmap"), o = document.getElementById(t + "_maplayercontroller_viewcontrol_robotmap"); if ("robotmap" == e && "false" == a.getAttribute("data-active")) window["map_" + t + "_visible_layers"] = [], $("#" + t + "_maplayercontroller > tr.layercontrollerrow").not("[data-systemname='robotmap']").each((function () { var e = $(this).attr("data-systemname"), a = $(this).find("td").first().find("div.view"); "true" == $(a).attr("data-active") && window["map_" + t + "_visible_layers"].push(e), $("#" + t + "_layer_" + e).hide(), document.getElementById(t + "_maplayercontroller_viewcontrol_" + e).setAttribute("data-active", "false") })), $(i).show(), o.setAttribute("data-active", "true"); else if ("robotmap" == e && "true" == a.getAttribute("data-active")) { $(i).hide(), o.setAttribute("data-active", "false"); for (var n = 0; n < window["map_" + t + "_visible_layers"].length;)$("#" + t + "_layer_" + window["map_" + t + "_visible_layers"][n]).show(), document.getElementById(t + "_maplayercontroller_viewcontrol_" + window["map_" + t + "_visible_layers"][n]).setAttribute("data-active", "true"), n++ } else { "true" == a.getAttribute("data-active") ? (a.setAttribute("data-active", "false"), $(r).hide()) : (a.setAttribute("data-active", "true"), $(r).show()); var s = 0; $("#" + t + "_maplayercontroller > tr.layercontrollerrow").not("[data-systemname='robotmap']").each((function () { var t = $(this).find("td").first().find("div.view"); "true" == $(t).attr("data-active") && s++ })), 0 == s ? ($(i).show(), o.setAttribute("data-active", "true")) : ($(i).hide(), o.setAttribute("data-active", "false")), window["map_" + t + "_visible_layers"] = [], $("#" + t + "_maplayercontroller > tr.layercontrollerrow").not("[data-systemname='robotmap']").each((function () { var e = $(this).attr("data-systemname"), a = $(this).find("td").first().find("div.view"); "true" == $(a).attr("data-active") && window["map_" + t + "_visible_layers"].push(e) })) } var d = {}; return d["map_" + t + "_visible_layers"] = window["map_" + t + "_visible_layers"], $.post("/?mode=set-runtime-settings", d, (function (t) { })), !0 } function map_layercontrol_set_layer(t, e) { document.getElementById(t + "_mapcontainer").setAttribute("data-current-layer", e), $("#" + t + "_maplayercontroller > tr.layercontrollerrow").attr("data-active", "false"), $("#" + t + "_maplayercontroller > tr[data-systemname='" + e + "'].layercontrollerrow").attr("data-active", "true") } function map_add_layercontrol(t, e, a, r, i, o) { var n = !0; "object" == typeof window["map_" + t + "_visible_layers"] ? -1 == window["map_" + t + "_visible_layers"].indexOf(r) && (n = !1) : n = !1; var s = window["map_" + t + "_layercount"] + 1, d = document.getElementById(t + "_mapcontainer"), l = document.getElementById(t + "_maplayercontroller"), p = (document.getElementById(t + "_maplayercontroller_layer_toprow"), document.createElement("tr")); p.setAttribute("class", "layercontrollerrow"), p.setAttribute("data-systemname", r), p.setAttribute("id", t + "_maplayercontroller_layer_row_" + s), 1 == s ? l.appendChild(p) : l.insertBefore(p, document.getElementById(t + "_maplayercontroller_layer_row_" + (s - 1))); var m, u = document.createElement("div"); u.setAttribute("class", "view"), u.setAttribute("id", t + "_maplayercontroller_viewcontrol_" + r), 1 == n ? u.setAttribute("data-active", "true") : u.setAttribute("data-active", "false"), u.innerHTML = "<span>View</span>", u.onclick = function () { map_layercontrol_toggle_view(t, r) }, (m = document.createElement("td")).appendChild(u), p.appendChild(m), (m = document.createElement("td")).innerHTML = 1 == o ? '<div class="edit" onclick="map_layercontrol_set_layer(\'' + t + "','" + r + "');\"><span>Edit</span></div>\n" : '<div class="lock"><span>Edit</span></div>\n', p.appendChild(m), (m = document.createElement("td")).innerHTML = "<div>" + a + "</div>\n", p.appendChild(m), 1 == o && ($("#" + t + "_maplayercontroller > tr.layercontrollerrow").attr("data-active", "false"), $(p).attr("data-active", "true"), d.setAttribute("data-current-layer", r)), window["map_" + t + "_layercount"] = s, 1 == n ? $("#" + t + "_layer_" + r).show() : $("#" + t + "_layer_" + r).hide() } function map_toolbutton_trigger_init(t) { var e = document.getElementById(t).getAttribute("data-call"), a = document.getElementById(t).getAttribute("data-args"); $(document).on("touchstart click", "#" + t, (function (t) { if (t.stopPropagation(), t.preventDefault(), !0 === t.handled) return !1; window[e].apply(this, a.split(";")), t.handled = !0 })) } function map_init_choice_selector(t) { if (area_events.areas.length <= 0) setTimeout((function () { map_init_choice_selector(t) }), 500); else { var e = $("#" + t + "_toolbutton_mychoice_selector"); e.length > 0 && e.selectmenu({ width: 230, position: { collision: "flip" }, create: function (t, e) { $("#" + this.id + "-button").children("span.colorholder").remove(); var a = document.createElement("span"); a.setAttribute("class", "colorholder"), document.getElementById(this.id + "-button").appendChild(a) }, select: function (e, a) { map_set_mychoice(t) }, open: function (e, a) { $("ul#" + t + "_toolbutton_mychoice_selector-menu").children("li").each((function (e) { this.setAttribute("data-value", document.getElementById(t + "_toolbutton_mychoice_selector").options[e].value); var a = document.getElementById(t + "_toolbutton_mychoice_selector").options[e].value, r = $(this).children("div").text(), i = document.createElement("div"); $(i).addClass("colordot"); var o = area_events.getAreaColor(a); if ("object" == typeof o) { var n = { "background-color": "rgba(" + o.rgb_string + ", 0.8)", border: "1px solid rgba(" + o.rgb_string + ")" }; $(i).css(n) } var s = document.createElement("div"); $(s).addClass("name"), $(s).text(r), $(this).children("div").html(""), $(this).children("div").prepend($(i)), $(this).children("div").append($(s)) })) } }) } } MIR.constants.MAP = { world: { REAL: 0, MAP: 1, VIEWPORT: 2, DOM: 3 }, state: { MAPPING: 0, FINALIZING: 1, ROTATING: 2, APPENDING: 3, READY: 4 }, tools: { SELECTOR: "itemselector", NAVIGATOR: "navigator", DELETE: "itemeraser", POSITION: "drawposition" }, choice_layers: { walls: "walls", positions: "positions", markers: "positions", floors: "floor", oneway: "oneway", preferred: "areaprefs_preferred", unpreferred: "areaprefs_unpreferred", forbidden: "areaprefs_forbidden", critical: "areaprefs_critical", blink: "areaevents_blink" } }; var robots_fetched, area_events = !1; function updateMapZones(t, e) { var a = { mode: "get-map-data" }; a.id = e, a.pageviewid = pageviewid, $.get("/", a, (function (e) { window["map_" + t + "_metadata"].layers = e.metadata.layers, area_events.setWindowLayers(t), MIR.runtime.layers[t] = window["map_" + t + "_metadata"].layers })) } function map_init(t, e, a, r, i, o) { if (!1 === area_events && (area_events = new MIR.components.areaEvents).init().then((function () { $.extend(MIR.constants.MAP.choice_layers, area_events.parsedAreas) })), area_events.loaded) { var n = document.getElementById(t + "_mapcontainer"), s = (document.getElementById(t + "_map"), $("#" + t + "_map")), d = n.getAttribute("data-current-tool"); map_init_choice_selector(t); var l, p, m = $(n); if ($.extend(m, { mir: { $container: m, $holder: m.find(".mapholder"), $map: m.find(".map"), config: { CLICK_AREA_SIZE: 2 }, is_locked: function () { return "true" === this.$container.attr("data-locked") }, is_rotating: function () { return "true" === this.$container.attr("data-rotating") }, is_editable: function () { return "true" === this.$container.attr("data-drawable") }, is_robot_centered: function () { return "true" === this.$container.attr("data-center-robot") }, get_tool: function () { return this.$container.attr("data-current-tool") }, get_zoom: function () { return parseFloat(this.$container.attr("data-zoom-scale")) }, get_guid: function () { return this.$container.attr("data-map-guid") }, get_element_id: function () { return this.$container.attr("data-element-id") }, get_viewport_size: function () { return { width: this.$holder.width(), height: this.$holder.height() } }, get_map_size: function () { return { width: this.$container.attr("data-map-width"), height: this.$container.attr("data-map-height") } }, set_map_cursor: function (t) { this.$container.find(".mapholder").css("cursor", t) }, choice2layer: function (t) { return MIR.constants.MAP.choice_layers[t] }, layer2choice: function (t) { for (var e in MIR.constants.MAP.choice_layers) if (MIR.constants.MAP.choice_layers[e] === t) return e }, get_chosen_layer: function () { var t = this.$container.attr("data-mychoice"); return this.choice2layer(t) }, dom_to_view: function (t) { var e = this.$holder.offset(); return { x: t.x - e.left, y: t.y - e.top } }, view_to_map: function (t) { var e = this.$map.position(), a = this.get_zoom(); return { x: (t.x - e.left) / a, y: (t.y - e.top) / a } }, dom_to_map: function (t) { return this.convert_coords(t, MIR.constants.MAP.world.DOM, MIR.constants.MAP.world.MAP) }, get_origin: function () { return { x: this.$container.attr("data-origin-x"), y: this.$container.attr("data-origin-y") } }, get_scale: function () { return this.$container.attr("data-resscale") }, real_to_map: function (t) { var e = this.get_scale(), a = this.get_origin(), r = this.get_map_size(); return { x: t.x * e - a.x, y: r.height - (t.y * e - a.y) } }, map_to_viewport: function (t) { var e = this.get_zoom(), a = this.get_map_offset(); return { x: t.x * e + a.left, y: t.y * e + a.top } }, get_map_offset: function () { return { left: parseFloat(this.$container.attr("data-zoom-offset-left")), top: parseFloat(this.$container.attr("data-zoom-offset-top")) } }, set_map_offset: function (t, e) { if (this.$container.attr({ "data-zoom-offset-left": t.left, "data-zoom-offset-top": t.top }), this.$map.css({ top: t.top + "px", left: t.left + "px" }), e) { var a = this.get_storage_id(); MIR.storage.set(a, "data-zoom-offset-left", t.left), MIR.storage.set(a, "data-zoom-offset-top", t.top) } }, get_storage_id: function () { return this.$container.attr("alt-id") ? this.$container.attr("alt-id") + "_" + this.get_guid() : this.get_element_id() + "_mapcontainer_" + this.get_guid() }, get_saved_parameters: function () { var t = this.get_storage_id(); return { zoom: MIR.storage.get(t, "data-zoom-scale"), offset_left: MIR.storage.get(t, "data-zoom-offset-left"), offset_top: MIR.storage.get(t, "data-zoom-offset-top") } }, get_click_area: function (t, e) { var a = MIR.constants.MAP.world, r = this.convert_coords(t, a.DOM, a.MAP), i = Math.max(e || 0, this.config.CLICK_AREA_SIZE) / this.get_zoom(); return { top_left: { x: r.x - i, y: r.y - i }, bottom_right: { x: r.x + i, y: r.y + i } } }, get_position_sizing: function (t) { $pos = this.$container.find(".position:first"); var e = parseFloat(90 - t.orientation).toFixed(2); $pos.css("transform", "rotate(0deg)"); var a = Math.abs($pos.outerWidth()); return $pos.css("transform", "rotate(" + e + "deg)"), a }, get_position_type: function (t) { return MIR.runtime.position_types.find((function (e) { return e.id == t })) }, convert_coords: function (t, e, a) { var r, i = this; if (void 0 === e || void 0 === a) throw new Error("Worlds are undefined."); if (e < a) r = [this.real_to_map, this.map_to_viewport, function (t) { return t }].slice(e, a); else { if (!(e > a)) return t; r = [function (t) { return t }, this.view_to_map, this.dom_to_view].slice(a, e).reverse() } return $.each(r, (function (e, a) { t = a.call(i, t) })), t }, center_coords: function (t, e, a) { var r = this, i = this.convert_coords(t, e, MIR.constants.MAP.world.VIEWPORT), o = this.get_viewport_size(), n = this.get_map_offset(), s = { left: n.left - i.x + o.width / 2, top: n.top - i.y + o.height / 2 }; a = $.extend({ callback: !1, interval: 200 }, a), this.$map.finish().animate({ top: s.top + "px", left: s.left + "px" }, { easing: "linear", duration: a.interval, complete: function () { r.set_map_offset(s, !0), map_update_handles(r.get_element_id()), "function" == typeof a.callback && a.callback() } }) } } }), $.extend(!0, MIR.runtime, { maps: {}, get_mission_queue_prompt: function (t, e) { var a = new MIR.ui.prompt({ headline: mir_translate("Clear mission queue?"), message: mir_translate("The mission queue is not empty. Do you want to clear it?"), buttons: [new MIR.ui.button({ label: mir_translate("Clear and queue"), attr: { class: "mir-red" }, events: { click: function () { t(), a.mir.$overlay.remove() } } }), new MIR.ui.button({ label: mir_translate("Append"), attr: { class: "mir-green" }, events: { click: function () { e(), a.mir.$overlay.remove() } } })] }) } }), MIR.runtime.maps[t] = m, void 0 === MIR.runtime.position_types && (MIR.runtime.position_types = null, $.getJSON("/?mode=get-data&endpoint=/position_types?only_data=true", (function (t) { MIR.runtime.position_types = t.results }))), $(window).keydown((function (e) { if (e.keyCode == MIR.ui.constants.KEY_SPACE) { var a = !1; if ($(document.activeElement).is("input") && (a = !0), !window.map_space_holding && !a && (window.map_space_holding = !0, 0 == $("#" + t + "_mapdialogscreen:visible").length && 0 === $(".mir-overlay").length && 0 === $(".mapsettings_overlay:visible").length)) { e.preventDefault(); var r = n.getAttribute("data-rotating"), i = $("#" + t + "_layer_robotmap"); l = s.css("cursor"), p = m.attr("data-current-tool"), m.attr("data-current-tool", "navigator"), $("#" + t + "_mapdrawer").data("was-visible", $("#" + t + "_mapdrawer").is(":visible")).hide(), "true" == r && (s.children().hide(), i.show()), s.data("draggable", s.draggable("option", "disabled")).draggable("enable").css("cursor", "move").find("*").each((function (t, e) { var a = $(e); a.data("pointer-events", a.css("pointer-events")).css("pointer-events", "").data("cursor", a.css("cursor")).css("cursor", "inherit") })) } } if (e.keyCode == MIR.ui.constants.KEY_SHIFT) { window.map_shift_holding = !0; var o = n.getAttribute("data-current-tool"); ("shapedrawer" == o || "linedrawer" == o) && window[t + "_localpoints"].length > 0 && map_draw_helpline(t, !0) } if ("true" == m.attr("data-appendmode") && e.keyCode > 36 && e.keyCode < 41) { e.preventDefault(); var d = m.find(".appendee.ui-draggable"), u = Number(d.attr("data-pos-x")), c = Number(d.attr("data-pos-y")); switch (e.keyCode) { case 37: u -= 1; break; case 39: u += 1; break; case 38: c -= 1; break; case 40: c += 1 }d.attr("style", "left: " + u + "px; top:" + c + "px; width: " + d.attr("data-width") + "px; height: " + d.attr("data-height") + "px;"), d.attr({ "data-pos-x": u, "data-pos-y": c }) } })), $(window).keyup((function (e) { if (e.keyCode == MIR.ui.constants.KEY_SPACE && (window.map_space_holding = !1, 0 == $("#" + t + "_mapdialogscreen:visible").length && 0 === $(".mir-overlay").length && 0 === $(".mapsettings_overlay:visible").length)) { (n.getAttribute("data-selected-shape").length > 0 || "linedrawer" == d || "shapedrawer" == d) && map_update_handles(t), $("#" + t + "_mapdrawer").data("was-visible") && $("#" + t + "_mapdrawer").show(); var a = n.getAttribute("data-rotating"), r = $("#" + t + "_layer_robotmap"), i = $("#" + t + "_layer_draw"); "true" == a && (r.show(), i.show()), m.attr("data-current-tool", p), s.css("cursor", l).children().css("cursor", "") } e.keyCode == MIR.ui.constants.KEY_SHIFT && (window.map_shift_holding = !1, map_clean_helpline(t)) })), window["map_" + t + "_last_mouse_x"] = 0, window["map_" + t + "_last_mouse_y"] = 0, window["map_" + t + "_hitpoint"] = !1, $(document).on("mousemove", "#" + t + "_mapdrawer", (function (e) { if (null == e.originalEvent.offsetX) { var a = document.getElementById(t + "_mapdrawer").getBoundingClientRect(); window["map_" + t + "_last_mouse_x"] = e.originalEvent.touches[0].clientX - a.left, window["map_" + t + "_last_mouse_y"] = e.originalEvent.touches[0].clientY - a.top } else window["map_" + t + "_last_mouse_x"] = e.originalEvent.offsetX, window["map_" + t + "_last_mouse_y"] = e.originalEvent.offsetY })), map_toolbars_place(), $("#" + t + "_maplayercontroller").find(".layercontrollerrow").remove(), $("#" + t + "_map").find(".layer").remove(), "false" == n.getAttribute("data-initializing")) { n.setAttribute("data-initializing", "true"); var u = { mode: "get-map-data" }; u.id = e, u.pageviewid = pageviewid, $.get("/", u, (function (s) { var d = !0, l = $("#" + t + "_toolbutton_mychoice_selector").attr("areaevents-edit-allowed"), p = $("#" + t + "_toolbutton_mychoice_selector").attr("positions-edit-allowed"); -1 == s.allowed_methods.indexOf("PUT") ? (d = !1, n.setAttribute("data-allow-edit", "false")) : n.setAttribute("data-allow-edit", "true"), $("#" + t + "_toolbutton_mychoice_selector").children("option").each((function () { var t = this.getAttribute("value"), e = MIR.constants.MAP.choice_layers[t]; "markers" != t && "positions" != t || 1 == p || $(this).remove(), (("walls" == t || "floors" == t || "oneway" == t) && 1 != d || void 0 !== e && e.indexOf("areaprefs_") > -1 && 1 != d) && $(this).remove(), void 0 !== e && e.indexOf("areaevents_") > -1 && 1 != l && $(this).remove() })), -1 == s.allowed_methods.indexOf("DELETE") ? n.setAttribute("data-allow-delete", "false") : n.setAttribute("data-allow-delete", "true"); var u = s.metadata; n.setAttribute("data-custommap", s.custommap), window["map_" + t + "_metadata"] = s.metadata, area_events.setWindowLayers(t), $.extend(!0, MIR.runtime, { layers: {} }), MIR.runtime.layers[t] = window["map_" + t + "_metadata"].layers; var c = s.resolution, _ = 1 / c, g = u.width, h = u.height, f = 1 / c * s.origin_x, v = 1 / c * s.origin_y; n.setAttribute("data-resolution", c), n.setAttribute("data-resscale", _), n.setAttribute("data-origin-x", f), n.setAttribute("data-origin-y", v); var b = document.getElementById(t + "_map"), y = (document.getElementById(t + "_mapdrawer"), new Date), w = document.createElement("img"); w.setAttribute("src", "/?mode=get-map&calltype=light&id=" + e + "&t=" + Math.floor(y.getTime() / 1e3)), w.setAttribute("data-elementid", t), w.setAttribute("data-mapid", e), w.setAttribute("id", t + "_real_robotmap"); var A = document.createElement("div"); A.setAttribute("class", "layer"), A.appendChild(w), A.setAttribute("id", t + "_layer_robotmap"), A.setAttribute("data-layertype", "robotmap"), b.appendChild(A), map_add_layercontrol(t, e, "Robot map", "robotmap", !0, !1); y = new Date; var E = document.createElement("img"); E.setAttribute("width", g), E.setAttribute("height", h), E.setAttribute("id", t + "_real_basemap_floor_img"), E.setAttribute("src", "data:image/png;base64, " + u.base_map_floor); var x = document.createElement("canvas"); x.setAttribute("id", t + "_real_basemap_floor"); x.getContext("2d"); $(x).hide(); var I = document.createElement("div"); I.setAttribute("class", "layer"), I.setAttribute("id", t + "_layer_basemap_floor"), I.setAttribute("data-layertype", "basemap"), I.appendChild(x), I.appendChild(E), b.appendChild(I), map_add_layercontrol(t, e, "Base map floor", "basemap_floor", !0, !0); var B = document.createElement("div"); B.setAttribute("class", "layer"), B.setAttribute("id", t + "_layer_floor"), B.setAttribute("style", "width: " + g + "px; height: " + h + "px"), b.appendChild(B); var M = document.createElement("iframe"); M.setAttribute("src", "/?calltype=light&mode=map-get-svg&pageviewid=" + pageviewid + "&id=" + e + "&layer=floor&eid=" + t), M.setAttribute("width", g), M.setAttribute("height", h), M.setAttribute("frameborder", 0), M.setAttribute("scrolling", "no"), M.setAttribute("id", t + "_layer_floor_svg"), M.setAttribute("data-element-id", t), B.appendChild(M), map_add_layercontrol(t, e, "Floors", "floor", !0, !0); var C = document.createElement("div"); C.setAttribute("class", "layer"), C.setAttribute("id", t + "_layer_oneway"), b.appendChild(C); var k = document.createElement("iframe"); k.setAttribute("src", "/?calltype=light&mode=map-get-svg&pageviewid=" + pageviewid + "&id=" + e + "&layer=oneway&eid=" + t), k.setAttribute("width", g), k.setAttribute("height", h), k.setAttribute("frameborder", 0), k.setAttribute("scrolling", "no"), k.setAttribute("data-element-id", t), C.appendChild(k); var T = []; T.push("preferred"), T.push("unpreferred"), T.push("forbidden"), T.push("critical"); for (var z = 0; z < T.length;) { var R = document.createElement("div"); R.setAttribute("class", "layer"), R.setAttribute("id", t + "_layer_areaprefs_" + T[z]), b.appendChild(R); var L = document.createElement("iframe"); L.setAttribute("src", "/?calltype=light&mode=map-get-svg&pageviewid=" + pageviewid + "&id=" + e + "&layer=areaprefs_" + T[z] + "&eid=" + t), L.setAttribute("width", g), L.setAttribute("height", h), L.setAttribute("frameborder", 0), L.setAttribute("scrolling", "no"), L.setAttribute("data-element-id", t), R.appendChild(L), map_add_layercontrol(t, e, capitalize(T[z]), "areaprefs_" + T[z], !0, !0), z++ } area_events.areas.forEach((function (a) { var r = document.createElement("div"); r.setAttribute("class", "layer"), r.setAttribute("id", t + "_layer_areaevents_" + a.legacyName), b.appendChild(r); var i = new Date, o = document.createElement("iframe"); o.setAttribute("src", "/?calltype=light&mode=map-get-svg&pageviewid=" + pageviewid + "&id=" + e + "&layer=areaevents_" + a.legacyName + "&eid=" + t + "&s=" + i.getTime()), o.setAttribute("width", g), o.setAttribute("height", h), o.setAttribute("frameborder", 0), o.setAttribute("scrolling", "no"), o.setAttribute("data-element-id", t), r.appendChild(o), map_add_layercontrol(t, e, a.name, "areaevents_" + a.legacyName, !0, !0) })); var F = document.createElement("div"); F.setAttribute("class", "layer"), F.setAttribute("id", t + "_layer_paths"), F.setAttribute("style", "width: " + g + "px; height: " + h + "px"), b.appendChild(F); var P = document.createElement("iframe"); P.setAttribute("src", "/?calltype=light&mode=map-get-svg&pageviewid=" + pageviewid + "&id=" + e + "&layer=paths&eid=" + t), P.setAttribute("width", g), P.setAttribute("height", h), P.setAttribute("frameborder", 0), P.setAttribute("scrolling", "no"), P.setAttribute("id", t + "_layer_paths_svg"), P.setAttribute("data-element-id", t), F.appendChild(P), map_add_layercontrol(t, e, "Paths", "paths", !0, !0); var S = document.createElement("img"); S.setAttribute("id", t + "_gridmap"), S.setAttribute("data-element-id", t); var N = document.createElement("div"); N.setAttribute("class", "layer"), N.setAttribute("id", t + "_layer_gridmap"), N.setAttribute("data-layertype", "gridmap"), N.appendChild(S), b.appendChild(N), map_add_layercontrol(t, e, "Grid map", "gridmap", !0, !1); var D = document.createElement("img"); D.setAttribute("width", g), D.setAttribute("height", h), D.setAttribute("id", t + "_real_basemap_walls_img"), D.setAttribute("src", "data:image/png;base64, " + u.base_map_walls); var H = document.createElement("canvas"); H.setAttribute("id", t + "_real_basemap_walls"); H.getContext("2d"); $(H).hide(); var O = document.createElement("div"); O.setAttribute("class", "layer"), O.setAttribute("id", t + "_layer_basemap_walls"), O.setAttribute("data-layertype", "basemap"), O.appendChild(H), O.appendChild(D), b.appendChild(O), map_add_layercontrol(t, e, "Base map walls", "basemap_walls", !0, !0); var X = document.createElement("div"); X.setAttribute("class", "layer"), X.setAttribute("id", t + "_layer_walls"), X.setAttribute("style", "width: " + g + "px; height: " + h + "px"), b.appendChild(X); var j = document.createElement("iframe"); j.setAttribute("src", "/?calltype=light&mode=map-get-svg&pageviewid=" + pageviewid + "&id=" + e + "&layer=walls&eid=" + t), j.setAttribute("width", g), j.setAttribute("height", h), j.setAttribute("frameborder", 0), j.setAttribute("scrolling", "no"), j.setAttribute("data-element-id", t), X.appendChild(j), map_add_layercontrol(t, e, "Walls", "walls", !0, !0); var Y = document.createElement("img"); Y.setAttribute("id", t + "_laserscans"), Y.setAttribute("data-element-id", t); var q = document.createElement("div"); q.setAttribute("class", "layer"), q.setAttribute("id", t + "_layer_laserscans"), q.setAttribute("data-layertype", "laserscans"), q.appendChild(Y), b.appendChild(q), map_add_layercontrol(t, e, "Laser scans", "laserscans", !0, !1); var G = document.createElement("div"); G.setAttribute("class", "layer"), G.setAttribute("data-layertype", "path"), G.setAttribute("id", t + "_layer_path"); var W = document.createElementNS("http://www.w3.org/2000/svg", "svg"); W.setAttribute("id", "layer_path_svg_" + t), W.setAttribute("x", "0px"), W.setAttribute("y", "0px"), W.setAttribute("width", g + "px"), W.setAttribute("height", h + "px"), W.setAttribute("viewbox", "0 0 " + g + " " + h), W.setAttribute("version", "1.1"), W.setAttribute("xml:space", "preserve"); var V = document.createElementNS("http://www.w3.org/2000/svg", "polyline"); V.setAttribute("id", "robot_path_points_" + t), V.setAttribute("polygon", ""), V.setAttribute("fill", "none"), V.setAttribute("stroke-width", "3"), V.setAttribute("stroke-linejoin", "round"), V.setAttribute("stroke-linecap", "round"), V.setAttribute("stroke-dasharray", "0, 8"), V.setAttribute("stroke", "#004771"), W.appendChild(V), G.appendChild(W), b.appendChild(G), map_add_layercontrol(t, e, "Path", "path", !0, !1); var U = document.createElement("div"); U.setAttribute("class", "layer"), U.setAttribute("data-layertype", "positions"), U.setAttribute("id", t + "_layer_positions"), U.setAttribute("style", "width: " + g + "px; height: " + h + "px"), b.appendChild(U), map_add_layercontrol(t, e, "Positions", "positions", !0, !1); var K = document.createElement("div"); K.setAttribute("class", "layer"), K.setAttribute("data-layertype", "mapping"), K.setAttribute("id", t + "_layer_mapping"), b.appendChild(K); var J = document.createElement("div"); J.setAttribute("class", "robot"), J.setAttribute("id", t + "_layer_robot_robot"); var Z = $(document.createElementNS("http://www.w3.org/2000/svg", "polygon")).attr({ transform: "rotate(90), translate(15 -15), scale(1,-1)" }), Q = $(document.createElementNS("http://www.w3.org/2000/svg", "svg")).attr({ id: t + "_layer_footprint_footprint", class: "footprint" }).append(Z), tt = document.createElement("div"); tt.setAttribute("class", "cart"), tt.setAttribute("id", t + "_layer_cart_cart"); var et = document.createElement("div"); et.setAttribute("class", "layer"), et.setAttribute("data-layertype", "robot"), et.setAttribute("id", t + "_layer_robot"), et.setAttribute("style", "width: " + g + "px; height: " + h + "px"), et.appendChild(J), et.appendChild(Q[0]), et.appendChild(tt), b.appendChild(et), map_add_layercontrol(t, e, "Robot", "robot", !0, !1); var at = document.createElement("div"); at.setAttribute("class", "layer"), at.setAttribute("data-layertype", "tmpsvg"), at.setAttribute("id", t + "_layer_tmpsvg"), b.appendChild(at); var rt = document.createElement("canvas"); rt.setAttribute("id", t + "_layer_draw_canvas"), rt.setAttribute("width", g), rt.setAttribute("height", h); var it = document.createElement("div"); it.setAttribute("class", "layer"), it.setAttribute("data-layertype", "draw"), it.setAttribute("id", t + "_layer_draw"), it.appendChild(rt), b.appendChild(it); var ot = document.createElement("div"); ot.setAttribute("class", "layer"), ot.setAttribute("data-layertype", "patheditor"), ot.setAttribute("id", t + "_layer_patheditor"), b.appendChild(ot), w.onload = function () { if ("&silent=true" == this.getAttribute("src").slice(-12)); else { map_start_pathmap(this.getAttribute("data-elementid")); var t = document.getElementById(this.getAttribute("data-elementid") + "_mapcontainer"); t.setAttribute("data-map-width", this.width), t.setAttribute("data-map-height", this.height); var e = this.getAttribute("data-mapid"), n = this.getAttribute("data-elementid"); map_set_mychoice(n); var s = { mode: "get-map-positions", calltype: "light" }; s.id = e, $.ajax({ mapid: e, elementid: n, url: "/", data: s, method: "GET", dataType: "json", success: function (e) { for (var s = document.getElementById(this.elementid + "_mapcontainer"), d = document.getElementById(this.elementid + "_layer_positions"), l = s.getAttribute("data-resscale"), p = s.getAttribute("data-origin-x"), u = s.getAttribute("data-origin-y"), c = s.getAttribute("data-map-height"), _ = 0; _ < e.length;) { e[_].pos_left = e[_].pos_x * l - p, e[_].pos_top = c - (e[_].pos_y * l - u); var g = document.createElement("div"); g.setAttribute("class", "position"), g.setAttribute("data-guid", e[_].guid), g.setAttribute("data-type-id", e[_].type_id), g.setAttribute("data-name", e[_].name), g.setAttribute("data-parent-id", ""), g.setAttribute("data-map-guid", s.getAttribute("data-map-guid")), d.appendChild(g), (v = document.createElement("img")).setAttribute("src", "/graphics/icon_position_" + e[_].type_id + ".svg"), g.appendChild(v); var h = 90 - e[_].orientation; $(g).css("left", e[_].pos_left + "px"), $(g).css("top", e[_].pos_top + "px"), $(g).css("WebkitTransform", "rotate(" + h + "deg)"), $(g).css("-moz-transform", "rotate(" + h + "deg)"), $(g).css("-ms-transform", "rotate(" + h + "deg)"), $(g).css("transform", "rotate(" + h + "deg)"); for (var f = 0; f < e[_].child_positions.length;) { e[_].child_positions[f].pos_left = e[_].child_positions[f].pos_x * l - p, e[_].child_positions[f].pos_top = c - (e[_].child_positions[f].pos_y * l - u), e[_].child_positions[f].orientation = 90 - e[_].child_positions[f].orientation; var v, b = document.createElement("div"); b.setAttribute("class", "child_position"), b.setAttribute("data-guid", e[_].child_positions[f].guid), b.setAttribute("data-name", e[_].child_positions[f].name), b.setAttribute("data-map-guid", s.getAttribute("data-map-guid")), b.setAttribute("data-parent-id", e[_].guid), b.setAttribute("data-type-id", e[_].child_positions[f].type_id), d.appendChild(b), (v = document.createElement("img")).setAttribute("src", "/graphics/icon_position_helper.svg"), b.appendChild(v), $(b).css("left", e[_].child_positions[f].pos_left + "px"), $(b).css("top", e[_].child_positions[f].pos_top + "px"), $(b).css("WebkitTransform", "rotate(" + e[_].child_positions[f].orientation + "deg)"), $(b).css("-moz-transform", "rotate(" + e[_].child_positions[f].orientation + "deg)"), $(b).css("-ms-transform", "rotate(" + e[_].child_positions[f].orientation + "deg)"), $(b).css("transform", "rotate(" + e[_].child_positions[f].orientation + "deg)"), f++ } _++ } var y = {}; y[n] = e, $.extend(!0, MIR.runtime, { positions: y }); var w = MIR.storage.get(m.mir.get_storage_id(), "data-center-robot"), A = !0; if ("false" == t.getAttribute("data-locked")) if (map_set_guide(n, map_lang_guide_ready), r) map_record_start(n, !0, i); else if (o) map_finalizing_start(n), A = !1; else if (i) map_center_map(n, !1, !0), map_appendplacer_start(n); else if (1 == a) map_rotate_start(n); else { var E = m.mir.get_saved_parameters(); E.zoom && E.offset_left && E.offset_top ? (map_zoom(m.mir.get_element_id(), E.zoom, { interval: 0, callback: function () { m.mir.set_map_offset({ top: E.offset_top, left: E.offset_left }, !0) } }), w && map_toggle_center_robot(n, !0)) : map_center_map(n, !1) } else o ? (map_finalizing_start(n), A = !1) : (map_zoom(n, 2, { interval: 0 }), map_toggle_center_robot(n, !0)); A && t.setAttribute("data-initializing", "false") } }) } }, window["map_" + t + "_pathseq"] = -1, "false" == n.getAttribute("data-locked") && (map_start_laserscans(t), map_start_gridmap(t)), "fleet" == systemtype && (map_fleet_init(t), n.getAttribute("data-locked")), map_init_click_handler(MIR.runtime.maps[t]), map_init_scroll_zoom(MIR.runtime.maps[t]) })).fail((function (t) { console.warn(t.responseText) })), "false" == n.getAttribute("data-locked") && map_navigator(t) } return !0 } setTimeout((function () { map_init(t, e, a, r, i, o) }), 500) } function activate_laserscans() { if ("robot" == systemtype) { var t = new ROSLIB.Service({ ros: ros, name: "/mirwebapp/command", serviceType: "mirWebApp/Command" }), e = new ROSLIB.ServiceRequest({ cmd: "cont:5" }); t.callService(e, (function (t) { })) } } function map_start_pathmap(t) { if ("robot" == systemtype) { var e = document.getElementById(t + "_mapcontainer"); e.getAttribute("data-map-guid") == robot_map_id && (window["ros_path_listener_" + t] = new ROSLIB.Topic({ ros: ros, name: "/mirwebapp/web_path", messageType: "mirMsgs/WebPath", throttle_rate: 10 }), window["ros_path_listener_" + t].subscribe((function (a) { if (e.getAttribute("data-map-guid") == robot_map_id) { var r = document.getElementById(t + "_mapcontainer"), i = r.getAttribute("data-map-height"), o = r.getAttribute("data-resscale"), n = r.getAttribute("data-origin-x"), s = r.getAttribute("data-origin-y"); window["map_" + t + "_pathseq"] = a.seq; for (var d = 0, l = ""; d < a.x.length;) { l += a.x[d] * o - n + " " + (i - (a.y[d] * o - s)) + " ", d++ } var p = document.getElementById("robot_path_points_" + t); p && p.setAttribute("points", l) } }))) } return !0 } function map_start_gridmap(t) { if ("robot" == systemtype) { var e = document.getElementById(t + "_mapcontainer"); if (window["map_" + t + "_gridmap_idx"] = -1, e.getAttribute("data-map-guid") == robot_map_id) new ROSLIB.Topic({ ros: ros, name: "/mirwebapp/grid_map_metadata", messageType: "mirMsgs/LocalMapStat", throttle_rate: 10 }).subscribe((function (e) { if (document.getElementById(t + "_gridmap")) { var a = document.getElementById(t + "_gridmap"), r = document.getElementById(t + "_mapcontainer"); if (-1 == window["map_" + t + "_gridmap_idx"]) { var i = new Date; a.src = "/robot-images/grid_map/grid_map_" + e.idx + ".png?t=" + i.getTime(), window["map_" + t + "_gridmap_idx"] = e.idx, a.onload = function () { var a = r.getAttribute("data-map-height"), i = e.x - this.width / 2, o = parseFloat(a) + (e.y - this.height / 2); $(this).css("top", o + "px"), $(this).css("left", i + "px"), window["map_" + t + "_gridmap_idx"] = -1 } } } })) } return !0 } function map_start_laserscans(t) { if ("robot" == systemtype) { var e = document.getElementById(t + "_mapcontainer"); if (window["map_" + t + "_laserscans_agent_timer"] = 0, window["map_" + t + "_laserscans_idx"] = -1, window["map_" + t + "_laserscans_agent"] && window.clearInterval(window["map_" + t + "_laserscans_agent"]), window["map_" + t + "_laserscantimer"] && window.clearInterval(window["map_" + t + "_laserscantimer"]), e.getAttribute("data-map-guid") == robot_map_id) window["map_" + t + "_laserscantimer"] = setInterval(function t() { return activate_laserscans(), t }(), 8e3), window["map_" + t + "_laserscans_agent"] = setInterval((function () { var e = new Date; window["map_" + t + "_laserscans_agent_timer"] < e.getTime() - 3e3 && window["map_" + t + "_laserscans_agent_timer"] > 0 && (window.clearInterval(window["map_" + t + "_laserscans_agent"]), window.clearInterval(window["map_" + t + "_laserscantimer"]), map_start_laserscans(t), map_start_gridmap(t), map_start_pathmap(t)) }), 5e3), new ROSLIB.Topic({ ros: ros, name: "/mirwebapp/laser_map_metadata", messageType: "mirMsgs/LocalMapStat", throttle_rate: 10 }).subscribe((function (e) { if (document.getElementById(t + "_laserscans")) { var a = document.getElementById(t + "_laserscans"), r = document.getElementById(t + "_mapcontainer"), i = (new Date).getTime(); window["map_" + t + "_laserscans_agent_timer"] = i, -1 == window["map_" + t + "_laserscans_idx"] && (a.src = "/robot-images/laser_map/laser_map_" + e.idx + ".png?t=" + i, window["map_" + t + "_laserscans_idx"] = e.idx, a.onload = function () { var a = r.getAttribute("data-map-height"), i = e.x - this.width / 2, o = parseFloat(a) + (e.y - this.height / 2); $(this).css("top", o + "px"), $(this).css("left", i + "px"), window["map_" + t + "_laserscans_idx"] = -1 }) } })) } return !0 } function map_isolate_layer(t, e) { var a = $("#" + t + "_mapholder").find("div.layer"), r = [], i = 0; $("#" + t + "_maplayercontroller > tr.layercontrollerrow").attr("data-active", "false"), $("#" + t + "_maplayercontroller").find("tr.layercontrollerrow").find("td").find("div.view").attr("data-active", "false"), $("#" + t + "_maplayercontroller > tr.layercontrollerrow[data-systemname='" + e + "']").attr("data-active", "true"), $("#" + t + "_maplayercontroller_viewcontrol_" + e).attr("data-active", "true"), "floor" === e || "walls" === e ? (r = ["#" + t + "_layer_basemap_floor", "#" + t + "_layer_floor", "#" + t + "_layer_basemap_walls", "#" + t + "_layer_walls", "#" + t + "_layer_draw"], i = 0) : (r = ["#" + t + "_layer_" + e], i = .2), a.not(r.join(",")).css("opacity", i), a.filter(r.join(",")).css("opacity", 1) } function checkDialogBoxIsVisible(t) { return !!$("." + t[0].className).find(".box").length } function map_init_scroll_zoom(t) { var e = MIR.util.throttle((function (e) { var a = t.mir, r = MIR.constants.MAP.world, i = !a.is_robot_centered() && a.convert_coords({ x: e.pageX, y: e.pageY }, r.DOM, r.VIEWPORT); e.deltaY < 0 ? map_zoom(t.mir.get_element_id(), "out", { zoom_to_coords: i, interval: 300 }) : map_zoom(t.mir.get_element_id(), "in", { zoom_to_coords: i, interval: 300 }) }), 300); if (t.off("mousewheel.zoom"), t.mir.is_locked()) return !1; t.on("mousewheel.zoom", (function (a) { return checkDialogBoxIsVisible(t) ? (t.off("mousewheel.zoom"), $("#cancel").on("click", (function () { map_init_scroll_zoom(t) })), $("#submit").on("click", (function () { map_init_scroll_zoom(t) })), !1) : (e(a), !1) })) } function map_show_all_layers(t) { var e = document.getElementById(t + "_mapcontainer"); $("#" + t + "_mapholder").find("div.layer").not("[data-layertype='grid']").show(), $("#" + t + "_mapholder").find("div.layer").not("[data-layertype='grid']").css("opacity", 1), $("#" + t + "_mapholder").find("div.layer").not("[data-layertype='grid']").css("pointer-events", ""), $("#" + t + "_mapholder").find("div.layer#" + t + "_layer_draw").hide(), $("#" + t + "_maplayercontroller").find("tr.layercontrollerrow").find("td").find("div.view").attr("data-active", "true"), $("#" + t + "_mapholder").find("div.layer#" + t + "_layer_robotmap").hide(), $("#" + t + "_maplayercontroller").find("tr.layercontrollerrow[data-systemname='robotmap']").find("td").find("div.view").attr("data-active", "false"), "walls" == e.getAttribute("data-mychoice") || "floors" == e.getAttribute("data-mychoice") ? $("#" + t + "_mapholder").find("div.layer#" + t + "_layer_positions").hide() : document.getElementById(t + "_maplayercontroller_viewcontrol_positions") && $("#" + t + "_mapholder").find("div.layer#" + t + "_layer_positions").show() } function map_init_click_handler(t) { var e = t.mir; if (t.off("click.map-click"), e.is_locked()) return !1; t.on("click.map-click touchend", "div.mapholder", (function (a) { if (e.is_rotating()) return !1; var r = MIR.runtime.positions[e.get_element_id()], i = MIR.runtime.layers[e.get_element_id()], o = MIR.math, n = MIR.constants.MAP.tools; if (-1 !== $.inArray(e.get_tool(), [n.SELECTOR, n.NAVIGATOR, n.DELETE])) { if (null == a.pageX || null == a.pageY) { if ("touchend" != a.type) return; a.originalEvent.pageX && a.originalEvent.pageY ? (a.pageX = a.originalEvent.pageX, a.pageY = a.originalEvent.pageY) : (a.pageX = a.changedTouches[0].pageX, a.pageY = a.changedTouches[0].pageY) } var s = { x: a.pageX, y: a.pageY }, d = e.get_chosen_layer(), l = t.find(".position").length >= 1, p = e.is_editable() && "positions" !== d; if (l && (!d || "positions" == d)) { var m = function (t) { function a(t) { if ($pos = $('.position[data-guid="' + t.guid + '"], .child_position[data-guid="' + t.guid + '"]'), $pos_offset = $pos.offset(), 0 != $pos.length) { var a = Math.abs($pos.outerWidth() / 2), r = { x: $pos_offset.left + a, y: $pos_offset.top + a }; if (!o.check_point_in_circle(r, n, i)) return !1; var d = e.get_position_type(t.type_id); s.push({ name: t.name + " / " + mir_translate(d.name), value: t.guid }) } } e.dom_to_map(t); var i = t, n = e.get_position_sizing(r[0]) / 2, s = []; return $.each(r, (function (t, e) { a(e), e.show_children && $.each(e.child_positions, (function (t, e) { a(e) })) })), s }(s), u = t.find(".robot").length >= 1 && "robot" === a.target.className; if (1 === m.length && !u) return void h(t.find("[data-guid='" + m.pop().value + "']")[0]); if (u) { $.each(m, (function (t, e) { e.hasOwnProperty("im_a_robot") && e.im_a_robot && m.splice($.inArray(e, m), 1) })); var c = a.target; m.push({ value: c.getAttribute("robot-ip"), name: c.getAttribute("data-name"), im_a_robot: !0 }) } if (m.length > 1) return g(mir_translate("Pick a position"), m, (function (e) { var a = t.find("[data-guid='" + e.value + "'],.robot[robot-ip='" + e.value + "']"); if (e.hasOwnProperty("im_a_robot")) { var r = $(a).each((function (t, e) { return !!e.classList.contains("robot") })); return r.length && robot_dialog(r[0]), !1 } h(a[0]) })), !1 } if (p && "navigator" != e.get_tool()) { layers_to_check = {}, d ? layers_to_check[d] = i[d] : layers_to_check = i; var _ = function (t, a) { var r = [], i = e.dom_to_map(t); return $.each(a, (function (a, n) { $.each(n.shapes, (function (n, s) { if (!s.polygon && s.points && "object" == typeof s.points && (s.polygon = s.points), s && s.polygon && s.polygon.constructor === Array) { if ("stroke" !== s.type) { if (!o.check_point_in_shape(i, s.polygon)) return } else if (!o.check_polyline_area_intersect(e.get_click_area(t, s.brushsize), s.polygon)) return; if (!s.name) { var d = e.layer2choice(a), l = $("#" + e.get_element_id() + "_toolbutton_mychoice_selector").find('option[value="' + d + '"]').html(), p = n + 1; s.name = l + " (" + p + ")" } r.push({ name: s.name, value: s.guid ? s.guid : generate_uuid(), idx_layer: a, idx_shape: n }) } })) })), r }(s, layers_to_check); if (0 !== _.length) { if (1 !== _.length) return g(mir_translate("Choose an area"), _, (function (t) { f(t) })), !1; f(_.pop()) } } } function g(e, a, r) { var i = { header: e, parent: t, options: a, on_select: function (t, e) { t && r(e) }, on_before_render: function (t) { t.mir.$dialog_label.hide(), t.mir.$dialog_input.hide() } }; MIR.ui.search_dialog(i) } function h(t) { var a = $(t).find("img").attr("src"); if ("7" == (a = (a = a.replace("/graphics/icon_position_", "")).replace(".svg", "")) || "9" == a || "11" == a || "13" == a || "16" == a || "18" == a || "20" == a || "22" == a || "24" == a) var i = "marker"; else i = "position"; var o = t.parentNode.parentNode.parentNode.parentNode.parentNode; document.getElementById(o.getAttribute("data-element-id") + "_robotinfoscreen"); robot_dialog_close(); var n = document.getElementById(o.getAttribute("data-element-id") + "_mapdialogscreen"); n.innerHTML = ""; var s = document.createElement("div"); s.setAttribute("class", "box"), s.setAttribute("id", o.getAttribute("data-element-id") + "_position_box"), n.appendChild(s); var d = document.createElement("h1"); d.innerHTML = "marker" == i ? "<span>" + map_lang_position_marker + ":</span> " + t.getAttribute("data-name") : "<span>" + map_lang_position_position + ":</span> " + t.getAttribute("data-name"), s.appendChild(d); var l = document.createElement("table"); l.setAttribute("cellpadding", 0), l.setAttribute("cellspacing", 0), l.setAttribute("class", "optionholder"), s.appendChild(l); var p = document.createElement("tr"); if (l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).setAttribute("data-guid", t.getAttribute("data-guid")), m.setAttribute("data-type", a), m.setAttribute("data-action", "goto"), m.innerHTML = map_lang_positionsdialogue_goto, m.onclick = function () { var t = this.getAttribute("data-guid"), e = this.getAttribute("data-type"); if ("fleet" == systemtype) document.getElementById(o.getAttribute("data-element-id") + "_position_box").parentNode.removeChild(document.getElementById(o.getAttribute("data-element-id") + "_position_box")), $(n).hide(), map_fleet_go_to_position(o.getAttribute("data-element-id"), t, e); else { var a = { mode: "map-go-to-position" }; a.id = this.getAttribute("data-guid"), a.type = this.getAttribute("data-type"), $.ajax({ url: "/", data: a, method: "GET", dataType: "json", guid: this.getAttribute("data-guid"), success: function (a) { document.getElementById(o.getAttribute("data-element-id") + "_position_box").parentNode.removeChild(document.getElementById(o.getAttribute("data-element-id") + "_position_box")), $(n).hide(), "question" == a.status && MIR.runtime.get_mission_queue_prompt((function () { map_go_to_position(t, e, "yes") }), (function () { map_go_to_position(t, e, "no") })) } }) } }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + map_lang_positionsdialogue_goto_text + "</p>\n", p.appendChild(u), "position" == i) { p = document.createElement("tr"); l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).innerHTML = map_lang_positionsdialogue_move, m.setAttribute("data-guid", t.getAttribute("data-guid")), m.setAttribute("data-action", "move"), m.setAttribute("data-element-id", o.getAttribute("data-element-id")), m.setAttribute("data-name", t.getAttribute("data-name")), m.setAttribute("data-type-id", t.getAttribute("data-type-id")), m.setAttribute("data-parent-id", t.getAttribute("data-parent-id")), m.onclick = function () { map_draw_position(this.getAttribute("data-element-id"), this.getAttribute("data-guid"), this.getAttribute("data-name")), document.getElementById(o.getAttribute("data-element-id") + "_position_box").parentNode.removeChild(document.getElementById(o.getAttribute("data-element-id") + "_position_box")), $(n).hide() }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + map_lang_positionsdialogue_move_text + "</p>\n", p.appendChild(u) } p = document.createElement("tr"); if (l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).setAttribute("data-guid", t.getAttribute("data-guid")), m.setAttribute("data-map-guid", t.getAttribute("data-map-guid")), m.setAttribute("data-element-id", o.getAttribute("data-element-id")), m.innerHTML = map_lang_positionsdialogue_edit, m.setAttribute("data-action", "edit"), m.onclick = function () { var t = this.getAttribute("data-guid"), e = this.getAttribute("data-element-id"), a = this.getAttribute("data-map-guid"), r = { mode: "get-data" }; r.endpoint = "/positions/" + t, r.calltype = "light", $.ajax({ url: "/", data: r, method: "GET", dataType: "json", success: function (t) { if (200 == t.headers.httpcode) if (-1 == t.results.allowed_methods.indexOf("PUT")) launch_error(map_lang_position_noperm); else { var r = {}; if (r.pos_x = t.results.pos_x, r.pos_y = t.results.pos_y, r.orientation = t.results.orientation, r.type_id = t.results.type_id, r.name = t.results.name, r.guid = t.results.guid, r.parent_id = t.results.parent_id, "7" == r.type_id || "9" == r.type_id || "11" == r.type_id || "13" == r.type_id || "16" == r.type_id || "18" == r.type_id || "20" == r.type_id || "22" == r.type_id || "24" == r.type_id) var i = "marker"; else i = "position"; void 0 !== t.results.charging_group && (r.charging_group = t.results.charging_group), "marker" == i && (r.offset_x = t.results.offset_x, r.offset_y = t.results.offset_y, r.offset_orientation = t.results.offset_orientation, void 0 !== t.results.bar_distance && void 0 !== t.results.bar_length && (r.bar_length = t.results.bar_length ? t.results.bar_length : 0, r.bar_distance = t.results.bar_distance ? t.results.bar_distance : 0), void 0 !== t.results.shelf_leg_asymmetry_x && (r.shelf_leg_asymmetry_x = t.results.shelf_leg_asymmetry_x ? t.results.shelf_leg_asymmetry_x : 0)), document.getElementById(e + "_position_box").parentNode.removeChild(document.getElementById(e + "_position_box")), $(n).hide(), map_position_dialogue(e, a, r, i) } } }) }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + map_lang_positionsdialogue_edit_text + "</p>\n", p.appendChild(u), "" == t.getAttribute("data-parent-id")) { p = document.createElement("tr"); l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).setAttribute("data-guid", t.getAttribute("data-guid")), m.innerHTML = map_lang_positionsdialogue_delete, m.setAttribute("data-action", "delete"), m.onclick = function () { var t = { mode: "map-delete-position" }; t.id = this.getAttribute("data-guid"), $.ajax({ url: "/", data: t, method: "GET", dataType: "json", guid: this.getAttribute("data-guid"), success: function (t) { var a = this.guid; 204 == t.headers.httpcode ? ($('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div[data-guid="' + a + '"].position').remove(), $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div[data-parent-id="' + a + '"].child_position').remove(), document.getElementById(o.getAttribute("data-element-id") + "_position_box").parentNode.removeChild(document.getElementById(o.getAttribute("data-element-id") + "_position_box")), $.each(MIR.runtime.positions, (function (t) { MIR.runtime.maps[t].mir.get_guid() === e.get_guid() && $.each(MIR.runtime.positions[t], (function (e, r) { if (r.guid == a) return MIR.runtime.positions[t].splice(e, 1), !1 })) }))) : launch_error(map_lang_position_nopermdel), $(n).hide() } }) }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + map_lang_positionsdialogue_delete_text + "</p>\n", p.appendChild(u) } if ("fleet" == MIR.config.product) { p = document.createElement("tr"); l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).setAttribute("data-guid", t.getAttribute("data-guid")), m.setAttribute("data-map-guid", t.getAttribute("data-map-guid")), m.setAttribute("data-element-id", o.getAttribute("data-element-id")), m.innerHTML = mir_translate("fleet_map_dialog_resource_queue"), m.onclick = function () { var t = $(this).closest(".box"), e = this.getAttribute("data-guid"), a = (this.getAttribute("data-element-id"), this.getAttribute("data-map-guid"), {}); a.mode = "get-data", a.endpoint = "/positions/" + e, a.calltype = "light", $.ajax({ url: "/", data: a, method: "GET", dataType: "json", success: function (a) { var r, i = a.results, o = '<div class="resource-box"><h1>' + mir_translate("fleet_map_dialog_resource_queue_title") + i.name + '</h1><div class="current_use_wrap"><fieldset><legend>' + mir_translate("fleet_map_dialog_resource_currently_using") + '</legend><div class="current_using"><p>' + mir_translate("fleet_map_dialog_resource_no_currently_using") + '</p></div></fieldset></div><fieldset class="queue_wrap"><legend>' + mir_translate("fleet_map_dialog_resource_queue") + '</legend><div class="robots_in_queue"><p>' + mir_translate("fleet_map_dialog_resource_no_in_queue") + '</p></div></fieldset><input type="button" value="' + mir_translate("Cancel") + '" class="dialog-cancel-btn" name="cancel" id="cancel"></div>'; t.append(o), $resource_box = t.find(".resource-box"), $cancel_button = t.find("#cancel"), $cancel_button.on("click", (function () { $resource_box.remove() })), r = t, $.ajax({ url: "/?mode=get-resource-queue", method: "POST", data: { guid: e }, dataType: "json", success: function (t) { var e = r.find(".current_using"), a = r.find(".robots_in_queue"); r.find(".res-robot").remove(), $.each(t.assigned, (function (t, a) { e.prepend('<div class="res-robot">' + a.status.robot_name + "</div>") })), $.each(t.queue, (function (t, e) { a.prepend('<div class="res-robot">' + e.status.robot_name + "</div>") })) } }) } }) }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + mir_translate("fleet_map_dialog_resource_queue_description") + "</p>\n", p.appendChild(u) } if ($('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div[data-parent-id="' + t.getAttribute("data-guid") + '"].child_position').length > 0) { p = document.createElement("tr"); l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).setAttribute("data-guid", t.getAttribute("data-guid")), m.setAttribute("data-type", a), "block" == $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div[data-parent-id="' + t.getAttribute("data-guid") + '"].child_position').css("display") ? (m.setAttribute("data-action", "hidehelpers"), m.innerHTML = mir_translate("Hide entry-position(s)")) : (m.setAttribute("data-action", "showhelpers"), m.innerHTML = mir_translate("Show entry-position(s)")), m.setAttribute("data-guid", t.getAttribute("data-guid")), m.onclick = function () { var t = "showhelpers" == this.getAttribute("data-action"), e = this.getAttribute("data-guid"); $('div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div[data-parent-id="' + e + '"].child_position').toggle(t), $.each(r, (function (a, r) { if (r.guid === e) return r.show_children = t, !1 })), document.getElementById(o.getAttribute("data-element-id") + "_position_box").parentNode.removeChild(document.getElementById(o.getAttribute("data-element-id") + "_position_box")), $(n).hide() }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + mir_translate("Show entry position(s) for this position") + "</p>\n", p.appendChild(u) } var m, u; p = document.createElement("tr"); l.appendChild(p), (u = document.createElement("td")).setAttribute("class", "buttoncell"), p.appendChild(u), (m = document.createElement("div")).innerHTML = map_lang_positionsdialogue_cancel, m.setAttribute("data-guid", t.getAttribute("data-guid")), m.setAttribute("data-action", "cancel"), m.onclick = function () { document.getElementById(o.getAttribute("data-element-id") + "_position_box").parentNode.removeChild(document.getElementById(o.getAttribute("data-element-id") + "_position_box")), $(n).hide() }, u.appendChild(m), (u = document.createElement("td")).setAttribute("class", "descriptioncell"), u.innerHTML = "<p>" + map_lang_positionsdialogue_cancel_text + "</p>\n", p.appendChild(u), $(n).show() } function f(a) { var r = e.get_element_id(), i = [r, a.idx_layer, a.idx_shape].join("_"), o = [r, "layer", a.idx_layer].join("_"), s = e.layer2choice(a.idx_layer), d = window["map_" + e.get_element_id() + "_metadata"].layers[a.idx_layer].shapes[a.idx_shape]; if (t.attr("shape-index", a.idx_shape), e.get_tool() === n.DELETE) { if (!checkShapePermission(d, "DELETE", r)) return; map_delete_shape(t.find("#" + o + " iframe").contents().find("#" + i).get(0), r, a.idx_layer) } else { if (!checkShapePermission(d, "PUT", r)) return; t.find("select").val() !== s && (t.find("select").val(s).selectmenu("refresh"), map_set_mychoice(r)), t.attr("data-selected-shape", o), map_itemselector(r), map_layercontrol_set_layer(r, a.idx_layer), $(r + "_layer_draw").show(), map_draw_shape_on_canvas(r, i); -1 == ["oneway", "areaprefs_preferred", "areaprefs_unpreferred", "areaprefs_forbidden", "areaprefs_critical", "floor", "walls"].indexOf(a.idx_layer) && t.find(".toolbarbutton_areaeventsettings").show(), MIR.runtime.maps[r].mir.get_chosen_layer() || reset_all_layer_opacity(r) } } })) } function map_go_to_position(t, e, a, r) { var i = { mode: "map-go-to-position" }; i.id = t, i.type = e, i.clearall = a, i.robot_id = r || 0, $.ajax({ url: "/", data: i, method: "GET", dataType: "json", success: function (t) { playbar_highlight() } }) } function map_draw_shape_on_canvas(t, e) { var a = document.getElementById(t + "_mapcontainer"), r = a.getAttribute("data-current-layer"); a.setAttribute("data-selected-shape", e); document.getElementById(t + "_layer_patheditor"); var i = document.getElementById(t + "_mapdrawer"), o = e; o = Math.round(o.replace(t + "_" + r + "_", "")); var n = window["map_" + t + "_metadata"].layers[r].shapes[o]; a.setAttribute("data-selected-shape-type", n.type), "stroke" == n.type && a.setAttribute("data-current-linesize", n.brushsize), "oneway" == r && "shape" == n.type && n.direction && a.setAttribute("data-oneway-direction", n.direction); var s = n.polygon, d = parseFloat(a.getAttribute("data-zoom-scale")); i.innerHTML = "", "areaprefs_preferred" == r ? (n.color = "#c8ffc8", a.setAttribute("data-current-prefarea", "preferred"), a.setAttribute("data-areaeventsettings-type", "-1")) : "areaprefs_unpreferred" == r ? (n.color = "#c8c8ff", a.setAttribute("data-current-prefarea", "unpreferred"), a.setAttribute("data-areaeventsettings-type", "-1")) : "areaprefs_critical" == r ? (n.color = "#f5d8a2", a.setAttribute("data-current-prefarea", "critical"), a.setAttribute("data-areaeventsettings-type", "-1")) : "areaprefs_forbidden" == r && (n.color = "#ffc8c8", a.setAttribute("data-current-prefarea", "forbidden"), a.setAttribute("data-areaeventsettings-type", "-1")), a.setAttribute("data-areaevent-name", n.name); for (var l = 0; l < s.length;) { var p = document.createElement("div"); p.setAttribute("class", "refigurepathhandle"), p.setAttribute("data-layer", r), p.setAttribute("data-path", o), p.setAttribute("data-point", l), p.setAttribute("data-element-id", t), i.appendChild(p); var m = parseFloat(s[l].y), u = parseFloat(s[l].x); m *= d, u *= d, m += parseFloat(a.getAttribute("data-zoom-offset-top")), u += parseFloat(a.getAttribute("data-zoom-offset-left")), $(p).css("top", m + "px"), $(p).css("left", u + "px"), l++ } var c = !1; $(".refigurepathhandle").draggable({ drag: function (t, e) { var a = this.getAttribute("data-element-id"), r = document.getElementById(a + "_mapcontainer"), i = parseFloat(r.getAttribute("data-zoom-scale")), o = this.getAttribute("data-point"), n = this.getAttribute("data-layer"), s = this.getAttribute("data-path"); if (0 == c) { var d = { type: "move_point" }; d.layer = n, d.path_id = s, d.point_id = o, d.old_x = window["map_" + a + "_metadata"].layers[n].shapes[s].polygon[o].x, d.old_y = window["map_" + a + "_metadata"].layers[n].shapes[s].polygon[o].y, map_add_to_history(a, d), c = !0 } var l = e.position.left, p = e.position.top; l -= parseFloat(r.getAttribute("data-zoom-offset-left")), p -= parseFloat(r.getAttribute("data-zoom-offset-top")), l = Math.round(l / i), p = Math.round(p / i); var m = window["map_" + a + "_metadata"].layers[n].shapes[s].polygon; window["map_" + a + "_metadata"].layers[n].shapes[s].is_updated = !0; for (var u = "", _ = !1, g = 0; g < m.length;)g == o ? (0 == _ ? (u += "M", _ = !0) : u += "L", u += l + " " + p) : "DELETED" == m[g] || (0 == _ ? (u += "M", _ = !0) : u += "L", u += m[g].x + " " + m[g].y), g++; window["map_" + a + "_metadata"].layers[n].shapes[s].polygon[o].x = l, window["map_" + a + "_metadata"].layers[n].shapes[s].polygon[o].y = p, "shape" == window["map_" + a + "_metadata"].layers[n].shapes[s].type && (u += "z"); var h = document.getElementById(a + "_layer_" + n), f = $(h).find("iframe"), v = $(f).contents(); $(v).find("#" + a + "_" + n + "_" + s).attr("d", u), map_set_save_state(a, "savable", !1) }, stop: function (t, e) { map_update_ghost(this.getAttribute("data-element-id"), this.getAttribute("data-layer"), this.getAttribute("data-path")), c = !1 } }), $(i).show() } function keydown_parent(t) { var e = jQuery.Event("keydown", { keyCode: t.keyCode }); $(window).trigger(e) } function map_position_dialogue_check_name_used(t, e, a, r, i) { $.ajax({ mapid: a, elementid: e, url: "/", data: { mode: "get-map-site-positions", calltype: "light", id: a }, method: "GET", dataType: "json", success: function (e) { var a = $.grep(e, (function (e) { return e.name === t && (!r || !r.guid || r.guid !== e.guid) })); i(0 !== a.length) } }) } function map_position_dialogue(t, e, a, r) { var i = document.getElementById(t + "_map"); if ($(i).draggable("disable"), null != a && 0 != a.guid.length || "marker" != r) if ("marker" == r) o = map_lang_positiondialogue_headline_edit_marker; else if (null != a && 0 != a.guid.length || "position" != r) o = map_lang_positiondialogue_headline_edit_position; else var o = map_lang_positiondialogue_headline_create_position; else var o = map_lang_positiondialogue_headline_create_marker; "marker" == r && start_process("move_base"); var n = document.getElementById(t + "_mapcontainer"), s = document.getElementById(t + "_mapdialogscreen"); s.innerHTML = ""; var d = document.createElement("div"); d.setAttribute("class", "box"), d.setAttribute("id", t + "_position_formbox"), s.appendChild(d); var l = document.createElement("h1"); l.innerHTML = o, d.appendChild(l); var p = document.createElement("p"); p.innerHTML = "", p.setAttribute("id", "position_error"), p.setAttribute("class", "position_error"), d.appendChild(p); var m = document.createElement("form"); m.setAttribute("action", ""), m.setAttribute("method", "POST"), m.setAttribute("autocomplete", "off"), d.appendChild(m), m.onsubmit = function (o) { o.preventDefault(), $("p#position_error").html(""), $("p.fielderror").html(""), $("div.mapdialogscreen > div.box > form > div.fieldholder > input").attr("data-error", "false"), $("div.mapdialogscreen > div.box > form > div.fieldholder > select").attr("data-error", "false"); var d = document.getElementById("position_name").value, l = document.getElementById("position_type").options[document.getElementById("position_type").selectedIndex].value, p = document.getElementById("position_orientation").value, m = document.getElementById("position_x").value, u = document.getElementById("position_y").value, c = {}; if (c["name:::::string"] = d, c["type_id:::::integer"] = l, c["orientation:::::float"] = p, c["pos_x:::::float"] = m, c["pos_y:::::float"] = u, c["map_id:::::string"] = e, "marker" == r) { var _ = document.getElementById("offset_orientation").value, g = document.getElementById("offset_x").value, h = document.getElementById("offset_y").value, f = document.getElementById("bar_length").value, v = document.getElementById("bar_distance").value, b = document.getElementById("shelf_leg_asymmetry_x").value; c["offset_orientation:::::float"] = _, c["offset_x:::::float"] = g, c["offset_y:::::float"] = h, c["bar_length:::::float"] = f, c["bar_distance:::::float"] = v, c["shelf_leg_asymmetry_x:::::float"] = b, "fleet" == MIR.config.product && $("#charging_group").length >= 1 && (c.charging_group = $("#charging_group").val()) } if (null == a || 0 == a.guid.length) var y = "/?endpoint=/positions&mode=update-item"; else y = "/?endpoint=/positions/" + a.guid + "&mode=update-item&id=" + a.guid; return $.ajax({ url: y, data: c, method: "POST", dataType: "json", success: function (o) { if (200 == o.headers.httpcode || 201 == o.headers.httpcode) { var d = n.getAttribute("data-resscale"), l = n.getAttribute("data-origin-x"), p = n.getAttribute("data-origin-y"), m = n.getAttribute("data-map-height"), u = o.results.pos_x * d - l, c = m - (o.results.pos_y * d - p); o.results.pos_left = u, o.results.pos_top = c; var _ = o.results.orientation; 200 == o.headers.httpcode ? $.each(MIR.runtime.positions, (function (t, e) { $.each(e, (function (e, a) { a.guid === o.results.guid && ($.extend(MIR.runtime.positions[t][e], o.results), a.child_positions = []) })) })) : $.each(MIR.runtime.positions, (function (t) { MIR.runtime.maps[t].mir.get_guid() === e && MIR.runtime.positions[t].push(o.results) })), a && null != a && 0 != a.guid.length && ($("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.position[data-guid='" + a.guid + "']").remove(), $("div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.child_position[data-guid='" + a.guid + "']").remove()), null == o.results.parent_id && (o.results.parent_id = ""); var g = document.createElement("div"); a && null != a.parent_id && "" != a.parent_id ? g.setAttribute("class", "child_position") : g.setAttribute("class", "position"), g.setAttribute("data-guid", o.results.guid), g.setAttribute("data-name", o.results.name), g.setAttribute("data-type-id", o.results.type_id), g.setAttribute("data-map-guid", n.getAttribute("data-map-guid")), g.setAttribute("data-parent-id", o.results.parent_id), document.getElementById(t + "_layer_positions").appendChild(g); var h = document.createElement("img"); a && a.parent_id && 36 == a.parent_id.length ? h.setAttribute("src", "/graphics/icon_position_helper.svg") : h.setAttribute("src", "/graphics/icon_position_" + o.results.type_id + ".svg"), g.appendChild(h); _ = 90 - o.results.orientation; if ($(g).css("left", u + "px"), $(g).css("top", c + "px"), $(g).css("WebkitTransform", "rotate(" + _ + "deg)"), $(g).css("-moz-transform", "rotate(" + _ + "deg)"), $(g).css("-ms-transform", "rotate(" + _ + "deg)"), $(g).css("transform", "rotate(" + _ + "deg)"), 36 == o.results.parent_id.length && $(g).show(), $("#" + t + "_layer_positions").find("div#tmp_pos").remove(), "block" == $("#" + t + "_layer_positions").find("div.child_position[data-parent-id='" + o.results.guid + "']").css("display")) var f = !0; else f = !1; $("#" + t + "_layer_positions").find("div.child_position[data-parent-id='" + o.results.guid + "']").remove(); var v = { mode: "get-data" }; v.endpoint = "/positions/" + o.results.guid + "/helper_positions?whitelist=pos_x,pos_y,guid,name,type_id,orientation", v.calltype = "light", $.ajax({ url: "/", data: v, method: "GET", dataType: "json", success: function (e) { for (var a = 0; a < e.results.length;) { var r = e.results[a].pos_x * d - l, i = m - (e.results[a].pos_y * d - p); $.each(MIR.runtime.positions, (function (t, n) { $.each(n, (function (t, n) { if (n.guid === o.results.guid) return n.child_positions || (n.child_positions = []), n.child_positions.push({ guid: e.results[a].guid, pos_left: r, pos_top: i, name: e.results[a].name, type_id: e.results[a].type_id }), n.show_children = f, !1 })) })); var s = 90 - e.results[a].orientation, u = document.createElement("div"); u.setAttribute("class", "child_position"), u.setAttribute("data-guid", e.results[a].guid), u.setAttribute("data-name", e.results[a].name), u.setAttribute("data-type-id", e.results[a].type_id), u.setAttribute("data-map-guid", n.getAttribute("data-map-guid")), u.setAttribute("data-parent-id", o.results.guid), document.getElementById(t + "_layer_positions").appendChild(u); var c = document.createElement("img"); c.setAttribute("src", "/graphics/icon_position_helper.svg"), u.appendChild(c), $(u).css("left", r + "px"), $(u).css("top", i + "px"), $(u).css("WebkitTransform", "rotate(" + s + "deg)"), $(u).css("-moz-transform", "rotate(" + s + "deg)"), $(u).css("-ms-transform", "rotate(" + s + "deg)"), $(u).css("transform", "rotate(" + s + "deg)"), 1 == f && $(u).show(), a++ } } }), document.getElementById(t + "_position_formbox").parentNode.removeChild(document.getElementById(t + "_position_formbox")), $(s).hide(), $(i).draggable("enable"), map_navigator(t) } else for (var b in document.getElementById("position_error").innerHTML = o.results.error_human, o.results.field_errors) { if ("name" == b) var y = document.getElementById("position_name"); else if ("type_id" == b) y = document.getElementById("position_type"); else if ("orientation" == b) y = document.getElementById("position_orientation"); else if ("pos_x" == b) y = document.getElementById("position_x"); else if ("pos_y" == b) y = document.getElementById("position_y"); else if ("offset_x" == b && "marker" == r) y = document.getElementById("offset_x"); else if ("offset_y" == b && "marker" == r) y = document.getElementById("offset_y"); else if ("offset_orientation" == b && "marker" == r) y = document.getElementById("offset_orientation"); else if ("bar_length" == b && "marker" == r) y = document.getElementById("bar_length"); else if ("bar_distance" == b && "marker" == r) y = document.getElementById("bar_distance"); else if ("shelf_leg_asymmetry_x" == b && "marker" == r) y = document.getElementById("shelf_leg_asymmetry_x"); else y = document.getElementById("position_name"); y.setAttribute("data-error", "true"), b.length > 0 && (document.getElementById("fielderror_" + b).innerHTML = o.results.field_errors[b].error_human) } } }), !1 }, (g = document.createElement("div")).setAttribute("class", "fieldholder"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "position_name"), h.innerHTML = map_lang_positiondialogue_name, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", a.name), f.setAttribute("maxlength", 100), f.setAttribute("name", "position_name"), f.setAttribute("id", "position_name"), f.setAttribute("autocomplete", "off"), g.appendChild(f), $(f).on("keyup", (function () { var r = $(this); $("#fieldwarn_name").toggle(!1), void 0 !== this.position_warn_timeout && (window.clearTimeout(this.position_warn_timeout), delete this.position_warn_timeout), this.position_warn_timeout = setTimeout((function () { r.attr("data-spinning", "false"), map_position_dialogue_check_name_used(r.val(), t, e, a, (function (t) { $("#fieldwarn_name").toggle(t) })) }), 300), r.attr("data-spinning", "true") })); var u = document.createElement("p"); u.setAttribute("id", "fieldwarn_name"), u.setAttribute("class", "fieldwarn"), u.innerHTML = mir_translate("A position with this name already exists on this site!"), g.appendChild(u), null != a && map_position_dialogue_check_name_used(a.name, t, e, a, (function (t) { $("#fieldwarn_name").toggle(t) })), (c = document.createElement("p")).setAttribute("id", "fielderror_name"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), (g = document.createElement("div")).setAttribute("class", "fieldholder"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "position_type"), h.innerHTML = map_lang_positiondialogue_type, g.appendChild(h), (f = document.createElement("select")).setAttribute("name", "position_type"), f.setAttribute("id", "position_type"), f.setAttribute("data-element-id", t), f.onchange = function () { m.setAttribute("position_type_chosen", $("select#position_type").val()), map_position_dialogue_toggle_offset(this.getAttribute("data-element-id")) }, g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_type_id"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c); var c, _ = { mode: "get-data", endpoint: "/position_types?sort_by=name,asc" }; if ($.ajax({ url: "/", data: _, method: "GET", dataType: "json", success: function (e) { if (200 == e.headers.httpcode) { for (var i = [1, 5, MIR.constants.POSITION_TYPES.ELEVATOR_ENTRY, MIR.constants.POSITION_TYPES.ELEVATOR_EXIT], o = 0; o < e.results.length;) { var n = !1; if (a && a.parent_id && 36 == a.parent_id.length && "position" == r && e.results[o].id == a.type_id || "marker" == r && ("7" == e.results[o].id || "9" == e.results[o].id || "11" == e.results[o].id || "13" == e.results[o].id || check_feature(MIR.constants.FEATURES.PRECISION_DOCKING) && "16" == e.results[o].id || "18" == e.results[o].id || "20" == e.results[o].id || "22" == e.results[o].id || "24" == e.results[o].id) ? n = !0 : "position" != r || a.parent_id && 0 != a.parent_id.length || !("0" == e.results[o].id || check_feature("hook") && "1" == e.results[o].id || check_feature("shelf") && "5" == e.results[o].id || check_feature("fleet") && "42" == e.results[o].id || "15" == e.results[o].id || "42" == e.results[o].id || e.results[o].id == MIR.constants.POSITION_TYPES.ELEVATOR_ENTRY || e.results[o].id == MIR.constants.POSITION_TYPES.ELEVATOR_EXIT) ? "position" == r && "fleet" == MIR.config.product && i.indexOf(e.results[o].id) > -1 && (n = !0) : n = !0, 1 == n) { var s = document.createElement("option"); s.setAttribute("value", e.results[o].id), null == a || a.type_id == e.results[o].id && s.setAttribute("selected", "selected"), s.innerHTML = mir_translate(e.results[o].name), document.getElementById("position_type").appendChild(s) } o++ } map_position_dialogue_toggle_offset(t) } document.getElementById("position_name").focus(), m.setAttribute("position_type_chosen", $("select#position_type").val()) } }), (g = document.createElement("div")).setAttribute("class", "fieldholder"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "position_orientation"), h.innerHTML = map_lang_positiondialogue_orientation, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", number_format(a.orientation, 3, ".", "")), f.setAttribute("maxlength", 10), f.setAttribute("name", "position_orientation"), f.setAttribute("id", "position_orientation"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_orientation"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), (g = document.createElement("div")).setAttribute("class", "fieldholder"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "position_x"), h.innerHTML = map_lang_positiondialogue_xcoordinate, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", number_format(a.pos_x, 3, ".", "")), f.setAttribute("maxlength", 10), f.setAttribute("name", "position_x"), f.setAttribute("id", "position_x"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_pos_x"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), (g = document.createElement("div")).setAttribute("class", "fieldholder"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "position_y"), h.innerHTML = map_lang_positiondialogue_ycoordinate, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", number_format(a.pos_y, 3, ".", "")), f.setAttribute("maxlength", 10), f.setAttribute("name", "position_y"), f.setAttribute("id", "position_y"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_pos_y"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "offset_x"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "offset_x"), h.innerHTML = map_lang_positiondialogue_xoffset, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", a.offset_x), f.setAttribute("maxlength", 10), f.setAttribute("name", "offset_x"), f.setAttribute("id", "offset_x"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_offset_x"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), $(g).hide(), (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "offset_y"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "offset_y"), h.innerHTML = map_lang_positiondialogue_yoffset, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", a.offset_y), f.setAttribute("maxlength", 10), f.setAttribute("name", "offset_y"), f.setAttribute("id", "offset_y"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_offset_y"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), $(g).hide(), (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "offset_orientation"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "offset_orientation"), h.innerHTML = map_lang_positiondialogue_offsetorientation, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a ? f.setAttribute("value", "") : f.setAttribute("value", a.offset_orientation), f.setAttribute("maxlength", 10), f.setAttribute("name", "offset_orientation"), f.setAttribute("id", "offset_orientation"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_offset_orientation"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), $(g).hide(), (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "bar_length"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "bar_length"), h.innerHTML = map_lang_positiondialogue_barlength, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a || void 0 === a.bar_length ? f.setAttribute("value", "") : f.setAttribute("value", a.bar_length), f.setAttribute("maxlength", 10), f.setAttribute("name", "bar_length"), f.setAttribute("id", "bar_length"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_bar_length"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), $(g).hide(), (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "bar_distance"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "bar_distance"), h.innerHTML = map_lang_positiondialogue_bardistance, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a || void 0 === a.bar_distance ? f.setAttribute("value", "") : f.setAttribute("value", a.bar_distance), f.setAttribute("maxlength", 10), f.setAttribute("name", "bar_distance"), f.setAttribute("id", "bar_distance"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_bar_distance"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), $(g).hide(), (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "shelf_leg_asymmetry_x"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "shelf_leg_asymmetry_x"), h.innerHTML = map_lang_positiondialogue_shelflegasymmetry, g.appendChild(h), (f = document.createElement("input")).setAttribute("type", "text"), null == a || void 0 === a.shelf_leg_asymmetry_x ? f.setAttribute("value", "") : f.setAttribute("value", a.shelf_leg_asymmetry_x), f.setAttribute("maxlength", 10), f.setAttribute("name", "shelf_leg_asymmetry_x"), f.setAttribute("id", "shelf_leg_asymmetry_x"), f.setAttribute("autocomplete", "off"), g.appendChild(f), (c = document.createElement("p")).setAttribute("id", "fielderror_shelf_leg_asymmetry_x"), c.setAttribute("class", "fielderror"), c.innerHTML = "", g.appendChild(c), $(g).hide(), "fleet" == MIR.config.product) { var g, h, f; (g = document.createElement("div")).setAttribute("class", "fieldholder"), g.setAttribute("data-field", "charging_group"), m.appendChild(g), (h = document.createElement("label")).setAttribute("for", "position_type"), h.innerHTML = mir_translate("fleet_map_dialog_marker_charging_group"), g.appendChild(h), (f = document.createElement("select")).setAttribute("name", "charging_group"), f.setAttribute("id", "charging_group"); var v = document.createElement("option"); v.setAttribute("value", "0"), v.innerHTML = mir_translate("fleet_map_dialog_marker_charging_group_option_default"), f.appendChild(v), $.ajax({ url: "/?mode=get-charging-groups&calltype=light", method: "GET", dataType: "json", success: function (t) { 200 == t.headers.httpcode && $.each(t.results, (function (t, e) { var r = document.createElement("option"); r.setAttribute("value", e.id), r.innerHTML = e.name, void 0 !== a.charging_group && a.charging_group == e.id && r.setAttribute("selected", "selected"), f.appendChild(r) })) } }), g.appendChild(f) } var b = document.createElement("div"); if (b.setAttribute("class", "buttonholder"), m.appendChild(b), (y = document.createElement("input")).setAttribute("type", "submit"), y.setAttribute("value", map_lang_positiondialogue_ok), y.setAttribute("name", "submit"), y.setAttribute("id", "submit"), b.appendChild(y), "marker" == r && "true" == n.getAttribute("data-active-map")) (y = document.createElement("input")).setAttribute("type", "button"), y.setAttribute("value", mir_translate("Detect marker")), y.setAttribute("name", "userobotposition"), y.setAttribute("id", "userobotposition"), b.appendChild(y), y.onclick = function () { document.getElementById("position_x").value = "", document.getElementById("position_y").value = "", document.getElementById("position_orientation").value = "", document.getElementById("offset_x").value = "", document.getElementById("offset_y").value = "", document.getElementById("offset_orientation").value = ""; var t = parseInt($("select#position_type").val()), e = 1, a = 0; "MIR500" != mir_product && "MIR1000" != mir_product && "MIR600" != mir_product && "MIR1350" != mir_product || (e = 1.2, a = -.15), 18 != t && 24 != t || (e = 1.925, a = 0), 13 == t && (e = .7, a = 0, "MIR500" != mir_product && "MIR1000" != mir_product && "MIR600" != mir_product && "MIR1350" != mir_product || (e = 1, a = 0)); var r = robot_cur_degrees * Math.PI / 180; 22 == t && (document.getElementById("bar_length").value < .3 || document.getElementById("bar_distance").value < .75) ? (document.getElementById("bar_length").value < .3 && (document.getElementById("bar_length").setAttribute("data-error", "true"), document.getElementById("fielderror_bar_length").innerHTML = mir_translate("input_error_bar_length_too_short")), document.getElementById("bar_distance").value < .75 && (document.getElementById("bar_distance").setAttribute("data-error", "true"), document.getElementById("fielderror_bar_distance").innerHTML = mir_translate("input_error_bar_distance_too_short"))) : (document.getElementById("bar_length").setAttribute("data-error", "false"), document.getElementById("bar_distance").setAttribute("data-error", "false"), document.getElementById("fielderror_bar_distance").innerHTML = "", document.getElementById("fielderror_bar_length").innerHTML = "", detect_marker(e, a, r, t, !0), launch_waiter(map_lang_positiondialogue_tryingtodetectmarker)), 24 == t && (document.getElementById("bar_length").value < .3 || document.getElementById("bar_distance").value < .75 || document.getElementById("shelf_leg_asymmetry_x").value < -.75 || document.getElementById("shelf_leg_asymmetry_x").value > .75) && (document.getElementById("bar_length").value < .3 && (document.getElementById("bar_length").setAttribute("data-error", "true"), document.getElementById("fielderror_bar_length").innerHTML = mir_translate("input_error_bar_length_too_short")), document.getElementById("bar_distance").value < .75 && (document.getElementById("bar_distance").setAttribute("data-error", "true"), document.getElementById("fielderror_bar_distance").innerHTML = mir_translate("input_error_bar_distance_too_short")), (document.getElementById("shelf_leg_asymmetry_x").value < -.75 || document.getElementById("shelf_leg_asymmetry_x").value > .75) && (document.getElementById("shelf_leg_asymmetry_x").setAttribute("data-error", "true"), document.getElementById("fielderror_shelf_leg_asymmetry_x").innerHTML = mir_translate("input_error_shelf_leg_asymmetry_x_too_big"))) }; else if ("true" == n.getAttribute("data-active-map")) { var y; if ((y = document.createElement("input")).setAttribute("type", "button"), y.setAttribute("value", mir_translate("Use robot position")), y.setAttribute("name", "userobotposition"), y.setAttribute("id", "userobotposition"), b.appendChild(y), y.onclick = function () { document.getElementById("position_x").value = number_format(robot_cur_x, 3, ".", ""), document.getElementById("position_y").value = number_format(robot_cur_y, 3, ".", ""), document.getElementById("position_orientation").value = number_format(robot_cur_degrees, 3, ".", "") }, cart_attached) (y = document.createElement("input")).setAttribute("type", "button"), y.setAttribute("value", map_lang_positiondialogue_usecartposition), y.setAttribute("name", "usecartposition"), y.setAttribute("id", "usecartposition"), b.appendChild(y), y.onclick = function () { document.getElementById("position_x").value = number_format(cart_front_x, 3, ".", ""), document.getElementById("position_y").value = number_format(cart_front_y, 3, ".", ""), document.getElementById("position_orientation").value = number_format(cart_front_degrees, 3, ".", "") } } (y = document.createElement("input")).setAttribute("type", "button"), y.setAttribute("value", mir_translate("Cancel")), y.setAttribute("name", "cancel"), y.setAttribute("id", "cancel"), b.appendChild(y), y.onclick = function () { $("#" + t + "_layer_positions").find("div#tmp_pos").remove(), document.getElementById(t + "_position_formbox").parentNode.removeChild(document.getElementById(t + "_position_formbox")), $(s).hide(), map_navigator(t) }, $(s).show() } function map_position_dialogue_toggle_offset(t) { var e = $("select#position_type").val(); return 9 == e || 11 == e || 13 == e || 18 == e ? ($("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_x']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_y']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_orientation']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_length']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_distance']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='shelf_leg_asymmetry_x']").hide()) : 22 == e ? ($("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_x']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_y']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_orientation']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_length']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_distance']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='shelf_leg_asymmetry_x']").hide()) : 24 == e ? ($("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_x']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_y']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_orientation']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_length']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_distance']").show(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='shelf_leg_asymmetry_x']").show()) : ($("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_x']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_y']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='offset_orientation']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_length']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='bar_distance']").hide(), $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='shelf_leg_asymmetry_x']").hide()), 7 == e || 20 == e ? $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='charging_group']").show() : $("div.mapcontainer > div.mapwrapper > div.mapdialogscreen > div.box > form > div.fieldholder[data-field='charging_group']").hide(), !0 } function detect_marker(t, e, a, r, i) { var o = new ROSLIB.ActionClient({ ros: ros, serverName: "move_base", actionName: "mir_actions/MirMoveBaseAction" }), n = robot_cur_degrees * Math.PI / 180, s = robot_cur_x + Math.cos(n) * t - Math.sin(n) * e, d = robot_cur_y + Math.sin(n) * t + Math.cos(n) * e, l = !1, p = 0, m = 0, u = 0, c = 0; 22 == r ? (m = parseFloat($("input#bar_length").val()), u = parseFloat($("input#bar_distance").val())) : 24 == r && (m = parseFloat($("input#bar_length").val()), u = parseFloat($("input#bar_distance").val()), c = parseFloat($("input#shelf_leg_asymmetry_x").val())); var _ = new ROSLIB.Goal({ actionClient: o, goalMessage: { move_task: 4, only_track: !0, pattern_type: r, pose: { x: s, y: d, theta: a }, offset: { x: 0, y: 0, theta: i ? 0 : Math.PI }, bar_length: m, bar_distance: u, shelf_leg_asymmetry_x: c, tolerance: 1 } }); _.send(), _.on("feedback", (function (t) { if (++p > 0 && !l) { l = !0; var e = t.pose.x - robot_cur_x, a = t.pose.y - robot_cur_y, i = t.pose.theta - Math.atan2(a, e), o = robot_cur_degrees - 180 * t.pose.theta / Math.PI; o > 180 ? o -= 360 : o < -180 && (o += 360); var n = Math.sqrt(e * e + a * a); if (document.getElementById("position_x").value = t.pose.x.toFixed(3), document.getElementById("position_y").value = t.pose.y.toFixed(3), document.getElementById("position_orientation").value = (180 * t.pose.theta / Math.PI).toFixed(3), 18 == r || 22 == r || 24 == r) document.getElementById("offset_x").value = 0, document.getElementById("offset_y").value = 0, Math.abs(o) < 90 ? document.getElementById("offset_orientation").value = (0).toFixed(3) : document.getElementById("offset_orientation").value = 180..toFixed(3); else if (13 == r) { var s = .3; t.marker_inversion && (s = -.05); var d = .5; "MIR500" != mir_product && "MIR1000" != mir_product && "MIR600" != mir_product && "MIR1350" != mir_product || (s = .65, t.marker_inversion && (s = -.3), d = .9), document.getElementById("offset_x").value = s, (Math.sin(i) * n).toFixed(3) > 0 && Math.cos(o * Math.PI / 180).toFixed(3) > 0 ? (document.getElementById("offset_y").value = d, document.getElementById("offset_orientation").value = 0) : (Math.sin(i) * n).toFixed(3) < 0 && Math.cos(o * Math.PI / 180).toFixed(3) > 0 ? (document.getElementById("offset_y").value = -d, document.getElementById("offset_orientation").value = 0) : (Math.sin(i) * n).toFixed(3) > 0 && Math.cos(o * Math.PI / 180).toFixed(3) < 0 ? (document.getElementById("offset_y").value = d, document.getElementById("offset_orientation").value = 180) : (document.getElementById("offset_y").value = -d, document.getElementById("offset_orientation").value = 180) } else document.getElementById("offset_x").value = (-Math.cos(i) * n).toFixed(3), document.getElementById("offset_y").value = (Math.sin(i) * n).toFixed(3), document.getElementById("offset_orientation").value = o.toFixed(3); 0 == document.getElementById("offset_x").value.length && (document.getElementById("offset_x").value = 0), 0 == document.getElementById("offset_y").value.length && (document.getElementById("offset_y").value = 0), 0 == document.getElementById("offset_orientation").value.length && (document.getElementById("offset_orientation").value = 0), _.cancel(), close_waiter() } })), setTimeout((function () { if (!l) if (_.cancel(), i) { var a = robot_cur_degrees * Math.PI / 180 + Math.PI; a > Math.PI ? a -= 2 * Math.PI : a < -Math.PI && (a += 2 * Math.PI), detect_marker(-t, -e, a, r, !1) } else _.cancel(), close_waiter(), launch_error(map_lang_positiondialogue_failedtolocatemarker) }), 3e3) } function map_areaeventsettings(t) { var e = document.getElementById(t + "_mapcontainer"), a = parseInt(e.getAttribute("data-areaeventsettings-type")), r = document.getElementById(t + "_mapdialogscreen"); r.innerHTML = "", document.getElementById(t + "_areaeventsettings") && document.getElementById(t + "_areaeventsettings").parentNode.removeChild(document.getElementById(t + "_areaeventsettings")), $(r).hide(); var i = e.getAttribute("data-selected-shape"), o = e.getAttribute("data-current-layer"), n = document.createElement("div"); n.setAttribute("class", "box"), n.setAttribute("id", t + "_areaeventsettings"), r.appendChild(n); var s = document.createElement("h1"); s.innerHTML = map_lang_zonesettings; var d = document.createElement("i"); d.setAttribute("class", "help-icon"), d.onclick = function () { MIR.ui.helptext(mir_translate("shared_maps_popup_dialog_zone_settings_help_text"), mir_translate("shared_maps_popup_dialog_zone_settings_help_headline"), !0) }, s.appendChild(d), n.appendChild(s); var l = document.createElement("form"); l.setAttribute("novalidate", !0), l.setAttribute("action", ""), l.setAttribute("method", ""), l.setAttribute("data-element-id", t), l.setAttribute("data-type-id", a), n.appendChild(l), l.onsubmit = function (e) { if (e.preventDefault(), !area_events.save(this)) return !1; var a = document.getElementById(this.getAttribute("data-element-id") + "_mapcontainer").getAttribute("data-selected-shape"); if (a.length > 0) for (var i = (a = a.split("_")).length, o = (a[i - 1], 1); o < i;)o < i - 1 && (o > 1 && "_", a[o]), o++; $(r).hide(), map_set_save_state(this.getAttribute("data-element-id"), "savable", !1); var n = $("#" + t + "_mapcontainer"); return 1 == n.attr("navigator-on-close") && (n.removeAttr("navigator-on-close"), map_navigator(t)), !1 }; var p = document.createElement("div"); p.setAttribute("class", "fieldgroup"), p.setAttribute("id", "areaeventsettings_fieldgroup_" + a), p.setAttribute("data-for", i), l.appendChild(p), (u = document.createElement("div")).setAttribute("class", "fieldholder"), p.appendChild(u); var m = document.createElement("label"); m.setAttribute("for", "areaevent_name"), m.innerHTML = mir_translate("Name"), u.appendChild(m); var u, c = void 0 !== window["map_" + t + "_metadata"].layers[o].shapes[e.getAttribute("shape-index")] ? window["map_" + t + "_metadata"].layers[o].shapes[e.getAttribute("shape-index")].name : e.getAttribute("data-areaevent-name"), _ = document.createElement("input"); _.setAttribute("type", "text"), _.setAttribute("autocomplete", "off"), _.setAttribute("id", "areaevent_name"), _.setAttribute("name", "areaevent_name"), _.setAttribute("value", c), u.appendChild(_), (u = document.createElement("div")).setAttribute("class", "fieldholder"), p.appendChild(u); var g = { modal: r, layer: o, shape_index: e.getAttribute("shape-index") }; area_events.settingsModal(t, g); var h, f = document.createElement("div"); return f.setAttribute("class", "buttonholder"), l.appendChild(f), (h = document.createElement("input")).setAttribute("type", "submit"), h.setAttribute("value", mir_translate("OK")), h.setAttribute("name", "submit"), h.setAttribute("id", "submit"), f.appendChild(h), (h = document.createElement("input")).setAttribute("type", "button"), h.setAttribute("value", mir_translate("Cancel")), h.setAttribute("name", "cancel"), h.setAttribute("id", "cancel"), f.appendChild(h), h.onclick = function () { document.getElementById(t + "_areaeventsettings").parentNode.removeChild(document.getElementById(t + "_areaeventsettings")), $(r).hide() }, $(r).show(), 9 != a && 8 != a || document.getElementById("areaevent_name").focus(), !0 } function map_brushsettings(t) { var e = document.getElementById(t + "_mapcontainer"), a = document.getElementById(t + "_mapdialogscreen"); a.innerHTML = ""; var r = document.createElement("div"); r.setAttribute("class", "box"), r.setAttribute("id", t + "_brushsizepicker"), a.appendChild(r); var i = document.createElement("h1"); i.innerHTML = map_lang_brushsettings, r.appendChild(i); for (var o = 5; o <= 50;) { var n = document.createElement("div"); n.setAttribute("class", "areaprefholder"), n.setAttribute("data-element-id", t), n.setAttribute("data-prefbrushsize", o), parseInt(e.getAttribute("data-current-brushsize")) == o ? n.setAttribute("data-active", "true") : n.setAttribute("data-active", "false"), r.appendChild(n), n.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapcontainer").setAttribute("data-current-brushsize", this.getAttribute("data-prefbrushsize")), document.getElementById(this.getAttribute("data-element-id") + "_brushsizepicker").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_brushsizepicker")), $(a).hide() }; var s = document.createElement("div"); s.setAttribute("class", "sizebox"), s.setAttribute("data-size", o), n.appendChild(s); var d = document.createElement("div"); d.setAttribute("class", "explainbox"), n.appendChild(d); var l = document.createElement("p"); l.innerHTML = o + " " + map_lang_brushsettings_pixels, d.appendChild(l), o += 10 == o ? 15 : 25 == o ? 5 : o > 29 ? 10 : 5 } $(a).show() } function map_linesettings(t) { var e = document.getElementById(t + "_mapcontainer"), a = document.getElementById(t + "_mapdialogscreen"), r = e.getAttribute("data-current-layer"), i = parseInt(e.getAttribute("data-current-linesize")); a.innerHTML = ""; var o = document.createElement("div"); o.setAttribute("class", "box"), o.setAttribute("id", t + "_mapsettings"), a.appendChild(o); var n = document.createElement("h1"); n.innerHTML = map_lang_linesettings, o.appendChild(n); var s = document.createElement("div"); s.setAttribute("class", "linesettingswrapper"), o.appendChild(s); var d = document.createElement("div"); d.setAttribute("class", "previewcolumn"), s.appendChild(d); var l = document.createElement("div"); l.setAttribute("class", "pickercolumn"), s.appendChild(l); var p = document.createElement("h3"); p.setAttribute("class", "list-head"), p.innerHTML = map_lang_linesetting_preset_header, l.appendChild(p); var m = document.createElement("ul"); l.appendChild(m); var u = ["oneway"], c = ["walls"], _ = !1, g = !1; Array.isArray(u) && $.inArray(r, u) > -1 && (_ = !0), Array.isArray(c) && $.inArray(r, c) > -1 && (g = !0); var h, f = []; _ || ((h = {}).name = map_lang_linesettings_five, h.value = 1, h.extra = map_lang_linesettings_goodforwalls, f.push(h), (h = {}).name = map_lang_linesettings_ten, h.value = 2, h.extra = map_lang_linesettings_goodforwalls, f.push(h)); g || ((h = {}).name = map_lang_linesettings_fifty, h.value = 10, h.extra = map_lang_linesettings_goodforlanes, f.push(h), (h = {}).name = map_lang_linesettings_hundred, h.value = 20, h.extra = map_lang_linesettings_goodforlanes, f.push(h)); for (var v = !1, b = 0; b < f.length;) { (B = document.createElement("li")).setAttribute("data-value", f[b].value), B.setAttribute("data-element-id", t), f[b].value == i ? (B.setAttribute("data-active", "true"), v = !0) : B.setAttribute("data-active", "false"), m.appendChild(B); var y = document.createElement("div"); if (y.setAttribute("class", "name"), y.innerHTML = f[b].name, B.appendChild(y), f[b].extra.length > 0) { var w = document.createElement("div"); w.setAttribute("class", "label"), w.innerHTML = f[b].extra, B.appendChild(w) } B.onclick = function () { var t = document.getElementById(this.getAttribute("data-element-id") + "_mapcontainer"); t.setAttribute("data-current-linesize", this.getAttribute("data-value")); var e = t.getAttribute("data-current-layer"); $(t).find("div.mapwrapper > div.mapdialogscreen > div.box > div.linesettingswrapper > div.pickercolumn > ul > li").attr("data-active", "false"), this.setAttribute("data-active", "true"); var a = t.getAttribute("data-selected-shape"); if (a.length > 0) { for (var r = (a = a.split("_")).length, i = a[r - 1], o = "", n = 1; n < r;)n < r - 1 && (n > 1 && (o += "_"), o += a[n]), n++; window["map_" + this.getAttribute("data-element-id") + "_metadata"].layers[o].shapes[i]; window["map_" + this.getAttribute("data-element-id") + "_metadata"].layers[o].shapes[i].brushsize = parseInt(this.getAttribute("data-value")), map_set_save_state(this.getAttribute("data-element-id"), "savable", !1); var s = document.getElementById(this.getAttribute("data-element-id") + "_layer_" + o), d = $(s).find("iframe"), l = $(d).contents(), p = $(l).find("#" + this.getAttribute("data-element-id") + "_" + o + "_" + i).attr("style"); p = p.split(";"); for (n = 0; n < p.length;)" stroke-width:" == p[n].substr(0, " stroke-width:".length) && (p[n] = " stroke-width: " + this.getAttribute("data-value") + "px"), n++; p = p.join(";"), $(l).find("#" + this.getAttribute("data-element-id") + "_" + o + "_" + i).attr("style", p) } document.getElementById("maplinesettingspreview").setAttribute("style", "fill: none; stroke-width: " + this.getAttribute("data-value") + "px; stroke: #75ACD8; stroke-linecap: butt; stroke-linejoin: bevel;"); var m = $("#" + this.getAttribute("data-element-id") + "_layer_" + e).find("iframe").contents().find("svg").find("#tempshape"); 1 == m.length && $(m).attr("stroke-width", t.getAttribute("data-current-linesize") + "px") }, b++ } var A = 5 * parseInt(i); if (_ || g) x = 10 * (E = _ ? 50 : 5), I = _ ? 10 : 5; else var E = 5, x = 500, I = 5; (B = document.createElement("li")).setAttribute("data-value", A / 5), B.setAttribute("data-element-id", t), B.setAttribute("data-active", !v), B.setAttribute("class", "input"); var B, M = document.createElement("h3"); M.setAttribute("class", "list-head"), M.innerHTML = map_lang_linesetting_custom_header, (B = $(B)).append(M); var C = '<div class="number-step-group"><i class="checkmark"></i><a href="#" class="less">-' + I + '</a><input type="number" min="' + E + '" step="' + I + '" max="' + x + '" value="' + A + '" /><label>cm</label><a href="#" class="more">+' + I + "</a></div>"; B.append(C); var k = B.find(".less"), T = B.find(".more"), z = B.find("input"); B.on("click change", (function () { var t = z.val(), e = parseInt(t) / 5; B.attr("data-value", e); var a = document.getElementById(this.getAttribute("data-element-id") + "_mapcontainer"); a.setAttribute("data-current-linesize", this.getAttribute("data-value")); var r = a.getAttribute("data-current-layer"); $(a).find("div.mapwrapper > div.mapdialogscreen > div.box > div.linesettingswrapper > div.pickercolumn > ul > li").attr("data-active", "false"), this.setAttribute("data-active", "true"); var i = a.getAttribute("data-selected-shape"); if (i.length > 0) { for (var o = (i = i.split("_")).length, n = i[o - 1], s = "", d = 1; d < o;)d < o - 1 && (d > 1 && (s += "_"), s += i[d]), d++; window["map_" + this.getAttribute("data-element-id") + "_metadata"].layers[s].shapes[n]; window["map_" + this.getAttribute("data-element-id") + "_metadata"].layers[s].shapes[n].brushsize = parseInt(this.getAttribute("data-value")), map_set_save_state(this.getAttribute("data-element-id"), "savable", !1); var l = document.getElementById(this.getAttribute("data-element-id") + "_layer_" + s), p = $(l).find("iframe"), m = $(p).contents(), u = $(m).find("#" + this.getAttribute("data-element-id") + "_" + s + "_" + n).attr("style"); u = u.split(";"); for (d = 0; d < u.length;)" stroke-width:" == u[d].substr(0, " stroke-width:".length) && (u[d] = " stroke-width: " + this.getAttribute("data-value") + "px"), d++; u = u.join(";"), $(m).find("#" + this.getAttribute("data-element-id") + "_" + s + "_" + n).attr("style", u) } document.getElementById("maplinesettingspreview").setAttribute("style", "fill: none; stroke-width: " + this.getAttribute("data-value") + "px; stroke: #75ACD8; stroke-linecap: butt; stroke-linejoin: bevel;"); var c = $("#" + this.getAttribute("data-element-id") + "_layer_" + r).find("iframe").contents().find("svg").find("#tempshape"); 1 == c.length && $(c).attr("stroke-width", a.getAttribute("data-current-linesize") + "px") })), k.on("click", (function (t) { t.preventDefault(); var e = parseInt(z.val()) - I; e = e < E ? E : e, z.val(e), B.trigger("change") })), T.on("click", (function (t) { t.preventDefault(); var e = parseInt(z.val()) + I; e = e > x ? x : e, z.val(e), B.trigger("change") })), z.on("blur", (function () { var t = z.val(); t = (t = t > x ? x : t) < E ? E : t, z.val(t), B.trigger("change") })), z.on("keyup", (function (t) { if (8 != t.which && isNaN(String.fromCharCode(t.which)) && t.preventDefault(), 13 === t.keyCode) { var e = z.val(); e = (e = e > x ? x : e) < E ? E : e, z.val(e), B.trigger("change") } })), $(m).append(B); var R = document.createElementNS("http://www.w3.org/2000/svg", "svg"); R.setAttribute("width", 200), R.setAttribute("height", 200), d.appendChild(R); var L = document.createElementNS("http://www.w3.org/2000/svg", "path"); L.setAttribute("d", "M10 10L10 190L60 190L60 110L130 110L180 10"), L.setAttribute("style", "fill: none; stroke: #75ACD8; stroke-width: " + i + "px; stroke-linecap: butt; stroke-linejoin: bevel;"), L.setAttribute("id", "maplinesettingspreview"), R.appendChild(L); var F = document.createElement("div"); F.setAttribute("class", "okbutton"), F.setAttribute("data-element-id", t), F.innerHTML = map_lang_linesettings_close, o.appendChild(F), F.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(a).hide() }, $(a).show() } function map_set_mychoice(t) { $(".current_layer").removeClass("current_layer"); var e = document.getElementById(t + "_mapcontainer"), a = ""; if (document.getElementById(t + "_toolbutton_mychoice_selector")) try { var r = document.getElementById(t + "_toolbutton_mychoice_selector"); a = r.options[r.selectedIndex].value, $(r).parent().attr("data-val", a) } catch (t) { console.log(t) } e.setAttribute("data-mychoice", a), a || $(".toolbarbutton_itemselector").show(), "walls" == a ? e.setAttribute("data-current-linesize", "1") : e.setAttribute("data-current-linesize", "20"), e.setAttribute("data-areaevent-name", ""); var i = void 0 !== MIR.constants.MAP.choice_layers[a] ? MIR.constants.MAP.choice_layers[a] : ""; e.setAttribute("data-current-layer", i); var o = document.getElementById(t + "_layer_" + i), n = $(o).find("iframe"); if (n) { var s = $(n).contents(); $(s).find("#tempshape").remove() } window[t + "_localpoints"] = []; map_navigator(t), a.length > 0 ? map_set_guide(t, window["map_lang_guide_mychoice_" + a]) : map_clear_guide(t), map_toolbars_place(), map_show_all_layers(t); var d = MIR.runtime.maps[t].mir.get_chosen_layer(); if (d && (map_itemselector(t), map_isolate_layer(t, d), -1 != d.indexOf("areaevents_"))) { var l = area_events.getAreaColor(a); if ("object" == typeof l) { var p = { "background-color": "rgba(" + l.rgb_string + ", 0.8)", border: "1px solid rgba(" + l.rgb_string + ")" }; $(".colorholder").css(p) } } return !0 } function map_reset_mychoice(t) { var e = document.getElementById(t + "_mapcontainer"); if (e.setAttribute("data-mychoice", ""), "true" == e.getAttribute("data-drawable")) { var a = document.getElementById(t + "_toolbutton_mychoice_selector"); $(a).val("").selectmenu("refresh") } return !0 } function map_autoselect_layer(t, e, a) { var r = document.getElementById(t + "_mapcontainer").getAttribute("data-mychoice"), i = ""; return i = "walls" == r && "vectors" == e ? "walls" : "walls" == r ? "basemap_walls" : "floors" == r && "vectors" == e ? "floor" : "floors" == r ? "basemap_floor" : "oneway" == r ? "oneway" : "preferred" == r || "unpreferred" == r || "forbidden" == r || "critical" == r ? "areaprefs_" + r : "areaevents_" + r, 1 == a || map_layercontrol_set_layer(t, i), !0 } function map_set_save_state(t, e, a) { var r = document.getElementById(t + "_mapcontainer"), i = r.getAttribute("data-save-state"); return "saved" == e || "saving" == e ? resetChanges() : submitwarn_set(), "saving" == i && "saved" == e && 1 == a ? r.getAttribute("data-next-save-state").length > 0 ? (r.setAttribute("data-save-state", r.getAttribute("data-next-save-state")), r.setAttribute("data-next-save-state", "")) : r.setAttribute("data-save-state", "saved") : "saving" == e && 1 == a ? r.setAttribute("data-save-state", "saving") : "saving" == i ? r.setAttribute("data-next-save-state", e) : (r.setAttribute("data-save-state", e), r.setAttribute("data-next-save-state", "")), !0 } function map_autosave(t) { "savable" == document.getElementById(t + "_mapcontainer").getAttribute("data-save-state") && map_save(t, !0) } function map_set_guide(t, e) { return document.getElementById(t + "_mapguide").innerHTML = e, map_determine_guide_visibility(t), !0 } function map_clear_guide(t) { return document.getElementById(t + "_mapguide").innerHTML = "", map_determine_guide_visibility(t), !0 } function map_determine_guide_visibility(t) { var e = document.getElementById(t + "_mapguidescreen"); return 0 == document.getElementById(t + "_mapguide").innerHTML.length ? e.setAttribute("data-visible", "false") : e.setAttribute("data-visible", "true"), !0 } function map_misc(t) { document.getElementById(t + "_mapcontainer"); var e = document.getElementById(t + "_mapdialogscreen"); e.innerHTML = ""; var a = document.createElement("div"); a.setAttribute("class", "box"), a.setAttribute("id", t + "_mapsettings"), e.appendChild(a); var r = document.createElement("h1"); r.innerHTML = "<span>" + mir_translate("Miscellaneous") + "</span>", a.appendChild(r); var i = document.createElement("div"); i.setAttribute("class", "mapmiscwrapper"), a.appendChild(i); var o = document.createElement("table"); o.setAttribute("cellpadding", "0"), o.setAttribute("cellspacing", "0"), i.appendChild(o); var n = document.createElement("tr"); if (o.appendChild(n), (p = document.createElement("td")).setAttribute("class", "buttoncell"), n.appendChild(p), (s = document.createElement("div")).setAttribute("class", "upload_destructive"), s.innerHTML = "<span>" + mir_translate("Destructive upload") + "</span>", s.setAttribute("data-element-id", t), s.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(e).hide(), map_upload(this.getAttribute("data-element-id")) }, p.appendChild(s), (p = document.createElement("td")).setAttribute("class", "explaincell"), n.appendChild(p), (d = document.createElement("span")).innerHTML = mir_translate("Destructive upload"), p.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate("Replace existing map with uploaded map."), p.appendChild(l), "robot" == systemtype) { (p = document.createElement("td")).setAttribute("class", "buttoncell"), n.appendChild(p), (s = document.createElement("div")).setAttribute("class", "record_destructive"), s.innerHTML = "<span>" + mir_translate("Destructive record") + "</span>", s.setAttribute("data-element-id", t), s.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(e).hide(), map_record_start_check(this.getAttribute("data-element-id")) }, p.appendChild(s), (p = document.createElement("td")).setAttribute("class", "explaincell"), n.appendChild(p), (d = document.createElement("span")).innerHTML = mir_translate("Destructive record"), p.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate("Replace existing map with new recording of map."), p.appendChild(l); n = document.createElement("tr"); o.appendChild(n) } ((p = document.createElement("td")).setAttribute("class", "buttoncell"), n.appendChild(p), (s = document.createElement("div")).setAttribute("class", "upload_append"), s.innerHTML = "<span>" + mir_translate("Append upload") + "</span>", s.setAttribute("data-element-id", t), s.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(e).hide(), map_upload(this.getAttribute("data-element-id"), !0) }, p.appendChild(s), (p = document.createElement("td")).setAttribute("class", "explaincell"), n.appendChild(p), (d = document.createElement("span")).innerHTML = mir_translate("Append upload"), p.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate("Upload a new map to append to current map."), p.appendChild(l), "robot" == systemtype) && ((p = document.createElement("td")).setAttribute("class", "buttoncell"), n.appendChild(p), (s = document.createElement("div")).setAttribute("class", "record_append"), s.innerHTML = "<span>" + mir_translate("Append record") + "</span>", s.setAttribute("data-element-id", t), s.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(e).hide(), map_record_start_check(this.getAttribute("data-element-id"), !0) }, p.appendChild(s), (p = document.createElement("td")).setAttribute("class", "explaincell"), n.appendChild(p), (d = document.createElement("span")).innerHTML = mir_translate("Append record"), p.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate("Record a new map and append it to existing map."), p.appendChild(l)); var s, d, l, p; n = document.createElement("tr"); o.appendChild(n), (p = document.createElement("td")).setAttribute("class", "buttoncell"), n.appendChild(p), (s = document.createElement("div")).setAttribute("class", "download"), s.innerHTML = "<span>" + mir_translate("Download map") + "<span>", s.setAttribute("data-element-id", t), s.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(e).hide(), map_download(this.getAttribute("data-element-id")) }, p.appendChild(s), (p = document.createElement("td")).setAttribute("class", "explaincell"), n.appendChild(p), (d = document.createElement("span")).innerHTML = mir_translate("Download map"), p.appendChild(d), (l = document.createElement("p")).innerHTML = mir_translate("Download the current map."), p.appendChild(l), (p = document.createElement("td")).setAttribute("class", "buttoncell"), p.innerHTML = "&nbsp;", n.appendChild(p), (p = document.createElement("td")).setAttribute("class", "explaincell"), p.innerHTML = "&nbsp;", n.appendChild(p); var m = document.createElement("div"); return m.setAttribute("class", "okbutton"), m.setAttribute("data-element-id", t), m.innerHTML = mir_translate("Cancel"), a.appendChild(m), m.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(e).hide() }, $(e).show(), !0 } function map_undo(t) { var e = document.getElementById(t + "_mapcontainer"); return "shapedrawer" == e.getAttribute("data-current-tool") || "linedrawer" == e.getAttribute("data-current-tool") || ("true" == e.getAttribute("data-undoable") && window["map_" + t + "_history"].length > 0 ? (map_perform_undo(t, window["map_" + t + "_history"][0]), window["map_" + t + "_history"].splice(0, 1), window["map_" + t + "_history"].length > 0 ? e.setAttribute("data-undoable", "true") : e.setAttribute("data-undoable", "false")) : e.setAttribute("data-undoable", "false")), !0 } function map_add_to_history(t, e) { var a = document.getElementById(t + "_mapcontainer"); return window["map_" + t + "_history"].unshift(e), window["map_" + t + "_history"].length > 10 && window["map_" + t + "_history"].splice(10, window["map_" + t + "_history"].length - 10), window["map_" + t + "_history"].length > 0 ? a.setAttribute("data-undoable", "true") : a.setAttribute("data-undoable", "false"), !0 } function map_perform_undo(t, e) { var a = document.getElementById(t + "_mapcontainer"), r = document.getElementById(t + "_mapdrawer"), i = parseFloat(a.getAttribute("data-zoom-scale")); if ("move_point" == e.type) { for (var o = window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].polygon, n = "", s = !1, d = 0; d < o.length;)d == e.point_id ? (0 == s ? (n += "M", s = !0) : n += "L", n += e.old_x + " " + e.old_y) : "DELETED" == o[d] || (0 == s ? (n += "M", s = !0) : n += "L", n += o[d].x + " " + o[d].y), d++; window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].polygon[e.point_id].x = e.old_x, window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].polygon[e.point_id].y = e.old_y, "shape" == window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].type && (n += "z"); var l = document.getElementById(t + "_layer_" + e.layer), p = $(l).find("iframe"), m = $(p).contents(); $(m).find("#" + t + "_" + e.layer + "_" + e.path_id).attr("d", n); var u = Math.round(e.old_y * i) + parseFloat(a.getAttribute("data-zoom-offset-top")), c = Math.round(e.old_x * i) + parseFloat(a.getAttribute("data-zoom-offset-left")); $(r).find("div.refigurepathhandle[data-layer='" + e.layer + "'][data-path='" + e.path_id + "'][data-point='" + e.point_id + "']").css("top", u), $(r).find("div.refigurepathhandle[data-layer='" + e.layer + "'][data-path='" + e.path_id + "'][data-point='" + e.point_id + "']").css("left", c), map_set_save_state(t, "savable", !1) } else if ("delete_point" == e.type) { window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].polygon[e.point_id] = e.old_obj; for (o = window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].polygon, n = "", d = 0, s = !1; d < o.length;)"DELETED" == o[d] && d !== e.point_id || (0 == s ? (n += "M", s = !0) : n += "L", n += o[d].x + " " + o[d].y), d++; "stroke" == window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id].type || (n += "z"); l = document.getElementById(t + "_layer_" + e.layer), p = $(l).find("iframe"), m = $(p).contents(); $(m).find("#" + t + "_" + e.layer + "_" + e.path_id).attr("d", n); u = Math.round(e.old_obj.y * i) + parseFloat(a.getAttribute("data-zoom-offset-top")), c = Math.round(e.old_obj.x * i) + parseFloat(a.getAttribute("data-zoom-offset-left")); var _ = document.createElement("div"); _.setAttribute("class", "refigurepathhandle"), _.setAttribute("data-layer", e.layer), _.setAttribute("data-path", e.path_id), _.setAttribute("data-point", e.point_id), _.setAttribute("data-element-id", t), r.appendChild(_), $(_).css("top", u), $(_).css("left", c), map_set_save_state(t, "savable", !1) } else if ("delete_shape" == e.type) { var g = $("#" + t + "_layer_" + e.layer).find("iframe").contents().find("svg"), h = document.createElementNS("http://www.w3.org/2000/svg", "path"); h.setAttribute("d", e.svgdata), "shape" == e.old_obj.type ? h.setAttribute("style", "fill: " + e.old_obj.color + "; stroke: none; opacity: 1;") : h.setAttribute("style", "fill: none; stroke: " + e.old_obj.color + "; stroke-width: " + e.old_obj.brushsize + "px; stroke-linecap: butt; stroke-linejoin: bevel; opacity: 1;"), h.setAttribute("id", t + "_" + e.layer + "_" + e.path_id), h.setAttribute("class", t + "_svgpath"), g.append(h), window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id] = e.old_obj, map_set_save_state(t, "savable", !1) } else if ("insert_point" == e.type) { l = document.getElementById(t + "_layer_" + e.layer), p = $(l).find("iframe"), m = $(p).contents(); $(m).find("#" + t + "_" + e.layer + "_" + e.path_id).attr("d", e.svgdata), window["map_" + t + "_metadata"].layers[e.layer].shapes[e.path_id] = e.old_obj, $(r).find("div.refigurepathhandle[data-layer='" + e.layer + "'][data-path='" + e.path_id + "'][data-point='" + e.point_id + "']").remove(), map_set_save_state(t, "savable", !1) } else if ("delete_pixels" == e.type) { (l = document.getElementById(t + "_layer_" + e.layer)).getElementsByTagName("canvas")[0]; "basemap_floor" == e.layer ? document.getElementById(t + "_real_basemap_floor_img").src = e.data : document.getElementById(t + "_real_basemap_walls_img").src = e.data, map_set_save_state(t, "savable", !1) } else if ("create_shape" == e.type) { l = document.getElementById(t + "_layer_" + e.layer), p = $(l).find("iframe"), m = $(p).contents(); $(m).find("#" + e.path_id).remove(), window["map_" + t + "_metadata"].layers[e.layer].shapes[e.removeid] = "DELETED", map_set_save_state(t, "savable", !1) } return map_navigator(t), !0 } function map_delete(t, e) { 1 == e ? (launch_waiter(map_lang_deletemap_deleting), instant_delete("/maps", t, "location.href='/setup/maps';")) : launch_confirm(map_lang_deletemap_headline, map_lang_deletemap_text, "map_delete('" + t + "',true)", map_lang_deletemap_btn_delete, map_lang_deletemap_btn_cancel) } function map_update_ghost(t, e, a) { var r = document.getElementById(t + "_layer_" + e), i = $(r).find("iframe"), o = $(i).contents(); return 1 == $(o).find("#" + t + "_" + e + "_" + a).length ? $(o).find("#" + t + "_" + e + "_" + a + "_ghost").attr("d", $(o).find("#" + t + "_" + e + "_" + a).attr("d")) : $(o).find("#" + t + "_" + e + "_" + a + "_ghost").remove(), !0 } function map_toolbars_place() { return $("div.mapcontainer").each((function () { $(this).attr("data-toollines", "1"), $(this).children("div.maptoolbar").height() > 40 ? $(this).attr("data-toollines", "2") : $(this).attr("data-toollines", "1") })), !0 } function map_draw_helpline(t, e) { var a = document.getElementById(t + "_mapcontainer"), r = a.getAttribute("data-current-layer"); return $(document).off("mousemove", "#" + t + "_mapdrawer"), $(document).on("mousemove", "#" + t + "_mapdrawer", (function (e) { if (e.stopPropagation(), e.preventDefault(), !0 === e.handled) return !1; e.handled = !0; var i = parseFloat(a.getAttribute("data-zoom-scale")); if (null == e.originalEvent) var o = window["map_" + t + "_last_mouse_x"], n = window["map_" + t + "_last_mouse_y"]; else if (null == e.originalEvent.offsetX && e.originalEvent.touches[0].length > -1) { var s = document.getElementById(t + "_mapdrawer").getBoundingClientRect(); o = e.originalEvent.touches[0].clientX - s.left, n = e.originalEvent.touches[0].clientY - s.top } else o = e.originalEvent.offsetX, n = e.originalEvent.offsetY; window["map_" + t + "_last_mouse_x"] = o, window["map_" + t + "_last_mouse_y"] = n, o -= parseFloat(a.getAttribute("data-zoom-offset-left")), n -= parseFloat(a.getAttribute("data-zoom-offset-top")), o = Math.round(o / i), n = Math.round(n / i); var d = calculate_angle_between_points(o, n, window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x, window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y), l = ""; l = d >= -45 && d <= 45 ? "y" : d >= 45 && d <= 135 ? "x" : d >= 135 || d <= -135 ? "y" : "x"; var p = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x, m = window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y; p *= i, m *= i, p += parseFloat(a.getAttribute("data-zoom-offset-left")), m += parseFloat(a.getAttribute("data-zoom-offset-top")), "x" == l ? (o = p, o -= parseFloat(a.getAttribute("data-zoom-offset-left")), o = Math.round(o / i)) : (n = m, n -= parseFloat(a.getAttribute("data-zoom-offset-top")), n = Math.round(n / i)); document.getElementById(t + "_layer_" + r); var u = $("#" + t + "_layer_" + r).find("iframe").contents().find("svg"); if ($(u).find("#helpline").remove(), 0 == window["map_" + t + "_hitpoint"]) { var c = "M" + window[t + "_localpoints"][window[t + "_localpoints"].length - 1].x + " " + window[t + "_localpoints"][window[t + "_localpoints"].length - 1].y + "L" + o + " " + n, _ = document.createElementNS("http://www.w3.org/2000/svg", "path"); _.setAttribute("d", c), _.setAttribute("fill", "none"), _.setAttribute("stroke", "#bb0000"), _.setAttribute("stroke-width", "1px"), _.setAttribute("stroke-linecap", "butt"), _.setAttribute("stroke-linejoin", "bevel"), _.setAttribute("stroke-dasharray", "3,3"), _.setAttribute("opacity", "1"), _.setAttribute("id", "helpline"), u.append(_) } })), 1 == e && $("#" + t + "_mapdrawer").trigger("mousemove"), !0 } function map_clean_helpline(t) { var e = document.getElementById(t + "_mapcontainer").getAttribute("data-current-layer"); $(document).off("mousemove", "#" + t + "_mapdrawer"); document.getElementById(t + "_layer_" + e); var a = $("#" + t + "_layer_" + e).find("iframe").contents().find("svg"); return $(a).find("#helpline").remove(), $(document).on("mousemove", "#" + t + "_mapdrawer", (function (e) { if (null == e.originalEvent.offsetX) { var a = document.getElementById(t + "_mapdrawer").getBoundingClientRect(); window["map_" + t + "_last_mouse_x"] = e.originalEvent.touches[0].clientX - a.left, window["map_" + t + "_last_mouse_y"] = e.originalEvent.touches[0].clientY - a.top } else window["map_" + t + "_last_mouse_x"] = e.originalEvent.offsetX, window["map_" + t + "_last_mouse_y"] = e.originalEvent.offsetY })), !0 } function determine_marker_images(t) { var e = Object.values(MIR.constants.MARKER_TYPES), a = $("#" + t + "_layer_positions>.position").filter((function (t, a) { return e.indexOf(parseInt($(a).attr("data-type-id"))) > -1 })).children(); if (a.length > 0) { var r = a.height() < 30; a.toggle(!r) } return !0 } function map_appendplacer_start(t) { launch_waiter(mir_translate("Setting up workspace...")); var e = document.getElementById(t + "_mapcontainer"), a = document.getElementById(t + "_map"); e.setAttribute("data-appendmode", "true"); var r = parseFloat(e.getAttribute("data-resscale")), i = parseFloat(e.getAttribute("data-origin-x")), o = parseFloat(e.getAttribute("data-origin-y")), n = parseInt(e.getAttribute("data-map-height")), s = { mode: "map-get-appendlayers" }; return s.id = e.getAttribute("data-map-guid"), $.ajax({ url: "/", data: s, method: "GET", dataType: "json", success: function (s) { if (s.appendlayers.length > 0) { var d = document.createElement("div"); d.setAttribute("class", "appendholder"), d.setAttribute("id", t + "_layer_appendholder"), a.appendChild(d); for (var l = 0; l < s.appendlayers.length;) { var p = document.createElement("img"); p.setAttribute("src", "/?calltype=light&mode=map-appendlayer-preview&map_id=" + e.getAttribute("data-map-guid") + "&id=" + s.appendlayers[l].id), p.setAttribute("width", Math.round(s.appendlayers[l].width)), p.setAttribute("height", Math.round(s.appendlayers[l].height)); var m = document.createElement("div"); m.setAttribute("class", "handle_drag"), m.setAttribute("data-action", "drag"); var u = document.createElement("div"); u.setAttribute("class", "handle_rotate_upleft"), u.setAttribute("data-action", "rotate"); var c = document.createElement("div"); c.setAttribute("class", "handle_rotate_upright"), c.setAttribute("data-action", "rotate"); var _ = document.createElement("div"); _.setAttribute("class", "handle_rotate_downleft"), _.setAttribute("data-action", "rotate"); var g = document.createElement("div"); g.setAttribute("class", "handle_rotate_downright"), g.setAttribute("data-action", "rotate"); var h = parseFloat(s.appendlayers[l].pos_x), f = parseFloat(s.appendlayers[l].pos_y); h = h * r - i, f = n - (f = f * r - o); var v = parseFloat(s.appendlayers[l].rotation), b = document.createElement("div"); b.setAttribute("class", "appendee"), b.setAttribute("data-id", s.appendlayers[l].id), b.setAttribute("data-pos-x", h), b.setAttribute("data-pos-y", f), b.setAttribute("data-width", s.appendlayers[l].width), b.setAttribute("data-height", s.appendlayers[l].height), b.setAttribute("data-rotation", v), b.setAttribute("data-rotating", "false"), b.setAttribute("data-rotation-start-angle", ""), b.setAttribute("data-rotation-current-angle", ""), b.setAttribute("style", "top: " + f + "px; left: " + h + "px; width: " + Math.round(s.appendlayers[l].width) + "px; height: " + Math.round(s.appendlayers[l].height) + "px;"), b.appendChild(p), b.appendChild(m), b.appendChild(u), b.appendChild(c), b.appendChild(_), b.appendChild(g), d.appendChild(b), $(b).css("WebkitTransform", "rotate(" + v + "deg)"), $(b).css("-moz-transform", "rotate(" + v + "deg)"), $(b).css("-ms-transform", "rotate(" + v + "deg)"), $(b).css("transform", "rotate(" + v + "deg)"); $(b).draggable({ handle: ".handle_drag,.handle_rotate_upleft,.handle_rotate_upright,.handle_rotate_downleft,.handle_rotate_downright", start: function (t, e) { if ("rotate" == t.originalEvent.target.getAttribute("data-action")) { var a = $(this).offset(), r = a.left + $(this).width() / 2, i = a.top + $(this).height() / 2, o = t.originalEvent.originalEvent.clientX, n = t.originalEvent.originalEvent.clientY, s = calculate_angle_between_points(r, i, o, n) + 180; this.setAttribute("data-rotation-start-angle", s), this.setAttribute("data-rotation-center-x", r), this.setAttribute("data-rotation-center-y", i), this.setAttribute("data-rotating", "true") } else t.clientX, t.clientY }, stop: function (t, e) { "true" == this.getAttribute("data-rotating") ? (this.setAttribute("data-rotation", this.getAttribute("data-rotation-current-angle")), this.setAttribute("data-rotation-start-angle", ""), this.setAttribute("data-rotation-current-angle", ""), this.setAttribute("data-rotating", "false")) : (this.setAttribute("data-pos-x", e.position.left), this.setAttribute("data-pos-y", e.position.top)) }, drag: function (t, e) { if ("true" == this.getAttribute("data-rotating")) { e.position.left = this.getAttribute("data-pos-x"), e.position.top = this.getAttribute("data-pos-y"); var a = parseFloat(this.getAttribute("data-rotation-center-x")), r = parseFloat(this.getAttribute("data-rotation-center-y")), i = t.originalEvent.originalEvent.clientX, o = t.originalEvent.originalEvent.clientY, n = calculate_angle_between_points(a, r, i, o) + 180, s = parseFloat(this.getAttribute("data-rotation")) + (n - parseFloat(this.getAttribute("data-rotation-start-angle"))); this.setAttribute("data-rotation-current-angle", s), $(this).css("WebkitTransform", "rotate(" + s + "deg)"), $(this).css("-moz-transform", "rotate(" + s + "deg)"), $(this).css("-ms-transform", "rotate(" + s + "deg)"), $(this).css("transform", "rotate(" + s + "deg)") } } }), l++ } } else map_appendplacer_stop(t, !1); close_waiter() } }), !0 } function map_appendplacer_stop(t, e) { var a = document.getElementById(t + "_mapcontainer"); if (a.setAttribute("data-appendmode", "false"), 1 == e) { launch_waiter(mir_translate("Merging the maps...")); var r = []; $(a).find("#" + t + "_layer_appendholder > div.appendee").each((function () { var t = {}; t.pos_x = parseFloat(this.getAttribute("data-pos-x")), t.pos_y = parseFloat(this.getAttribute("data-pos-y")), t.rotation = parseFloat(this.getAttribute("data-rotation")), t.id = this.getAttribute("data-id"), r.push(t) })), (i = {}).id = a.getAttribute("data-map-guid"), i.resscale = a.getAttribute("data-resscale"), i.origin_x = a.getAttribute("data-origin-x"), i.origin_y = a.getAttribute("data-origin-y"), i.resolution = a.getAttribute("data-resolution"), i.appendlayers = r, $.ajax({ url: "/?mode=map-save-appendlayers", data: i, method: "POST", dataType: "json", success: function (e) { var r = {}; r["map_" + t + "_appendmapping"] = "false", $.post("/?mode=set-runtime-settings", r); var i = new Date; window.pageviewid = "refresh_" + i.getTime(), $(a).find("#" + t + "_layer_appendholder").remove(), $.post("/?mode=delete-runtime-settings"), close_waiter(), map_init(t, a.getAttribute("data-map-guid")) } }) } else { var i; launch_waiter(mir_translate("Removing the recorded map...")), (i = {}).id = a.getAttribute("data-map-guid"), $.ajax({ url: "/?mode=map-discard-appendlayers", data: i, method: "POST", dataType: "json", success: function (e) { var r = {}; r["map_" + t + "_appendmapping"] = "false", $.post("/?mode=set-runtime-settings", r); var i = new Date; window.pageviewid = "refresh_" + i.getTime(), $(a).find("#" + t + "_layer_appendholder").remove(), $.post("/?mode=delete-runtime-settings"), close_waiter(), map_init(t, a.getAttribute("data-map-guid")) } }) } return !0 } function map_fleet_go_to_position(t, e, a) { var r = document.getElementById(t + "_mapcontainer"), i = document.getElementById(t + "_mapdialogscreen"); i.innerHTML = ""; var o = document.createElement("div"); o.setAttribute("class", "box"), o.setAttribute("id", t + "_mapsettings"), i.appendChild(o); var n = document.createElement("h1"); n.innerHTML = mir_translate("Select a") + "<span> " + mir_translate("robot") + "</span>", o.appendChild(n); var s = document.createElement("p"); s.innerHTML = "<span>" + mir_translate("Please select which robot you want to go to the selected position.") + "</span>", o.appendChild(s); var d = document.createElement("form"); d.setAttribute("action", ""), d.setAttribute("method", "post"), d.setAttribute("data-guid", e), d.setAttribute("data-type", a), o.appendChild(d), d.onsubmit = function () { var t = this.getAttribute("data-guid"), e = this.getAttribute("data-type"), a = $(this).find("select#robot_id").val(); return document.getElementById(r.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(r.getAttribute("data-element-id") + "_mapsettings")), $(i).hide(), map_go_to_position(t, e, "no", a), !1 }; var l = document.createElement("div"); l.setAttribute("class", "fieldholder"), d.appendChild(l); var p = document.createElement("label"); p.setAttribute("for", "robot_id"), p.innerHTML = mir_translate("Robot:"), l.appendChild(p); var m = document.createElement("select"); m.setAttribute("name", "robot_id"), m.setAttribute("id", "robot_id"), m.setAttribute("data-element-id", t), l.appendChild(m); var u, c = document.createElement("div"); c.setAttribute("class", "buttonholder"), d.appendChild(c), (u = document.createElement("input")).setAttribute("type", "submit"), u.setAttribute("value", mir_translate("OK")), u.setAttribute("name", "submit"), u.setAttribute("id", "submit"), c.appendChild(u), (u = document.createElement("input")).setAttribute("type", "button"), u.setAttribute("value", mir_translate("Cancel")), u.setAttribute("name", "cancel"), u.setAttribute("id", "cancel"), u.setAttribute("data-element-id", t), c.appendChild(u), u.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_mapsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_mapsettings")), $(i).hide() }; var _ = { endpoint: "/robots", fields: ["id", "status"] }; return $.ajax({ url: "/?mode=get-api-list", data: _, method: "POST", dataType: "json", success: function (t) { for (var e = 0; e < t.results.length;) { var a = document.createElement("option"); a.setAttribute("value", t.results[e].id), a.innerHTML = t.results[e].status.robot_name, $(i).find("select#robot_id").append(a), e++ } } }), $(i).show(), !0 } function map_fleet_init(t) { var e = MIR.runtime.maps[t], a = e.attr("data-robotlock"), r = $("#" + t + '_mapcontainer  .layer[data-layertype="robot"]'); r.find(".robot").remove(); var i = e.attr("data-map-guid"); window.fleet_robot_dialog_active_robot = 1; var o = []; function n(t, r) { t.attr("current-state", r.state); var i = e.attr("data-resscale"), o = e.attr("data-origin-x"), n = e.attr("data-origin-y"), s = e.attr("data-map-height"); if (window["fleet_robot_data_" + r.robot_id] = r, update_robotinfo(), r.position) { var d = r.position.x * i - o, l = s - (r.position.y * i - n); "true" == e.attr("data-locked") && a == r.robot_id && e.mir.center_coords({ x: parseFloat(d), y: parseFloat(l) }, MIR.constants.MAP.world.MAP, { interval: 100, callback: !1 }); var p = r.position.orientation; (p = -(p + 90)) < 0 ? p += 360 : p > 360 && (p -= 360), t.css("top", l), t.css("left", d), t.css({ transform: "rotate(" + p + "deg)", WebkitTransform: "rotate(" + p + "deg)", "-moz-transform": "rotate(" + p + "deg)", "-ms-transform": "rotate(" + p + "deg)" }); var m = t.parent().find(".footprint").find("polygon"); if (m.length && r.robot_id.toString() === window.fleet_robot_dialog_active_robot) { var u = JSON.parse(r.footprint); if (u) { var c = $.map(u, (function (t) { return [t[0] * i + "," + t[1] * i] })).join(" "); m.attr("points", c), m.parent().css({ transform: "rotate(" + p + "deg)", WebkitTransform: "rotate(" + p + "deg)", "-moz-transform": "rotate(" + p + "deg)", "-ms-transform": "rotate(" + p + "deg)", left: d, top: l }) } } } } var s = { url: "/?mode=map-get-fleet-robots", data: { id: i }, dataType: "json", success: function (t) { var e; e = t, $.each(e.robots, (function (t, e) { if (o.filter((function (t) { return t.id === e.id })).length <= 0) { var a = e; o.push(e), r.append('<div class="robot" robot-id="' + e.id + '" current-state="' + e.state + '" robot-ip="' + e.ip + '" robot-model="' + e.robot_model + '" data-name="' + e.name + '"><div class="light"></div></div>'); var i = r.find('.robot[robot-id="' + e.id + '"]'), s = MIR.ros.protocol + e.ip + ":" + MIR.ros.port; "443" == MIR.ros.port && (s = MIR.ros.protocol + e.ip + ":" + MIR.ros.port + "/rosbridge/"), a.ros = new ROSLIB.Ros({ url: s }), window["robot_ros_" + e.id] = a, a.topic = new ROSLIB.Topic({ ros: a.ros, name: "/robot_status", messageType: "mirMsgs/RobotStatus" }), $(".footprint").remove(), a.topic.subscribe((function (t) { var a = { position: t.position, state: t.state_id, robot_id: e.id, errors: t.errors, mode_id: t.mode_id, mode_text: t.mode_text, name: e.name, mission_text: mir_translate_from_rosbridge(t.mission_text), battery_percentage: t.battery_percentage, fleet_state_text: e.fleet_state_text, ip_address: e.ip, software_version: t.software_version, state_text: t.state_text, safety_muted: t.safety_system_muted, footprint: e.footprint }; n(i, a) })), a.ros.on("error", (function (t) { n(i, a) })) } })), $.each(o, (function (t, a) { e.robots.filter((function (t) { return t.id === a.id })).length <= 0 && (o[t].topic.unsubscribe(), o.splice(t, 1), r.find('.robot[robot-id="' + a.id + '"]').remove()) })), robots_fetched = !0 } }; setInterval((function () { !1 !== robots_fetched && (robots_fetched = !1, $.post(s)) }), 2e3) } function map_set_oneway_direction(t) { var e = document.getElementById(t + "_mapcontainer"), a = document.getElementById(t + "_mapdialogscreen"); a.innerHTML = "", document.getElementById(t + "_onewaydirectionsettings") && document.getElementById(t + "_onewaydirectionsettings").parentNode.removeChild(document.getElementById(t + "_onewaydirectionsettings")), $(a).hide(); var r = document.createElement("div"); r.setAttribute("class", "box"), r.setAttribute("data-type", "onewaydirectionsettings"), r.setAttribute("id", t + "_onewaydirectionsettings"), a.appendChild(r); var i = document.createElement("h1"); i.innerHTML = mir_translate("Choose direction"), r.appendChild(i); var o = document.createElement("div"); o.setAttribute("class", "dirpicker"), r.appendChild(o); var n = document.createElement("div"); n.setAttribute("class", "cirque"), o.appendChild(n); for (var s = ["upleft", "up", "upright", "right", "left", "downright", "down", "downleft"], d = 0; d < s.length;) { var l = document.createElement("div"); l.setAttribute("data-dir", s[d]), l.setAttribute("data-element-id", t), s[d] == e.getAttribute("data-oneway-direction") ? l.setAttribute("data-active", "true") : l.setAttribute("data-active", "false"), l.setAttribute("class", s[d]), l.innerHTML = "<span>" + s[d] + "</span>\n", o.appendChild(l), l.onclick = function () { var t = document.getElementById(this.getAttribute("data-element-id") + "_mapcontainer"); if (t.setAttribute("data-oneway-direction", this.getAttribute("data-dir")), t.getAttribute("data-selected-shape").length > 0 && "shape" == t.getAttribute("data-selected-shape-type") && "oneway" == t.getAttribute("data-current-layer")) { var e = t.getAttribute("data-selected-shape"), r = -1; if (e.indexOf("_") > -1) { var i = e.split("_"); r = i[i.length - 1] } if (r > -1) { window["map_" + this.getAttribute("data-element-id") + "_metadata"].layers.oneway.shapes[r].direction = this.getAttribute("data-dir"); var o = $("#" + this.getAttribute("data-element-id") + "_layer_oneway").find("iframe"), n = $(o).contents(); $(n).find("#" + t.getAttribute("data-selected-shape")).css("fill", "url(#pattern_arrow_" + this.getAttribute("data-dir") + ")"), map_set_save_state(this.getAttribute("data-element-id"), "savable", !1) } } return document.getElementById(this.getAttribute("data-element-id") + "_onewaydirectionsettings").parentNode.removeChild(document.getElementById(this.getAttribute("data-element-id") + "_onewaydirectionsettings")), $(a).hide(), !0 }, d++ } return $(a).show(), !0 } function robot_dialog(t) { var e = t.closest(".mapcontainer"), a = e.getAttribute("data-element-id"), r = document.getElementById(a + "_robotinfoscreen"); window.fleet_robot_dialog_active_robot = t.getAttribute("robot-id"), document.getElementsByClassName("robot-name")[0].innerHTML = t.getAttribute("data-name"); var i = $(t).parent(), o = $(document.createElementNS("http://www.w3.org/2000/svg", "polygon")).attr({ transform: "rotate(90), translate(15 -15)" }), n = $(document.createElementNS("http://www.w3.org/2000/svg", "svg")).attr({ id: a + "_layer_footprint_footprint", class: "footprint" }).append(o); i.append(n[0]); var s = !!t.getAttribute("robot-id") && window["robot_ros_" + window.fleet_robot_dialog_active_robot]; if (s) { var d = {}; d.topic = new ROSLIB.Topic({ ros: s.ros, name: "/mirwebapp/web_path", messageType: "mirMsgs/WebPath", throttle_rate: 10 }); var l = document.getElementById("robot_path_points_" + a); d.topic.subscribe((function (t) { var r = e.getAttribute("data-map-height"), i = e.getAttribute("data-resscale"), o = e.getAttribute("data-origin-x"), n = e.getAttribute("data-origin-y"); window["map_" + a + "_pathseq"] = t.seq; for (var s = 0, d = ""; s < t.x.length;) { d += t.x[s] * i - o + " " + (r - (t.y[s] * i - n)) + " ", s++ } l && (l.setAttribute("points", d), $(l).show()) })) } document.getElementById("robotinfo-close").onclick = function () { robot_dialog_close() }; var p = $(r).find('.state_continue[data-type="continue"]'), m = $(r).find('.state_stop[data-type="pause"]'); p.click((function (e) { e.preventDefault(), fleet_robot_change_state(t.getAttribute("robot-ip"), 3) })), m.click((function (e) { e.preventDefault(), fleet_robot_change_state(t.getAttribute("robot-ip"), 4) })), $(".mapgridscreen,.mapguidescreen,.mapdialogscreen").hide(), $(r).show() } function robot_dialog_close() { var t = $(".robotinfoscreen")[0]; $(t).hide(); var e = $(t).find('.state_continue[data-type="continue"]'), a = $(t).find('.state_stop[data-type="pause"]'); $(e).replaceWith($(e).clone()), $(a).replaceWith($(a).clone()); var r = $(t).find("a.go-to-interface"); if (r) { var i = r.attr("href"); if (i) { i = i.replace("//", ""); var o = $('.robot[robot-ip="' + i + '"]'), n = window.fleet_robot_dialog_active_robot; o && $(o).parent().find(".footprint").remove() } } if (t) { var s = $(t).closest(".mapcontainer").attr("data-element-id"); document.getElementById(s + "_mapcontainer").removeEventListener("click", robot_dialog_close); var d = document.getElementById("robot_path_points_" + s); d && "fleet" == MIR.config.product.toLowerCase() && $(d).hide() } n && i && new ROSLIB.Topic({ ros: i, name: "/mirwebapp/web_path", messageType: "mirMsgs/WebPath", throttle_rate: 1e3 }).unsubscribe() } function update_robotinfo() { if (!window.fleet_robot_dialog_active_robot || window["fleet_robot_data_" + window.fleet_robot_dialog_active_robot]) { var t = window["fleet_robot_data_" + window.fleet_robot_dialog_active_robot], e = document.getElementsByClassName("go-to-interface")[0]; e.setAttribute("href", "//" + t.ip_address), e.setAttribute("target", "_blank"); var a = document.getElementsByClassName("go-to-robot-setup")[0]; a.setAttribute("href", "/setup/robots/" + t.robot_id), a.setAttribute("target", "_self"), document.getElementsByClassName("robot-state")[0].innerHTML = t.state_text || mir_translate("offline"), document.getElementsByClassName("robot-battery")[0].innerHTML = t.battery_percentage ? Math.ceil(parseFloat(t.battery_percentage)) + "%" : mir_translate("unknown battery percentage"), document.getElementsByClassName("robot-mission")[0].innerHTML = t.mission_text || "", document.getElementsByClassName("robot-mode")[0].innerHTML = t.mode_text || "", document.getElementsByClassName("robotinfoscreen")[0].setAttribute("data-state-id", t.state), t.errors && t.errors.length > 0 ? ($(".robot-errors-holder").show(), document.getElementsByClassName("robot-error")[0].innerHTML = t.errors[0].code + ": " + mir_translate_from_rosbridge(t.errors[0].description) + " (" + t.errors[0].module + ")") : $(".robot-errors-holder").hide() } } function map_reverse_oneway_direction(t) { var e = document.getElementById(t + "_mapcontainer").getAttribute("data-selected-shape"), a = -1; if (e.indexOf("_") > -1) { var r = e.split("_"); a = r[r.length - 1] } window["map_" + t + "_metadata"].layers.oneway.shapes[a].polygon.reverse(); for (var i = $("#" + t + "_layer_oneway").find("iframe"), o = $(i).contents(), n = "", s = 0; s < window["map_" + t + "_metadata"].layers.oneway.shapes[a].polygon.length;)n += 0 == s ? "M" : "L", n += window["map_" + t + "_metadata"].layers.oneway.shapes[a].polygon[s].x + " " + window["map_" + t + "_metadata"].layers.oneway.shapes[a].polygon[s].y, s++; return $(o).find("#" + e).attr("d", n), $(o).find("#" + e + "_ghost").attr("d", n), map_update_handles(t), map_set_save_state(t, "savable", !1), !0 } function map_find(t) { if (!MIR.runtime) return !1; if (!MIR.runtime.position_types || !MIR.runtime.positions || !MIR.runtime.maps) return !1; if (!MIR.runtime.positions[t] || !MIR.runtime.maps[t]) return !1; var e = MIR.runtime.positions[t], a = MIR.runtime.maps[t], r = []; $.each(e, (function (t, e) { var i = a.mir.get_position_type(e.type_id); r.push({ name: e.name, value: e.guid, groupname: mir_translate(i.name), coords: { x: e.pos_x, y: e.pos_y }, is_child: !1 }), $.each(e.child_positions, (function (t, o) { var n = a.mir.get_position_type(o.type_id); r.push({ name: e.name + " / " + mir_translate(n.name), value: o.guid, is_child: !0, groupname: mir_translate(i.name), coords: { x: o.pos_x, y: o.pos_y } }) })) })); var i = !1; MIR.ui.search_dialog({ header: "Find positions", parent: "body", options: r, on_before_render: function (t) { var e = t.mir, a = { type: "input", opts: { attr: i ? { type: "checkbox", checked: "checked" } : { type: "checkbox" } } }, r = { text: " " + mir_translate("Show helper _positions ") }, o = e.$show_helper = new MIR.ui.form_element(r, a); o.insertAfter(e.$header).on("change", (function () { i = o.mir.$control.prop("checked"), e.filter_list(e.$dialog_input.val()) })), e.filter_list(e.$dialog_input.val()), e.$dialog_label.find(".mir-label").hide(), e.$dialog_input.focus() }, on_filter_option: function (t) { return !(t.is_child && !i) || (t.$node.hide(), !1) }, on_select: function (e, r) { if (e) { var i = !1; if ($.each(MIR.runtime.positions[t], (function (t, a) { return a.guid !== e && ($.each(a.child_positions, (function (a, r) { if (r.guid === e) return i = t, !1 })), !1 === i && void 0) })), i) { var o = MIR.runtime.positions[t][i]; o.show_children = !0, $('div.mapcontainer .child_position[data-parent-id="' + o.guid + '"]').show() } map_toggle_center_robot(t, !1), a.mir.center_coords(r.coords, MIR.constants.MAP.world.REAL, { callback: function () { map_zoom(t, 3) } }) } } }) } function map_finalizing_start(t) { document.getElementById(t + "_mapcontainer").setAttribute("data-initializing", "true"), document.getElementById(t + "_maploadingscreen").innerHTML = "<p id=\"map-status\">{{ _('Processing map %(procent)s% ( %(done)s  of %(total)s )', {procent:procent, done:done, total:total}) }}</p>", new Vue({ el: "#map-status", data: MIR.runtime.map_finalization_data }) } function map_finalizing_stop(t) { document.getElementById(t + "_mapcontainer").setAttribute("data-initializing", "false"), document.getElementById(t + "_maploadingscreen").innerHTML = "" } $(document).on("touchstart click", "body[data-type='fleet'] div.mapcontainer > div.mapwrapper > div.mapholder > div.map > div.layer > div.robot", (function (t) { t.stopPropagation(), t.preventDefault(), robot_dialog_close(), robot_dialog(t.target), t.handled = !0 }));
function missions_summary_catalogue_launch_delete(e, t) { var i = document.createElement("div"); i.setAttribute("class", "overlay_delete"), i.setAttribute("id", "missiondelete_overlay"), document.getElementsByTagName("body")[0].appendChild(i); var s = document.createElement("div"); s.setAttribute("class", "box"), i.appendChild(s); var n = document.createElement("h1"); n.innerHTML = lang_main_missions_deletemission, s.appendChild(n); var a = document.createElement("p"); a.innerHTML = lang_main_missions_deletemission_text, s.appendChild(a); var r = document.createElement("div"); r.setAttribute("class", "buttonholder"), s.appendChild(r); var o = document.createElement("div"); o.setAttribute("class", "delete"), o.setAttribute("id", "missiondelete_submitbtn"), o.setAttribute("data-guid", t), o.setAttribute("data-element-id", e), o.innerHTML = lang_main_missions_deletemission_btn_delete, r.appendChild(o), o.onclick = function () { this.getAttribute("data-guid"); var e = { mode: "delete-mission" }; e.id = this.getAttribute("data-guid"), $.ajax({ url: "/?mode=get-group-missions&calltype=light", data: e, method: "GET", dataType: "json", guid: this.getAttribute("data-guid"), element_id: this.getAttribute("data-element-id"), success: function (e) { 204 == e.headers.httpcode ? $("#" + this.element_id + "_items").find("div[data-guid='" + this.guid + "']").length > 0 ? ($("#" + this.element_id + "_items").find("div[data-guid='" + this.guid + "']").remove(), document.getElementById("missiondelete_overlay").parentNode.removeChild(parent.document.getElementById("missiondelete_overlay"))) : $("div.dashboard > div.row > div[data-widget='missiongroup'].widget").find("div[data-guid='" + this.guid + "']").length > 0 ? ($("div.dashboard > div.row > div[data-widget='missiongroup'].widget").find("div[data-guid='" + this.guid + "']").remove(), document.getElementById("missiondelete_overlay").parentNode.removeChild(parent.document.getElementById("missiondelete_overlay"))) : location.href = "/setup/missions" : (document.getElementById("missiondelete_overlay").parentNode.removeChild(parent.document.getElementById("missiondelete_overlay")), launch_error(mir_translate(e.results.error_human))) } }) }; var d = document.createElement("div"); d.setAttribute("class", "cancel"), d.setAttribute("id", "missiondelete_cancelbtn"), d.innerHTML = lang_main_missions_deletemission_btn_cancel, r.appendChild(d), d.onclick = function () { document.getElementById("missiondelete_overlay").parentNode.removeChild(parent.document.getElementById("missiondelete_overlay")) } } function missions_summary_catalogue_load_missions(e) { return clearTimeout(missions_missionview_summary_timer), missions_missionview_summary_timer = setTimeout((function () { var t = document.getElementById(e + "_items"); t.innerHTML = ""; var i = document.getElementById("group_id"), s = i.options[i.selectedIndex].value; $.post("/?mode=set-user-settings&calltype=light", { missions_summary_group: s }, (function (e) { })); var n = {}; n.group = s, $.ajax({ url: "/?mode=get-group-missions", data: n, method: "POST", dataType: "json", element_id: e, success: function (e) { t.innerHTML = ""; var i = t.getAttribute("data-open-url"); if (e.length > 0) { for (var s = 0; s < e.length;) { var n = document.createElement("div"); n.setAttribute("class", "mission"), n.setAttribute("data-guid", e[s].guid), n.setAttribute("data-element-id", this.element_id), n.setAttribute("data-name", e[s].htmlname), n.setAttribute("data-openurl", i), t.appendChild(n); var a = document.createElement("div"); e[s].valid ? a.setAttribute("class", e[s].is_template ? "icon-template" : "icon") : (a.setAttribute("class", "icon-warn"), a.setAttribute("title", mir_translate("The mission contains invalid actions or sub-missions."))), n.appendChild(a); var r = document.createElement("div"); r.setAttribute("class", "info"), n.appendChild(r); var o = document.createElement("p"); o.setAttribute("class", "name"), o.innerHTML = e[s].htmlname, r.appendChild(o); var d = document.createElement("p"); if (d.setAttribute("class", "site"), d.innerHTML = e[s].htmlsite, r.appendChild(d), 1 == e[s].queueable && "fleet" != MIR.config.product) { var m = document.createElement("div"); m.setAttribute("class", "queuebutton"), m.setAttribute("data-element-id", this.element_id), m.setAttribute("data-guid", e[s].guid), m.setAttribute("data-name", e[s].name), n.appendChild(m), e[s].valid ? m.onclick = function () { missions_summary_queue(this.getAttribute("data-element-id"), this.getAttribute("data-guid"), this.getAttribute("data-name")) } : m.onclick = function () { launch_error(mir_translate("This mission contains invalid actions or sub-missions. You can't queue it.")) } } if (1 == e[s].editable) { var l = document.createElement("div"); l.setAttribute("class", "deletebutton"), l.setAttribute("data-element-id", this.element_id), l.setAttribute("data-guid", e[s].guid), n.appendChild(l), l.onclick = function () { missions_summary_catalogue_launch_delete(this.getAttribute("data-element-id"), this.getAttribute("data-guid")) }; var u = document.createElement("div"); u.setAttribute("class", "editbutton"), u.setAttribute("data-element-id", this.element_id), u.setAttribute("data-guid", e[s].guid), n.appendChild(u), u.onclick = function () { location.href = i.replace("[guid]", this.getAttribute("data-guid")) } } else { var _ = document.createElement("div"); _.setAttribute("class", "watchbutton"), _.setAttribute("data-element-id", this.element_id), _.setAttribute("data-guid", e[s].guid), n.appendChild(_), _.onclick = function () { location.href = i.replace("[guid]", this.getAttribute("data-guid")) } } s++ } $(document).on("click", "body[data-mobile='true'] > div.wrapper > div.content > div.missions_summary > div.missions_summary_catalogue > div.items > div.mission", (function (e) { missions_summary_mobile_mission_menu(this.getAttribute("data-element-id"), this.getAttribute("data-guid"), this.getAttribute("data-name"), this.getAttribute("data-openurl")) })) } else { var p = document.createElement("p"); p.setAttribute("class", "nodata"), p.innerHTML = lang_main_missions_nomissionsingroup, t.appendChild(p) } } }) }), 200), !0 } function missions_summary_mobile_mission_menu(e, t, i, s) { var n = document.createElement("div"); n.setAttribute("class", "mobilemissionmenu"), n.setAttribute("id", "mobilemissionmenu"), document.getElementsByTagName("body")[0].appendChild(n); var a = document.createElement("div"); a.setAttribute("class", "box"), n.appendChild(a); var r = document.createElement("ul"); a.appendChild(r); var o = document.createElement("li"); o.setAttribute("class", "queue"), o.setAttribute("data-element-id", e), o.setAttribute("data-guid", t), o.setAttribute("data-name", i), o.innerHTML = "<div><span>" + lang_main_missions_queue + "</span></div>", r.appendChild(o); var d = document.createElement("li"); d.setAttribute("class", "edit"), d.setAttribute("data-element-id", e), d.setAttribute("data-guid", t), d.setAttribute("data-name", i), d.setAttribute("data-open-url", s), d.innerHTML = "<div><span>" + lang_main_missions_edit + "</span></div>", r.appendChild(d); var m = document.createElement("li"); m.setAttribute("class", "delete"), m.innerHTML = "<div><span>" + lang_main_missions_delete + "</span></div>", m.setAttribute("data-element-id", e), m.setAttribute("data-guid", t), r.appendChild(m); var l = document.createElement("li"); return l.setAttribute("class", "cancel"), l.innerHTML = "<div><span>" + lang_main_missions_cancel + "</span></div>", r.appendChild(l), o.onclick = function () { "fleet" == MIR.config.product ? fleet_schedule_modal(this.getAttribute("data-guid")) : missions_summary_queue(this.getAttribute("data-element-id"), this.getAttribute("data-guid"), this.getAttribute("data-name")), document.getElementById("mobilemissionmenu").parentNode.removeChild(parent.document.getElementById("mobilemissionmenu")) }, d.onclick = function () { location.href = this.getAttribute("data-open-url").replace("[guid]", this.getAttribute("data-guid")) }, m.onclick = function () { missions_summary_catalogue_launch_delete(this.getAttribute("data-element-id"), this.getAttribute("data-guid")), document.getElementById("mobilemissionmenu").parentNode.removeChild(parent.document.getElementById("mobilemissionmenu")) }, l.onclick = function () { document.getElementById("mobilemissionmenu").parentNode.removeChild(parent.document.getElementById("mobilemissionmenu")) }, !0 } function missions_summary_check_queue(e, t) { var i = document.getElementById(e + "_queue"), s = { mode: "get-mission-queue", calltype: "light" }; $.ajax({ url: "/", data: s, method: "GET", dataType: "json", element_id: e, success: function (s) { if ("NOPRIV" == s[0]) $("#" + e + "_queue_loader").hide(), $("#" + e + "_queue_nopriv").show(); else { for (var n = !1, a = $(i).children("li"), r = 0; r < s.length;) { if (parseInt($(a[r]).attr("data-queue-id")) == parseInt(s[r].id) && $(a[r]).attr("data-mission-guid") == s[r].mission_id) { var o = $(a[r]).find("div.state"), d = $(a[r]).find("div.remove"); $(o).html("<span>" + s[r].state + "</span>"), $(d).attr("data-state", s[r].state), "Pending" == s[r].state ? $(o).attr("data-state-color", "yellow") : "Executing" == s[r].state && $(o).attr("data-state-color", "green") } else n = !0; r++ } if (a.length != s.length && (n = !0), 0 == s.length && (n = !0), 1 == window["missions_summary_" + e + "_force_reload"] && (n = !0), 1 == n && 0 == window["missions_summary_" + e + "_dragging"] && (0 == window.missions_summary_queue_adding || null == window.missions_summary_queue_adding)) { 1 == $("#" + e + "_queue").hasClass("ui-sortable") && $("#" + e + "_queue").sortable("cancel"), $("#" + e + "_queue_loader").show(), i.innerHTML = ""; for (r = 0; r < s.length;)missions_summary_add_queue_item(e, s[r]), r++; $("#" + e + "_queue_loader").hide(), missions_summary_queue_checkifitems(e), $("#" + e + "_queue").sortable({ scroll: !0, items: "li:not(.running)", handle: ".movehandle", start: function (t, i) { window["missions_summary_" + e + "_dragging"] = !0 }, stop: function (t, i) { for (var s = i.item[0].getAttribute("data-queue-id"), n = -1, a = $("#" + e + "_queue").children("li.still"), r = 0; r < a.length;)a[r].getAttribute("data-queue-id") == s && (n = r + 1), r++; if (n > -1) { var o = {}; o.id = s, o.position = n, $.ajax({ url: "/?mode=order-mission-queue", data: o, method: "POST", dataType: "json", element_id: e, success: function (t) { window["missions_summary_" + e + "_dragging"] = !1 } }) } } }) } !1 !== t && setTimeout((function () { missions_summary_check_queue(e) }), 2e3) } } }) } function missions_summary_queue(e, t, i) { var s = (new Date).getTime(), n = { id: -1 }; n.mission_id = "tmp_" + s, n.name = "Temp", n.state = "Queueing", window.missions_summary_queue_adding = !0, "fleet" == window.systemtype ? launch_waiter("Placing mission in queue...") : missions_summary_add_queue_item(e, n, i); var a = {}; return a.id = t, $.ajax({ url: "/?mode=queue-mission", data: a, method: "POST", dataType: "json", element_id: e, replaceguid: "tmp_" + s, success: function (i) { if ("fleet" == window.systemtype && close_waiter(), $("ul#" + this.element_id + "_queue").find("li[data-mission-guid='" + this.replaceguid + "']").remove(), "questions" == i.type) { var s = document.createElement("div"); s.setAttribute("class", "missionqueuequestions_overlay"), s.setAttribute("id", "missionqueuequestions_overlay"), document.getElementsByTagName("body")[0].appendChild(s); var n = document.createElement("div"); n.setAttribute("class", "box"), s.appendChild(n); var a = document.createElement("h1"); a.innerHTML = mir_translate("Please respond..."), n.appendChild(a); var r = document.createElement("p"); r.innerHTML = mir_translate("Text about mission variables..."), n.appendChild(r); var o = document.createElement("form"); o.setAttribute("action", ""), o.setAttribute("method", ""), n.appendChild(o), o.onsubmit = function () { $("div.box > form > div.fieldholder").attr("data-error", "false"), $("div.box > form > p.error").html(""); for (var s = {}, a = 0; a < i.questions.length;)s[i.questions[a].systemname] = mission_summary_queue_field_fetch_value(i.questions[a].systemname, i.questions[a].type, i.questions[a].constraints.nullable), a++; var r = {}; return r.id = t, r.vals = s, $.ajax({ url: "/?mode=queue-mission", data: r, method: "POST", dataType: "json", element_id: e, success: function (t) { if (window.missions_summary_queue_adding = !1, 201 == t.headers.httpcode) playbar_highlight(), "fleet" == window.systemtype ? "fleet_schedule" == document.getElementsByTagName("body")[0].getAttribute("data-module") && fleet_schedule_load(e, !0) : missions_summary_add_queue_item(this.element_id, t.results), window["missions_summary_" + e + "_force_reload"] = !0, document.getElementById("missionqueuequestions_overlay").parentNode.removeChild(parent.document.getElementById("missionqueuequestions_overlay")); else if (t.results.error_human.length > 0 && (d.innerHTML = mir_translate(t.results.error_human), $(n).animate({ scrollTop: 0 }, 100)), void 0 === t.results.field_errors); else { for (var i in t.results.field_errors.parameters) document.getElementById("missionqueue_fieldholder_" + t.results.field_errors.parameters[i].systemname).setAttribute("data-error", "true"), document.getElementById("missionqueue_error_" + t.results.field_errors.parameters[i].systemname).innerHTML = mir_translate(t.results.field_errors.parameters[i].error_human); t.results.field_errors.earliest_start_time && (document.getElementById("missionqueue_fieldholder_earliest_start_time").setAttribute("data-error", "true"), document.getElementById("missionqueue_error_earliest_start_time").innerHTML = mir_translate(t.results.field_errors.earliest_start_time.error_human)), t.results.field_errors.robot_id && (document.getElementById("missionqueue_fieldholder_robot_id").setAttribute("data-error", "true"), document.getElementById("missionqueue_error_robot_id").innerHTML = mir_translate(t.results.field_errors.robot_id.error_human)) } } }), !1 }; var d = document.createElement("p"); d.setAttribute("id", "missionqueue_error"), d.setAttribute("class", "error"), d.innerHTML = "", o.appendChild(d), mission_summary_queue_fieldgenerator(i.questions, o); var m = document.createElement("div"); m.setAttribute("class", "buttonholder"), o.appendChild(m); var l = document.createElement("input"); l.setAttribute("type", "submit"), l.setAttribute("name", "submit"), l.setAttribute("id", "missiondynvareditor_submitbtn"), l.setAttribute("value", mir_translate("OK")), m.appendChild(l); var u = document.createElement("input"); u.setAttribute("type", "button"), u.setAttribute("name", "missionqueuequestions_cancelbtn"), u.setAttribute("id", "missionqueuequestions_cancelbtn"), u.setAttribute("value", mir_translate("Cancel")), m.appendChild(u), u.onclick = function () { document.getElementById("missionqueuequestions_overlay").parentNode.removeChild(parent.document.getElementById("missionqueuequestions_overlay")) } } else 201 == i.headers.httpcode && ("fleet" == window.systemtype || missions_summary_add_queue_item(this.element_id, i.results, null), playbar_highlight(), window.missions_summary_queue_adding = !1) } }), !0 } function mission_summary_queue_field_fetch_value(e, t, i) { if ("Selection" == t || "Reference" == t) var s = document.getElementById(e).value; else if ("Duration" == t) { var n = document.getElementById("missionqueue_fieldholder_" + e + "_hours"), a = document.getElementById("missionqueue_fieldholder_" + e + "_minutes"), r = document.getElementById("missionqueue_fieldholder_" + e + "_seconds"), o = n.value; 1 == o.length && (o = "0" + o); var d = a.value; 1 == d.length && (d = "0" + d); var m = r.value; 1 == m.length && (m = "0" + m); s = o + ":" + d + ":" + m + ".000000" } else if ("Duration_old" == t) s = missions_missionview_transform_duration_totime(document.getElementById(data.questions[c].systemname).getAttribute("data-cur")); else if ("DateTime" == t) { s = ""; s += document.getElementById(e + "_date").value, s += "@", s += document.getElementById(e + "_hour").value, s += ":", s += document.getElementById(e + "_minute").value } else if ("Boolean" == t) s = 1 == document.getElementById(e).checked; else s = document.getElementById(e).value; return (i && "Reference" == t && "" == s || 1 == i && "Reference" != t && 1 == document.getElementById(e + "_nulloption").checked) && (s = MIR.ui.constants.NULL_VALUE), s } function mission_summary_queue_fieldgenerator(e, t) { for (var i = 0; i < e.length;) { var s = document.createElement("div"); if (s.setAttribute("class", "fieldholder"), s.setAttribute("data-error", "false"), s.setAttribute("data-field-type", e[i].type), s.setAttribute("id", "missionqueue_fieldholder_" + e[i].systemname), t.appendChild(s), "Boolean" == e[i].type); else (B = document.createElement("label")).setAttribute("for", "missiondynvareditor_field_name"), B.innerHTML = e[i].name, s.appendChild(B); if ("Reference" == e[i].type || "Selection" == e[i].type) { e[i].constraints.nullable && e[i].options.splice(0, 0, { name: e[i].constraints.null_option, value: "" }); var n = { attr: { id: e[i].systemname, name: e[i].systemname }, options: e[i].options, header: e[i].name, parent: "#missionqueuequestions_overlay" }; e[i].is_position && (n.extra_dialog_options = { sort_options: function (e, t) { var i = (e.has_priority ? "0" : "1") + e.clean_group_name + e.clean_name, s = (t.has_priority ? "0" : "1") + t.clean_group_name + t.clean_name; return i < s ? -1 : i > s ? 1 : 0 }, on_create_group_node: function (e, t, i) { i.has_priority && (e.$text_node = $("<span>" + i.groupname + "</span>"), e.$node.html("").append(e.$text_node).append('<span class="mir-txt-silent">&nbsp;' + mir_translate("(Active map)") + "</span>")) } }); var a = MIR.ui.search_select(n); e[i].default ? a.val(e[i].default) : !e[i].default && e[i].constraints.nullable && a.val(""), a.appendTo(s) } else if ("DateTime" == e[i].type) { var r = document.createElement("input"); r.setAttribute("type", "text"), r.setAttribute("maxlength", "50"), r.setAttribute("autocomplete", "off"), r.setAttribute("readonly", "readonly"), r.setAttribute("class", "datetime_date"), r.setAttribute("name", e[i].systemname + "_date"), r.setAttribute("id", e[i].systemname + "_date"), r.setAttribute("value", e[i].default_date), s.appendChild(r); var o = document.createElement("div"); o.setAttribute("class", "datetime_clock"), s.appendChild(o); var d = document.createElement("input"); d.setAttribute("type", "text"), d.setAttribute("maxlength", "2"), d.setAttribute("autocomplete", "off"), d.setAttribute("class", "datetime_hour"), d.setAttribute("name", e[i].systemname + "_hour"), d.setAttribute("id", e[i].systemname + "_hour"), d.setAttribute("value", e[i].default_hour), s.appendChild(d); var m = document.createElement("span"); m.setAttribute("class", "datetime_sep"), m.innerHTML = ":", s.appendChild(m); var l = document.createElement("input"); l.setAttribute("type", "text"), l.setAttribute("maxlength", "2"), l.setAttribute("autocomplete", "off"), l.setAttribute("class", "datetime_minute"), l.setAttribute("name", e[i].systemname + "_minute"), l.setAttribute("id", e[i].systemname + "_minute"), l.setAttribute("value", e[i].default_minute), s.appendChild(l), $("input#" + e[i].systemname + "_date").datepicker({ dateFormat: "mm-dd-yy", firstDay: 1, maxDate: e[i].constraints.max, minDate: e[i].constraints.min, beforeShow: function () { return "true" != $(this).parent().attr("data-disabled") } }) } else if ("Duration" == e[i].type) { if (null == e[i].default) var u = 0; else u = missions_missionview_transform_duration_toseconds(e[i].default); var _ = Math.floor(u / 60), p = Math.floor(_ / 60), c = u - 60 * _; _ = _ - 60 * p; 1 == String(c).length && (c = "0" + String(c)), 1 == String(_).length && (_ = "0" + _), 1 == String(p).length && (p = "0" + p); var v = [p, _, c], h = ["hours", "minutes", "seconds"], g = [mir_translate("Hrs"), mir_translate("Min"), mir_translate("Sec")], b = document.createElement("div"); b.setAttribute("class", "durationpickerholder"), b.setAttribute("data-cur", u), b.setAttribute("id", "missionqueue_fieldholder_" + e[i].systemname), b.setAttribute("data-systemname", e[i].systemname), s.appendChild(b); var w = document.createElement("table"); w.setAttribute("cellpadding", "0"), w.setAttribute("cellspacing", "0"), b.appendChild(w); var f = document.createElement("tr"); w.appendChild(f); for (var A = 0; A < h.length;) { (C = document.createElement("td")).setAttribute("class", "arrow_up"), f.appendChild(C), (I = document.createElement("div")).setAttribute("data-timetype", h[A]), I.setAttribute("data-systemname", e[i].systemname), I.innerHTML = "<span>+</span>", I.onclick = function () { var e = document.getElementById("missionqueue_fieldholder_" + this.getAttribute("data-systemname") + "_" + this.getAttribute("data-timetype")), t = "00"; if (parseInt(e.value)) var i = parseInt(e.value); else i = 0; i >= 24 && "hours" == this.getAttribute("data-timetype") || i >= 59 && "minutes" == this.getAttribute("data-timetype") || i >= 59 && "seconds" == this.getAttribute("data-timetype") ? t = "00" : 1 == (t = String(i + 1)).length && (t = "0" + t), e.value = t }, C.appendChild(I), A++ } f = document.createElement("tr"); w.appendChild(f); for (A = 0; A < h.length;) { (C = document.createElement("td")).setAttribute("class", "field"), f.appendChild(C); var y = document.createElement("input"); y.setAttribute("type", "text"), y.setAttribute("maxlength", "2"), y.setAttribute("value", v[A]), y.setAttribute("data-timetype", h[A]), y.setAttribute("data-old-value", ""), y.setAttribute("name", "missionqueue_fieldholder_" + e[i].systemname + "_" + h[A]), y.setAttribute("id", "missionqueue_fieldholder_" + e[i].systemname + "_" + h[A]), y.onkeyup = function (e) { var t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]; if (2 == this.value.length && t.indexOf(e.key) > -1 && e.target == this && this.value !== this.getAttribute("data-old-value")) { var i = "missiondynvareditor_field_def_" + this.getAttribute("data-timetype"); "hours" == this.getAttribute("data-timetype") ? i += "minutes" : "minutes" == this.getAttribute("data-timetype") ? i += "seconds" : i += "hours", $("#" + i).select(), $("#" + i).focus() } else t.indexOf(e.key) > -1 && this.setAttribute("data-old-value", "") }, y.onblur = function (e) { if (e.target == this) { for (var t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"], i = !1, s = 0; s < this.value.length;)-1 == t.indexOf(this.value[s]) && (i = !0), s++; 0 == this.value.length || 1 == i ? this.value = "00" : "hours" == this.getAttribute("data-timetype") && parseInt(this.value) > 24 ? this.value = "24" : "hours" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : "minutes" == this.getAttribute("data-timetype") && parseInt(this.value) > 59 ? this.value = "59" : "minutes" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : "seconds" == this.getAttribute("data-timetype") && parseInt(this.value) > 59 ? this.value = "59" : "seconds" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : 1 == this.value.length && (this.value = "0" + this.value), this.setAttribute("data-old-value", this.value) } }, C.appendChild(y), A++ } f = document.createElement("tr"); w.appendChild(f); for (A = 0; A < h.length;) { (C = document.createElement("td")).setAttribute("class", "text"), f.appendChild(C); var E = document.createElement("div"); E.innerHTML = "<span>" + g[A] + "</span>", C.appendChild(E), A++ } f = document.createElement("tr"); w.appendChild(f); for (A = 0; A < h.length;) { var C, I; (C = document.createElement("td")).setAttribute("class", "arrow_down"), f.appendChild(C), (I = document.createElement("div")).setAttribute("data-timetype", h[A]), I.setAttribute("data-systemname", e[i].systemname), I.innerHTML = "<span>-</span>", I.onclick = function () { var e = document.getElementById("missionqueue_fieldholder_" + this.getAttribute("data-systemname") + "_" + this.getAttribute("data-timetype")), t = "00"; if (parseInt(e.value)) var i = parseInt(e.value); else i = 0; i <= 0 && "hours" == this.getAttribute("data-timetype") ? t = "24" : i <= 0 && "minutes" == this.getAttribute("data-timetype") || i <= 0 && "seconds" == this.getAttribute("data-timetype") ? t = "59" : 1 == (t = String(i - 1)).length && (t = "0" + t), e.value = t }, C.appendChild(I), A++ } } else if ("String" == e[i].type || "Float" == e[i].type || "Duration" == e[i].type || "Integer" == e[i].type) { (T = document.createElement("input")).setAttribute("type", "text"), T.setAttribute("maxlength", "50"), null == e[i].default || T.setAttribute("value", e[i].default), T.setAttribute("autocomplete", "off"), T.setAttribute("name", e[i].systemname), T.setAttribute("id", e[i].systemname), s.appendChild(T) } else if ("Boolean" == e[i].type) { var T, B; (T = document.createElement("input")).setAttribute("type", "checkbox"), T.setAttribute("value", "1"), T.setAttribute("name", e[i].systemname), T.setAttribute("id", e[i].systemname), 1 == e[i].default && T.setAttribute("checked", "checked"), s.appendChild(T), (B = document.createElement("label")).setAttribute("for", e[i].systemname), B.innerHTML = e[i].name, s.appendChild(B) } var L = document.createElement("p"); if (L.setAttribute("id", "missionqueue_error_" + e[i].systemname), L.setAttribute("class", "fielderror"), L.innerHTML = "", s.appendChild(L), 1 == e[i].constraints.nullable && "Reference" != e[i].type) { var k = document.createElement("div"); k.setAttribute("class", "nullerholder"), s.appendChild(k); var M = document.createElement("input"); M.setAttribute("type", "checkbox"), M.setAttribute("name", "missiondynvareditor_field_nullable"), M.setAttribute("id", e[i].systemname + "_nulloption"), M.setAttribute("value", "1"), null == e[i].default && (M.setAttribute("checked", "true"), s.setAttribute("data-disabled", "true"), s.setAttribute("disabled", "disabled")), k.appendChild(M); var x = document.createElement("label"); x.setAttribute("for", e[i].systemname + "_nulloption"), x.innerHTML = e[i].constraints.null_option, k.appendChild(x), M.onclick = function () { 1 == this.checked ? (this.parentNode.parentNode.setAttribute("data-disabled", "true"), this.parentNode.parentNode.setAttribute("disabled", "disabled")) : (this.parentNode.parentNode.setAttribute("data-disabled", "false"), this.parentNode.parentNode.removeAttribute("disabled")) } } i++ } } function missions_summary_add_queue_item(e, t, i) { if (null == e); else { var s = document.getElementById(e + "_queue"), n = document.createElement("li"); "Executing" == t.state ? n.setAttribute("class", "running") : "Queueing" == t.state ? n.setAttribute("class", "queueing") : n.setAttribute("class", "still"), n.setAttribute("data-queue-id", t.id), n.setAttribute("data-mission-guid", t.mission_id), s.appendChild(n); var a = document.createElement("div"); a.setAttribute("class", "movehandle"), a.innerHTML = "<span>" + lang_main_missions_move + "</span>", n.appendChild(a); var r = document.createElement("div"); if (r.setAttribute("class", "name"), "Queueing" == t.state ? r.innerHTML = "<span>" + i + "</span>" : r.innerHTML = "<span>" + t.name + "</span>", n.appendChild(r), "Queueing" == t.state); else { var o = document.createElement("span"); o.innerHTML = t.state; var d = document.createElement("div"); d.setAttribute("class", "state"), "Pending" == t.state ? d.setAttribute("data-state-color", "yellow") : "Executing" == t.state && d.setAttribute("data-state-color", "green"), d.appendChild(o), n.appendChild(d); var m = document.createElement("div"); m.setAttribute("class", "remove"), "undefined" != typeof systemtype && "fleet" != systemtype && (m.innerHTML = "<span>x</span>"), m.setAttribute("data-queue-id", t.id), m.setAttribute("data-state", t.state), -1 == t.allowed_methods.indexOf("DELETE") ? m.setAttribute("data-active", "false") : m.setAttribute("data-active", "true"), n.appendChild(m), t.allowed_methods.indexOf("DELETE") > -1 && (m.onclick = function () { "Executing" == this.getAttribute("data-state") ? launch_confirm(lang_missions_summary_remove_executing_mission, lang_missions_summary_remove_executing_mission_text, "missions_summary_remove_queue_item('" + e + "','" + this.getAttribute("data-queue-id") + "');") : missions_summary_remove_queue_item(e, this.getAttribute("data-queue-id")) }) } missions_summary_queue_checkifitems(e) } return !0 } function missions_summary_remove_queue_item(e, t) { var i = document.getElementById(e + "_queue"); $(i).children("li[data-queue-id='" + t + "']").hide(); var s = {}; return s.id = t, s.mode = "delete-mission-queue-item", $.ajax({ url: "/", data: s, method: "GET", dataType: "json", element_id: e, qid: t, success: function (e) { missions_summary_delete_queue_item(this.element_id, this.qid) } }), !0 } function missions_summary_delete_queue_item(e, t) { var i = document.getElementById(e + "_queue"); return $(i).children("li[data-queue-id='" + t + "']").remove(), missions_summary_queue_checkifitems(e), !0 } function missions_summary_queue_checkifitems(e) { var t = document.getElementById(e + "_queue"); return 0 == $(t).children("li").length ? ($(t).hide(), $(t.parentNode).children("div.nodataholder").show()) : ($(t).show(), $(t.parentNode).children("div.nodataholder").hide()), !0 } function missions_missionview_toggle_mobileactions(e) { var t = document.getElementById(e + "_missionview"); "true" == t.getAttribute("data-show-mobileactionpicker") ? t.setAttribute("data-show-mobileactionpicker", "false") : t.setAttribute("data-show-mobileactionpicker", "true") } function missions_missionview_make_sortable(e, t) { e.sortable({ cursorAt: { left: -5, top: -5 }, tolerance: "pointer", helper: "clone", handle: ".movehandle", element_id: t, placeholder: "sortable-placeholder", scroll: !0, forcePlaceholderSize: !0, appendTo: "#missionview_" + t + "_list_main", zIndex: 999999999999, connectWith: ".missionview_" + t + "_list", stop: function (e, i) { missions_missionview_move_item(t, i.item), missions_missionview_align_settings_panel(t) } }) } function missions_missionview_init(e) { var t = document.getElementById("missionview_" + e + "_actionlist"), i = document.createElement("ul"); i.setAttribute("class", "missionview_" + e + "_list"), i.setAttribute("id", "missionview_" + e + "_list_main"), t.appendChild(i); var s = document.createElement("div"); s.setAttribute("class", "no_action"), s.innerHTML = mir_translate("This mission contains no actions."), t.appendChild(s), (window["missions_missionview_" + e + "_permissions"].indexOf("PUT") > -1 || window["missions_missionview_" + e + "_data"].is_template) && missions_missionview_make_sortable($("#missionview_" + e + "_list_main"), e), missions_missionview_load_actions(e, "", "missionview_" + e + "_list_main", window["missions_missionview_" + e + "_data"].is_template), missions_missionview_get_active_action(e), topsubbar_init(e) } function missions_missionview_move_item(e, t) { var i = $(t).parent("ul").attr("id"), s = $(t).attr("id"); window["missions_missionview_" + e + "_elements"][s].mother = i == "missionview_" + e + "_list_main" ? "" : i, submitwarn_set() } function missions_missionview_clone(e, t) { var i = window["missions_missionview_" + e + "_elements"]; if (!t in i) return !1; $(".ui-sortable").sortable("destroy"), $(".ui-draggable").removeClass("ui-draggable"); var s = $("#" + t).clone(!0, !0).wrap("<div/>").parent(), n = [{ action_id: t, action_mom: i[t].mother }]; for (s.find("[data-action-guid]").attr("data-action-guid", "").end(); 0 !== n.length;) { var a = n.shift(), r = a.action_id, o = a.action_mom, d = i[r], m = $.extend(!0, {}, d); $.each(m.vals, (function (e) { /local_guid$/.test(e) && delete m.vals[e] })), m.mother = o; var l = "missions_missionview_" + e + "_action_" + window["missions_missionview_" + e + "_element_counter"]; window["missions_missionview_" + e + "_element_counter"]++, window["missions_missionview_" + e + "_elements"][l] = m, $.each(i, (function (e, t) { t.mother.substr(0, r.length + 1) === r + "_" && n.push({ action_id: e, action_mom: t.mother.replace(r, l) }) })), s.find('[id="' + r + '"]').attr("id", l).end().find("[data-settings-open]").attr("data-settings-open", "false").end().find("[data-highlighted]").attr("data-highlighted", "false").end().find('[data-item-id="' + r + '"]').attr("data-item-id", l).end().find('[id^="' + r + '_"]').each((function () { var e = $(this), t = e.attr("id").replace(r, l); e.attr("id", t) })).end().find('[data-for-item^="' + r + '_"]').each((function () { var e = $(this), t = e.attr("data-for-item").replace(r, l); e.attr("data-for-item", t) })).end() } s.find("li:first").unwrap().insertAfter("#" + t), (window["missions_missionview_" + e + "_permissions"].indexOf("PUT") > -1 || window["missions_missionview_" + e + "_data"].is_template) && missions_missionview_make_sortable($("#missionview_" + e + '_list_main,[id^="missions_' + e + '_missionview_action"][id*="_sublist_"]'), e) } function missions_missionview_add_action(e, t, i, s, n, a, r) { null == s && submitwarn_set(); var o = document.getElementById(e + "_missionview"), d = o.getAttribute("data-highlighted-scope"); "go_figure" == n && d.length > 0 && document.getElementById(d) ? n = d : "go_figure" == n && (n = "missionview_" + e + "_list_main"); var m = document.getElementById(n), l = "missions_missionview_" + e + "_action_" + window["missions_missionview_" + e + "_element_counter"]; window["missions_missionview_" + e + "_elements"][l] = {}, m.getAttribute("id") == "missionview_" + e + "_list_main" ? window["missions_missionview_" + e + "_elements"][l].mother = "" : window["missions_missionview_" + e + "_elements"][l].mother = m.getAttribute("id"), window["missions_missionview_" + e + "_element_counter"]++; var u = t; "load_mission_" == u.substr(0, 13) && (u = "load_mission"); var _ = document.createElement("li"); _.setAttribute("data-settings-open", "false"), _.setAttribute("data-selected", "false"), _.setAttribute("data-has-scopes", "false"), _.setAttribute("data-num-scopes", 0), _.setAttribute("data-collapsed", "false"), _.setAttribute("class", "action"), _.setAttribute("id", l), _.setAttribute("data-action-guid", i), _.setAttribute("data-error", "false"), _.setAttribute("data-action-type", u), _.setAttribute("data-is-template", r.toString()), m.appendChild(_); var p = document.createElement("div"); p.setAttribute("class", "mainitem"), _.appendChild(p); var c = document.createElement("div"); c.setAttribute("class", "movehandle"), p.appendChild(c); var v = { mode: "get-mission-action-structure", calltype: "light" }; if (v.my_user_group_id = user_group_id, v.action_type = t, v.pageviewid = pageviewid, v.mission_guid = o.getAttribute("data-mission-guid"), null == s && (submitwarn_set(), "load_mission" == u)) { var h = t.substr(13, t.length); v.mission_guid = h } return v.site_guid = o.getAttribute("data-site-guid"), v.language = document.getElementsByTagName("body")[0].getAttribute("data-current-language"), $.ajax({ url: "/", data: v, method: "GET", dataType: "json", element_id: e, item_id: l, settings: s, guid: i, success: function (t) { if (window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info = t, window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals = {}, window["missions_missionview_" + this.element_id + "_elements"][this.item_id].dynvals = {}, t.description) t.description; else; if ("load_mission" == u && null == this.settings && void 0 !== t.parameters) for (var i = 0; i < t.parameters.length; i++)null != t.parameters[i].dependencies && (this.settings = t.parameters); if (null != this.settings) for (var n = this, a = 0; a < this.settings.length;) { if ("load_mission" == u) { if (s) { var r = s.find((function (e) { return e.id == n.settings[a].id })); r && "object" == typeof r && (this.settings[a].value = r.value) } for (var d = 0; d < this.settings.length; d++) { var m = this.settings[d]; m.dependencies && $.each(m.dependencies, (function (e, t) { t.dependency_id && (window["missions_missionview_" + n.element_id + "_elements"][n.item_id].dynvals[t.dependency_id] = 1) })) } } null !== this.settings[a].value && void 0 !== this.settings[a].value || void 0 === this.settings[a].default || (this.settings[a].value = this.settings[a].default), void 0 === this.settings[a].value && "Reference" == this.settings[a].type && "object" == typeof this.settings[a].options && this.settings[a].options.length > 0 && (this.settings[a].value = this.settings[a].options[0].value), null == this.settings[a].value && (this.settings[a].value = MIR.ui.constants.NULL_VALUE), window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[this.settings[a].id] = this.settings[a].value, window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[this.settings[a].id + "_local_guid"] = this.settings[a].guid; var l = -1; if (null == this.settings[a].input_name); else { var _ = {}; _.name = this.settings[a].input_name, _.def = this.settings[a].value, _.type = this.settings[a].type, "Selection" != _.type && "Reference" != _.type || (_.type = this.settings[a].type + ":::" + this.settings[a].id); for (var p = 0; p < window["missions_missionview_" + e + "_dynvars"].length;)window["missions_missionview_" + e + "_dynvars"][p].name == _.name && window["missions_missionview_" + e + "_dynvars"][p].type == _.type && (l = p), p++; -1 == l && (window["missions_missionview_" + e + "_dynvars"].push(_), l = window["missions_missionview_" + e + "_dynvars"].length - 1) } window["missions_missionview_" + this.element_id + "_elements"][this.item_id].dynvals[this.settings[a].id] = l, a++ } var v = document.getElementById(this.item_id); 1 == t.existing ? v.setAttribute("data-existing", "true") : (v.setAttribute("data-existing", "false"), c.setAttribute("class", "movehandle_disabled")); var h = v.childNodes[0], g = document.createElement("div"); g.setAttribute("class", "description"), 1 == t.existing ? "load_mission" == t.action_type ? g.innerHTML = "<p>" + t.name + "</p>" : g.innerHTML = "<p>" + mir_translate(t.name) + "</p>" : g.innerHTML = "<p>" + lang_missions_missionview_submission_deleted + "</p>", h.appendChild(g); var b = document.createElement("div"); b.setAttribute("class", "settingsicon"), b.setAttribute("data-element-id", this.element_id), b.setAttribute("data-item-id", this.item_id); var w = document.createElement("div"); w.setAttribute("class", "viewicon"), w.setAttribute("data-item-id", this.item_id); var f = document.createElement("div"); f.setAttribute("class", "cloneicon"), f.setAttribute("data-item-id", this.item_id), h.appendChild(f), h.appendChild(w), h.appendChild(b), $(b).click((function () { (window["missions_missionview_" + this.getAttribute("data-element-id") + "_permissions"].indexOf("PUT") > -1 || window["missions_missionview_" + e + "_data"].is_template) && ("true" == document.getElementById(this.getAttribute("data-item-id")).getAttribute("data-settings-open") ? missions_missionview_validation_action(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), !0, !0) : missions_missionview_launch_settings(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"))) })), $(w).click((function () { "true" == document.getElementById(this.getAttribute("data-item-id")).getAttribute("data-collapsed") ? document.getElementById(this.getAttribute("data-item-id")).setAttribute("data-collapsed", "false") : (document.getElementById(this.getAttribute("data-item-id")).setAttribute("data-collapsed", "true"), o.getAttribute("data-highlighted-scope").substr(0, this.parentNode.parentNode.getAttribute("id").length) == this.parentNode.parentNode.getAttribute("id") && (o.setAttribute("data-highlighted-scope", ""), $(o).find("div.substatement,div.subholder").attr("data-highlighted", "false"))) })), $(f).click((function () { missions_missionview_clone(e, this.getAttribute("data-item-id")) })); var A = 0; if (void 0 !== window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters) for (var y = 0; y < window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters.length;) { if (void 0 === window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].default) l = ""; else l = window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].default; if ("" === window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] || void 0 === window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] || (l = window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id]), null == l && 1 == window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].nullable && (l = MIR.ui.constants.NULL_VALUE), "" == l ? "Scope" == window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].type ? window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = [] : "String" == window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].type ? window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = "" : "Reference" == window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].type || "Selection" == window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].type ? (window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].options.length > 0 ? window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].options[0].value : window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = "", window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].options.length > 0 && (window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].options[0].value)) : window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = 0 : window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id] = l, missions_missionview_set_action_names(this.element_id, this.item_id), "Scope" == window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].type) { var E = document.createElement("div"); E.setAttribute("class", "substatement"), E.setAttribute("data-highlighted", "false"), E.setAttribute("data-element-id", e), E.setAttribute("data-for-item", this.item_id + "_sublist_" + (A + 1)), E.innerHTML = "<p>" + mir_translate(window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].name) + "</p>", v.appendChild(E), $(E).click((function () { var e = this.getAttribute("data-highlighted"), t = document.getElementById(this.getAttribute("data-element-id") + "_missionview"); if ($("ul#missionview_" + this.getAttribute("data-element-id") + "_list_main").find("div.substatement,div.subholder").attr("data-highlighted", "false"), "true" == e) t.setAttribute("data-highlighted-scope", ""); else { var i = this.parentNode; t.setAttribute("data-highlighted-scope", this.getAttribute("data-for-item")), this.setAttribute("data-highlighted", "true"), $(i).children("div[data-for-item='" + this.getAttribute("data-for-item") + "'].subholder").attr("data-highlighted", "true") } })); var C = document.createElement("div"); C.setAttribute("class", "subholder"), C.setAttribute("data-highlighted", "false"), C.setAttribute("data-for-item", this.item_id + "_sublist_" + (A + 1)), v.appendChild(C); var I = document.createElement("ul"); I.setAttribute("id", this.item_id + "_sublist_" + (A + 1)), I.setAttribute("class", "missionview_" + this.element_id + "_list"), C.appendChild(I); var T = document.createElement("div"); T.setAttribute("class", "subholder_msg"), T.innerHTML = mir_translate("You can drop action(s) here."), C.appendChild(T), void 0 !== window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id + "_local_guid"] && missions_missionview_load_actions(e, window["missions_missionview_" + this.element_id + "_elements"][this.item_id].vals[window["missions_missionview_" + this.element_id + "_elements"][this.item_id].info.parameters[y].id + "_local_guid"], this.item_id + "_sublist_" + (A + 1), window["missions_missionview_" + e + "_data"].is_template), (window["missions_missionview_" + e + "_permissions"].indexOf("PUT") > -1 || window["missions_missionview_" + e + "_data"].is_template) && missions_missionview_make_sortable($("#" + this.item_id + "_sublist_" + (A + 1)), e), A++ } y++ } A > 0 ? (v.setAttribute("data-has-scopes", "true"), v.setAttribute("data-num-scopes", A)) : v.setAttribute("data-has-scopes", "false") } }), (n = document.getElementById(e + "_missionview")).setAttribute("data-show-mobileactionpicker", "false"), l } function missions_missionview_set_action_names(element_id, item_id) { var is_simple_cond = function (e) { return "object" == typeof e && "value" in e && "operator" in e && "parameter_id" in e }, eval_cond = function (cond) { if (is_simple_cond(cond)) { var parameter_val, cond_val = null === cond.value ? MIR.ui.constants.NULL_VALUE : cond.value; return cond.parameter_id in _dyn_values && _dyn_values[cond.parameter_id] > -1 ? parameter_val = _dyn_values[cond.parameter_id] : cond.parameter_id in _values && (parameter_val = _values[cond.parameter_id]), eval('"' + parameter_val + '"' + cond.operator + '"' + cond_val + '"') } if (Array.isArray(cond)) return cond.some((function (e) { return eval_cond(e) })); throw new Error("Invalid conditions in action!") }, itemholder = document.getElementById(item_id), nameholder = $(itemholder).children("div.mainitem").children("div.description").children("p"), current_action = window["missions_missionview_" + element_id + "_elements"][item_id], _dyn_values = current_action.dynvals, _values = current_action.vals, desc; if (Array.isArray(current_action.info.descriptions)) { var _descriptions = current_action.info.descriptions, description = _descriptions.find((function (e) { return e.conditions.every((function (e) { return eval_cond(e) })) })); description && (desc = description.text) } if (void 0 === desc && (desc = "string" == typeof current_action.info.description ? current_action.info.description : ""), desc.length > 0 && current_action.info.parameters) { for (var properties = {}, c = 0; c < current_action.info.parameters.length;) { var current_parameter = current_action.info.parameters[c], curid = current_parameter.id, curtype = current_parameter.type; if (current_parameter.options) var curoptions = current_parameter.options; else var curoptions = []; var curval = current_action.vals[current_parameter.id], curdynval = current_action.dynvals[current_parameter.id]; if (curdynval > -1) var dt = "dynval", curwritingval = window["missions_missionview_" + element_id + "_dynvars"][curdynval].name; else { var dt = "regular", curwritingval = curval; if ("Reference" == curtype || "Selection" == curtype) { for (var s = 0; s < curoptions.length;)curoptions[s].value == curval && (curwritingval = curoptions[s].name), s++; curval && curwritingval == curval && 36 == curval.length && (curwritingval = lang_missions_missionview_unknown_element) } else if ("Duration" == curtype) if (void 0 !== curval && curval && curval !== MIR.ui.constants.NULL_VALUE) { curwritingval = curval.split(".")[0]; var time_array = curwritingval.split(":"); curwritingval = "", time_array = time_array.map((function (e) { return parseInt(e) })), time_array[0] ? time_array[0] += " " + mir_translate("hour") : time_array[0] = null, time_array[1] ? time_array[1] += " " + mir_translate("min") : time_array[1] = null, time_array[2] ? time_array[2] += " " + mir_translate("sec") : time_array[2] = null, time_array = time_array.filter((function (e) { return null !== e })), curwritingval = time_array.join("/") } else curwritingval = mir_translate("Forever"); curwritingval == MIR.ui.constants.NULL_VALUE && (curwritingval = current_parameter.null_option.toLowerCase()) } properties[curid] = '<strong data-type="' + dt + '">' + curwritingval + "</strong>", c++ } desc = mir_translate(desc, properties) } else desc = mir_translate(current_action.info.name); $(nameholder).html(desc) } function missions_missionview_toggle_parameters(e, t) { $.each(window["missions_missionview_" + e + "_elements"][t].info.parameters, (function () { var i = t + "_fieldwrapper_" + this.saveid, s = !1, n = window["missions_missionview_" + e + "_elements"][t].dynvals, a = window["missions_missionview_" + e + "_elements"][t].vals; if (this.dependencies ? $.each(this.dependencies, (function () { var i = n[this.dependency_id]; if (-1 !== i && void 0 !== i) return s = !0, !0; var r = a[this.dependency_id]; if (null === this.value && r === MIR.ui.constants.NULL_VALUE && (s = !0), this.check_field) { var o = r, d = this.dependency_id, m = window["missions_missionview_" + e + "_elements"][t].info.parameters, l = $.grep(m, (function (e) { return e.id == d }))[0], u = $.grep(l.options, (function (e) { return e.value == o }))[0]; u && (r = u[this.check_field]) } if (Array.isArray(this.value)) s = $.inArray(r, this.value) > -1; else if (r == this.value) return s = !0, !0 })) : s = !0, $("#" + i).toggle(s), !s && this.nullable) { var r = e + "_missionview_settingspanel_field_" + this.id + "_nullfield", o = $("#" + r); o.is(":checked") || o.click() } })) } function missions_missionview_launch_settings(e, t) { window["missions_missionview_" + e + "_original_elements"] = $.extend(!0, {}, window["missions_missionview_" + e + "_elements"][t]), window["missions_missionview_" + e + "_original_dynvars"] = $.extend(!0, [], window["missions_missionview_" + e + "_dynvars"]), window["missions_missionview_" + e + "_original_errors"] = $.extend(!0, [], window["missions_missionview_" + e + "errors"]); window["missions_missionview_" + e + "_elements"][t]; submitwarn_set(), document.getElementById(e + "_missionview").setAttribute("data-show-settings", "true"), $("li.action").attr("data-settings-open", "false"), document.getElementById(t).setAttribute("data-settings-open", "true"); var i = document.getElementById(e + "_missionview_settingspanel"); i.innerHTML = ""; var s = document.createElement("h3"), n = ""; if (window["missions_missionview_" + e + "_elements"][t].info.help.length > 0 && 1 == window["missions_missionview_" + e + "_elements"][t].info.existing ? (window.help_window_text = window["missions_missionview_" + e + "_elements"][t].info.help, n += '<span class="help" onclick="help_launch(help_window_text);"></span>', s.setAttribute("data-has-help", "true")) : s.setAttribute("data-has-help", "false"), 1 == window["missions_missionview_" + e + "_elements"][t].info.existing ? n += mir_translate(window["missions_missionview_" + e + "_elements"][t].info.name) : n += lang_missions_missionview_deleted_mission, s.innerHTML = n, i.appendChild(s), void 0 === window["missions_missionview_" + e + "_elements"][t].info.parameters); else for (var a = 0; a < window["missions_missionview_" + e + "_elements"][t].info.parameters.length;) { var r = window["missions_missionview_" + e + "_elements"][t].dynvals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id], o = window["missions_missionview_" + e + "_elements"][t].info.parameters[a].type, d = document.createElement("div"); if (d.setAttribute("class", "fieldwrapper"), d.setAttribute("data-dynbutton", "false"), d.setAttribute("data-ftype", o), d.setAttribute("data-error", "false"), d.setAttribute("data-inactive", "false"), r > -1 ? d.setAttribute("data-dynval", "true") : d.setAttribute("data-dynval", "false"), d.setAttribute("id", t + "_fieldwrapper_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), i.appendChild(d), "Reference" == o || "Selection" == o || "Integer" == o || "Float" == o || "String" == o || "Duration" == o) { (R = document.createElement("label")).setAttribute("for", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid); var m = mir_translate(window["missions_missionview_" + e + "_elements"][t].info.parameters[a].name); window["missions_missionview_" + e + "_elements"][t].info.parameters[a].help.length > 0 && (window["help_window_text_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid] = window["missions_missionview_" + e + "_elements"][t].info.parameters[a].help, m += '<span class="help" onclick="help_launch(help_window_text_' + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid + ');"></span>'), R.innerHTML = m, d.appendChild(R) } var l = document.createElement("div"); l.setAttribute("class", "fieldholder"), l.setAttribute("id", t + "_fieldholder_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), d.appendChild(l); var u = !1; if ("Reference" == o || "Selection" == o) { u = !0; var _ = document.createElement("select"); if (_.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), _.setAttribute("name", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), _.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), _.setAttribute("data-item-id", t), _.setAttribute("data-element-id", e), _.setAttribute("data-count", a), l.appendChild(_), _.onchange = function () { if ("popuppositionpicker" == this.options[this.selectedIndex].value) missions_missionview_launch_popuppositionpicker(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].info.parameters[this.getAttribute("data-count")].options); else { var e = this.getAttribute("data-item-id"), t = this.getAttribute("data-parameter-id"), i = this.getAttribute("data-element-id"); window["missions_missionview_" + i + "_elements"][e].vals[t] = this.options[this.selectedIndex].value, missions_missionview_set_action_names(i, e), missions_missionview_toggle_parameters(i, e) } }, void 0 === window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options || 0 == window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options.length) { (b = document.createElement("option")).setAttribute("value", ""), b.setAttribute("selected", "selected"), b.innerHTML = lang_missions_missionview_nooptionsavailable, _.appendChild(b), _.setAttribute("disabled", "disabled") } else { var p = "", c = !1, v = 0; for (window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options.sort((function (e, t) { return e.prioritize || t.prioritize ? e.prioritize ? -1 : 1 : e.groupname && t.groupname && e.groupname != t.groupname ? e.groupname.toUpperCase() < t.groupname.toUpperCase() ? -1 : 1 : e.name.toUpperCase() < t.name.toUpperCase() ? -1 : 1 })); v < window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options.length;) { if (window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[0].groupname) { if (window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[v].groupname == p); else { var h = document.createElement("optgroup"); h.setAttribute("label", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[v].groupname), _.appendChild(h), p = window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[v].groupname } var g = h } else g = _; var b; (b = document.createElement("option")).setAttribute("value", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[v].value), window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[v].value == window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id] && (b.setAttribute("selected", "selected"), c = !0), b.innerHTML = window["missions_missionview_" + e + "_elements"][t].info.parameters[a].options[v].name, g.appendChild(b), v++ } if (!c) { var w = window["missions_missionview_" + e + "_elements"][t], f = w.info.parameters[a].id; w.vals[f] == MIR.ui.constants.NULL_VALUE && w.info.parameters[a].nullable || (w.vals[f] = $(_).val()), missions_missionview_set_action_names(e, t) } } window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id } else if ("String" == o) { u = !0, (A = window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id]) == MIR.ui.constants.NULL_VALUE && (A = ""), (y = document.createElement("input")).setAttribute("type", "text"), y.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), y.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), y.setAttribute("data-item-id", t), y.setAttribute("data-element-id", e), y.setAttribute("name", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), y.setAttribute("value", A), l.appendChild(y), y.onkeyup = function () { var e = this.getAttribute("data-item-id"), t = this.getAttribute("data-parameter-id"), i = this.getAttribute("data-element-id"); window["missions_missionview_" + i + "_elements"][e].vals[t] = this.value, missions_missionview_set_action_names(i, e) } } else if ("Integer" == o || "Float" == o) { var A, y; u = !0, (A = window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id]) == MIR.ui.constants.NULL_VALUE && (A = ""), (y = document.createElement("input")).setAttribute("type", "text"), y.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), y.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), y.setAttribute("data-item-id", t), y.setAttribute("data-element-id", e), y.setAttribute("name", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), y.setAttribute("value", A), l.appendChild(y), y.onkeyup = function () { var e = this.getAttribute("data-item-id"), t = this.getAttribute("data-parameter-id"), i = this.getAttribute("data-element-id"); window["missions_missionview_" + i + "_elements"][e].vals[t] = this.value, missions_missionview_set_action_names(i, e) } } else if ("Duration" == o) { u = !0; missions_missionview_transform_duration_toseconds(window["missions_missionview_" + e + "_elements"][t].info.parameters[a].min), missions_missionview_transform_duration_toseconds(window["missions_missionview_" + e + "_elements"][t].info.parameters[a].max); if (window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id] == MIR.ui.constants.NULL_VALUE) var E = 0; else E = missions_missionview_transform_duration_toseconds(window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id]); window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id; var C = E, I = Math.floor(E / 60), T = Math.floor(I / 60), B = E - 60 * I; I = I - 60 * T; 1 == String(B).length && (B = "0" + String(B)), 1 == String(I).length && (I = "0" + I), 1 == String(T).length && (T = "0" + T); var L = [T, I, B], k = ["hours", "minutes", "seconds"], M = [lang_missions_missionview_durationpicker_hours, lang_missions_missionview_durationpicker_minutes, lang_missions_missionview_durationpicker_seconds], x = document.createElement("div"); x.setAttribute("class", "durationpickerholder"), x.setAttribute("data-cur", C), x.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), l.appendChild(x); var H = document.createElement("table"); H.setAttribute("cellpadding", "0"), H.setAttribute("cellspacing", "0"), x.appendChild(H); var q = document.createElement("tr"); H.appendChild(q); for (var N = 0; N < k.length;) { (j = document.createElement("td")).setAttribute("class", "arrow_up"), q.appendChild(j), (U = document.createElement("div")).setAttribute("data-timetype", k[N]), U.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), U.setAttribute("data-element-id", e), U.setAttribute("data-item-id", t), U.innerHTML = "<span>+</span>", U.onclick = function () { var e = document.getElementById(this.getAttribute("data-element-id") + "_missionview_settingspanel_field_" + this.getAttribute("data-parameter-id") + "_" + this.getAttribute("data-timetype")), t = "00"; if (parseInt(e.value)) var i = parseInt(e.value); else i = 0; i >= 24 && "hours" == this.getAttribute("data-timetype") || i >= 59 && "minutes" == this.getAttribute("data-timetype") || i >= 59 && "seconds" == this.getAttribute("data-timetype") ? t = "00" : 1 == (t = String(i + 1)).length && (t = "0" + t), e.value = t, missions_missionview_durationpickerholder_set_value(this.getAttribute("data-element-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-item-id")) }, j.appendChild(U), N++ } q = document.createElement("tr"); H.appendChild(q); for (N = 0; N < k.length;) { (j = document.createElement("td")).setAttribute("class", "field"), q.appendChild(j); var S = document.createElement("input"); S.setAttribute("type", "text"), S.setAttribute("maxlength", "2"), S.setAttribute("value", L[N]), S.setAttribute("data-timetype", k[N]), S.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), S.setAttribute("data-element-id", e), S.setAttribute("data-item-id", t), S.setAttribute("data-old-value", ""), S.setAttribute("name", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id + "_" + k[N]), S.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id + "_" + k[N]), S.onkeyup = function (e) { var t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]; if (2 == this.value.length && t.indexOf(e.key) > -1 && e.target == this && this.value !== this.getAttribute("data-old-value")) { var i = this.getAttribute("data-element-id") + "_missionview_settingspanel_field_" + this.getAttribute("data-parameter-id") + "_"; "hours" == this.getAttribute("data-timetype") ? i += "minutes" : "minutes" == this.getAttribute("data-timetype") ? i += "seconds" : i += "hours", $("#" + i).select(), $("#" + i).focus() } else t.indexOf(e.key) > -1 && this.setAttribute("data-old-value", ""); missions_missionview_durationpickerholder_set_value(this.getAttribute("data-element-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-item-id")) }, S.onblur = function (e) { if (e.target == this) { for (var t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"], i = !1, s = 0; s < this.value.length;)-1 == t.indexOf(this.value[s]) && (i = !0), s++; 0 == this.value.length || 1 == i ? this.value = "00" : "hours" == this.getAttribute("data-timetype") && parseInt(this.value) > 24 ? this.value = "24" : "hours" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : "minutes" == this.getAttribute("data-timetype") && parseInt(this.value) > 59 ? this.value = "59" : "minutes" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : "seconds" == this.getAttribute("data-timetype") && parseInt(this.value) > 59 ? this.value = "59" : "seconds" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : 1 == this.value.length && (this.value = "0" + this.value), this.setAttribute("data-old-value", this.value) } }, j.appendChild(S), N++ } q = document.createElement("tr"); H.appendChild(q); for (N = 0; N < k.length;) { (j = document.createElement("td")).setAttribute("class", "text"), q.appendChild(j); var O = document.createElement("div"); O.innerHTML = "<span>" + M[N] + "</span>", j.appendChild(O), N++ } q = document.createElement("tr"); H.appendChild(q); for (N = 0; N < k.length;) { var j, U; (j = document.createElement("td")).setAttribute("class", "arrow_down"), q.appendChild(j), (U = document.createElement("div")).setAttribute("data-timetype", k[N]), U.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), U.setAttribute("data-element-id", e), U.setAttribute("data-item-id", t), U.innerHTML = "<span>-</span>", U.onclick = function () { var e = document.getElementById(this.getAttribute("data-element-id") + "_missionview_settingspanel_field_" + this.getAttribute("data-parameter-id") + "_" + this.getAttribute("data-timetype")), t = "00"; if (parseInt(e.value)) var i = parseInt(e.value); else i = 0; i <= 0 && "hours" == this.getAttribute("data-timetype") ? t = "24" : i <= 0 && "minutes" == this.getAttribute("data-timetype") || i <= 0 && "seconds" == this.getAttribute("data-timetype") ? t = "59" : 1 == (t = String(i - 1)).length && (t = "0" + t), e.value = t, missions_missionview_durationpickerholder_set_value(this.getAttribute("data-element-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-item-id")) }, j.appendChild(U), N++ } } else if ("Boolean" == o) { u = !1; var R, P = document.createElement("input"); P.setAttribute("type", "checkbox"), P.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), P.setAttribute("name", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), P.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), P.setAttribute("data-item-id", t), P.setAttribute("data-element-id", e), 1 == window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id] && P.setAttribute("checked", "checked"), l.appendChild(P), P.onclick = function () { var e = this.getAttribute("data-item-id"), t = this.getAttribute("data-parameter-id"), i = this.getAttribute("data-element-id"); 1 == this.checked ? window["missions_missionview_" + i + "_elements"][e].vals[t] = 1 : window["missions_missionview_" + i + "_elements"][e].vals[t] = 0, missions_missionview_toggle_parameters(i, e), missions_missionview_set_action_names(i, e) }, (R = document.createElement("label")).setAttribute("data-fieldtype", "checkbox"), R.setAttribute("for", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), R.innerHTML = mir_translate(window["missions_missionview_" + e + "_elements"][t].info.parameters[a].name), l.appendChild(R); var D = document.createElement("div"); D.setAttribute("class", "clear"), l.appendChild(D) } if (1 == u) { d.setAttribute("data-dynbutton", "true"); var V = window["missions_missionview_" + e + "_elements"][t].info.parameters[a].type; "Selection" != V && "Reference" != V || (V = window["missions_missionview_" + e + "_elements"][t].info.parameters[a].type + ":::" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id); var J = window["missions_missionview_" + e + "_elements"][t].dynvals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id]; if (J > -1) var G = window["missions_missionview_" + e + "_dynvars"][J].name; else G = "Unknown"; var F = document.createElement("div"); F.setAttribute("class", "dynvarprops"), d.appendChild(F); var K = document.createElement("div"); K.setAttribute("class", "badge"), K.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), K.setAttribute("data-parameter-saveid", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), K.setAttribute("data-parameter-type", V), K.setAttribute("data-item-id", t), K.setAttribute("data-element-id", e), F.appendChild(K); var z = document.createElement("p"); z.setAttribute("id", t + "_dynvarbadgetext_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), z.innerHTML = G, K.appendChild(z), K.onclick = function () { var i = window["missions_missionview_" + e + "_elements"][t].dynvals[this.getAttribute("data-parameter-id")]; missions_missionview_launch_dynvars(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-parameter-saveid"), this.getAttribute("data-parameter-type"), i) }; var Q = document.createElement("div"); Q.setAttribute("class", "dynbutton"), Q.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), Q.setAttribute("data-parameter-saveid", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), Q.setAttribute("data-parameter-type", V), Q.setAttribute("data-item-id", t), Q.setAttribute("data-element-id", e), d.appendChild(Q), Q.onclick = function () { var i = window["missions_missionview_" + e + "_elements"][t].dynvals[this.getAttribute("data-parameter-id")]; missions_missionview_launch_dynvars(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-parameter-saveid"), this.getAttribute("data-parameter-type"), i) } } if (1 != window["missions_missionview_" + e + "_elements"][t].info.parameters[a].nullable || window["missions_missionview_" + e + "_elements"][t].info.parameters[a].hide_checkbox) d.setAttribute("data-nullable", "false"), d.setAttribute("data-null-option", ""); else { d.setAttribute("data-nullable", "true"), d.setAttribute("data-null-option", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].null_option); var Y = document.createElement("div"); Y.setAttribute("class", "nullerholder"), d.appendChild(Y); var W = document.createElement("input"); W.setAttribute("type", "checkbox"), W.setAttribute("name", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id + "_nullfield"), W.setAttribute("id", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id + "_nullfield"), W.setAttribute("data-element-id", e), W.setAttribute("data-item-id", t), W.setAttribute("data-cur-type", o), W.setAttribute("data-param-count", a), W.setAttribute("data-default-value", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].default), W.setAttribute("data-parameter-id", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id), W.setAttribute("data-parameter-saveid", window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), window["missions_missionview_" + e + "_elements"][t].vals[window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id] == MIR.ui.constants.NULL_VALUE && (W.setAttribute("checked", "checked"), d.setAttribute("data-inactive", "true")), W.setAttribute("value", "1"), Y.appendChild(W), W.onclick = function () { var i = this.getAttribute("data-default-value"), s = this.getAttribute("data-cur-type"); window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].vals[this.getAttribute("data-parameter-id")] == MIR.ui.constants.NULL_VALUE ? (this.parentNode.parentNode.setAttribute("data-inactive", "false"), "Integer" == s || "Float" == s ? ("null" == i && (i = window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].info.parameters[this.getAttribute("data-param-count")].min), document.getElementById(this.getAttribute("data-element-id") + "_missionview_settingspanel_field_" + window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].info.parameters[this.getAttribute("data-param-count")].saveid).value = i) : "Duration" == s ? "null" == i && (missions_missionview_durationpickerholder_set_value(this.getAttribute("data-element-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-item-id")), i = window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].vals[this.getAttribute("data-parameter-id")]) : "Reference" != s && "Selection" != s || ("null" == i && (i = window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].info.parameters[this.getAttribute("data-param-count")].min), $("#" + this.getAttribute("data-element-id") + "_missionview_settingspanel_field_" + window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].info.parameters[this.getAttribute("data-param-count")].saveid).val(i)), window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].vals[this.getAttribute("data-parameter-id")] = i) : (this.parentNode.parentNode.setAttribute("data-inactive", "true"), "Integer" != s && "Float" != s || (document.getElementById(this.getAttribute("data-element-id") + "_missionview_settingspanel_field_" + window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].info.parameters[this.getAttribute("data-param-count")].saveid).value = ""), window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].vals[this.getAttribute("data-parameter-id")] = MIR.ui.constants.NULL_VALUE), missions_missionview_set_action_names(this.getAttribute("data-element-id"), this.getAttribute("data-item-id")), missions_missionview_toggle_parameters(e, t) }; var X = document.createElement("label"); X.setAttribute("for", e + "_missionview_settingspanel_field_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id + "_nullfield"), X.innerHTML = mir_translate(window["missions_missionview_" + e + "_elements"][t].info.parameters[a].null_option), Y.appendChild(X) } var Z = document.createElement("div"); Z.setAttribute("class", "errorholder"), d.appendChild(Z); var ee = document.createElement("p"); ee.setAttribute("id", e + "_missionview_settingspanel_fielderror_" + window["missions_missionview_" + e + "_elements"][t].info.parameters[a].saveid), Z.appendChild(ee); var te = !1, ie = ""; for (N = 0; N < window["missions_missionview_" + e + "_errors"].length;)window["missions_missionview_" + e + "_errors"][N].item == t && (window["missions_missionview_" + e + "_errors"][N].field == window["missions_missionview_" + e + "_elements"][t].info.parameters[a].id && (te = !0, ie = mir_translate(window["missions_missionview_" + e + "_errors"][N].error_human)), document.getElementById(t).setAttribute("data-error", "true")), N++; 1 == te ? (d.setAttribute("data-error", "true"), ee.innerHTML = ie) : (d.setAttribute("data-error", "false"), ee.innerHTML = ""), a++ } (U = document.createElement("input")).setAttribute("type", "button"), U.setAttribute("id", e + "_missionview_settingspanel_field_setbutton"), U.setAttribute("name", e + "_missionview_settingspanel_field_setbutton"), U.setAttribute("data-element-id", e), U.setAttribute("data-item-id", t), U.setAttribute("value", mir_translate("Validate and close")), i.appendChild(U), U.onclick = function (e) { missions_missionview_validation_action(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), !0, !0) }, (U = document.createElement("input")).setAttribute("type", "button"), U.setAttribute("id", e + "_missionview_settingspanel_field_cancelbutton"), U.setAttribute("name", e + "_missionview_settingspanel_field_cancelbutton"), U.setAttribute("data-element-id", e), U.setAttribute("data-item-id", t), U.setAttribute("class", "undo"), U.setAttribute("value", mir_translate("Undo and close")), i.appendChild(U), U.onclick = function (e) { missions_missionview_undo_and_close(this.getAttribute("data-element-id"), this.getAttribute("data-item-id")) }; var se = document.createElement("input"); se.setAttribute("type", "button"), se.setAttribute("class", "remove"), se.setAttribute("id", e + "_missionview_settingspanel_field_delbutton"), se.setAttribute("name", e + "_missionview_settingspanel_field_delbutton"), se.setAttribute("data-element-id", e), se.setAttribute("data-item-id", t), se.setAttribute("value", mir_translate("Remove action")), i.appendChild(se), se.onclick = function () { document.getElementById(this.getAttribute("data-element-id") + "_missionview").setAttribute("data-show-settings", "false"), $("li.action").attr("data-settings-open", "false"), $("#" + this.getAttribute("data-item-id")).remove(), missions_missionview_align_settings_panel(e), delete window["missions_missionview_" + e + "_elements"][t] }, missions_missionview_toggle_parameters(e, t), 1 == document.getElementsByTagName("body")[0].getAttribute("data-mobile") ? (document.getElementsByTagName("body")[0].getAttribute("data-webapp"), $("html, body").animate({ scrollTop: 0 }, 300)) : ($(document).scroll((function () { missions_missionview_align_settings_panel(e) })), missions_missionview_align_settings_panel(e)) } function missions_missionview_align_settings_panel(e) { if ($(window).width() <= MIR.constants.MOBILE_RES_THRESHOLD + 40) return !1; var t = $("#" + e + "_missionview .header"), i = $("#" + e + "_missionview_settingspanelpusher"), s = $("#" + e + "_missionview_settingspanel"), n = 0; if (0 === s.length || !s.is(":visible")) return i.height(n), !1; if (1 !== t.length || 1 !== i.length) return !1; var a = $("#" + e + "_missionview_actionlist").outerHeight(), r = $("#" + e + "_missionview_settingspanel").outerHeight(); if (!(a < r)) { var o = a - r; o <= (n = $(document).scrollTop() - t.offset().top + parseInt(t.css("margin-top"))) && (n = o - 9), i.height(n) } } function missions_missionview_durationpickerholder_set_value(e, t, i) { var s = document.getElementById(e + "_missionview_settingspanel_field_" + t + "_hours"), n = document.getElementById(e + "_missionview_settingspanel_field_" + t + "_minutes"), a = document.getElementById(e + "_missionview_settingspanel_field_" + t + "_seconds"), r = s.value; 1 == r.length && (r = "0" + r); var o = n.value; 1 == o.length && (o = "0" + o); var d = a.value; 1 == d.length && (d = "0" + d); var m = r + ":" + o + ":" + d + ".000000", l = parseInt(d) + 60 * parseInt(o) + 3600 * parseInt(r); $(s).closest("div.durationpickerholder").attr("data-cur", l), window["missions_missionview_" + e + "_elements"][i].vals[t] = m, missions_missionview_set_action_names(e, i) } function missions_missionview_launch_popuppositionpicker(e, t, i, s) { var n = {}; return n.positions = s, $.ajax({ url: "/setup/missions?mode=popuppositionpicker-get-data", data: n, method: "POST", dataType: "json", success: function (e) { var t = document.createElement("div"); t.setAttribute("class", "popuppositionpicker"), t.setAttribute("id", "popuppositionpicker"), document.getElementsByTagName("body")[0].appendChild(t); var i = document.createElement("div"); i.setAttribute("class", "box"), t.appendChild(i); var s = document.createElement("div"); s.setAttribute("class", "header"), i.appendChild(s); var n = document.createElement("h1"); n.innerHTML = lang_missions_missionview_popuppositionpicker_chooseposition, s.appendChild(n); var a = document.createElement("div"); a.setAttribute("class", "backbutton"), a.innerHTML = "<span>" + lang_missions_missionview_popuppositionpicker_cancel + "</span>", s.appendChild(a), a.onclick = function () { document.getElementById("popuppositionpicker").parentNode.removeChild(document.getElementById("popuppositionpicker")) }; var r = document.createElement("div"); r.setAttribute("class", "formholder"), i.appendChild(r), (u = document.createElement("div")).setAttribute("class", "fieldholder"), r.appendChild(u); var o = document.createElement("label"); o.setAttribute("for", "popuppositionpicker_selector_site"), o.innerHTML = lang_missions_missionview_popuppositionpicker_site, u.appendChild(o); var d = document.createElement("select"); d.setAttribute("name", "popuppositionpicker_selector_site"), d.setAttribute("id", "popuppositionpicker_selector_site"), d.onchange = function () { if ("" == document.getElementById("popuppositionpicker_selector_site").options[document.getElementById("popuppositionpicker_selector_site").selectedIndex].value) { $("#popuppositionpicker_selector_map").html(""), (n = document.createElement("option")).setAttribute("value", ""), n.innerHTML = lang_missions_missionview_popuppositionpicker_allmaps, document.getElementById("popuppositionpicker_selector_map").appendChild(n) } else for (var t = 0, i = !0; t < e.length && 1 == i;) { if (e[t].guid == document.getElementById("popuppositionpicker_selector_site").options[document.getElementById("popuppositionpicker_selector_site").selectedIndex].value) { $("#popuppositionpicker_selector_map").html(""), (n = document.createElement("option")).setAttribute("value", ""), n.innerHTML = lang_missions_missionview_popuppositionpicker_allmaps, document.getElementById("popuppositionpicker_selector_map").appendChild(n); for (var s = 0; s < e[t].maps.length;) { var n; (n = document.createElement("option")).setAttribute("value", e[t].maps[s].guid), n.innerHTML = e[t].maps[s].name, document.getElementById("popuppositionpicker_selector_map").appendChild(n), s++ } i = !1 } t++ } return p(), !0 }, u.appendChild(d), (v = document.createElement("option")).setAttribute("value", ""), v.innerHTML = lang_missions_missionview_popuppositionpicker_allsites, d.appendChild(v); for (var m = 0; m < e.length;) { (v = document.createElement("option")).setAttribute("value", e[m].guid), v.innerHTML = e[m].name, d.appendChild(v), m++ } (u = document.createElement("div")).setAttribute("class", "fieldholder"), r.appendChild(u); var l = document.createElement("label"); l.setAttribute("for", "popuppositionpicker_selector_map"), l.innerHTML = lang_missions_missionview_popuppositionpicker_map, u.appendChild(l); var u, _ = document.createElement("select"); function p() { for (var t = [], i = document.getElementById("popuppositionpicker_selector_site").options[document.getElementById("popuppositionpicker_selector_site").selectedIndex].value, s = document.getElementById("popuppositionpicker_selector_map").options[document.getElementById("popuppositionpicker_selector_map").selectedIndex].value, n = 0; n < e.length;)"" != i && e[n].guid != i || t.push(e[n]), n++; var a = []; for (n = 0; n < t.length;) { var r = {}; r.guid = t[n].guid, r.name = t[n].name, r.maps = []; for (var o = 0; o < t[n].maps.length;)"" != s && s != t[n].maps[o].guid || r.maps.push(t[n].maps[o]), o++; a.push(r), n++ } var d = []; for (n = 0; n < a.length;) { for (var m = 0; m < a[n].maps.length;) { for (o = 0; o < a[n].maps[m].positions.length;)d.push(a[n].maps[m].positions[o]), o++; m++ } n++ } var l = document.getElementById("popuppositionpicker_results_list"); l.innerHTML = ""; var u = document.createElement("ul"); l.appendChild(u); for (o = 0; o < d.length;) { var _ = document.createElement("li"); _.setAttribute("data-guid", d[o].guid), u.appendChild(_); var p = document.createElement("div"); p.setAttribute("class", "icon"), _.appendChild(p); var c = document.createElement("div"); c.setAttribute("class", "name"), c.innerHTML = d[o].name, _.appendChild(c), _.onclick = function () { alert(this.getAttribute("data-guid")) }, o++ } } _.setAttribute("name", "popuppositionpicker_selector_map"), _.setAttribute("id", "popuppositionpicker_selector_map"), _.onchange = p, u.appendChild(_), (v = document.createElement("option")).setAttribute("value", ""), v.innerHTML = lang_missions_missionview_popuppositionpicker_allmaps, _.appendChild(v), (u = document.createElement("div")).setAttribute("class", "fieldholder"), r.appendChild(u); var c = document.createElement("label"); c.setAttribute("for", "popuppositionpicker_selector_view"), c.innerHTML = lang_missions_missionview_popuppositionpicker_view, u.appendChild(c); var v, h = document.createElement("select"); h.setAttribute("name", "popuppositionpicker_selector_view"), h.setAttribute("id", "popuppositionpicker_selector_view"), u.appendChild(h), (v = document.createElement("option")).setAttribute("value", "list"), v.innerHTML = lang_missions_missionview_popuppositionpicker_showaslist, h.appendChild(v), (v = document.createElement("option")).setAttribute("value", "map"), v.innerHTML = lang_missions_missionview_popuppositionpicker_showinmap, h.appendChild(v); var g = document.createElement("div"); g.setAttribute("class", "nodata"), g.setAttribute("id", "popuppositionpicker_nodata"), g.innerHTML = "<p>" + lang_missions_missionview_popuppositionpicker_nodata + "</p>", i.appendChild(g); var b = document.createElement("div"); b.setAttribute("class", "results_list"), b.setAttribute("id", "popuppositionpicker_results_list"), i.appendChild(b); var w = document.createElement("div"); w.setAttribute("class", "results_map"), w.setAttribute("id", "popuppositionpicker_results_map"), i.appendChild(w); var f = document.createElement("div"); f.setAttribute("class", "controlbar"), i.appendChild(f); var A = document.createElement("input"); A.setAttribute("name", "popuppositionpicker_filter"), A.setAttribute("id", "popuppositionpicker_filter"), A.setAttribute("placeholder", lang_missions_missionview_popuppositionpicker_searchinpositions), f.appendChild(A); var y = document.createElement("ul"); y.setAttribute("class", "buttonlist"), f.appendChild(y); var E = document.createElement("li"); E.setAttribute("id", ""), E.setAttribute("class", ""), E.setAttribute("data-active", "true"), E.innerHTML = lang_missions_missionview_popuppositionpicker_showinmap, y.appendChild(E); var C = document.createElement("li"); C.setAttribute("id", ""), C.setAttribute("class", ""), C.setAttribute("data-active", "false"), C.innerHTML = lang_missions_missionview_popuppositionpicker_showaslist, y.appendChild(C) } }), !0 } function missions_missionview_transform_duration_toseconds(e) { var t = 0, i = e.split("."); return i = (i = i[0]).split(":"), t += 3600 * parseInt(i[0]), t += 60 * parseInt(i[1]), t += parseInt(i[2]) } function missions_missionview_transform_duration_tostring(e) { var t = Math.floor(e / 60); e -= 60 * t; var i = Math.floor(t / 60); t -= 60 * i; var s = ""; return i > 0 && (s += 1 == i ? i + " hour" : i + " hours", (t > 0 || e > 0) && (s += "and")), (t > 0 || e > 0 && i > 0) && (s += 1 == t ? t + " minute" : t + " minutes", e > 0 && (s += " and ")), (e > 0 || 0 == i && 0 == t) && (s += e + " seconds"), s } function missions_missionview_transform_duration_totime(e) { var t = Math.floor(e / 60); e -= 60 * t; var i = Math.floor(t / 60); return t -= 60 * i, 1 == String(e).length && (e = "0" + String(e)), 1 == String(t).length && (t = "0" + String(t)), 1 == String(i).length && (i = "0" + String(i)), i + ":" + t + ":" + e + ".000000" } function missions_missionview_load_actions(e, t, i, s) { var n = window["missions_missionview_" + e + "_data"].guid, a = { mode: "load-mission-actionlist" }; a.mother = t, a.id = n, a.calltype = "light", a.pageviewid = pageviewid, $.ajax({ url: "/", data: a, method: "GET", dataType: "json", element_id: e, success: function (t) { for (var n = 0; n < t.length;) { var a; a = t[n].parameters, missions_missionview_add_action(e, t[n].action_type, t[n].guid, a, i, null, s), n++ } }, complete: function () { window["missions_missionview_" + e + "_initial_elements"] = JSON.parse(JSON.stringify(window["missions_missionview_" + e + "_elements"])) } }) } function missions_missionview_save_changes(e) { resetChanges(), document.getElementById(e + "_missionview").setAttribute("data-show-settings", "false"), document.getElementById(e + "_missionview").setAttribute("data-highlighted-scope", ""), $("li.action").attr("data-settings-open", "false"), $("ul#missionview_" + e + "_list_main").find("div.substatement,div.subholder").attr("data-highlighted", "false"); var t = document.createElement("div"); t.setAttribute("class", "overlay_progress"), t.setAttribute("id", "missionsaver_overlay"), document.getElementsByTagName("body")[0].appendChild(t); var i = document.createElement("div"); i.setAttribute("class", "box"), t.appendChild(i); var s = document.createElement("h1"); s.innerHTML = lang_main_missions_pleasewait, i.appendChild(s); var n = document.createElement("p"); n.innerHTML = lang_main_missions_savingmission, i.appendChild(n), $("ul#missionview_" + e + "_list_main").find("li").attr("data-error", "false"), window["missions_missionview_" + e + "_errors"] = []; var a = clean_mission_action_data(missions_missionview_fetch_actions(e, "missionview_" + e + "_list_main")), r = document.getElementById(e + "_missionview").getAttribute("data-mission-guid"), o = {}; return o.data = a, o.missiondata = window["missions_missionview_" + e + "_data"], o.dynvars = window["missions_missionview_" + e + "_dynvars"], o.id = r, o.dryrun = "true", $.ajax({ url: "/?mode=save-mission", data: o, method: "POST", dataType: "json", success: function (t) { if (close_waiter(), window["missions_missionview_" + e + "_errors"] = [], 0 == t.length) { var i = {}; i.data = a, i.missiondata = window["missions_missionview_" + e + "_data"], i.dynvars = window["missions_missionview_" + e + "_dynvars"], i.id = r, $.ajax({ url: "/?mode=save-mission", data: i, method: "POST", dataType: "json", element_id: e, success: function (e) { for (var t = 0; t < e.length;)document.getElementById(e[t].id).setAttribute("data-action-guid", e[t].guid), t++; var i = window.location.href; (i = i.split("/"))[5] == r ? document.getElementById("missionsaver_overlay").parentNode.removeChild(parent.document.getElementById("missionsaver_overlay")) : location.href = "/setup/missions/" + r } }) } else { for (var s = 0; s < t.length;) { if (document.getElementById(t[s].id).setAttribute("data-error", "true"), null == t[s].parameters); else for (var n = 0; n < window["missions_missionview_" + e + "_elements"][t[s].id].info.parameters.length;) { if (void 0 !== t[s].parameters[window["missions_missionview_" + e + "_elements"][t[s].id].info.parameters[n].id]) { var o = {}; o.item = t[s].id, o.field = window["missions_missionview_" + e + "_elements"][t[s].id].info.parameters[n].id, o.error_human = mir_translate(t[s].parameters[window["missions_missionview_" + e + "_elements"][t[s].id].info.parameters[n].id].error_human), o.error_code = t[s].parameters[window["missions_missionview_" + e + "_elements"][t[s].id].info.parameters[n].id].error_code, window["missions_missionview_" + e + "_errors"].push(o) } n++ } s++ } document.getElementById("missionsaver_overlay").parentNode.removeChild(parent.document.getElementById("missionsaver_overlay")); var d = document.createElement("div"); d.setAttribute("class", "overlay_error"), d.setAttribute("id", "missionerror_overlay"), document.getElementsByTagName("body")[0].appendChild(d); var m = document.createElement("div"); m.setAttribute("class", "box"), d.appendChild(m); var l = document.createElement("h1"); l.innerHTML = lang_main_missions_errorsoccured, m.appendChild(l); var u = document.createElement("p"); u.innerHTML = lang_main_missions_errorsoccured_text, m.appendChild(u); var _ = document.createElement("div"); _.setAttribute("class", "buttonholder"), m.appendChild(_); var p = document.createElement("div"); p.setAttribute("class", "ok"), p.setAttribute("id", "missionerror_submitbtn"), p.innerHTML = lang_main_missions_errors_ok, _.appendChild(p), p.onclick = function () { document.getElementById("missionerror_overlay").parentNode.removeChild(parent.document.getElementById("missionerror_overlay")) } } }, complete: function () { window["missions_missionview_" + e + "_initial_elements"] = JSON.parse(JSON.stringify(window["missions_missionview_" + e + "_elements"])) } }), !0 } function missions_missionview_save_as(e) { Promise.all([$.get("/setup/maps?mode=get-sites", (function (e) { sites = e.map((function (e) { return { text: e.htmlname, value: e.guid } })).sort((function (e, t) { return e.text < t.text ? -1 : 1 })), sites.unshift({ text: mir_translate("shared_popup_template_mission_saveas_site_no_site"), value: "" }) })), $.get("/setup/maps?mode=get-mission-groups", (function (e) { groups = e.map((function (e) { return { text: e.htmlname, value: e.guid } })).sort((function (e, t) { return e.text < t.text ? -1 : 1 })) }))]).then((function () { var t = new MIR.ui.form_element({ text: mir_translate("shared_popup_template_mission_saveas_site") }, { type: "select", opts: { def: window["missions_missionview_" + e + "_data"].session_id, options: sites, attr: { name: "session_id", class: "select" } } }, { text: mir_translate("shared_popup_template_mission_saveas_site_tooltip") }), i = new MIR.ui.form_element({ text: mir_translate("shared_popup_template_mission_saveas_group") }, { type: "select", opts: { def: window["missions_missionview_" + e + "_data"].group_id, options: groups, attr: { name: "group_id", class: "select" } } }, { text: mir_translate("shared_popup_template_mission_saveas_group_tooltip") }), s = document.createElement("div"); s.setAttribute("class", "missionsaveas_overlay"), s.setAttribute("id", "missionsaveas_overlay"), document.getElementsByTagName("body")[0].appendChild(s); var n = document.createElement("div"); n.setAttribute("class", "box"), s.appendChild(n); var a = document.createElement("h1"); a.innerHTML = lang_missions_missionview_saveas_headline, n.appendChild(a); var r = document.createElement("p"); r.innerHTML = lang_missions_missionview_saveas_text, n.appendChild(r); var o = document.createElement("form"); o.setAttribute("method", "post"), o.setAttribute("action", "/"), o.setAttribute("data-element-id", e), o.onsubmit = function () { var e = document.getElementById("missionsaveas_field_name").value; if (0 == e.length) return launch_error(lang_missions_missionview_saveas_noname, "document.getElementById('missionsaveas_field_name').focus();"), !1; launch_waiter(lang_missions_missionview_saveas_saving); var s = this.getAttribute("data-element-id"), n = document.getElementById(s + "_missionview").getAttribute("data-mission-guid"); document.getElementById("missionsaveas_overlay").parentNode.removeChild(parent.document.getElementById("missionsaveas_overlay")); var a = {}; return a.id = n, a.name = e, a.session_id = t.val(), a.group_id = i.val(), $.ajax({ url: "/?mode=saveas-mission", data: a, method: "POST", dataType: "json", success: function (n) { 1 == n.success ? (document.getElementById(s + "_missionview").setAttribute("data-mission-guid", n.guid), $("ul#missionview_" + s + "_list_main").find("li").attr("data-action-guid", ""), window["missions_missionview_" + s + "_data"].name = e, window["missions_missionview_" + s + "_data"].group_id = i.val(), window["missions_missionview_" + s + "_data"].session_id = t.val(), close_waiter(), launch_waiter(lang_missions_missionview_saveas_savingactions), missions_missionview_save_changes(s)) : (close_waiter(), launch_error(lang_missions_missionview_saveas_error)) }, complete: function () { window["missions_missionview_" + s + "_initial_elements"] = JSON.parse(JSON.stringify(window["missions_missionview_" + s + "_elements"])) } }), !1 }, n.appendChild(o); var d = document.createElement("label"); d.setAttribute("for", "missionsettings_field_name"), d.innerHTML = lang_missions_missionview_saveas_fieldname, o.appendChild(d); var m = document.createElement("input"); m.setAttribute("type", "text"), m.setAttribute("name", "missionsaveas_field_name"), m.setAttribute("id", "missionsaveas_field_name"), m.setAttribute("value", mir_translate("Copy of %(mission_name)s", { mission_name: window["missions_missionview_" + e + "_data"].name })), o.appendChild(m), $(o).append(t, i); var l = document.createElement("div"); l.setAttribute("class", "buttonholder"), o.appendChild(l); var u = document.createElement("input"); u.setAttribute("type", "submit"), u.setAttribute("name", "submit"), u.setAttribute("id", "missionsaveas_submitbtn"), u.setAttribute("value", mir_translate("Save")), l.appendChild(u); var _ = document.createElement("input"); return _.setAttribute("type", "button"), _.setAttribute("name", "missionsaveas_cancelbtn"), _.setAttribute("id", "missionsaveas_cancelbtn"), _.setAttribute("value", mir_translate("Cancel")), l.appendChild(_), _.onclick = function () { document.getElementById("missionsaveas_overlay").parentNode.removeChild(parent.document.getElementById("missionsaveas_overlay")) }, !0 })) } function missions_missionview_undo_and_close(e, t) { window["missions_missionview_" + e + "_elements"][t] = window["missions_missionview_" + e + "_original_elements"], window["missions_missionview_" + e + "_dynvars"] = window["missions_missionview_" + e + "_original_dynvars"], window["missions_missionview_" + e + "_errors"] = window["missions_missionview_" + e + "_original_errors"], window["missions_missionview_" + e + "_original_elements"] = void 0, window["missions_missionview_" + e + "_original_dynvars"] = void 0, window["missions_missionview_" + e + "_original_errors"] = void 0, missions_missionview_set_action_names(e, t); var i = $.grep(window["missions_missionview_" + e + "_errors"], (function () { return this.item = t })); document.getElementById(t).setAttribute("data-error", 0 === i.length ? "false" : "true"), document.getElementById(e + "_missionview").setAttribute("data-show-settings", "false"), document.getElementById(t).setAttribute("data-settings-open", !1) } function missions_missionview_validation_action(e, t, i, s) { s ? ($("ul#missionview_" + e + "_list_main").find("li#" + t).attr("data-error", "false"), window["missions_missionview_" + e + "_errors"] = $.grep(window["missions_missionview_" + e + "_errors"], (function (e) { return e.item === t }), !0)) : ($("ul#missionview_" + e + "_list_main").find("li").attr("data-error", "false"), window["missions_missionview_" + e + "_errors"] = []); var n = clean_mission_action_data(missions_missionview_fetch_actions(e, "missionview_" + e + "_list_main")), a = document.getElementById(e + "_missionview").getAttribute("data-mission-guid"), r = {}; return r.data = n, r.missiondata = window["missions_missionview_" + e + "_data"], r.dynvars = window["missions_missionview_" + e + "_dynvars"], r.id = a, r.dryrun = "true", $.ajax({ url: "/?mode=save-mission", data: r, method: "POST", dataType: "json", success: function (n) { if (0 == n.length) 1 == i && (document.getElementById(e + "_missionview").setAttribute("data-show-settings", "false"), document.getElementById(t).setAttribute("data-settings-open", !1), missions_missionview_align_settings_panel(e)); else { for (var a = 0, r = 0; r < n.length;)if (s && t !== n[r].id) r++; else { if (document.getElementById(n[r].id).setAttribute("data-error", "true"), null == n[r].parameters); else for (var o = 0; o < window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters.length;) { if (void 0 !== n[r].parameters[window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].id] && "true" == document.getElementById(n[r].id).getAttribute("data-settings-open") ? (document.getElementById(t + "_fieldwrapper_" + window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].saveid).setAttribute("data-error", "true"), document.getElementById(e + "_missionview_settingspanel_fielderror_" + window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].saveid).innerHTML = mir_translate(n[r].parameters[window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].id].error_human), a++) : (document.getElementById(e + "_missionview_settingspanel_fielderror_" + window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].saveid) && (document.getElementById(e + "_missionview_settingspanel_fielderror_" + window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].saveid).innerHTML = ""), document.getElementById(t + "_fieldwrapper_" + window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].saveid) && document.getElementById(t + "_fieldwrapper_" + window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].saveid).setAttribute("data-error", "false")), void 0 !== n[r].parameters[window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].id]) { var d = {}; d.item = n[r].id, d.field = window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].id, d.error_human = mir_translate(n[r].parameters[window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].id].error_human), d.error_code = n[r].parameters[window["missions_missionview_" + e + "_elements"][n[r].id].info.parameters[o].id].error_code, window["missions_missionview_" + e + "_errors"].push(d) } o++ } r++ } 0 == a && 1 == i && (document.getElementById(e + "_missionview").setAttribute("data-show-settings", "false"), document.getElementById(t).setAttribute("data-settings-open", !1)) } } }), !0 } function missions_missionview_fetch_actions(e, t) { var i = [], s = document.getElementById(t); return $(s).find("li").each((function () { var t = {}; t.id = this.getAttribute("id"), t.action_guid = this.getAttribute("data-action-guid"), t.data = window["missions_missionview_" + e + "_elements"][this.getAttribute("id")], i.push(t) })), i } function missions_missionview_launch_missionsettings(e, t) { var i = document.createElement("div"); i.setAttribute("class", "missionsettings_overlay"), i.setAttribute("id", "missionsettings_overlay"), document.getElementsByTagName("body")[0].appendChild(i); var s = document.createElement("div"); s.setAttribute("class", "box"), i.appendChild(s); var n = document.createElement("h1"); n.innerHTML = lang_missions_missionview_settings_headline, s.appendChild(n); var a = document.createElement("p"); a.innerHTML = lang_missions_missionview_settings_text, s.appendChild(a); var r = document.createElement("form"); r.setAttribute("method", "post"), r.setAttribute("action", "/"), r.setAttribute("data-element-id", e), r.onsubmit = function () { var e = this.getAttribute("data-element-id"), t = document.getElementById("missionsettings_field_name").value, i = document.getElementById("missionsettings_field_description").value, s = document.getElementById("missionsettings_field_group").options[document.getElementById("missionsettings_field_group").selectedIndex].value; return window["missions_missionview_" + e + "_data"].name = t, window["missions_missionview_" + e + "_data"].description = i, window["missions_missionview_" + e + "_data"].group_id = s, document.getElementById("missionsettings_overlay").parentNode.removeChild(parent.document.getElementById("missionsettings_overlay")), $("#" + e + "_missionview > div.header > div.column > h1 > span").html(t), !1 }, s.appendChild(r); var o = document.createElement("label"); o.setAttribute("for", "missionsettings_field_name"), o.innerHTML = lang_missions_missionview_settings_field_name + ":", r.appendChild(o); var d = document.createElement("input"); d.setAttribute("type", "text"), d.setAttribute("name", "missionsettings_field_name"), d.setAttribute("id", "missionsettings_field_name"), void 0 !== t.name ? d.setAttribute("value", t.name) : d.setAttribute("value", window["missions_missionview_" + e + "_data"].name), r.appendChild(d); var m = document.createElement("input"); m.setAttribute("type", "hidden"), m.setAttribute("name", "missionsettings_field_description"), m.setAttribute("id", "missionsettings_field_description"), void 0 !== t.description ? m.setAttribute("value", t.description) : m.setAttribute("value", window["missions_missionview_" + e + "_data"].description), r.appendChild(m); var l = document.createElement("label"); l.setAttribute("for", "missionsettings_field_group"), l.innerHTML = lang_missions_missionview_settings_field_group + ":", r.appendChild(l); var u = document.createElement("select"); u.setAttribute("name", "missionsettings_field_group"), u.setAttribute("id", "missionsettings_field_group"), void 0 !== t.description ? u.setAttribute("data-preselected", t.group) : u.setAttribute("data-preselected", window["missions_missionview_" + e + "_data"].group_id), r.appendChild(u); var _ = document.createElement("option"); _.setAttribute("value", ""), _.innerHTML = "No group", u.appendChild(_); var p = document.createElement("input"); p.setAttribute("type", "button"), p.setAttribute("name", "missionsettings_groupbtn"), p.setAttribute("id", "missionsettings_groupbtn"), p.setAttribute("data-element-id", e), p.setAttribute("value", lang_main_missiongroupeditor_createeditgroups), r.appendChild(p), p.onclick = function () { var e = {}; e.name = document.getElementById("missionsettings_field_name").value, e.description = document.getElementById("missionsettings_field_description").value, e.group = document.getElementById("missionsettings_field_group").options[document.getElementById("missionsettings_field_group").selectedIndex].value, document.getElementById("missionsettings_overlay").parentNode.removeChild(parent.document.getElementById("missionsettings_overlay")), missions_launch_groupsettings(this.getAttribute("data-element-id"), e) }; var c = document.createElement("div"); c.setAttribute("class", "buttonholder"), r.appendChild(c); var v = document.createElement("input"); v.setAttribute("type", "submit"), v.setAttribute("name", "missionsettings_submitbtn"), v.setAttribute("id", "missionsettings_submitbtn"), v.setAttribute("value", mir_translate("OK")), c.appendChild(v); var h = document.createElement("input"); h.setAttribute("type", "button"), h.setAttribute("name", "missionsettings_cancelbtn"), h.setAttribute("id", "missionsettings_cancelbtn"), h.setAttribute("value", mir_translate("Cancel")), c.appendChild(h), h.onclick = function () { document.getElementById("missionsettings_overlay").parentNode.removeChild(parent.document.getElementById("missionsettings_overlay")) }; var g = { mode: "get-mission-groups" }; $.ajax({ url: "/", data: g, method: "GET", dataType: "json", success: function (e) { var t = document.getElementById("missionsettings_field_group"), i = t.getAttribute("data-preselected"); $(t).find("option").remove(); for (var s = 0; s < e.length;) { var n = document.createElement("option"); n.setAttribute("value", e[s].guid), e[s].guid == i && n.setAttribute("selected", "selected"), n.innerHTML = e[s].htmlname, t.appendChild(n), s++ } } }), d.focus() } function missions_launch_groupsettings(e, t) { var i = document.createElement("div"); i.setAttribute("class", "missiongroupsettings_overlay"), i.setAttribute("id", "missiongroupsettings_overlay"), document.getElementsByTagName("body")[0].appendChild(i); var s = document.createElement("div"); s.setAttribute("class", "box"), i.appendChild(s); var n = document.createElement("h1"); n.innerHTML = lang_main_missiongroupeditor_missiongroups, s.appendChild(n); var a = document.createElement("div"); a.setAttribute("id", "missiongroupsettings_createbtn"), a.setAttribute("class", "missiongroupsettings_createbtn"), a.innerHTML = mir_translate("Create group"), s.appendChild(a), a.onclick = function () { document.getElementById("missiongroupsettings_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupsettings_overlay")), missions_missionview_launch_groupeditor(e, t, null) }; var r = document.createElement("p"); r.innerHTML = lang_main_missiongroupeditor_text, s.appendChild(r); var o = document.createElement("div"); o.setAttribute("id", "missiongroupsettings_groupholder"), o.setAttribute("class", "missiongroupsettings_groupholder"), s.appendChild(o); var d = document.createElement("div"); d.setAttribute("id", "missiongroupsettings_groupholder_nodata"), d.setAttribute("class", "missiongroupsettings_groupholder_nodata"), d.innerHTML = "<p>" + lang_main_missiongroupeditor_loading + "</p>", o.appendChild(d); var m = document.createElement("div"); m.setAttribute("class", "buttonholder"), s.appendChild(m); var l = document.createElement("input"); l.setAttribute("type", "submit"), l.setAttribute("name", "missionsettings_submitbtn"), l.setAttribute("id", "missionsettings_submitbtn"), l.setAttribute("value", mir_translate("OK")), m.appendChild(l), l.onclick = function () { document.getElementById("missiongroupsettings_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupsettings_overlay")), null == t || missions_missionview_launch_missionsettings(e, t) }; var u = document.createElement("input"); u.setAttribute("type", "button"), u.setAttribute("name", "missionsettings_cancelbtn"), u.setAttribute("id", "missionsettings_cancelbtn"), u.setAttribute("value", mir_translate("Cancel")), m.appendChild(u), u.onclick = function () { document.getElementById("missiongroupsettings_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupsettings_overlay")), null == t || missions_missionview_launch_missionsettings(e, t) }; var _ = { mode: "get-mission-groups", calltype: "light" }; $.ajax({ url: "/", data: _, method: "GET", dataType: "json", success: function (i) { $("#missiongroupsettings_groupholder_nodata").hide(); var s = document.createElement("table"); s.setAttribute("cellpadding", 0), s.setAttribute("cellspacing", 0), document.getElementById("missiongroupsettings_groupholder").appendChild(s); for (var n = 0; n < i.length;) { var a = document.createElement("tr"); a.setAttribute("id", "missiongroupsettings_groupholder_grouprow_" + i[n].guid), s.appendChild(a), (r = document.createElement("td")).innerHTML = "<div>&raquo;</div>", a.appendChild(r); var r = document.createElement("td"); null == t && r.setAttribute("data-clickable", "true"), r.setAttribute("data-guid", i[n].guid), r.setAttribute("data-element-id", e), r.innerHTML = "<div>" + mir_translate(i[n].htmlname) + "</div>", a.appendChild(r), null == t && (r.onclick = function () { var t = document.getElementById("group_id"); $(t).children("optgroup[data-type='groups']").length > 0 ? $(t).val("group_" + this.getAttribute("data-guid")) : $(t).val(this.getAttribute("data-guid")), null == e || missions_summary_catalogue_load_missions(this.getAttribute("data-element-id")), document.getElementById("missiongroupsettings_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupsettings_overlay")) }); r = document.createElement("td"); a.appendChild(r); var o = document.createElement("div"); o.innerHTML = "<span>" + lang_main_missions_edit + "</span>", o.setAttribute("data-guid", i[n].guid), r.appendChild(o), i[n].allowed_methods.indexOf("PUT") > -1 ? (o.setAttribute("data-active", "true"), o.onclick = function () { document.getElementById("missiongroupsettings_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupsettings_overlay")), missions_missionview_launch_groupeditor(e, t, this.getAttribute("data-guid")) }) : o.setAttribute("data-active", "false"); var d = document.createElement("div"); d.innerHTML = "<span>" + lang_main_missions_delete + "</span>", d.setAttribute("data-guid", i[n].guid), d.setAttribute("data-children", i[n].num_children), i[n].allowed_methods.indexOf("DELETE") > -1 ? (d.setAttribute("data-active", "true"), d.onclick = function () { this.getAttribute("data-children") > 0 ? launch_confirm(lang_main_missionsgroupseditor_deletewithcontent_headline, lang_main_missionsgroupseditor_deletewithcontent_text, "missiongroupeditor_delete_missiongroup('" + this.getAttribute("data-guid") + "');", lang_main_missionsgroupseditor_deletewithcontent_delete, lang_main_missionsgroupseditor_deletewithcontent_cancel) : missiongroupeditor_delete_missiongroup(this.getAttribute("data-guid")) }) : d.setAttribute("data-active", "false"), r.appendChild(d), n++ } } }) } function missiongroupeditor_delete_missiongroup(e) { var t = {}; t.id = e, t.mode = "delete-mission-group", $.ajax({ url: "/", data: t, method: "GET", dataType: "json", guid: e, success: function (e) { var t = document.getElementById("group_id"); $(t).find("option[value='group_" + this.guid + "']").remove(), $(t).find("option[value='" + this.guid + "']").remove(), $(t).trigger("change"), $("#missiongroupsettings_groupholder_grouprow_" + this.guid).remove() } }) } function missions_missionview_launch_groupeditor(e, t, i) { var s = document.createElement("div"); s.setAttribute("class", "missiongroupeditor_overlay"), s.setAttribute("id", "missiongroupeditor_overlay"), document.getElementsByTagName("body")[0].appendChild(s); var n = document.createElement("div"); n.setAttribute("class", "box"), s.appendChild(n); var a = document.createElement("h1"); a.innerHTML = null == i ? lang_main_missiongroupeditor_createmissiongroup : lang_main_missiongroupeditor_editmissiongroup, n.appendChild(a); var r = document.createElement("p"); r.innerHTML = lang_main_missiongroupeditor_create_text, n.appendChild(r); var o = document.createElement("form"); o.setAttribute("method", "post"), o.setAttribute("action", "/"), o.setAttribute("data-element-id", e), null == i ? o.setAttribute("data-guid", "") : o.setAttribute("data-guid", i), o.onsubmit = function () { var i = {}; return i.id = this.getAttribute("data-guid"), i.name = document.getElementById("missiongroupeditor_field_name").value, $.ajax({ url: "/?mode=update-mission-group", data: i, method: "POST", dataType: "json", settings: t, element_id: e, success: function (s) { if (null == t) { var n = document.getElementById("group_id"); if (36 == i.id.length) $(n).find("option[value='group_" + i.id + "']").html(s.results.name), $(n).find("option[value='" + i.id + "']").html(s.results.name), document.getElementById("missiongroupeditor_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupeditor_overlay")), missions_launch_groupsettings(e, t); else { if ($(n).children("optgroup[data-type='groups']").length > 0) var a = $(n).children("optgroup[data-type='groups']"); else a = n; var r = document.createElement("option"); if ($(n).children("optgroup[data-type='groups']").length > 0) var o = "group_" + s.results.guid; else o = s.results.guid; r.setAttribute("value", o), r.innerHTML = s.results.name, $(a).append(r), $(n).val(o), $(n).trigger("change"), document.getElementById("missiongroupeditor_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupeditor_overlay")) } } else document.getElementById("missiongroupeditor_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupeditor_overlay")), missions_launch_groupsettings(e, t) } }), !1 }, n.appendChild(o); var d = document.createElement("label"); d.setAttribute("for", "missiongroupeditor_field_name"), d.innerHTML = mir_translate("Name:"), o.appendChild(d); var m = document.createElement("input"); m.setAttribute("type", "text"), m.setAttribute("name", "missiongroupeditor_field_name"), m.setAttribute("id", "missiongroupeditor_field_name"), m.setAttribute("value", ""), o.appendChild(m); var l = document.createElement("div"); l.setAttribute("class", "buttonholder"), o.appendChild(l); var u = document.createElement("input"); u.setAttribute("type", "submit"), u.setAttribute("name", "submit"), u.setAttribute("id", "missiongroupeditor_submitbtn"), u.setAttribute("value", mir_translate("OK")), l.appendChild(u); var _ = document.createElement("input"); if (_.setAttribute("type", "button"), _.setAttribute("name", "missionsettings_cancelbtn"), _.setAttribute("id", "missionsettings_cancelbtn"), _.setAttribute("value", mir_translate("Cancel")), l.appendChild(_), _.onclick = function () { document.getElementById("missiongroupeditor_overlay").parentNode.removeChild(parent.document.getElementById("missiongroupeditor_overlay")), missions_launch_groupsettings(e, t) }, null == i); else { var p = { mode: "get-mission-group" }; p.id = i, $.ajax({ url: "/", data: p, method: "GET", dataType: "json", success: function (e) { document.getElementById("missiongroupeditor_field_name").value = e.results.name } }) } m.focus() } function missions_missionview_launch_dynvars(e, t, i, s, n, a) { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "true"); var r = document.createElement("div"); r.setAttribute("class", "missiondynvar_overlay"), r.setAttribute("id", "missiondynvar_overlay"), document.getElementsByTagName("body")[0].appendChild(r); var o = document.createElement("div"); o.setAttribute("class", "box"), r.appendChild(o); var d = document.createElement("h1"); d.innerHTML = lang_missions_missionview_variables, o.appendChild(d); var m = document.createElement("div"); m.setAttribute("id", "missiondynvar_createbtn"), m.setAttribute("class", "missiondynvar_createbtn"), m.setAttribute("data-element-id", e), m.setAttribute("data-item-id", t), m.setAttribute("data-parameter-id", i), m.setAttribute("data-parameter-saveid", s), m.setAttribute("data-parameter-type", n), m.innerHTML = lang_missions_missionview_variables_create, o.appendChild(m), m.onclick = function () { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"), document.getElementById("missiondynvar_overlay").parentNode.removeChild(parent.document.getElementById("missiondynvar_overlay")), missions_missionview_launch_dynvars_editor(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-parameter-saveid"), this.getAttribute("data-parameter-type"), null) }; var l = document.createElement("p"); l.innerHTML = lang_missions_missionview_variables_text, o.appendChild(l); var u = document.createElement("div"); u.setAttribute("id", "missiondynvar_varholder"), u.setAttribute("class", "missiondynvar_varholder"), o.appendChild(u); var _ = document.createElement("table"); _.setAttribute("cellpadding", 0), _.setAttribute("cellspacing", 0), u.appendChild(_); var p = document.createElement("tr"); _.appendChild(p), (v = document.createElement("input")).setAttribute("type", "radio"), v.setAttribute("name", "missiondynvar_option"), v.setAttribute("id", "missiondynvar_option_none"), v.setAttribute("value", "missiondynvar_option_none"), -1 != a && null != a || v.setAttribute("checked", "checked"), (h = document.createElement("td")).appendChild(v), p.appendChild(h), (h = document.createElement("td")).innerHTML = '<label for="missiondynvar_option_none">' + lang_missions_missionview_variables_no_use + "</label>", p.appendChild(h), (h = document.createElement("td")).innerHTML = "&nbsp;", p.appendChild(h); var c = 0; for (; c < window["missions_missionview_" + e + "_dynvars"].length;) { if (window["missions_missionview_" + e + "_dynvars"][c] && window["missions_missionview_" + e + "_dynvars"][c].type == n) { p = document.createElement("tr"); _.appendChild(p); var v, h = document.createElement("td"); p.appendChild(h), (v = document.createElement("input")).setAttribute("type", "radio"), v.setAttribute("name", "missiondynvar_option"), v.setAttribute("id", "missiondynvar_option_" + c), v.setAttribute("value", "missiondynvar_option_" + c), a == c && v.setAttribute("checked", "checked"), h.appendChild(v), (h = document.createElement("td")).innerHTML = '<label for="missiondynvar_option_' + c + '">' + window["missions_missionview_" + e + "_dynvars"][c].name + "</label>", p.appendChild(h), p.setAttribute("data-id", c); h = document.createElement("td"); p.appendChild(h); var g = document.createElement("div"); g.innerHTML = "<span>Edit</span>", g.setAttribute("data-id", c), g.setAttribute("data-element-id", e), g.setAttribute("data-item-id", t), g.setAttribute("data-parameter-id", i), g.setAttribute("data-parameter-saveid", s), g.setAttribute("data-parameter-type", n), h.appendChild(g), g.onclick = function () { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"), document.getElementById("missiondynvar_overlay").parentNode.removeChild(parent.document.getElementById("missiondynvar_overlay")), -1 == a || null == a ? missions_missionview_launch_dynvars_editor(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-parameter-saveid"), this.getAttribute("data-parameter-type"), this.getAttribute("data-id")) : missions_missionview_launch_dynvars_editor(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-parameter-saveid"), this.getAttribute("data-parameter-type"), this.getAttribute("data-id"), a) }; var b = document.createElement("div"); b.innerHTML = "<span>Remove</span>", b.setAttribute("data-id", c), b.setAttribute("data-element-id", e), b.setAttribute("data-item-id", t), b.setAttribute("data-parameter-id", i), b.setAttribute("data-parameter-saveid", s), b.setAttribute("data-parameter-type", n), h.appendChild(b), b.addEventListener("click", (function (t) { var i = "", s = parseInt(this.getAttribute("data-id")), n = this.getAttribute("data-item-id"), a = Object.values(window["missions_missionview_" + e + "_elements"]), r = window["missions_missionview_" + e + "_elements"][n], o = [], d = window["missions_missionview_" + e + "_dynvars"][s]; if (a.length && "number" == typeof s) for (var m = 0; m < a.length; m++) { var l = a[m], u = Object.values(l.dynvals).indexOf(s); d && u > -1 && (i = d.name, o.push(l)) } var p = o.indexOf(r), c = p > -1 && o[p] === r; if (o.length > 1 || 1 === o.length && -1 === o.indexOf(s) && !c) MIR.ui.prompt({ parent: "#missiondynvar_overlay", headline: mir_translate("dynvar_cannot_remove_dynvar_in_use_title"), message: mir_translate("dynvar_cannot_remove_dynvar_in_use_body", { variable: i }) }).addClass("with-error"); else { var v = t.target, h = v.getAttribute("data-id"), g = $('#missiondynvar_varholder tr[data-id="' + s + '"')[0], b = $('label[for="missiondynvar_option_' + h + '"]')[0].innerText, w = !!$("input#missiondynvar_option_" + h)[0].checked, f = { title: mir_translate("fleet_popup_dynvar_remove_title"), body: mir_translate("fleet_popup_dynvar_remove_body", { field: b }) }; MIR.ui.confirm(f).then((function () { var t = v.getAttribute("data-element-id"), i = v.getAttribute("data-item-id"), n = $("#" + t + "_missionview").attr("data-mission-guid"), a = $("#" + i).attr("data-action-guid"); $.ajax({ url: "/setup/missions/?mode=delete-dynamic-variable&calltype=light&mission=" + n, method: "POST", data: { mission: n, action: a, field: b }, dataType: "json" }).always((function (t) { window["missions_missionview_" + e + "_dynvars"][s] && (window["missions_missionview_" + e + "_dynvars"][s] = void 0), _.removeChild(g), w && ($("#missiondynvar_option_none")[0].checked = !0), $("#missiondynvar_varholder tr").each((function (e, t) { if (0 !== e) { var i = $(t).find('[data-id="' + e + '"]'); i && i.attr("data-id", e - 1); var s = $(t).find('input[name="missiondynvar_option"]'); s && s.attr("id") === "missiondynvar_option_" + e && (s.attr("id", "missiondynvar_option_" + (e - 1)), s.attr("value", "missiondynvar_option_" + (e - 1))); var n = $(t).find("label"); n && n.attr("for") === "missiondynvar_option_" + e && n.attr("for", "missiondynvar_option_" + (e - 1)) } })) })) })) } })) } c++ } var w = document.createElement("div"); w.setAttribute("class", "buttonholder"), o.appendChild(w); var f = document.createElement("input"); f.setAttribute("type", "submit"), f.setAttribute("name", "missiondynvar_submitbtn"), f.setAttribute("id", "missiondynvar_submitbtn"), f.setAttribute("data-element-id", e), f.setAttribute("data-item-id", t), f.setAttribute("data-parameter-id", i), f.setAttribute("data-parameter-saveid", s), f.setAttribute("value", mir_translate("OK")), w.appendChild(f), f.onclick = function () { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"); for (var t = -1, i = 0; i < window["missions_missionview_" + e + "_dynvars"].length;) { if (window["missions_missionview_" + e + "_dynvars"][i] && window["missions_missionview_" + e + "_dynvars"][i].type == n) { var s = $('#missiondynvar_varholder tr[data-id="' + i + '"] input'); s && s[0] && 1 == s[0].checked && (t = i) } i++ } var a = document.getElementById(this.getAttribute("data-item-id") + "_dynvarbadgetext_" + this.getAttribute("data-parameter-id")), r = document.getElementById(this.getAttribute("data-item-id") + "_fieldwrapper_" + this.getAttribute("data-parameter-saveid")); if (t > -1 ? (r.setAttribute("data-dynval", "true"), a.innerHTML = window["missions_missionview_" + this.getAttribute("data-element-id") + "_dynvars"][t].name) : (r.setAttribute("data-dynval", "false"), a.innerHTML = "Unknown"), window["missions_missionview_" + this.getAttribute("data-element-id") + "_elements"][this.getAttribute("data-item-id")].dynvals[this.getAttribute("data-parameter-id")] = t, missions_missionview_set_action_names(this.getAttribute("data-element-id"), this.getAttribute("data-item-id")), t > -1) { var o = this.getAttribute("data-item-id") + "_fieldwrapper_" + this.getAttribute("data-parameter-saveid"); $("#" + o).attr("data-error", "false"), $("#" + o).find("div.errorholder > p").html("") } document.getElementById("missiondynvar_overlay").parentNode.removeChild(parent.document.getElementById("missiondynvar_overlay")) }; var A = document.createElement("input"); A.setAttribute("type", "button"), A.setAttribute("name", "missiondynvar_cancelbtn"), A.setAttribute("id", "missiondynvar_cancelbtn"), A.setAttribute("value", mir_translate("Cancel")), w.appendChild(A), A.onclick = function () { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"), document.getElementById("missiondynvar_overlay").parentNode.removeChild(parent.document.getElementById("missiondynvar_overlay")) } } function missions_missionview_launch_dynvars_editor(e, t, i, s, n, a, r) { if ("Duration" == n) var o = "durationpicker", d = document.getElementById(e + "_missionview_settingspanel_field_" + s); else o = (d = document.getElementById(e + "_missionview_settingspanel_field_" + s)).tagName.toLowerCase(); var m = document.getElementById(t + "_fieldwrapper_" + s); document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "true"); var l = document.createElement("div"); l.setAttribute("class", "missiondynvareditor_overlay"), l.setAttribute("id", "missiondynvareditor_overlay"), document.getElementsByTagName("body")[0].appendChild(l); var u = document.createElement("div"); u.setAttribute("class", "box"), l.appendChild(u); var _ = document.createElement("h1"); _.innerHTML = null == a ? lang_missions_missionview_variables_create : lang_missions_missionview_variables_edit, u.appendChild(_); var p = document.createElement("p"); p.innerHTML = null == a ? lang_missions_missionview_variables_create_text : lang_missions_missionview_variables_edit_text, u.appendChild(p); var c = document.createElement("form"); c.setAttribute("method", "post"), c.setAttribute("action", "/"), c.setAttribute("data-element-id", e), c.setAttribute("data-item-id", t), c.setAttribute("data-parameter-id", i), c.setAttribute("data-parameter-saveid", s), c.setAttribute("data-parameter-type", n), null == a ? c.setAttribute("data-guid", "") : c.setAttribute("data-guid", a), c.onsubmit = function () { document.getElementById("missiondynvareditor_submitbtn").setAttribute("class", "spinning"), document.getElementById("missiondynvareditor_submitbtn").disabled = !0, document.getElementById("missiondynvareditor_fielderror").innerHTML = ""; var t = {}; if (t.name = document.getElementById("missiondynvareditor_field_name").value, "select" == o) t.def = document.getElementById("missiondynvareditor_field_def").options[document.getElementById("missiondynvareditor_field_def").selectedIndex].value; else if ("slider" == o) t.def = missions_missionview_transform_duration_totime(document.getElementById("missiondynvareditor_field_def").getAttribute("data-cur")); else if ("durationpicker" == o) { var i = document.getElementById("missiondynvareditor_field_def_hours"), s = document.getElementById("missiondynvareditor_field_def_minutes"), n = document.getElementById("missiondynvareditor_field_def_seconds"), a = i.value; 1 == a.length && (a = "0" + a); var d = s.value; 1 == d.length && (d = "0" + d); var m = n.value; 1 == m.length && (m = "0" + m), t.def = a + ":" + d + ":" + m + ".000000" } else t.def = document.getElementById("missiondynvareditor_field_def").value; t.type = this.getAttribute("data-parameter-type"), document.getElementById("missiondynvareditor_field_nullable") && 1 == document.getElementById("missiondynvareditor_field_nullable").checked && (t.def = MIR.ui.constants.NULL_VALUE); var l = document.getElementById(e + "_missionview").getAttribute("data-mission-guid"), u = missions_missionview_fetch_actions(e, "missionview_" + e + "_list_main"), _ = JSON.parse(JSON.stringify(window["missions_missionview_" + e + "_dynvars"])); if (this.getAttribute("data-guid").length > 0) { _[p = this.getAttribute("data-guid")] = t } else { for (var p = -1, c = 0; c < _.length;)_[c] && _[c].name == t.name && _[c].type == t.type && (p = c), c++; -1 == p && (_.push(t), p = _.length - 1) } for (var v = JSON.parse(JSON.stringify(u)), h = 0; h < v.length;) { if (v[h] && v[h].id == this.getAttribute("data-item-id")) for (var g in v[h].data.dynvals) g == this.getAttribute("data-parameter-id") && (v[h].data.dynvals[g] = p); h++ } var b = {}; return b.data = clean_mission_action_data(v), b.missiondata = window["missions_missionview_" + e + "_data"], b.dynvars = _, b.id = l, b.dryrun = "true", b.validate = "dynval", b.cur_dynval = t, $.ajax({ url: "/?mode=save-mission", data: b, method: "POST", dataType: "json", guid: this.getAttribute("data-guid"), element_id: this.getAttribute("data-element-id"), item_id: this.getAttribute("data-item-id"), parameter_id: this.getAttribute("data-parameter-id"), parameter_saveid: this.getAttribute("data-parameter-saveid"), parameter_type: this.getAttribute("data-parameter-type"), cur: t, sel: r, success: function (e) { document.getElementById("missiondynvareditor_submitbtn").removeAttribute("class"), document.getElementById("missiondynvareditor_submitbtn").disabled = !1; var i = !1, s = ""; if (e.length > 0) for (var n = 0; n < e.length;) { if (e[n].id == this.item_id) for (var a in e[n].parameters) a == this.parameter_id && (i = !0, s = mir_translate(e[n].parameters[a].error_human)); n++ } if (1 == i) document.getElementById("missiondynvareditor_fielderror").innerHTML = s; else { if (-1 == this.sel || null == this.sel) if (this.guid.length > 0) { var r = this.guid; window["missions_missionview_" + this.element_id + "_dynvars"][r] = this.cur } else { r = -1; for (var o = 0; o < window["missions_missionview_" + this.element_id + "_dynvars"].length;)window["missions_missionview_" + this.element_id + "_dynvars"][o] && window["missions_missionview_" + this.element_id + "_dynvars"][o].name == this.cur.name && window["missions_missionview_" + this.element_id + "_dynvars"][o].type == this.cur.type && (r = o), o++; -1 == r && (window["missions_missionview_" + this.element_id + "_dynvars"].push(this.cur), r = window["missions_missionview_" + this.element_id + "_dynvars"].length - 1) } else if (this.guid.length > 0) { window["missions_missionview_" + this.element_id + "_dynvars"][this.guid].name = t.name, window["missions_missionview_" + this.element_id + "_dynvars"][this.guid].def = t.def; r = this.guid } document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"), document.getElementById("missiondynvareditor_overlay").parentNode.removeChild(parent.document.getElementById("missiondynvareditor_overlay")), missions_missionview_launch_dynvars(this.element_id, this.item_id, this.parameter_id, this.parameter_saveid, this.parameter_type, r) } } }), !1 }, u.appendChild(c); var v = document.createElement("label"); v.setAttribute("for", "missiondynvareditor_field_name"), v.innerHTML = lang_missions_missionview_variables_name, c.appendChild(v); var h = document.createElement("input"); h.setAttribute("type", "text"), h.setAttribute("name", "missiondynvareditor_field_name"), h.setAttribute("id", "missiondynvareditor_field_name"), null == a ? h.setAttribute("value", "") : h.setAttribute("value", window["missions_missionview_" + e + "_dynvars"][a].name), c.appendChild(h); var g = document.createElement("label"); if (g.setAttribute("for", "missiondynvareditor_field_def"), g.innerHTML = lang_missions_missionview_variables_defaultvalue, c.appendChild(g), "select" == o) (P = document.createElement("select")).setAttribute("name", "missiondynvareditor_field_def"), P.setAttribute("id", "missiondynvareditor_field_def"), c.appendChild(P), $(d).children("option,optgroup").each((function () { if ("OPTGROUP" == this.tagName) { var t = document.createElement("optgroup"); t.setAttribute("label", this.getAttribute("label")), P.appendChild(t), $(this).children("option").each((function () { var i = document.createElement("option"); i.setAttribute("value", this.getAttribute("value")), i.innerHTML = this.innerHTML, null == a && 1 == this.selected ? i.setAttribute("selected", "selected") : null == a || window["missions_missionview_" + e + "_dynvars"][a].def == this.getAttribute("value") && i.setAttribute("selected", "selected"), t.appendChild(i) })) } else { var i = document.createElement("option"); i.setAttribute("value", this.getAttribute("value")), i.innerHTML = this.innerHTML, null == a && 1 == this.selected ? i.setAttribute("selected", "selected") : null == a || window["missions_missionview_" + e + "_dynvars"][a].def == this.getAttribute("value") && i.setAttribute("selected", "selected"), P.appendChild(i) } })); else if ("durationpicker" == o) { if (null == a) var b = parseInt(d.getAttribute("data-cur")); else if (null === a || null != window["missions_missionview_" + e + "_dynvars"][a].def && window["missions_missionview_" + e + "_dynvars"][a].def != MIR.ui.constants.NULL_VALUE) b = missions_missionview_transform_duration_toseconds(window["missions_missionview_" + e + "_dynvars"][a].def); else var b = 0; var w = Math.floor(b / 60), f = Math.floor(w / 60), A = b - 60 * w; w = w - 60 * f; 1 == String(A).length && (A = "0" + String(A)), 1 == String(w).length && (w = "0" + w), 1 == String(f).length && (f = "0" + f); var y = [f, w, A], E = ["hours", "minutes", "seconds"], C = [lang_missions_missionview_durationpicker_hours, lang_missions_missionview_durationpicker_minutes, lang_missions_missionview_durationpicker_seconds], I = document.createElement("div"); I.setAttribute("class", "durationpickerholder"), I.setAttribute("data-cur", b), I.setAttribute("id", "missiondynvareditor_field_def"), c.appendChild(I); var T = document.createElement("table"); T.setAttribute("cellpadding", "0"), T.setAttribute("cellspacing", "0"), I.appendChild(T); var B = document.createElement("tr"); T.appendChild(B); for (var L = 0; L < E.length;) { (x = document.createElement("td")).setAttribute("class", "arrow_up"), B.appendChild(x), (H = document.createElement("div")).setAttribute("data-timetype", E[L]), H.innerHTML = "<span>+</span>", H.onclick = function () { var e = document.getElementById("missiondynvareditor_field_def_" + this.getAttribute("data-timetype")), t = "00"; if (parseInt(e.value)) var i = parseInt(e.value); else i = 0; i >= 24 && "hours" == this.getAttribute("data-timetype") || i >= 59 && "minutes" == this.getAttribute("data-timetype") || i >= 59 && "seconds" == this.getAttribute("data-timetype") ? t = "00" : 1 == (t = String(i + 1)).length && (t = "0" + t), e.value = t }, x.appendChild(H), L++ } B = document.createElement("tr"); T.appendChild(B); for (L = 0; L < E.length;) { (x = document.createElement("td")).setAttribute("class", "field"), B.appendChild(x); var k = document.createElement("input"); k.setAttribute("type", "text"), k.setAttribute("maxlength", "2"), k.setAttribute("value", y[L]), k.setAttribute("data-timetype", E[L]), k.setAttribute("data-old-value", ""), k.setAttribute("name", "missiondynvareditor_field_def_" + E[L]), k.setAttribute("id", "missiondynvareditor_field_def_" + E[L]), k.onkeyup = function (e) { var t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]; if (2 == this.value.length && t.indexOf(e.key) > -1 && e.target == this && this.value !== this.getAttribute("data-old-value")) { var i = "missiondynvareditor_field_def_" + this.getAttribute("data-timetype"); "hours" == this.getAttribute("data-timetype") ? i += "minutes" : "minutes" == this.getAttribute("data-timetype") ? i += "seconds" : i += "hours", $("#" + i).select(), $("#" + i).focus() } else t.indexOf(e.key) > -1 && this.setAttribute("data-old-value", "") }, k.onblur = function (e) { if (e.target == this) { for (var t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"], i = !1, s = 0; s < this.value.length;)-1 == t.indexOf(this.value[s]) && (i = !0), s++; 0 == this.value.length || 1 == i ? this.value = "00" : "hours" == this.getAttribute("data-timetype") && parseInt(this.value) > 24 ? this.value = "24" : "hours" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : "minutes" == this.getAttribute("data-timetype") && parseInt(this.value) > 59 ? this.value = "59" : "minutes" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : "seconds" == this.getAttribute("data-timetype") && parseInt(this.value) > 59 ? this.value = "59" : "seconds" == this.getAttribute("data-timetype") && parseInt(this.value) < 0 ? this.value = "00" : 1 == this.value.length && (this.value = "0" + this.value), this.setAttribute("data-old-value", this.value) } }, x.appendChild(k), L++ } B = document.createElement("tr"); T.appendChild(B); for (L = 0; L < E.length;) { (x = document.createElement("td")).setAttribute("class", "text"), B.appendChild(x); var M = document.createElement("div"); M.innerHTML = "<span>" + C[L] + "</span>", x.appendChild(M), L++ } B = document.createElement("tr"); T.appendChild(B); for (L = 0; L < E.length;) { var x, H; (x = document.createElement("td")).setAttribute("class", "arrow_down"), B.appendChild(x), (H = document.createElement("div")).setAttribute("data-timetype", E[L]), H.innerHTML = "<span>-</span>", H.onclick = function () { var e = document.getElementById("missiondynvareditor_field_def_" + this.getAttribute("data-timetype")), t = "00"; if (parseInt(e.value)) var i = parseInt(e.value); else i = 0; i <= 0 && "hours" == this.getAttribute("data-timetype") ? t = "24" : i <= 0 && "minutes" == this.getAttribute("data-timetype") || i <= 0 && "seconds" == this.getAttribute("data-timetype") ? t = "59" : 1 == (t = String(i - 1)).length && (t = "0" + t), e.value = t }, x.appendChild(H), L++ } } else if ("slider" == o) { var q = parseInt(d.getAttribute("data-min")), N = parseInt(d.getAttribute("data-max")), S = (b = parseInt(d.getAttribute("data-cur")), d.getAttribute("data-nullfieldname"), d.getAttribute("data-use-pseudo")), O = d.getAttribute("data-slidervals"); "undefined" == O || (O = JSON.parse(O)), null == a || window["missions_missionview_" + e + "_dynvars"][a].def && (b = missions_missionview_transform_duration_toseconds(window["missions_missionview_" + e + "_dynvars"][a].def)); var j = document.createElement("div"); j.setAttribute("class", "sliderholder"), j.setAttribute("data-cur", b), j.setAttribute("id", "missiondynvareditor_field_def"), c.appendChild(j); var U = document.createElement("div"); U.setAttribute("class", "slider"), U.setAttribute("data-use-pseudo", S), j.appendChild(U); var R = document.createElement("div"); R.setAttribute("class", "sliderinfo"), c.appendChild(R), 1 == isNaN(b) && (b = q), $(U).slider({ min: q, max: N, value: b, create: function (e, t) { var i = b, s = i; "true" == e.target.getAttribute("data-use-pseudo") && (i = O.indexOf(i), $(U).slider("option", "value", i), s = O[i]), R.innerHTML = missions_missionview_transform_duration_tostring(s) }, slide: function (e, t) { var i = t.value; "true" == e.target.getAttribute("data-use-pseudo") && (i = O[t.value]), R.innerHTML = missions_missionview_transform_duration_tostring(i) }, stop: function (e, t) { var i = t.value; "true" == e.target.getAttribute("data-use-pseudo") && (i = O[t.value]), R.innerHTML = missions_missionview_transform_duration_tostring(i), j.setAttribute("data-cur", i) } }) } else { var P; (P = document.createElement("input")).setAttribute("type", "text"), P.setAttribute("name", "missiondynvareditor_field_def"), P.setAttribute("id", "missiondynvareditor_field_def"), null == a ? P.setAttribute("value", "") : window["missions_missionview_" + e + "_dynvars"][a].def !== MIR.ui.constants.NULL_VALUE && P.setAttribute("value", window["missions_missionview_" + e + "_dynvars"][a].def), c.appendChild(P) } var D = document.createElement("p"); if (D.setAttribute("class", "fielderror"), D.setAttribute("id", "missiondynvareditor_fielderror"), D.innerHTML = "", c.appendChild(D), "true" == m.getAttribute("data-nullable")) { var V = document.createElement("div"); V.setAttribute("class", "nullerholder"), c.appendChild(V); var J = document.createElement("input"); J.setAttribute("type", "checkbox"), J.setAttribute("name", "missiondynvareditor_field_nullable"), J.setAttribute("id", "missiondynvareditor_field_nullable"), J.setAttribute("value", "1"), null === a || null != window["missions_missionview_" + e + "_dynvars"][a].def && window["missions_missionview_" + e + "_dynvars"][a].def != MIR.ui.constants.NULL_VALUE || (J.setAttribute("checked", "true"), document.getElementById("missiondynvareditor_field_def").setAttribute("data-disabled", "true"), document.getElementById("missiondynvareditor_field_def").setAttribute("disabled", "disabled")), V.appendChild(J); var G = document.createElement("label"); G.setAttribute("for", "missiondynvareditor_field_nullable"), G.innerHTML = m.getAttribute("data-null-option"), V.appendChild(G), J.onclick = function () { 1 == this.checked ? (document.getElementById("missiondynvareditor_field_def").setAttribute("data-disabled", "true"), document.getElementById("missiondynvareditor_field_def").setAttribute("disabled", "disabled")) : (document.getElementById("missiondynvareditor_field_def").setAttribute("data-disabled", "false"), document.getElementById("missiondynvareditor_field_def").removeAttribute("disabled")) } } var F = document.createElement("div"); F.setAttribute("class", "buttonholder"), c.appendChild(F); var K = document.createElement("input"); K.setAttribute("type", "submit"), K.setAttribute("name", "submit"), K.setAttribute("id", "missiondynvareditor_submitbtn"), K.setAttribute("value", mir_translate("OK")), F.appendChild(K); var z = document.createElement("input"); z.setAttribute("type", "button"), z.setAttribute("name", "missiondynvareditor_cancelbtn"), z.setAttribute("id", "missiondynvareditor_cancelbtn"), z.setAttribute("data-element-id", e), z.setAttribute("data-item-id", t), z.setAttribute("data-parameter-id", i), z.setAttribute("data-parameter-saveid", s), z.setAttribute("data-parameter-type", n), z.setAttribute("value", mir_translate("Cancel")), F.appendChild(z), z.onclick = function () { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false"), document.getElementById("missiondynvareditor_overlay").parentNode.removeChild(parent.document.getElementById("missiondynvareditor_overlay")), missions_missionview_launch_dynvars(this.getAttribute("data-element-id"), this.getAttribute("data-item-id"), this.getAttribute("data-parameter-id"), this.getAttribute("data-parameter-saveid"), this.getAttribute("data-parameter-type"), null == r ? -1 : r) }, h.focus() } function missions_missionview_get_active_action(e) { if (0 == missions_missionview_active_action_running) { missions_missionview_active_action_running = !0; missions_missionview_fetch_actions(e, "missionview_" + e + "_list_main"); var t = document.getElementById(e + "_missionview").getAttribute("data-mission-guid"); if (robot_current_mission_guid && robot_current_mission_guid == t && robot_current_mission > 0) { var i = { mode: "get-active-mission", calltype: "light" }; i.queue_id = robot_current_mission, $.ajax({ url: "/", data: i, method: "GET", dataType: "json", element_id: e, success: function (t) { robot_current_mission_guid = t.mission_guid, robot_current_mission_action_guid = t.action_guid, $("#missionview_" + e + "_list_main").find("li.action").attr("data-running", "false"), robot_current_mission_action_guid && 36 == robot_current_mission_action_guid.length && $("#missionview_" + e + "_list_main").find("li[data-action-guid='" + robot_current_mission_action_guid + "'].action").attr("data-running", "true"), setTimeout((function () { missions_missionview_get_active_action(e) }), 1e3), missions_missionview_active_action_running = !1 } }) } else $("#missionview_" + e + "_list_main").find("li.action").attr("data-running", "false"), setTimeout((function () { missions_missionview_get_active_action(e) }), 3e3), missions_missionview_active_action_running = !1 } } function missionqueue_edit_item(e, t, i) { launch_waiter(mir_translate("Loading mission...")); var s = {}; return s.id = i, s.queue_id = t, s.edit = !0, $.ajax({ url: "/?mode=queue-mission", data: s, method: "POST", dataType: "json", element_id: e, success: function (s) { if (close_waiter(), "questions" == s.type) { var n = document.createElement("div"); n.setAttribute("class", "missionqueuequestions_overlay"), n.setAttribute("id", "missionqueuequestions_overlay"), document.getElementsByTagName("body")[0].appendChild(n); var a = document.createElement("div"); a.setAttribute("class", "box"), n.appendChild(a); var r = document.createElement("h1"); r.innerHTML = mir_translate("Edit mission queue instance"), a.appendChild(r); var o = document.createElement("p"); o.innerHTML = mir_translate("Text about mission variables..."), a.appendChild(o); var d = document.createElement("form"); d.setAttribute("action", ""), d.setAttribute("method", ""), a.appendChild(d), d.onsubmit = function () { launch_waiter(mir_translate("Saving changes...")), $("div.box > form > div.fieldholder").attr("data-error", "false"), $("div.box > form > div.fieldholder").attr("data-error", "false"), $("div.box > form > p.error").html(""); for (var n = {}, r = 0; r < s.questions.length;)n[s.questions[r].systemname] = mission_summary_queue_field_fetch_value(s.questions[r].systemname, s.questions[r].type, s.questions[r].constraints.nullable), r++; var o = {}; return o.id = i, o.queue_id = t, o.vals = n, o.update = !0, $.ajax({ url: "/?mode=queue-mission", data: o, method: "POST", dataType: "json", element_id: e, success: function (e) { if (close_waiter(), 200 == e.headers.httpcode) document.getElementById("missionqueuequestions_overlay").parentNode.removeChild(parent.document.getElementById("missionqueuequestions_overlay")); else if (e.results.error_human.length > 0 && (m.innerHTML = mir_translate(e.results.error_human), $(a).animate({ scrollTop: 0 }, 100)), void 0 === e.results.field_errors); else { for (var t in e.results.field_errors.parameters) document.getElementById("missionqueue_fieldholder_" + e.results.field_errors.parameters[t].systemname).setAttribute("data-error", "true"), document.getElementById("missionqueue_error_" + e.results.field_errors.parameters[t].systemname).innerHTML = mir_translate(e.results.field_errors.parameters[t].error_human); e.results.field_errors.earliest_start_time && (document.getElementById("missionqueue_fieldholder_earliest_start_time").setAttribute("data-error", "true"), document.getElementById("missionqueue_error_earliest_start_time").innerHTML = mir_translate(e.results.field_errors.earliest_start_time.error_human)), e.results.field_errors.robot_id && (document.getElementById("missionqueue_fieldholder_robot_id").setAttribute("data-error", "true"), document.getElementById("missionqueue_error_robot_id").innerHTML = mir_translate(e.results.field_errors.robot_id.error_human)) } } }), !1 }; var m = document.createElement("p"); m.setAttribute("id", "missionqueue_error"), m.setAttribute("class", "error"), m.innerHTML = "", d.appendChild(m), mission_summary_queue_fieldgenerator(s.questions, d); var l = document.createElement("div"); l.setAttribute("class", "buttonholder"), d.appendChild(l); var u = document.createElement("input"); u.setAttribute("type", "submit"), u.setAttribute("name", "submit"), u.setAttribute("id", "missiondynvareditor_submitbtn"), u.setAttribute("value", mir_translate("OK")), l.appendChild(u); var _ = document.createElement("input"); _.setAttribute("type", "button"), _.setAttribute("name", "missionqueuequestions_cancelbtn"), _.setAttribute("id", "missionqueuequestions_cancelbtn"), _.setAttribute("value", mir_translate("Cancel")), l.appendChild(_), _.onclick = function () { document.getElementById("missionqueuequestions_overlay").parentNode.removeChild(parent.document.getElementById("missionqueuequestions_overlay")) } } else launch_error(mir_translate("The requested item from the mission queue was not found.")) } }), !0 } function missionqueue_show_element(e) { launch_waiter(mir_translate("Loading mission data...")); var t = {}; return t.id = e, $.ajax({ url: "/?mode=get-mission-queue-item-data", data: t, method: "POST", dataType: "json", error: function (e) { alert(e.responseText) }, success: function (e) { if (close_waiter(), 1 == e.success) { document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "true"); var t = document.createElement("div"); t.setAttribute("class", "overlayform"), t.setAttribute("data-type", "missionqueueitem"), t.setAttribute("id", "missiondetailsoverlay"), document.getElementsByTagName("body")[0].appendChild(t); var i = document.createElement("div"); i.setAttribute("class", "box"), i.setAttribute("data-type", "missiondetails"), t.appendChild(i); var s = document.createElement("h1"); s.innerHTML = mir_translate("Mission instance details"), i.appendChild(s); var n = document.createElement("p"); n.innerHTML = mir_translate("Text about mission instance details..."), i.appendChild(n); for (var a = 0; a < e.details.length;) { var r = document.createElement("ul"); r.setAttribute("class", "mission_datalist"), i.appendChild(r); for (var o = 0; o < e.details[a].items.length;) { var d = document.createElement("div"); d.setAttribute("class", "name"), d.innerHTML = e.details[a].items[o].name + ":"; var m = document.createElement("div"); m.setAttribute("class", "value"), m.innerHTML = e.details[a].items[o].value; var l = document.createElement("li"); l.appendChild(d), l.appendChild(m), r.appendChild(l), o++ } a++ } if (e.log.length > 0) { var u = document.createElement("ul"); u.setAttribute("class", "mission_loglist"), i.appendChild(u), (_ = document.createElement("div")).setAttribute("class", "state"), _.innerHTML = "<span>&nbsp;</span>", (p = document.createElement("div")).setAttribute("class", "description"), p.innerHTML = "<span>" + mir_translate("Description") + "</span>", (c = document.createElement("div")).setAttribute("class", "started"), c.innerHTML = "<span>" + mir_translate("Started") + "</span>", (v = document.createElement("div")).setAttribute("class", "duration"), v.innerHTML = "<span>" + mir_translate("Duration") + "</span>", (h = document.createElement("div")).setAttribute("class", "finished"), h.innerHTML = "<span>" + mir_translate("Finished") + "</span>", (g = document.createElement("li")).setAttribute("class", "head"), g.appendChild(_), g.appendChild(p), g.appendChild(c), g.appendChild(v), g.appendChild(h), u.appendChild(g); for (a = 0; a < e.log.length;) { var _, p, c, v, h, g; (_ = document.createElement("div")).setAttribute("class", "state"), _.innerHTML = "<span>" + e.log[a].state + "</span>", (p = document.createElement("div")).setAttribute("class", "description"), p.innerHTML = e.log[a].description, (c = document.createElement("div")).setAttribute("class", "started"), c.innerHTML = e.log[a].started, (v = document.createElement("div")).setAttribute("class", "duration"), v.innerHTML = e.log[a].duration, (h = document.createElement("div")).setAttribute("class", "finished"), h.innerHTML = e.log[a].finished, (g = document.createElement("li")).setAttribute("data-state", e.log[a].state), g.appendChild(_), g.appendChild(p), g.appendChild(c), g.appendChild(v), g.appendChild(h), u.appendChild(g), a++ } } var b = document.createElement("ul"); b.setAttribute("class", "buttonlist"), i.appendChild(b); var w = document.createElement("li"); w.setAttribute("data-type", "submit"), w.innerHTML = mir_translate("OK"), b.appendChild(w), w.onclick = function () { document.getElementById("missiondetailsoverlay").parentNode.removeChild(parent.document.getElementById("missiondetailsoverlay")), document.getElementsByTagName("body")[0].setAttribute("data-mobile-dialogue", "false") } } else launch_error(mir_translate("The mission's data could not be loaded.")) } }), !0 } function clean_mission_action_data(e) { var t = JSON.parse(JSON.stringify(e)); return t.forEach(({ data: e }) => { Array.isArray(e.info.parameters) && e.info.parameters.forEach(e => { delete e.help, delete e.options, delete e.null_option, delete e.name }) }), t }
/*! sprintf-js v1.1.1 | Copyright (c) 2007-present, Alexandru MÄƒrÄƒÈ™teanu <hello@alexei.ro> | BSD-3-Clause */
!function () { "use strict"; function e(e) { return r(n(e), arguments) } function t(t, r) { return e.apply(null, [t].concat(r || [])) } function r(t, r) { var n, i, a, o, p, c, u, f, l, d = 1, g = t.length, b = ""; for (i = 0; i < g; i++)if ("string" == typeof t[i]) b += t[i]; else if (Array.isArray(t[i])) { if ((o = t[i])[2]) for (n = r[d], a = 0; a < o[2].length; a++) { if (!n.hasOwnProperty(o[2][a])) throw new Error(e('[sprintf] property "%s" does not exist', o[2][a])); n = n[o[2][a]] } else n = o[1] ? r[o[1]] : r[d++]; if (s.not_type.test(o[8]) && s.not_primitive.test(o[8]) && n instanceof Function && (n = n()), s.numeric_arg.test(o[8]) && "number" != typeof n && isNaN(n)) throw new TypeError(e("[sprintf] expecting number but found %T", n)); switch (s.number.test(o[8]) && (f = n >= 0), o[8]) { case "b": n = parseInt(n, 10).toString(2); break; case "c": n = String.fromCharCode(parseInt(n, 10)); break; case "d": case "i": n = parseInt(n, 10); break; case "j": n = JSON.stringify(n, null, o[6] ? parseInt(o[6]) : 0); break; case "e": n = o[7] ? parseFloat(n).toExponential(o[7]) : parseFloat(n).toExponential(); break; case "f": n = o[7] ? parseFloat(n).toFixed(o[7]) : parseFloat(n); break; case "g": n = o[7] ? String(Number(n.toPrecision(o[7]))) : parseFloat(n); break; case "o": n = (parseInt(n, 10) >>> 0).toString(8); break; case "s": n = String(n), n = o[7] ? n.substring(0, o[7]) : n; break; case "t": n = String(!!n), n = o[7] ? n.substring(0, o[7]) : n; break; case "T": n = Object.prototype.toString.call(n).slice(8, -1).toLowerCase(), n = o[7] ? n.substring(0, o[7]) : n; break; case "u": n = parseInt(n, 10) >>> 0; break; case "v": n = n.valueOf(), n = o[7] ? n.substring(0, o[7]) : n; break; case "x": n = (parseInt(n, 10) >>> 0).toString(16); break; case "X": n = (parseInt(n, 10) >>> 0).toString(16).toUpperCase() }s.json.test(o[8]) ? b += n : (!s.number.test(o[8]) || f && !o[3] ? l = "" : (l = f ? "+" : "-", n = n.toString().replace(s.sign, "")), c = o[4] ? "0" === o[4] ? "0" : o[4].charAt(1) : " ", u = o[6] - (l + n).length, p = o[6] && u > 0 ? c.repeat(u) : "", b += o[5] ? l + n + p : "0" === c ? l + p + n : p + l + n) } return b } function n(e) { if (i[e]) return i[e]; for (var t, r = e, n = [], a = 0; r;) { if (null !== (t = s.text.exec(r))) n.push(t[0]); else if (null !== (t = s.modulo.exec(r))) n.push("%"); else { if (null === (t = s.placeholder.exec(r))) throw new SyntaxError("[sprintf] unexpected placeholder"); if (t[2]) { a |= 1; var o = [], p = t[2], c = []; if (null === (c = s.key.exec(p))) throw new SyntaxError("[sprintf] failed to parse named argument key"); for (o.push(c[1]); "" !== (p = p.substring(c[0].length));)if (null !== (c = s.key_access.exec(p))) o.push(c[1]); else { if (null === (c = s.index_access.exec(p))) throw new SyntaxError("[sprintf] failed to parse named argument key"); o.push(c[1]) } t[2] = o } else a |= 2; if (3 === a) throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported"); n.push(t) } r = r.substring(t[0].length) } return i[e] = n } var s = { not_string: /[^s]/, not_bool: /[^t]/, not_type: /[^T]/, not_primitive: /[^v]/, number: /[diefg]/, numeric_arg: /[bcdiefguxX]/, json: /[j]/, not_json: /[^j]/, text: /^[^\x25]+/, modulo: /^\x25{2}/, placeholder: /^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/, key: /^([a-z_][a-z_\d]*)/i, key_access: /^\.([a-z_][a-z_\d]*)/i, index_access: /^\[(\d+)\]/, sign: /^[\+\-]/ }, i = Object.create(null); "undefined" != typeof exports && (exports.sprintf = e, exports.vsprintf = t), "undefined" != typeof window && (window.sprintf = e, window.vsprintf = t, "function" == typeof define && define.amd && define((function () { return { sprintf: e, vsprintf: t } }))) }();
var BluetoothDataGetter = BluetoothDataGetter || { refreshHandler: null, subscribers: {}, REFRESH_INTERVAL: 1500, lastData: !1, consts: { BLUETOOTH_DEVICE_DONE: 0, BLUETOOTH_DEVICE_SCANNING: 1, BLUETOOTH_DEVICE_CONNECTING: 2, BLUETOOTH_DEVICE_ERROR: 3, RELAY_STATUS_CONNECTED: 0, RELAY_STATUS_CONNECTING: 1, RELAY_STATUS_ERROR: 2, RELAY_STATUS_DISCONNECTED: 3 }, updateData: function () { $.getJSON("/?mode=bt-get&calltype=light", (function (t) { BluetoothDataGetter.lastData = t, BluetoothDataGetter.updateSubscribers() })) }, updateSubscribers: function () { $.each(BluetoothDataGetter.subscribers, (function (t, e) { e(BluetoothDataGetter.lastData) })) }, subscribe: function (t, e, a) { BluetoothDataGetter.subscribers[t] = e, a && BluetoothDataGetter.lastData && e(BluetoothDataGetter.lastData) }, unsubscribe: function (t) { delete BluetoothDataGetter.subscribers[t], 0 === BluetoothDataGetter.subscribers.length && BluetoothDataGetter.stop() }, start: function () { null === BluetoothDataGetter.refreshHandler && (BluetoothDataGetter.refreshHandler = setInterval(BluetoothDataGetter.updateData, BluetoothDataGetter.REFRESH_INTERVAL)) }, stop: function () { clearInterval(BluetoothDataGetter.refreshHandler), BluetoothDataGetter.refreshHandler = null } };
var HookDataGetter = HookDataGetter || { refreshHandler: null, inited: !1, subscribers: {}, REFRESH_INTERVAL: 1e3, lastData: !1, request: null, consts: { GRIPPER: { UNKNOWN: 0, HOMING: 1, OPEN: 2, OPENING: 3, CLOSED: 4, CLOSING: 6, ERROR: 9 }, BRAKE: { UNKNOWN: 0, INITIALIZING: 1, HOMING: 2, ACTIVE: 3, INACTIVE: 4, ACTIVATING: 5, DEACTIVATING: 6, ERROR: 7 }, HEIGHT: { CHANGING: 2, ERROR: 3 } }, hook_services: { set_height: new ROSLIB.Service({ ros: ros, name: "/hook/height/cmd/start", serviceType: "mir_hook_shared_interface/ActionGoalHookHeight" }), stop_height: new ROSLIB.Service({ ros: ros, name: "/hook/height/cmd/stop", serviceType: "mir_action_interface/MirActionStop" }) }, topics: { data: new ROSLIB.Topic({ ros: ros, name: "/hook/data", messageType: "mir_hook_shared_interface/HookData", throttle_rate: 100 }), marker: new ROSLIB.Topic({ ros: ros, name: "/hook/qr_markers", messageType: "geometry_msgs/TransformStamped" }), param_updater: new ROSLIB.Topic({ ros: ros, name: "/param_manager_update", messageType: "mir_param_interface/RosParamListUpdate" }) }, params: { trolley_attached: !1 }, updateData: function () { }, updateSubscribers: function () { $.each(HookDataGetter.subscribers, (function (e, t) { t(HookDataGetter.lastData) })) }, is_subscribed: function (e) { return void 0 !== HookDataGetter.subscribers[e] }, subscribe: function (e, t, a) { HookDataGetter.subscribers[e] = t, a && HookDataGetter.lastData && t(HookDataGetter.lastData) }, unsubscribe: function (e) { delete HookDataGetter.subscribers[e], 0 === HookDataGetter.subscribers.length && HookDataGetter.stop() }, start: function () { null === HookDataGetter.refreshHandler && (HookDataGetter.refreshHandler = setInterval(HookDataGetter.updateData, HookDataGetter.REFRESH_INTERVAL)) }, stop: function () { clearInterval(HookDataGetter.refreshHandler), HookDataGetter.refreshHandler = null }, init_params: function () { HookDataGetter.inited || (new ROSLIB.Param({ ros: ros, name: "/hook/status/trolley_attached" }).get((function (e) { HookDataGetter.params.trolley_attached = e })), HookDataGetter.topics.param_updater.subscribe((function (e) { e.list.forEach((function (e) { "/hook/status/trolley_attached" === e.name && (HookDataGetter.params.trolley_attached = "true" === e.value) })) })), HookDataGetter.inited = !0) } };